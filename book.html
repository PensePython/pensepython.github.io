<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Preface &mdash; Pense Python 2e documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2e',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Pense Python 2e documentation" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>[chapter]</p>
<div class="line-block">
<div class="line">3 Think Python</div>
<div class="line">How to Think Like a Computer Scientist</div>
</div>
<p>2nd Edition, Version 2.2.14</p>
<div class="line-block">
<div class="line">3 Think Python</div>
<div class="line">How to Think Like a Computer Scientist</div>
</div>
<p>2nd Edition, Version 2.2.14</p>
<p>Allen Downey</p>
<p>Green Tea Press</p>
<p>Needham, Massachusetts</p>
<p>Copyright ©&nbsp;2015 Allen Downey.</p>
<div class="line-block">
<div class="line">Green Tea Press</div>
<div class="line">9 Washburn Ave</div>
<div class="line">Needham MA 02492</div>
</div>
<p>Permission is granted to copy, distribute, and/or modify this document
under the terms of the Creative Commons Attribution-NonCommercial 3.0
Unported License, which is available at
<a class="reference external" href="http://creativecommons.org/licenses/by-nc/3.0/">http://creativecommons.org/licenses/by-nc/3.0/</a>.</p>
<p>The original form of this book is LaTeX&nbsp;source code. Compiling this
LaTeX&nbsp;source has the effect of generating a device-independent
representation of a textbook, which can be converted to other formats
and printed.</p>
<p>The LaTeX&nbsp;source for this book is available from
<a class="reference external" href="http://www.thinkpython2.com">http://www.thinkpython2.com</a></p>
<p>Think Python: How to Think Like a Computer Scientist</p>
<p>Allen B. Downey</p>
<p>2nd Edition, Version 2.2.14</p>
<div class="section" id="preface">
<h1>Preface<a class="headerlink" href="#preface" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-strange-history-of-this-book">
<h2>The strange history of this book<a class="headerlink" href="#the-strange-history-of-this-book" title="Permalink to this headline">¶</a></h2>
<p>In January 1999 I was preparing to teach an introductory programming
class in Java. I had taught it three times and I was getting frustrated.
The failure rate in the class was too high and, even for students who
succeeded, the overall level of achievement was too low.</p>
<p>One of the problems I saw was the books. They were too big, with too
much unnecessary detail about Java, and not enough high-level guidance
about how to program. And they all suffered from the trap door effect:
they would start out easy, proceed gradually, and then somewhere around
Chapter 5 the bottom would fall out. The students would get too much new
material, too fast, and I would spend the rest of the semester picking
up the pieces.</p>
<p>Two weeks before the first day of classes, I decided to write my own
book. My goals were:</p>
<ul class="simple">
<li>Keep it short. It is better for students to read 10 pages than not
read 50 pages.</li>
<li>Be careful with vocabulary. I tried to minimize jargon and define
each term at first use.</li>
<li>Build gradually. To avoid trap doors, I took the most difficult
topics and split them into a series of small steps.</li>
<li>Focus on programming, not the programming language. I included the
minimum useful subset of Java and left out the rest.</li>
</ul>
<p>I needed a title, so on a whim I chose <em>How to Think Like a Computer
Scientist</em>.</p>
<p>My first version was rough, but it worked. Students did the reading, and
they understood enough that I could spend class time on the hard topics,
the interesting topics and (most important) letting the students
practice.</p>
<p>I released the book under the GNU Free Documentation License, which
allows users to copy, modify, and distribute the book.</p>
<p>What happened next is the cool part. Jeff Elkner, a high school teacher
in Virginia, adopted my book and translated it into Python. He sent me a
copy of his translation, and I had the unusual experience of learning
Python by reading my own book. As Green Tea Press, I published the first
Python version in 2001.</p>
<p>In 2003 I started teaching at Olin College and I got to teach Python for
the first time. The contrast with Java was striking. Students struggled
less, learned more, worked on more interesting projects, and generally
had a lot more fun.</p>
<p>Since then I’ve continued to develop the book, correcting errors,
improving some of the examples and adding material, especially
exercises.</p>
<p>The result is this book, now with the less grandiose title <em>Think
Python</em>. Some of the changes are:</p>
<ul class="simple">
<li>I added a section about debugging at the end of each chapter. These
sections present general techniques for finding and avoiding bugs,
and warnings about Python pitfalls.</li>
<li>I added more exercises, ranging from short tests of understanding to
a few substantial projects. Most exercises include a link to my
solution.</li>
<li>I added a series of case studies—longer examples with exercises,
solutions, and discussion.</li>
<li>I expanded the discussion of program development plans and basic
design patterns.</li>
<li>I added appendices about debugging and analysis of algorithms.</li>
</ul>
<p>The second edition of <em>Think Python</em> has these new features:</p>
<ul class="simple">
<li>The book and all supporting code have been updated to Python 3.</li>
<li>I added a few sections, and more details on the web, to help
beginners get started running Python in a browser, so you don’t have
to deal with installing Python until you want to.</li>
<li>For Chapter&nbsp;[turtle] I switched from my own turtle graphics package,
called Swampy, to a more standard Python module, turtle, which is
easier to install and more powerful.</li>
<li>I added a new chapter called “The Goodies”, which introduces some
additional Python features that are not strictly necessary, but
sometimes handy.</li>
</ul>
<p>I hope you enjoy working with this book, and that it helps you learn to
program and think like a computer scientist, at least a little bit.</p>
<div class="line-block">
<div class="line">Allen B. Downey</div>
<div class="line">Olin College</div>
</div>
</div>
<div class="section" id="acknowledgments">
<h2>Acknowledgments<a class="headerlink" href="#acknowledgments" title="Permalink to this headline">¶</a></h2>
<p>Many thanks to Jeff Elkner, who translated my Java book into Python,
which got this project started and introduced me to what has turned out
to be my favorite language.</p>
<p>Thanks also to Chris Meyers, who contributed several sections to <em>How to
Think Like a Computer Scientist</em>.</p>
<p>Thanks to the Free Software Foundation for developing the GNU Free
Documentation License, which helped make my collaboration with Jeff and
Chris possible, and Creative Commons for the license I am using now.</p>
<p>Thanks to the editors at Lulu who worked on <em>How to Think Like a
Computer Scientist</em>.</p>
<p>Thanks to the editors at O’Reilly Media who worked on <em>Think Python</em>.</p>
<p>Thanks to all the students who worked with earlier versions of this book
and all the contributors (listed below) who sent in corrections and
suggestions.</p>
</div>
<div class="section" id="contributor-list">
<h2>Contributor List<a class="headerlink" href="#contributor-list" title="Permalink to this headline">¶</a></h2>
<p>More than 100 sharp-eyed and thoughtful readers have sent in suggestions
and corrections over the past few years. Their contributions, and
enthusiasm for this project, have been a huge help.</p>
<p>If you have a suggestion or correction, please send email to
<a class="reference external" href="mailto:feedback&#37;&#52;&#48;thinkpython&#46;com">feedback<span>&#64;</span>thinkpython<span>&#46;</span>com</a>. If I make a change based on your feedback, I
will add you to the contributor list (unless you ask to be omitted).</p>
<p>If you include at least part of the sentence the error appears in, that
makes it easy for me to search. Page and section numbers are fine, too,
but not quite as easy to work with. Thanks!</p>
<ul class="simple">
<li>Lloyd Hugh Allen sent in a correction to Section 8.4.</li>
<li>Yvon Boulianne sent in a correction of a semantic error in Chapter 5.</li>
<li>Fred Bremmer submitted a correction in Section 2.1.</li>
<li>Jonah Cohen wrote the Perl scripts to convert the LaTeX source for
this book into beautiful HTML.</li>
<li>Michael Conlon sent in a grammar correction in Chapter 2 and an
improvement in style in Chapter 1, and he initiated discussion on the
technical aspects of interpreters.</li>
<li>Benoit Girard sent in a correction to a humorous mistake in Section
5.6.</li>
<li>Courtney Gleason and Katherine Smith wrote horsebet.py, which was
used as a case study in an earlier version of the book. Their program
can now be found on the website.</li>
<li>Lee Harr submitted more corrections than we have room to list here,
and indeed he should be listed as one of the principal editors of the
text.</li>
<li>James Kaylin is a student using the text. He has submitted numerous
corrections.</li>
<li>David Kershaw fixed the broken catTwice function in Section 3.10.</li>
<li>Eddie Lam has sent in numerous corrections to Chapters 1, 2, and 3.
He also fixed the Makefile so that it creates an index the first time
it is run and helped us set up a versioning scheme.</li>
<li>Man-Yong Lee sent in a correction to the example code in Section 2.4.</li>
<li>David Mayo pointed out that the word ``unconsciously“ in Chapter 1
needed to be changed to ``subconsciously”.</li>
<li>Chris McAloon sent in several corrections to Sections 3.9 and 3.10.</li>
<li>Matthew J. Moelter has been a long-time contributor who sent in
numerous corrections and suggestions to the book.</li>
<li>Simon Dicon Montford reported a missing function definition and
several typos in Chapter 3. He also found errors in the increment
function in Chapter 13.</li>
<li>John Ouzts corrected the definition of ``return value&#8221; in Chapter
3.</li>
<li>Kevin Parks sent in valuable comments and suggestions as to how to
improve the distribution of the book.</li>
<li>David Pool sent in a typo in the glossary of Chapter 1, as well as
kind words of encouragement.</li>
<li>Michael Schmitt sent in a correction to the chapter on files and
exceptions.</li>
<li>Robin Shaw pointed out an error in Section 13.1, where the printTime
function was used in an example without being defined.</li>
<li>Paul Sleigh found an error in Chapter 7 and a bug in Jonah Cohen’s
Perl script that generates HTML from LaTeX.</li>
<li>Craig T. Snydal is testing the text in a course at Drew University.
He has contributed several valuable suggestions and corrections.</li>
<li>Ian Thomas and his students are using the text in a programming
course. They are the first ones to test the chapters in the latter
half of the book, and they have made numerous corrections and
suggestions.</li>
<li>Keith Verheyden sent in a correction in Chapter 3.</li>
<li>Peter Winstanley let us know about a longstanding error in our Latin
in Chapter 3.</li>
<li>Chris Wrobel made corrections to the code in the chapter on file I/O
and exceptions.</li>
<li>Moshe Zadka has made invaluable contributions to this project. In
addition to writing the first draft of the chapter on Dictionaries,
he provided continual guidance in the early stages of the book.</li>
<li>Christoph Zwerschke sent several corrections and pedagogic
suggestions, and explained the difference between <em>gleich</em> and
<em>selbe</em>.</li>
<li>James Mayer sent us a whole slew of spelling and typographical
errors, including two in the contributor list.</li>
<li>Hayden McAfee caught a potentially confusing inconsistency between
two examples.</li>
<li>Angel Arnal is part of an international team of translators working
on the Spanish version of the text. He has also found several errors
in the English version.</li>
<li>Tauhidul Hoque and Lex Berezhny created the illustrations in Chapter
1 and improved many of the other illustrations.</li>
<li>Dr. Michele Alzetta caught an error in Chapter 8 and sent some
interesting pedagogic comments and suggestions about Fibonacci and
Old Maid.</li>
<li>Andy Mitchell caught a typo in Chapter 1 and a broken example in
Chapter 2.</li>
<li>Kalin Harvey suggested a clarification in Chapter 7 and caught some
typos.</li>
<li>Christopher P. Smith caught several typos and helped us update the
book for Python 2.2.</li>
<li>David Hutchins caught a typo in the Foreword.</li>
<li>Gregor Lingl is teaching Python at a high school in Vienna, Austria.
He is working on a German translation of the book, and he caught a
couple of bad errors in Chapter 5.</li>
<li>Julie Peters caught a typo in the Preface.</li>
<li>Florin Oprina sent in an improvement in makeTime, a correction in
printTime, and a nice typo.</li>
<li>D.&nbsp;J.&nbsp;Webre suggested a clarification in Chapter 3.</li>
<li>Ken found a fistful of errors in Chapters 8, 9 and 11.</li>
<li>Ivo Wever caught a typo in Chapter 5 and suggested a clarification in
Chapter 3.</li>
<li>Curtis Yanko suggested a clarification in Chapter 2.</li>
<li>Ben Logan sent in a number of typos and problems with translating the
book into HTML.</li>
<li>Jason Armstrong saw the missing word in Chapter 2.</li>
<li>Louis Cordier noticed a spot in Chapter 16 where the code didn’t
match the text.</li>
<li>Brian Cain suggested several clarifications in Chapters 2 and 3.</li>
<li>Rob Black sent in a passel of corrections, including some changes for
Python 2.2.</li>
<li>Jean-Philippe Rey at Ecole Centrale Paris sent a number of patches,
including some updates for Python 2.2 and other thoughtful
improvements.</li>
<li>Jason Mader at George Washington University made a number of useful
suggestions and corrections.</li>
<li>Jan Gundtofte-Bruun reminded us that “a error” is an error.</li>
<li>Abel David and Alexis Dinno reminded us that the plural of “matrix”
is “matrices”, not “matrixes”. This error was in the book for years,
but two readers with the same initials reported it on the same day.
Weird.</li>
<li>Charles Thayer encouraged us to get rid of the semi-colons we had put
at the ends of some statements and to clean up our use of “argument”
and “parameter”.</li>
<li>Roger Sperberg pointed out a twisted piece of logic in Chapter 3.</li>
<li>Sam Bull pointed out a confusing paragraph in Chapter 2.</li>
<li>Andrew Cheung pointed out two instances of “use before def”.</li>
<li>C. Corey Capel spotted the missing word in the Third Theorem of
Debugging and a typo in Chapter 4.</li>
<li>Alessandra helped clear up some Turtle confusion.</li>
<li>Wim Champagne found a brain-o in a dictionary example.</li>
<li>Douglas Wright pointed out a problem with floor division in arc.</li>
<li>Jared Spindor found some jetsam at the end of a sentence.</li>
<li>Lin Peiheng sent a number of very helpful suggestions.</li>
<li>Ray Hagtvedt sent in two errors and a not-quite-error.</li>
<li>Torsten Hübsch pointed out an inconsistency in Swampy.</li>
<li>Inga Petuhhov corrected an example in Chapter 14.</li>
<li>Arne Babenhauserheide sent several helpful corrections.</li>
<li>Mark E. Casida is is good at spotting repeated words.</li>
<li>Scott Tyler filled in a that was missing. And then sent in a heap of
corrections.</li>
<li>Gordon Shephard sent in several corrections, all in separate emails.</li>
<li>Andrew Turner spotted an error in Chapter 8.</li>
<li>Adam Hobart fixed a problem with floor division in arc.</li>
<li>Daryl Hammond and Sarah Zimmerman pointed out that I served up
math.pi too early. And Zim spotted a typo.</li>
<li>George Sass found a bug in a Debugging section.</li>
<li>Brian Bingham suggested Exercise&nbsp;[exrotatepairs].</li>
<li>Leah Engelbert-Fenton pointed out that I used tuple as a variable
name, contrary to my own advice. And then found a bunch of typos and
a “use before def”.</li>
<li>Joe Funke spotted a typo.</li>
<li>Chao-chao Chen found an inconsistency in the Fibonacci example.</li>
<li>Jeff Paine knows the difference between space and spam.</li>
<li>Lubos Pintes sent in a typo.</li>
<li>Gregg Lind and Abigail Heithoff suggested Exercise&nbsp;[checksum].</li>
<li>Max Hailperin has sent in a number of corrections and suggestions.
Max is one of the authors of the extraordinary <em>Concrete
Abstractions</em>, which you might want to read when you are done with
this book.</li>
<li>Chotipat Pornavalai found an error in an error message.</li>
<li>Stanislaw Antol sent a list of very helpful suggestions.</li>
<li>Eric Pashman sent a number of corrections for Chapters 4–11.</li>
<li>Miguel Azevedo found some typos.</li>
<li>Jianhua Liu sent in a long list of corrections.</li>
<li>Nick King found a missing word.</li>
<li>Martin Zuther sent a long list of suggestions.</li>
<li>Adam Zimmerman found an inconsistency in my instance of an “instance”
and several other errors.</li>
<li>Ratnakar Tiwari suggested a footnote explaining degenerate triangles.</li>
<li>Anurag Goel suggested another solution for <code class="docutils literal"><span class="pre">is_abecedarian</span></code> and
sent some additional corrections. And he knows how to spell Jane
Austen.</li>
<li>Kelli Kratzer spotted one of the typos.</li>
<li>Mark Griffiths pointed out a confusing example in Chapter 3.</li>
<li>Roydan Ongie found an error in my Newton’s method.</li>
<li>Patryk Wolowiec helped me with a problem in the HTML version.</li>
<li>Mark Chonofsky told me about a new keyword in Python 3.</li>
<li>Russell Coleman helped me with my geometry.</li>
<li>Wei Huang spotted several typographical errors.</li>
<li>Karen Barber spotted the the oldest typo in the book.</li>
<li>Nam Nguyen found a typo and pointed out that I used the Decorator
pattern but didn’t mention it by name.</li>
<li>Stéphane Morin sent in several corrections and suggestions.</li>
<li>Paul Stoop corrected a typo in <code class="docutils literal"><span class="pre">uses_only</span></code>.</li>
<li>Eric Bronner pointed out a confusion in the discussion of the order
of operations.</li>
<li>Alexandros Gezerlis set a new standard for the number and quality of
suggestions he submitted. We are deeply grateful!</li>
<li>Gray Thomas knows his right from his left.</li>
<li>Giovanni Escobar Sosa sent a long list of corrections and
suggestions.</li>
<li>Alix Etienne fixed one of the URLs.</li>
<li>Kuang He found a typo.</li>
<li>Daniel Neilson corrected an error about the order of operations.</li>
<li>Will McGinnis pointed out that polyline was defined differently in
two places.</li>
<li>Swarup Sahoo spotted a missing semi-colon.</li>
<li>Frank Hecker pointed out an exercise that was under-specified, and
some broken links.</li>
<li>Animesh B helped me clean up a confusing example.</li>
<li>Martin Caspersen found two round-off errors.</li>
<li>Gregor Ulm sent several corrections and suggestions.</li>
<li>Dimitrios Tsirigkas suggested I clarify an exercise.</li>
<li>Carlos Tafur sent a page of corrections and suggestions.</li>
<li>Martin Nordsletten found a bug in an exercise solution.</li>
<li>Lars O.D. Christensen found a broken reference.</li>
<li>Victor Simeone found a typo.</li>
<li>Sven Hoexter pointed out that a variable named input shadows a
build-in function.</li>
<li>Viet Le found a typo.</li>
<li>Stephen Gregory pointed out the problem with cmp in Python 3.</li>
<li>Matthew Shultz let me know about a broken link.</li>
<li>Lokesh Kumar Makani let me know about some broken links and some
changes in error messages.</li>
<li>Ishwar Bhat corrected my statement of Fermat’s last theorem.</li>
<li>Brian McGhie suggested a clarification.</li>
<li>Andrea Zanella translated the book into Italian, and sent a number of
corrections along the way.</li>
<li>Many, many thanks to Melissa Lewis and Luciano Ramalho for excellent
comments and suggestions on the second edition.</li>
<li>Thanks to Harry Percival from PythonAnywhere for his help getting
people started running Python in a browser.</li>
<li>Xavier Van Aubel made several useful corrections in the second
edition.</li>
</ul>
</div>
</div>
<div class="section" id="the-way-of-the-program">
<h1>The way of the program<a class="headerlink" href="#the-way-of-the-program" title="Permalink to this headline">¶</a></h1>
<p>The goal of this book is to teach you to think like a computer
scientist. This way of thinking combines some of the best features of
mathematics, engineering, and natural science. Like mathematicians,
computer scientists use formal languages to denote ideas (specifically
computations). Like engineers, they design things, assembling components
into systems and evaluating tradeoffs among alternatives. Like
scientists, they observe the behavior of complex systems, form
hypotheses, and test predictions.</p>
<p>The single most important skill for a computer scientist is <strong>problem
solving</strong>. Problem solving means the ability to formulate problems,
think creatively about solutions, and express a solution clearly and
accurately. As it turns out, the process of learning to program is an
excellent opportunity to practice problem-solving skills. That’s why
this chapter is called, “The way of the program”.</p>
<p>On one level, you will be learning to program, a useful skill by itself.
On another level, you will use programming as a means to an end. As we
go along, that end will become clearer.</p>
<div class="section" id="what-is-a-program">
<h2>What is a program?<a class="headerlink" href="#what-is-a-program" title="Permalink to this headline">¶</a></h2>
<p>A <strong>program</strong> is a sequence of instructions that specifies how to
perform a computation. The computation might be something mathematical,
such as solving a system of equations or finding the roots of a
polynomial, but it can also be a symbolic computation, such as searching
and replacing text in a document or something graphical, like processing
an image or playing a video.</p>
<p>The details look different in different languages, but a few basic
instructions appear in just about every language:</p>
<dl class="docutils">
<dt>input:</dt>
<dd>Get data from the keyboard, a file, the network, or some other
device.</dd>
<dt>output:</dt>
<dd>Display data on the screen, save it in a file, send it over the
network, etc.</dd>
<dt>math:</dt>
<dd>Perform basic mathematical operations like addition and
multiplication.</dd>
<dt>conditional execution:</dt>
<dd>Check for certain conditions and run the appropriate code.</dd>
<dt>repetition:</dt>
<dd>Perform some action repeatedly, usually with some variation.</dd>
</dl>
<p>Believe it or not, that’s pretty much all there is to it. Every program
you’ve ever used, no matter how complicated, is made up of instructions
that look pretty much like these. So you can think of programming as the
process of breaking a large, complex task into smaller and smaller
subtasks until the subtasks are simple enough to be performed with one
of these basic instructions.</p>
</div>
<div class="section" id="running-python">
<h2>Running Python<a class="headerlink" href="#running-python" title="Permalink to this headline">¶</a></h2>
<p>One of the challenges of getting started with Python is that you might
have to install Python and related software on your computer. If you are
familiar with your operating system, and especially if you are
comfortable with the command-line interface, you will have no trouble
installing Python. But for beginners, it can be painful to learn about
system administration and programming at the same time.</p>
<p>To avoid that problem, I recommend that you start out running Python in
a browser. Later, when you are comfortable with Python, I’ll make
suggestions for installing Python on your computer.</p>
<p>There are a number of web pages you can use to run Python. If you
already have a favorite, go ahead and use it. Otherwise I recommend
PythonAnywhere. I provide detailed instructions for getting started at
<a class="reference external" href="http://tinyurl.com/thinkpython2e">http://tinyurl.com/thinkpython2e</a>.</p>
<p>There are two versions of Python, called Python 2 and Python 3. They are
very similar, so if you learn one, it is easy to switch to the other. In
fact, there are only a few differences you will encounter as a beginner.
This book is written for Python 3, but I include some notes about Python
2.</p>
<p>The Python <strong>interpreter</strong> is a program that reads and executes Python
code. Depending on your environment, you might start the interpreter by
clicking on an icon, or by typing python on a command line. When it
starts, you should see output like this:</p>
<div class="highlight-python"><div class="highlight"><pre>Python 3.4.0 (default, Jun 19 2015, 14:20:21)
[GCC 4.8.2] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt;
</pre></div>
</div>
<p>The first three lines contain information about the interpreter and the
operating system it’s running on, so it might be different for you. But
you should check that the version number, which is 3.4.0 in this
example, begins with 3, which indicates that you are running Python 3.
If it begins with 2, you are running (you guessed it) Python 2.</p>
<p>The last line is a <strong>prompt</strong> that indicates that the interpreter is
ready for you to enter code. If you type a line of code and hit Enter,
the interpreter displays the result:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span>
<span class="go">2</span>
</pre></div>
</div>
<p>Now you’re ready to get started. From here on, I assume that you know
how to start the Python interpreter and run code.</p>
</div>
<div class="section" id="the-first-program">
<h2>The first program<a class="headerlink" href="#the-first-program" title="Permalink to this headline">¶</a></h2>
<p>Traditionally, the first program you write in a new language is called
“Hello, World!” because all it does is display the words “Hello,
World!”. In Python, it looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;Hello, World!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is an example of a <strong>print statement</strong>, although it doesn’t
actually print anything on paper. It displays a result on the screen. In
this case, the result is the words</p>
<div class="highlight-python"><div class="highlight"><pre>Hello, World!
</pre></div>
</div>
<p>The quotation marks in the program mark the beginning and end of the
text to be displayed; they don’t appear in the result.</p>
<p>The parentheses indicate that print is a function. We’ll get to
functions in Chapter&nbsp;[funcchap].</p>
<p>In Python 2, the print statement is slightly different; it is not a
function, so it doesn’t use parentheses.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;Hello, World!&#39;</span>
</pre></div>
</div>
<p>This distinction will make more sense soon, but that’s enough to get
started.</p>
</div>
<div class="section" id="arithmetic-operators">
<h2>Arithmetic operators<a class="headerlink" href="#arithmetic-operators" title="Permalink to this headline">¶</a></h2>
<p>After “Hello, World”, the next step is arithmetic. Python provides
<strong>operators</strong>, which are special symbols that represent computations
like addition and multiplication.</p>
<p>The operators +, -, and perform addition, subtraction, and
multiplication, as in the following examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">40</span> <span class="o">+</span> <span class="mi">2</span>
<span class="go">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">43</span> <span class="o">-</span> <span class="mi">1</span>
<span class="go">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">6</span> <span class="o">*</span> <span class="mi">7</span>
<span class="go">42</span>
</pre></div>
</div>
<p>The operator / performs division:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">84</span> <span class="o">/</span> <span class="mi">2</span>
<span class="go">42.0</span>
</pre></div>
</div>
<p>You might wonder why the result is 42.0 instead of 42. I’ll explain in
the next section.</p>
<p>Finally, the operator * performs exponentiation; that is, it raises a
number to a power:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">6</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">6</span>
<span class="go">42</span>
</pre></div>
</div>
<p>In some other languages, <code class="docutils literal"><span class="pre">^</span></code> is used for exponentiation, but in Python
it is a bitwise operator called XOR. If you are not familiar with
bitwise operators, the result will surprise you:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">6</span> <span class="o">^</span> <span class="mi">2</span>
<span class="go">4</span>
</pre></div>
</div>
<p>I won’t cover bitwise operators in this book, but you can read about
them at <a class="reference external" href="http://wiki.python.org/moin/BitwiseOperators">http://wiki.python.org/moin/BitwiseOperators</a>.</p>
</div>
<div class="section" id="values-and-types">
<h2>Values and types<a class="headerlink" href="#values-and-types" title="Permalink to this headline">¶</a></h2>
<p>A <strong>value</strong> is one of the basic things a program works with, like a
letter or a number. Some values we have seen so far are 2, 42.0, and
<code class="docutils literal"><span class="pre">'Hello,</span> <span class="pre">World!'</span></code>.</p>
<p>These values belong to different <strong>types</strong>: 2 is an <strong>integer</strong>, 42.0 is
a <strong>floating-point number</strong>, and <code class="docutils literal"><span class="pre">'Hello,</span> <span class="pre">World!'</span></code> is a <strong>string</strong>,
so-called because the letters it contains are strung together.</p>
<p>If you are not sure what type a value has, the interpreter can tell you:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">&lt;class &#39;int&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="mf">42.0</span><span class="p">)</span>
<span class="go">&lt;class &#39;float&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="s">&#39;Hello, World!&#39;</span><span class="p">)</span>
<span class="go">&lt;class &#39;str&#39;&gt;</span>
</pre></div>
</div>
<p>In these results, the word “class” is used in the sense of a category; a
type is a category of values.</p>
<p>Not surprisingly, integers belong to the type int, strings belong to str
and floating-point numbers belong to float.</p>
<p>What about values like <code class="docutils literal"><span class="pre">'2'</span></code> and <code class="docutils literal"><span class="pre">'42.0'</span></code>? They look like numbers,
but they are in quotation marks like strings.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="s">&#39;2&#39;</span><span class="p">)</span>
<span class="go">&lt;class &#39;str&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="s">&#39;42.0&#39;</span><span class="p">)</span>
<span class="go">&lt;class &#39;str&#39;&gt;</span>
</pre></div>
</div>
<p>They’re strings.</p>
<p>When you type a large integer, you might be tempted to use commas
between groups of digits, as in 1,000,000. This is not a legal <em>integer</em>
in Python, but it is legal:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span><span class="p">,</span><span class="mo">000</span><span class="p">,</span><span class="mo">000</span>
<span class="go">(1, 0, 0)</span>
</pre></div>
</div>
<p>That’s not what we expected at all! Python interprets 1,000,000 as a
comma-separated sequence of integers. We’ll learn more about this kind
of sequence later.</p>
</div>
<div class="section" id="formal-and-natural-languages">
<h2>Formal and natural languages<a class="headerlink" href="#formal-and-natural-languages" title="Permalink to this headline">¶</a></h2>
<p><strong>Natural languages</strong> are the languages people speak, such as English,
Spanish, and French. They were not designed by people (although people
try to impose some order on them); they evolved naturally.</p>
<p><strong>Formal languages</strong> are languages that are designed by people for
specific applications. For example, the notation that mathematicians use
is a formal language that is particularly good at denoting relationships
among numbers and symbols. Chemists use a formal language to represent
the chemical structure of molecules. And most importantly:</p>
<blockquote>
<div><strong>Programming languages are formal languages that have been designed
to express computations.</strong></div></blockquote>
<p>Formal languages tend to have strict <strong>syntax</strong> rules that govern the
structure of statements. For example, in mathematics the statement
<span class="math">3 + 3 = 6</span> has correct syntax, but <span class="math">3 + = 3 \$ 6</span> does not.
In chemistry <span class="math">H_2O</span> is a syntactically correct formula, but
<span class="math">_2Zz</span> is not.</p>
<p>Syntax rules come in two flavors, pertaining to <strong>tokens</strong> and
structure. Tokens are the basic elements of the language, such as words,
numbers, and chemical elements. One of the problems with
<span class="math">3 += 3 \$ 6</span> is that :math:` $ ` is not a legal token in
mathematics (at least as far as I know). Similarly, <span class="math">_2Zz</span> is not
legal because there is no element with the abbreviation <span class="math">Zz</span>.</p>
<p>The second type of syntax rule pertains to the way tokens are combined.
The equation <span class="math">3 += 3</span> is illegal because even though <span class="math">+</span> and
<span class="math">=</span> are legal tokens, you can’t have one right after the other.
Similarly, in a chemical formula the subscript comes after the element
name, not before.</p>
<p>This is &#64; well-structured Engli$h sentence with invalid t*kens in it.
This sentence all valid tokens has, but invalid structure with.</p>
<p>When you read a sentence in English or a statement in a formal language,
you have to figure out the structure (although in a natural language you
do this subconsciously). This process is called <strong>parsing</strong>.</p>
<p>Although formal and natural languages have many features in
common—tokens, structure, and syntax—there are some differences:</p>
<dl class="docutils">
<dt>ambiguity:</dt>
<dd>Natural languages are full of ambiguity, which people deal with by
using contextual clues and other information. Formal languages are
designed to be nearly or completely unambiguous, which means that
any statement has exactly one meaning, regardless of context.</dd>
<dt>redundancy:</dt>
<dd>In order to make up for ambiguity and reduce misunderstandings,
natural languages employ lots of redundancy. As a result, they are
often verbose. Formal languages are less redundant and more concise.</dd>
<dt>literalness:</dt>
<dd>Natural languages are full of idiom and metaphor. If I say, “The
penny dropped”, there is probably no penny and nothing dropping
(this idiom means that someone understood something after a period
of confusion). Formal languages mean exactly what they say.</dd>
</dl>
<p>Because we all grow up speaking natural languages, it is sometimes hard
to adjust to formal languages. The difference between formal and natural
language is like the difference between poetry and prose, but more so:</p>
<dl class="docutils">
<dt>Poetry:</dt>
<dd>Words are used for their sounds as well as for their meaning, and
the whole poem together creates an effect or emotional response.
Ambiguity is not only common but often deliberate.</dd>
<dt>Prose:</dt>
<dd>The literal meaning of words is more important, and the structure
contributes more meaning. Prose is more amenable to analysis than
poetry but still often ambiguous.</dd>
<dt>Programs:</dt>
<dd>The meaning of a computer program is unambiguous and literal, and
can be understood entirely by analysis of the tokens and structure.</dd>
</dl>
<p>Formal languages are more dense than natural languages, so it takes
longer to read them. Also, the structure is important, so it is not
always best to read from top to bottom, left to right. Instead, learn to
parse the program in your head, identifying the tokens and interpreting
the structure. Finally, the details matter. Small errors in spelling and
punctuation, which you can get away with in natural languages, can make
a big difference in a formal language.</p>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>Programmers make mistakes. For whimsical reasons, programming errors are
called <strong>bugs</strong> and the process of tracking them down is called
<strong>debugging</strong>.</p>
<p>Programming, and especially debugging, sometimes brings out strong
emotions. If you are struggling with a difficult bug, you might feel
angry, despondent, or embarrassed.</p>
<p>There is evidence that people naturally respond to computers as if they
were people. When they work well, we think of them as teammates, and
when they are obstinate or rude, we respond to them the same way we
respond to rude, obstinate people (Reeves and Nass, <em>The Media Equation:
How People Treat Computers, Television, and New Media Like Real People
and Places</em>).</p>
<p>Preparing for these reactions might help you deal with them. One
approach is to think of the computer as an employee with certain
strengths, like speed and precision, and particular weaknesses, like
lack of empathy and inability to grasp the big picture.</p>
<p>Your job is to be a good manager: find ways to take advantage of the
strengths and mitigate the weaknesses. And find ways to use your
emotions to engage with the problem, without letting your reactions
interfere with your ability to work effectively.</p>
<p>Learning to debug can be frustrating, but it is a valuable skill that is
useful for many activities beyond programming. At the end of each
chapter there is a section, like this one, with my suggestions for
debugging. I hope they help!</p>
</div>
<div class="section" id="glossary">
<h2>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>problem solving:</dt>
<dd>The process of formulating a problem, finding a solution, and
expressing it.</dd>
<dt>high-level language:</dt>
<dd>A programming language like Python that is designed to be easy for
humans to read and write.</dd>
<dt>low-level language:</dt>
<dd>A programming language that is designed to be easy for a computer to
run; also called “machine language” or “assembly language”.</dd>
<dt>portability:</dt>
<dd>A property of a program that can run on more than one kind of
computer.</dd>
<dt>interpreter:</dt>
<dd>A program that reads another program and executes it</dd>
<dt>prompt:</dt>
<dd>Characters displayed by the interpreter to indicate that it is ready
to take input from the user.</dd>
<dt>program:</dt>
<dd>A set of instructions that specifies a computation.</dd>
<dt>print statement:</dt>
<dd>An instruction that causes the Python interpreter to display a value
on the screen.</dd>
<dt>operator:</dt>
<dd>A special symbol that represents a simple computation like addition,
multiplication, or string concatenation.</dd>
<dt>value:</dt>
<dd>One of the basic units of data, like a number or string, that a
program manipulates.</dd>
<dt>type:</dt>
<dd>A category of values. The types we have seen so far are integers
(type int), floating-point numbers (type float), and strings (type
str).</dd>
<dt>integer:</dt>
<dd>A type that represents whole numbers.</dd>
<dt>floating-point:</dt>
<dd>A type that represents numbers with fractional parts.</dd>
<dt>string:</dt>
<dd>A type that represents sequences of characters.</dd>
<dt>natural language:</dt>
<dd>Any one of the languages that people speak that evolved naturally.</dd>
<dt>formal language:</dt>
<dd>Any one of the languages that people have designed for specific
purposes, such as representing mathematical ideas or computer
programs; all programming languages are formal languages.</dd>
<dt>token:</dt>
<dd>One of the basic elements of the syntactic structure of a program,
analogous to a word in a natural language.</dd>
<dt>syntax:</dt>
<dd>The rules that govern the structure of a program.</dd>
<dt>parse:</dt>
<dd>To examine a program and analyze the syntactic structure.</dd>
<dt>bug:</dt>
<dd>An error in a program.</dd>
<dt>debugging:</dt>
<dd>The process of finding and correcting bugs.</dd>
</dl>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>It is a good idea to read this book in front of a computer so you can
try out the examples as you go.</p>
<p>Whenever you are experimenting with a new feature, you should try to
make mistakes. For example, in the “Hello, world!” program, what happens
if you leave out one of the quotation marks? What if you leave out both?
What if you spell print wrong?</p>
<p>This kind of experiment helps you remember what you read; it also helps
when you are programming, because you get to know what the error
messages mean. It is better to make mistakes now and on purpose than
later and accidentally.</p>
<ol class="arabic simple">
<li>In a print statement, what happens if you leave out one of the
parentheses, or both?</li>
<li>If you are trying to print a string, what happens if you leave out
one of the quotation marks, or both?</li>
<li>You can use a minus sign to make a negative number like -2. What
happens if you put a plus sign before a number? What about 2++2?</li>
<li>In math notation, leading zeros are ok, as in 02. What happens if you
try this in Python?</li>
<li>What happens if you have two values with no operator between them?</li>
</ol>
<p>Start the Python interpreter and use it as a calculator.</p>
<ol class="arabic simple">
<li>How many seconds are there in 42 minutes 42 seconds?</li>
<li>How many miles are there in 10 kilometers? Hint: there are 1.61
kilometers in a mile.</li>
<li>If you run a 10 kilometer race in 42 minutes 42 seconds, what is your
average pace (time per mile in minutes and seconds)? What is your
average speed in miles per hour?</li>
</ol>
</div>
</div>
<div class="section" id="variables-expressions-and-statements">
<h1>Variables, expressions and statements<a class="headerlink" href="#variables-expressions-and-statements" title="Permalink to this headline">¶</a></h1>
<p>One of the most powerful features of a programming language is the
ability to manipulate <strong>variables</strong>. A variable is a name that refers to
a value.</p>
<div class="section" id="assignment-statements">
<h2>Assignment statements<a class="headerlink" href="#assignment-statements" title="Permalink to this headline">¶</a></h2>
<p>An <strong>assignment statement</strong> creates a new variable and gives it a value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">message</span> <span class="o">=</span> <span class="s">&#39;And now for something completely different&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">17</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pi</span> <span class="o">=</span> <span class="mf">3.141592653589793</span>
</pre></div>
</div>
<p>This example makes three assignments. The first assigns a string to a
new variable named message; the second gives the integer 17 to n; the
third assigns the (approximate) value of <span class="math">\pi</span> to pi.</p>
<p>A common way to represent variables on paper is to write the name with
an arrow pointing to its value. This kind of figure is called a <strong>state
diagram</strong> because it shows what state each of the variables is in (think
of it as the variable’s state of mind). Figure&nbsp;[fig.state2] shows the
result of the previous example.</p>
<div class="figure" id="id66">
<img alt="State diagram." src="_images/state2.pdf" />
<p class="caption"><span class="caption-text">State diagram.</span></p>
</div>
</div>
<div class="section" id="variable-names">
<h2>Variable names<a class="headerlink" href="#variable-names" title="Permalink to this headline">¶</a></h2>
<p>Programmers generally choose names for their variables that are
meaningful—they document what the variable is used for.</p>
<p>Variable names can be as long as you like. They can contain both letters
and numbers, but they can’t begin with a number. It is legal to use
uppercase letters, but it is conventional to use only lower case for
variables names.</p>
<p>The underscore character, <code class="docutils literal"><span class="pre">_</span></code>, can appear in a name. It is often used
in names with multiple words, such as <code class="docutils literal"><span class="pre">your_name</span></code> or
<code class="docutils literal"><span class="pre">airspeed_of_unladen_swallow</span></code>.</p>
<p>If you give a variable an illegal name, you get a syntax error:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt;&gt;&gt; 76trombones = &#39;big parade&#39;
SyntaxError: invalid syntax
&gt;&gt;&gt; more@ = 1000000
SyntaxError: invalid syntax
&gt;&gt;&gt; class = &#39;Advanced Theoretical Zymurgy&#39;
SyntaxError: invalid syntax
</pre></div>
</div>
<p>76trombones is illegal because it begins with a number. more&#64; is illegal
because it contains an illegal character, &#64;. But what’s wrong with
class?</p>
<p>It turns out that class is one of Python’s <strong>keywords</strong>. The interpreter
uses keywords to recognize the structure of the program, and they cannot
be used as variable names.</p>
<p>Python 3 has these keywords:</p>
<div class="highlight-python"><div class="highlight"><pre>False      class      finally    is         return
None       continue   for        lambda     try
True       def        from       nonlocal   while
and        del        global     not        with
as         elif       if         or         yield
assert     else       import     pass
break      except     in         raise
</pre></div>
</div>
<p>You don’t have to memorize this list. In most development environments,
keywords are displayed in a different color; if you try to use one as a
variable name, you’ll know.</p>
</div>
<div class="section" id="expressions-and-statements">
<h2>Expressions and statements<a class="headerlink" href="#expressions-and-statements" title="Permalink to this headline">¶</a></h2>
<p>An <strong>expression</strong> is a combination of values, variables, and operators.
A value all by itself is considered an expression, and so is a variable,
so the following are all legal expressions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">42</span>
<span class="go">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span>
<span class="go">17</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">+</span> <span class="mi">25</span>
<span class="go">42</span>
</pre></div>
</div>
<p>When you type an expression at the prompt, the interpreter <strong>evaluates</strong>
it, which means that it finds the value of the expression. In this
example, n has the value 17 and n + 25 has the value 42.</p>
<p>A <strong>statement</strong> is a unit of code that has an effect, like creating a
variable or displaying a value.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">17</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>The first line is an assignment statement that gives a value to n. The
second line is a print statement that displays the value of n.</p>
<p>When you type a statement, the interpreter <strong>executes</strong> it, which means
that it does whatever the statement says. In general, statements don’t
have values.</p>
</div>
<div class="section" id="script-mode">
<h2>Script mode<a class="headerlink" href="#script-mode" title="Permalink to this headline">¶</a></h2>
<p>So far we have run Python in <strong>interactive mode</strong>, which means that you
interact directly with the interpreter. Interactive mode is a good way
to get started, but if you are working with more than a few lines of
code, it can be clumsy.</p>
<p>The alternative is to save code in a file called a <strong>script</strong> and then
run the interpreter in <strong>script mode</strong> to execute the script. By
convention, Python scripts have names that end with .py.</p>
<p>If you know how to create and run a script on your computer, you are
ready to go. Otherwise I recommend using PythonAnywhere again. I have
posted instructions for running in script mode at
<a class="reference external" href="http://tinyurl.com/thinkpython2e">http://tinyurl.com/thinkpython2e</a>.</p>
<p>Because Python provides both modes, you can test bits of code in
interactive mode before you put them in a script. But there are
differences between interactive mode and script mode that can be
confusing.</p>
<p>For example, if you are using Python as a calculator, you might type</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">miles</span> <span class="o">=</span> <span class="mf">26.2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">miles</span> <span class="o">*</span> <span class="mf">1.61</span>
<span class="go">42.182</span>
</pre></div>
</div>
<p>The first line assigns a value to miles, but it has no visible effect.
The second line is an expression, so the interpreter evaluates it and
displays the result. It turns out that a marathon is about 42
kilometers.</p>
<p>But if you type the same code into a script and run it, you get no
output at all. In script mode an expression, all by itself, has no
visible effect. Python actually evaluates the expression, but it doesn’t
display the value unless you tell it to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">miles</span> <span class="o">=</span> <span class="mf">26.2</span>
<span class="k">print</span><span class="p">(</span><span class="n">miles</span> <span class="o">*</span> <span class="mf">1.61</span><span class="p">)</span>
</pre></div>
</div>
<p>This behavior can be confusing at first.</p>
<p>A script usually contains a sequence of statements. If there is more
than one statement, the results appear one at a time as the statements
execute.</p>
<p>For example, the script</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>produces the output</p>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">1</span>
<span class="mi">2</span>
</pre></div>
</div>
<p>The assignment statement produces no output.</p>
<p>To check your understanding, type the following statements in the Python
interpreter and see what they do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">5</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Now put the same statements in a script and run it. What is the output?
Modify the script by transforming each expression into a print statement
and then run it again.</p>
</div>
<div class="section" id="order-of-operations">
<h2>Order of operations<a class="headerlink" href="#order-of-operations" title="Permalink to this headline">¶</a></h2>
<p>When an expression contains more than one operator, the order of
evaluation depends on the <strong>order of operations</strong>. For mathematical
operators, Python follows mathematical convention. The acronym
<strong>PEMDAS</strong> is a useful way to remember the rules:</p>
<ul class="simple">
<li><strong>P</strong>arentheses have the highest precedence and can be used to
force an expression to evaluate in the order you want. Since
expressions in parentheses are evaluated first, 2 * (3-1) is 4, and
(1+1)**(5-2) is 8. You can also use parentheses to make an
expression easier to read, as in (minute * 100) / 60, even if it
doesn’t change the result.</li>
<li><strong>E</strong>xponentiation has the next highest precedence, so 1 + 2**3
is 9, not 27, and 2 * 3**2 is 18, not 36.</li>
<li><strong>M</strong>ultiplication and <strong>D</strong>ivision have higher precedence than
<strong>A</strong>ddition and <strong>S</strong>ubtraction. So 2*3-1 is 5, not 4, and
6+4/2 is 8, not 5.</li>
<li>Operators with the same precedence are evaluated from left to right
(except exponentiation). So in the expression degrees / 2 * pi, the
division happens first and the result is multiplied by pi. To divide
by <span class="math">2 \pi</span>, you can use parentheses or write degrees / 2 / pi.</li>
</ul>
<p>I don’t work very hard to remember the precedence of operators. If I
can’t tell by looking at the expression, I use parentheses to make it
obvious.</p>
</div>
<div class="section" id="string-operations">
<h2>String operations<a class="headerlink" href="#string-operations" title="Permalink to this headline">¶</a></h2>
<p>In general, you can’t perform mathematical operations on strings, even
if the strings look like numbers, so the following are illegal:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;2&#39;</span><span class="o">-</span><span class="s">&#39;1&#39;</span>    <span class="s">&#39;eggs&#39;</span><span class="o">/</span><span class="s">&#39;easy&#39;</span>    <span class="s">&#39;third&#39;</span><span class="o">*</span><span class="s">&#39;a charm&#39;</span>
</pre></div>
</div>
<p>But there are two exceptions, + and .</p>
<p>The + operator performs <strong>string concatenation</strong>, which means it joins
the strings by linking them end-to-end. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">first</span> <span class="o">=</span> <span class="s">&#39;throat&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">second</span> <span class="o">=</span> <span class="s">&#39;warbler&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">first</span> <span class="o">+</span> <span class="n">second</span>
<span class="go">throatwarbler</span>
</pre></div>
</div>
<p>The operator also works on strings; it performs repetition. For example,
<code class="docutils literal"><span class="pre">'Spam'*3</span></code> is <code class="docutils literal"><span class="pre">'SpamSpamSpam'</span></code>. If one of the values is a string,
the other has to be an integer.</p>
<p>This use of + and makes sense by analogy with addition and
multiplication. Just as 4*3 is equivalent to 4+4+4, we expect
<code class="docutils literal"><span class="pre">'Spam'*3</span></code> to be the same as <code class="docutils literal"><span class="pre">'Spam'+'Spam'+'Spam'</span></code>, and it is. On
the other hand, there is a significant way in which string concatenation
and repetition are different from integer addition and multiplication.
Can you think of a property that addition has that string concatenation
does not?</p>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<p>As programs get bigger and more complicated, they get more difficult to
read. Formal languages are dense, and it is often difficult to look at a
piece of code and figure out what it is doing, or why.</p>
<p>For this reason, it is a good idea to add notes to your programs to
explain in natural language what the program is doing. These notes are
called <strong>comments</strong>, and they start with the <code class="docutils literal"><span class="pre">#</span></code> symbol:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># compute the percentage of the hour that has elapsed</span>
<span class="n">percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">minute</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span>
</pre></div>
</div>
<p>In this case, the comment appears on a line by itself. You can also put
comments at the end of a line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">minute</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span>     <span class="c"># percentage of an hour</span>
</pre></div>
</div>
<p>Everything from the # to the end of the line is ignored—it has no effect
on the execution of the program.</p>
<p>Comments are most useful when they document non-obvious features of the
code. It is reasonable to assume that the reader can figure out <em>what</em>
the code does; it is more useful to explain <em>why</em>.</p>
<p>This comment is redundant with the code and useless:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">v</span> <span class="o">=</span> <span class="mi">5</span>     <span class="c"># assign 5 to v</span>
</pre></div>
</div>
<p>This comment contains useful information that is not in the code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">v</span> <span class="o">=</span> <span class="mi">5</span>     <span class="c"># velocity in meters/second.</span>
</pre></div>
</div>
<p>Good variable names can reduce the need for comments, but long names can
make complex expressions hard to read, so there is a tradeoff.</p>
</div>
<div class="section" id="id1">
<h2>Debugging<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Three kinds of errors can occur in a program: syntax errors, runtime
errors, and semantic errors. It is useful to distinguish between them in
order to track them down more quickly.</p>
<dl class="docutils">
<dt>Syntax error:</dt>
<dd><p class="first">“Syntax” refers to the structure of a program and the rules about
that structure. For example, parentheses have to come in matching
pairs, so (1 + 2) is legal, but 8) is a <strong>syntax error</strong>.</p>
<p class="last">If there is a syntax error anywhere in your program, Python displays
an error message and quits, and you will not be able to run the
program. During the first few weeks of your programming career, you
might spend a lot of time tracking down syntax errors. As you gain
experience, you will make fewer errors and find them faster.</p>
</dd>
<dt>Runtime error:</dt>
<dd><p class="first">The second type of error is a runtime error, so called because the
error does not appear until after the program has started running.
These errors are also called <strong>exceptions</strong> because they usually
indicate that something exceptional (and bad) has happened.</p>
<p class="last">Runtime errors are rare in the simple programs you will see in the
first few chapters, so it might be a while before you encounter one.</p>
</dd>
<dt>Semantic error:</dt>
<dd><p class="first">The third type of error is “semantic”, which means related to
meaning. If there is a semantic error in your program, it will run
without generating error messages, but it will not do the right
thing. It will do something else. Specifically, it will do what you
told it to do.</p>
<p class="last">Identifying semantic errors can be tricky because it requires you to
work backward by looking at the output of the program and trying to
figure out what it is doing.</p>
</dd>
</dl>
</div>
<div class="section" id="id2">
<h2>Glossary<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>variable:</dt>
<dd>A name that refers to a value.</dd>
<dt>assignment:</dt>
<dd>A statement that assigns a value to a variable.</dd>
<dt>state diagram:</dt>
<dd>A graphical representation of a set of variables and the values they
refer to.</dd>
<dt>keyword:</dt>
<dd>A reserved word that is used to parse a program; you cannot use
keywords like if, def, and while as variable names.</dd>
<dt>operand:</dt>
<dd>One of the values on which an operator operates.</dd>
<dt>expression:</dt>
<dd>A combination of variables, operators, and values that represents a
single result.</dd>
<dt>evaluate:</dt>
<dd>To simplify an expression by performing the operations in order to
yield a single value.</dd>
<dt>statement:</dt>
<dd>A section of code that represents a command or action. So far, the
statements we have seen are assignments and print statements.</dd>
<dt>execute:</dt>
<dd>To run a statement and do what it says.</dd>
<dt>interactive mode:</dt>
<dd>A way of using the Python interpreter by typing code at the prompt.</dd>
<dt>script mode:</dt>
<dd>A way of using the Python interpreter to read code from a script and
run it.</dd>
<dt>script:</dt>
<dd>A program stored in a file.</dd>
<dt>order of operations:</dt>
<dd>Rules governing the order in which expressions involving multiple
operators and operands are evaluated.</dd>
<dt>concatenate:</dt>
<dd>To join two operands end-to-end.</dd>
<dt>comment:</dt>
<dd>Information in a program that is meant for other programmers (or
anyone reading the source code) and has no effect on the execution
of the program.</dd>
<dt>syntax error:</dt>
<dd>An error in a program that makes it impossible to parse (and
therefore impossible to interpret).</dd>
<dt>exception:</dt>
<dd>An error that is detected while the program is running.</dd>
<dt>semantics:</dt>
<dd>The meaning of a program.</dd>
<dt>semantic error:</dt>
<dd>An error in a program that makes it do something other than what the
programmer intended.</dd>
</dl>
</div>
<div class="section" id="id3">
<h2>Exercises<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Repeating my advice from the previous chapter, whenever you learn a new
feature, you should try it out in interactive mode and make errors on
purpose to see what goes wrong.</p>
<ul class="simple">
<li>We’ve seen that n = 42 is legal. What about 42 = n?</li>
<li>How about x = y = 1?</li>
<li>In some languages every statement ends with a semi-colon, ;. What
happens if you put a semi-colon at the end of a Python statement?</li>
<li>What if you put a period at the end of a statement?</li>
<li>In math notation you can multiply <span class="math">x</span> and <span class="math">y</span> like this:
<span class="math">x y</span>. What happens if you try that in Python?</li>
</ul>
<p>Practice using the Python interpreter as a calculator:</p>
<ol class="arabic simple">
<li>The volume of a sphere with radius <span class="math">r</span> is
<span class="math">\frac{4}{3} \pi r^3</span>. What is the volume of a sphere with
radius 5?</li>
<li>Suppose the cover price of a book is $24.95, but bookstores get a 40%
discount. Shipping costs $3 for the first copy and 75 cents for each
additional copy. What is the total wholesale cost for 60 copies?</li>
<li>If I leave my house at 6:52 am and run 1 mile at an easy pace (8:15
per mile), then 3 miles at tempo (7:12 per mile) and 1 mile at easy
pace again, what time do I get home for breakfast?</li>
</ol>
</div>
</div>
<div class="section" id="functions">
<h1>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h1>
<p>In the context of programming, a <strong>function</strong> is a named sequence of
statements that performs a computation. When you define a function, you
specify the name and the sequence of statements. Later, you can “call”
the function by name.</p>
<div class="section" id="function-calls">
<h2>Function calls<a class="headerlink" href="#function-calls" title="Permalink to this headline">¶</a></h2>
<p>We have already seen one example of a <strong>function call</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="go">&lt;class &#39;int&#39;&gt;</span>
</pre></div>
</div>
<p>The name of the function is type. The expression in parentheses is
called the <strong>argument</strong> of the function. The result, for this function,
is the type of the argument.</p>
<p>It is common to say that a function “takes” an argument and “returns” a
result. The result is also called the <strong>return value</strong>.</p>
<p>Python provides functions that convert values from one type to another.
The int function takes any value and converts it to an integer, if it
can, or complains otherwise:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;32&#39;</span><span class="p">)</span>
<span class="go">32</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;Hello&#39;</span><span class="p">)</span>
<span class="go">ValueError: invalid literal for int(): Hello</span>
</pre></div>
</div>
<p>int can convert floating-point values to integers, but it doesn’t round
off; it chops off the fraction part:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="mf">3.99999</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="mf">2.3</span><span class="p">)</span>
<span class="go">-2</span>
</pre></div>
</div>
<p>float converts integers and strings to floating-point numbers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">float</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="go">32.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;3.14159&#39;</span><span class="p">)</span>
<span class="go">3.14159</span>
</pre></div>
</div>
<p>Finally, str converts its argument to a string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="go">&#39;32&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="mf">3.14159</span><span class="p">)</span>
<span class="go">&#39;3.14159&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="math-functions">
<h2>Math functions<a class="headerlink" href="#math-functions" title="Permalink to this headline">¶</a></h2>
<p>Python has a math module that provides most of the familiar mathematical
functions. A <strong>module</strong> is a file that contains a collection of related
functions.</p>
<p>Before we can use the functions in a module, we have to import it with
an <strong>import statement</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
<p>This statement creates a <strong>module object</strong> named math. If you display
the module object, you get some information about it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">math</span>
<span class="go">&lt;module &#39;math&#39; (built-in)&gt;</span>
</pre></div>
</div>
<p>The module object contains the functions and variables defined in the
module. To access one of the functions, you have to specify the name of
the module and the name of the function, separated by a dot (also known
as a period). This format is called <strong>dot notation</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ratio</span> <span class="o">=</span> <span class="n">signal_power</span> <span class="o">/</span> <span class="n">noise_power</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">decibels</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">radians</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">height</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span>
</pre></div>
</div>
<p>The first example uses <code class="docutils literal"><span class="pre">math.log10</span></code> to compute a signal-to-noise ratio
in decibels (assuming that <code class="docutils literal"><span class="pre">signal_power</span></code> and <code class="docutils literal"><span class="pre">noise_power</span></code> are
defined). The math module also provides log, which computes logarithms
base e.</p>
<p>The second example finds the sine of radians. The name of the variable
is a hint that sin and the other trigonometric functions (cos, tan,
etc.) take arguments in radians. To convert from degrees to radians,
divide by 180 and multiply by <span class="math">\pi</span>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">degrees</span> <span class="o">=</span> <span class="mi">45</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">radians</span> <span class="o">=</span> <span class="n">degrees</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span>
<span class="go">0.707106781187</span>
</pre></div>
</div>
<p>The expression math.pi gets the variable pi from the math module. Its
value is a floating-point approximation of <span class="math">\pi</span>, accurate to
about 15 digits.</p>
<p>If you know trigonometry, you can check the previous result by comparing
it to the square root of two divided by two:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
<span class="go">0.707106781187</span>
</pre></div>
</div>
</div>
<div class="section" id="composition">
<h2>Composition<a class="headerlink" href="#composition" title="Permalink to this headline">¶</a></h2>
<p>So far, we have looked at the elements of a program—variables,
expressions, and statements—in isolation, without talking about how to
combine them.</p>
<p>One of the most useful features of programming languages is their
ability to take small building blocks and <strong>compose</strong> them. For example,
the argument of a function can be any kind of expression, including
arithmetic operators:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">degrees</span> <span class="o">/</span> <span class="mf">360.0</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</pre></div>
</div>
<p>And even function calls:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>Almost anywhere you can put a value, you can put an arbitrary
expression, with one exception: the left side of an assignment statement
has to be a variable name. Any other expression on the left side is a
syntax error (we will see exceptions to this rule later).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">minutes</span> <span class="o">=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">60</span>                 <span class="c"># right</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hours</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">=</span> <span class="n">minutes</span>                 <span class="c"># wrong!</span>
<span class="go">SyntaxError: can&#39;t assign to operator</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-new-functions">
<h2>Adding new functions<a class="headerlink" href="#adding-new-functions" title="Permalink to this headline">¶</a></h2>
<p>So far, we have only been using the functions that come with Python, but
it is also possible to add new functions. A <strong>function definition</strong>
specifies the name of a new function and the sequence of statements that
run when the function is called.</p>
<p>Here is an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">print_lyrics</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;I&#39;m a lumberjack, and I&#39;m okay.&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;I sleep all night and I work all day.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>def is a keyword that indicates that this is a function definition. The
name of the function is <code class="docutils literal"><span class="pre">print_lyrics</span></code>. The rules for function names
are the same as for variable names: letters, numbers and underscore are
legal, but the first character can’t be a number. You can’t use a
keyword as the name of a function, and you should avoid having a
variable and a function with the same name.</p>
<p>The empty parentheses after the name indicate that this function doesn’t
take any arguments.</p>
<p>The first line of the function definition is called the <strong>header</strong>; the
rest is called the <strong>body</strong>. The header has to end with a colon and the
body has to be indented. By convention, indentation is always four
spaces. The body can contain any number of statements.</p>
<p>The strings in the print statements are enclosed in double quotes.
Single quotes and double quotes do the same thing; most people use
single quotes except in cases like this where a single quote (which is
also an apostrophe) appears in the string.</p>
<p>All quotation marks (single and double) must be “straight quotes”,
usually located next to Enter on the keyboard. “Curly quotes”, like the
ones in this sentence, are not legal in Python.</p>
<p>If you type a function definition in interactive mode, the interpreter
prints dots (...) to let you know that the definition isn’t complete:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">print_lyrics</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;I&#39;m a lumberjack, and I&#39;m okay.&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;I sleep all night and I work all day.&quot;</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>To end the function, you have to enter an empty line.</p>
<p>Defining a function creates a <strong>function object</strong>, which has type
<code class="docutils literal"><span class="pre">function</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">print_lyrics</span><span class="p">)</span>
<span class="go">&lt;function print_lyrics at 0xb7e99e9c&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">print_lyrics</span><span class="p">)</span>
<span class="go">&lt;class &#39;function&#39;&gt;</span>
</pre></div>
</div>
<p>The syntax for calling the new function is the same as for built-in
functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">print_lyrics</span><span class="p">()</span>
<span class="go">I&#39;m a lumberjack, and I&#39;m okay.</span>
<span class="go">I sleep all night and I work all day.</span>
</pre></div>
</div>
<p>Once you have defined a function, you can use it inside another
function. For example, to repeat the previous refrain, we could write a
function called <code class="docutils literal"><span class="pre">repeat_lyrics</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">repeat_lyrics</span><span class="p">():</span>
    <span class="n">print_lyrics</span><span class="p">()</span>
    <span class="n">print_lyrics</span><span class="p">()</span>
</pre></div>
</div>
<p>And then call <code class="docutils literal"><span class="pre">repeat_lyrics</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">repeat_lyrics</span><span class="p">()</span>
<span class="go">I&#39;m a lumberjack, and I&#39;m okay.</span>
<span class="go">I sleep all night and I work all day.</span>
<span class="go">I&#39;m a lumberjack, and I&#39;m okay.</span>
<span class="go">I sleep all night and I work all day.</span>
</pre></div>
</div>
<p>But that’s not really how the song goes.</p>
</div>
<div class="section" id="definitions-and-uses">
<h2>Definitions and uses<a class="headerlink" href="#definitions-and-uses" title="Permalink to this headline">¶</a></h2>
<p>Pulling together the code fragments from the previous section, the whole
program looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">print_lyrics</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;I&#39;m a lumberjack, and I&#39;m okay.&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;I sleep all night and I work all day.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">repeat_lyrics</span><span class="p">():</span>
    <span class="n">print_lyrics</span><span class="p">()</span>
    <span class="n">print_lyrics</span><span class="p">()</span>

<span class="n">repeat_lyrics</span><span class="p">()</span>
</pre></div>
</div>
<p>This program contains two function definitions: <code class="docutils literal"><span class="pre">print_lyrics</span></code> and
<code class="docutils literal"><span class="pre">repeat_lyrics</span></code>. Function definitions get executed just like other
statements, but the effect is to create function objects. The statements
inside the function do not run until the function is called, and the
function definition generates no output.</p>
<p>As you might expect, you have to create a function before you can run
it. In other words, the function definition has to run before the
function gets called.</p>
<p>As an exercise, move the last line of this program to the top, so the
function call appears before the definitions. Run the program and see
what error message you get.</p>
<p>Now move the function call back to the bottom and move the definition of
<code class="docutils literal"><span class="pre">print_lyrics</span></code> after the definition of <code class="docutils literal"><span class="pre">repeat_lyrics</span></code>. What happens
when you run this program?</p>
</div>
<div class="section" id="flow-of-execution">
<h2>Flow of execution<a class="headerlink" href="#flow-of-execution" title="Permalink to this headline">¶</a></h2>
<p>To ensure that a function is defined before its first use, you have to
know the order statements run in, which is called the <strong>flow of
execution</strong>.</p>
<p>Execution always begins at the first statement of the program.
Statements are run one at a time, in order from top to bottom.</p>
<p>Function definitions do not alter the flow of execution of the program,
but remember that statements inside the function don’t run until the
function is called.</p>
<p>A function call is like a detour in the flow of execution. Instead of
going to the next statement, the flow jumps to the body of the function,
runs the statements there, and then comes back to pick up where it left
off.</p>
<p>That sounds simple enough, until you remember that one function can call
another. While in the middle of one function, the program might have to
run the statements in another function. Then, while running that new
function, the program might have to run yet another function!</p>
<p>Fortunately, Python is good at keeping track of where it is, so each
time a function completes, the program picks up where it left off in the
function that called it. When it gets to the end of the program, it
terminates.</p>
<p>In summary, when you read a program, you don’t always want to read from
top to bottom. Sometimes it makes more sense if you follow the flow of
execution.</p>
</div>
<div class="section" id="parameters-and-arguments">
<h2>Parameters and arguments<a class="headerlink" href="#parameters-and-arguments" title="Permalink to this headline">¶</a></h2>
<p>Some of the functions we have seen require arguments. For example, when
you call math.sin you pass a number as an argument. Some functions take
more than one argument: math.pow takes two, the base and the exponent.</p>
<p>Inside the function, the arguments are assigned to variables called
<strong>parameters</strong>. Here is a definition for a function that takes an
argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">print_twice</span><span class="p">(</span><span class="n">bruce</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">bruce</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">bruce</span><span class="p">)</span>
</pre></div>
</div>
<p>This function assigns the argument to a parameter named bruce. When the
function is called, it prints the value of the parameter (whatever it
is) twice.</p>
<p>This function works with any value that can be printed.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">print_twice</span><span class="p">(</span><span class="s">&#39;Spam&#39;</span><span class="p">)</span>
<span class="go">Spam</span>
<span class="go">Spam</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_twice</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="go">42</span>
<span class="go">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_twice</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="go">3.14159265359</span>
<span class="go">3.14159265359</span>
</pre></div>
</div>
<p>The same rules of composition that apply to built-in functions also
apply to programmer-defined functions, so we can use any kind of
expression as an argument for <code class="docutils literal"><span class="pre">print_twice</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">print_twice</span><span class="p">(</span><span class="s">&#39;Spam &#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
<span class="go">Spam Spam Spam Spam</span>
<span class="go">Spam Spam Spam Spam</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_twice</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<span class="go">-1.0</span>
<span class="go">-1.0</span>
</pre></div>
</div>
<p>The argument is evaluated before the function is called, so in the
examples the expressions <code class="docutils literal"><span class="pre">'Spam</span> <span class="pre">'*4</span></code> and math.cos(math.pi) are only
evaluated once.</p>
<p>You can also use a variable as an argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">michael</span> <span class="o">=</span> <span class="s">&#39;Eric, the half a bee.&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_twice</span><span class="p">(</span><span class="n">michael</span><span class="p">)</span>
<span class="go">Eric, the half a bee.</span>
<span class="go">Eric, the half a bee.</span>
</pre></div>
</div>
<p>The name of the variable we pass as an argument (michael) has nothing to
do with the name of the parameter (bruce). It doesn’t matter what the
value was called back home (in the caller); here in <code class="docutils literal"><span class="pre">print_twice</span></code>, we
call everybody bruce.</p>
</div>
<div class="section" id="variables-and-parameters-are-local">
<h2>Variables and parameters are local<a class="headerlink" href="#variables-and-parameters-are-local" title="Permalink to this headline">¶</a></h2>
<p>When you create a variable inside a function, it is <strong>local</strong>, which
means that it only exists inside the function. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">cat_twice</span><span class="p">(</span><span class="n">part1</span><span class="p">,</span> <span class="n">part2</span><span class="p">):</span>
    <span class="n">cat</span> <span class="o">=</span> <span class="n">part1</span> <span class="o">+</span> <span class="n">part2</span>
    <span class="n">print_twice</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</pre></div>
</div>
<p>This function takes two arguments, concatenates them, and prints the
result twice. Here is an example that uses it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">line1</span> <span class="o">=</span> <span class="s">&#39;Bing tiddle &#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line2</span> <span class="o">=</span> <span class="s">&#39;tiddle bang.&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cat_twice</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">)</span>
<span class="go">Bing tiddle tiddle bang.</span>
<span class="go">Bing tiddle tiddle bang.</span>
</pre></div>
</div>
<p>When <code class="docutils literal"><span class="pre">cat_twice</span></code> terminates, the variable cat is destroyed. If we try
to print it, we get an exception:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
<span class="go">NameError: name &#39;cat&#39; is not defined</span>
</pre></div>
</div>
<p>Parameters are also local. For example, outside <code class="docutils literal"><span class="pre">print_twice</span></code>, there
is no such thing as bruce.</p>
</div>
<div class="section" id="stack-diagrams">
<h2>Stack diagrams<a class="headerlink" href="#stack-diagrams" title="Permalink to this headline">¶</a></h2>
<p>To keep track of which variables can be used where, it is sometimes
useful to draw a <strong>stack diagram</strong>. Like state diagrams, stack diagrams
show the value of each variable, but they also show the function each
variable belongs to.</p>
<p>Each function is represented by a <strong>frame</strong>. A frame is a box with the
name of a function beside it and the parameters and variables of the
function inside it. The stack diagram for the previous example is shown
in Figure&nbsp;[fig.stack].</p>
<div class="figure" id="id67">
<img alt="Stack diagram." src="_images/stack.pdf" />
<p class="caption"><span class="caption-text">Stack diagram.</span></p>
</div>
<p>The frames are arranged in a stack that indicates which function called
which, and so on. In this example, <code class="docutils literal"><span class="pre">print_twice</span></code> was called by
<code class="docutils literal"><span class="pre">cat_twice</span></code>, and <code class="docutils literal"><span class="pre">cat_twice</span></code> was called by <code class="docutils literal"><span class="pre">__main__</span></code>, which is a
special name for the topmost frame. When you create a variable outside
of any function, it belongs to <code class="docutils literal"><span class="pre">__main__</span></code>.</p>
<p>Each parameter refers to the same value as its corresponding argument.
So, part1 has the same value as line1, part2 has the same value as
line2, and bruce has the same value as cat.</p>
<p>If an error occurs during a function call, Python prints the name of the
function, the name of the function that called it, and the name of the
function that called <em>that</em>, all the way back to <code class="docutils literal"><span class="pre">__main__</span></code>.</p>
<p>For example, if you try to access cat from within <code class="docutils literal"><span class="pre">print_twice</span></code>, you
get a NameError:</p>
<div class="highlight-python"><div class="highlight"><pre>Traceback (innermost last):
  File &quot;test.py&quot;, line 13, in __main__
    cat_twice(line1, line2)
  File &quot;test.py&quot;, line 5, in cat_twice
    print_twice(cat)
  File &quot;test.py&quot;, line 9, in print_twice
    print(cat)
NameError: name &#39;cat&#39; is not defined
</pre></div>
</div>
<p>This list of functions is called a <strong>traceback</strong>. It tells you what
program file the error occurred in, and what line, and what functions
were executing at the time. It also shows the line of code that caused
the error.</p>
<p>The order of the functions in the traceback is the same as the order of
the frames in the stack diagram. The function that is currently running
is at the bottom.</p>
</div>
<div class="section" id="fruitful-functions-and-void-functions">
<h2>Fruitful functions and void functions<a class="headerlink" href="#fruitful-functions-and-void-functions" title="Permalink to this headline">¶</a></h2>
<p>Some of the functions we have used, such as the math functions, return
results; for lack of a better name, I call them <strong>fruitful functions</strong>.
Other functions, like <code class="docutils literal"><span class="pre">print_twice</span></code>, perform an action but don’t
return a value. They are called <strong>void functions</strong>.</p>
<p>When you call a fruitful function, you almost always want to do
something with the result; for example, you might assign it to a
variable or use it as part of an expression:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span>
<span class="n">golden</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>
</div>
<p>When you call a function in interactive mode, Python displays the
result:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">2.2360679774997898</span>
</pre></div>
</div>
<p>But in a script, if you call a fruitful function all by itself, the
return value is lost forever!</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>This script computes the square root of 5, but since it doesn’t store or
display the result, it is not very useful.</p>
<p>Void functions might display something on the screen or have some other
effect, but they don’t have a return value. If you assign the result to
a variable, you get a special value called None.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">print_twice</span><span class="p">(</span><span class="s">&#39;Bing&#39;</span><span class="p">)</span>
<span class="go">Bing</span>
<span class="go">Bing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">None</span>
</pre></div>
</div>
<p>The value None is not the same as the string <code class="docutils literal"><span class="pre">'None'</span></code>. It is a special
value that has its own type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
<span class="go">&lt;class &#39;NoneType&#39;&gt;</span>
</pre></div>
</div>
<p>The functions we have written so far are all void. We will start writing
fruitful functions in a few chapters.</p>
</div>
<div class="section" id="why-functions">
<h2>Why functions?<a class="headerlink" href="#why-functions" title="Permalink to this headline">¶</a></h2>
<p>It may not be clear why it is worth the trouble to divide a program into
functions. There are several reasons:</p>
<ul class="simple">
<li>Creating a new function gives you an opportunity to name a group of
statements, which makes your program easier to read and debug.</li>
<li>Functions can make a program smaller by eliminating repetitive code.
Later, if you make a change, you only have to make it in one place.</li>
<li>Dividing a long program into functions allows you to debug the parts
one at a time and then assemble them into a working whole.</li>
<li>Well-designed functions are often useful for many programs. Once you
write and debug one, you can reuse it.</li>
</ul>
</div>
<div class="section" id="id4">
<h2>Debugging<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>One of the most important skills you will acquire is debugging. Although
it can be frustrating, debugging is one of the most intellectually rich,
challenging, and interesting parts of programming.</p>
<p>In some ways debugging is like detective work. You are confronted with
clues and you have to infer the processes and events that led to the
results you see.</p>
<p>Debugging is also like an experimental science. Once you have an idea
about what is going wrong, you modify your program and try again. If
your hypothesis was correct, you can predict the result of the
modification, and you take a step closer to a working program. If your
hypothesis was wrong, you have to come up with a new one. As Sherlock
Holmes pointed out, “When you have eliminated the impossible, whatever
remains, however improbable, must be the truth.” (A. Conan Doyle, <em>The
Sign of Four</em>)</p>
<p>For some people, programming and debugging are the same thing. That is,
programming is the process of gradually debugging a program until it
does what you want. The idea is that you should start with a working
program and make small modifications, debugging them as you go.</p>
<p>For example, Linux is an operating system that contains millions of
lines of code, but it started out as a simple program Linus Torvalds
used to explore the Intel 80386 chip. According to Larry Greenfield,
“One of Linus’s earlier projects was a program that would switch between
printing AAAA and BBBB. This later evolved to Linux.” (<em>The Linux Users’
Guide</em> Beta Version 1).</p>
</div>
<div class="section" id="id5">
<h2>Glossary<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>function:</dt>
<dd>A named sequence of statements that performs some useful operation.
Functions may or may not take arguments and may or may not produce a
result.</dd>
<dt>function definition:</dt>
<dd>A statement that creates a new function, specifying its name,
parameters, and the statements it contains.</dd>
<dt>function object:</dt>
<dd>A value created by a function definition. The name of the function
is a variable that refers to a function object.</dd>
<dt>header:</dt>
<dd>The first line of a function definition.</dd>
<dt>body:</dt>
<dd>The sequence of statements inside a function definition.</dd>
<dt>parameter:</dt>
<dd>A name used inside a function to refer to the value passed as an
argument.</dd>
<dt>function call:</dt>
<dd>A statement that runs a function. It consists of the function name
followed by an argument list in parentheses.</dd>
<dt>argument:</dt>
<dd>A value provided to a function when the function is called. This
value is assigned to the corresponding parameter in the function.</dd>
<dt>local variable:</dt>
<dd>A variable defined inside a function. A local variable can only be
used inside its function.</dd>
<dt>return value:</dt>
<dd>The result of a function. If a function call is used as an
expression, the return value is the value of the expression.</dd>
<dt>fruitful function:</dt>
<dd>A function that returns a value.</dd>
<dt>void function:</dt>
<dd>A function that always returns None.</dd>
<dt>None:</dt>
<dd>A special value returned by void functions.</dd>
<dt>module:</dt>
<dd>A file that contains a collection of related functions and other
definitions.</dd>
<dt>import statement:</dt>
<dd>A statement that reads a module file and creates a module object.</dd>
<dt>module object:</dt>
<dd>A value created by an import statement that provides access to the
values defined in a module.</dd>
<dt>dot notation:</dt>
<dd>The syntax for calling a function in another module by specifying
the module name followed by a dot (period) and the function name.</dd>
<dt>composition:</dt>
<dd>Using an expression as part of a larger expression, or a statement
as part of a larger statement.</dd>
<dt>flow of execution:</dt>
<dd>The order statements run in.</dd>
<dt>stack diagram:</dt>
<dd>A graphical representation of a stack of functions, their variables,
and the values they refer to.</dd>
<dt>frame:</dt>
<dd>A box in a stack diagram that represents a function call. It
contains the local variables and parameters of the function.</dd>
<dt>traceback:</dt>
<dd>A list of the functions that are executing, printed when an
exception occurs.</dd>
</dl>
</div>
<div class="section" id="id6">
<h2>Exercises<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>Write a function named <code class="docutils literal"><span class="pre">right_justify</span></code> that takes a string named s as
a parameter and prints the string with enough leading spaces so that the
last letter of the string is in column 70 of the display.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">right_justify</span><span class="p">(</span><span class="s">&#39;monty&#39;</span><span class="p">)</span>
<span class="go">                                                                 monty</span>
</pre></div>
</div>
<p>Hint: Use string concatenation and repetition. Also, Python provides a
built-in function called len that returns the length of a string, so the
value of <code class="docutils literal"><span class="pre">len('monty')</span></code> is 5.</p>
<p>A function object is a value you can assign to a variable or pass as an
argument. For example, <code class="docutils literal"><span class="pre">do_twice</span></code> is a function that takes a function
object as an argument and calls it twice:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">do_twice</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">f</span><span class="p">()</span>
    <span class="n">f</span><span class="p">()</span>
</pre></div>
</div>
<p>Here’s an example that uses <code class="docutils literal"><span class="pre">do_twice</span></code> to call a function named
<code class="docutils literal"><span class="pre">print_spam</span></code> twice.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">print_spam</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;spam&#39;</span><span class="p">)</span>

<span class="n">do_twice</span><span class="p">(</span><span class="n">print_spam</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>Type this example into a script and test it.</li>
<li>Modify <code class="docutils literal"><span class="pre">do_twice</span></code> so that it takes two arguments, a function object
and a value, and calls the function twice, passing the value as an
argument.</li>
<li>Copy the definition of <code class="docutils literal"><span class="pre">print_twice</span></code> from earlier in this chapter
to your script.</li>
<li>Use the modified version of <code class="docutils literal"><span class="pre">do_twice</span></code> to call <code class="docutils literal"><span class="pre">print_twice</span></code>
twice, passing <code class="docutils literal"><span class="pre">'spam'</span></code> as an argument.</li>
<li>Define a new function called <code class="docutils literal"><span class="pre">do_four</span></code> that takes a function object
and a value and calls the function four times, passing the value as a
parameter. There should be only two statements in the body of this
function, not four.</li>
</ol>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/do_four.py">http://thinkpython2.com/code/do_four.py</a>.</p>
<p>Note: This exercise should be done using only the statements and other
features we have learned so far.</p>
<ol class="arabic">
<li><p class="first">Write a function that draws a grid like the following:</p>
<div class="highlight-python"><div class="highlight"><pre>+ - - - - + - - - - +
|         |         |
|         |         |
|         |         |
|         |         |
+ - - - - + - - - - +
|         |         |
|         |         |
|         |         |
|         |         |
+ - - - - + - - - - +
</pre></div>
</div>
<p>Hint: to print more than one value on a line, you can print a
comma-separated sequence of values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, print advances to the next line, but you can override
that behavior and put a space at the end, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The output of these statements is <code class="docutils literal"><span class="pre">'+</span> <span class="pre">-'</span></code>.</p>
<p>A print statement with no argument ends the current line and goes to
the next line.</p>
</li>
<li><p class="first">Write a function that draws a similar grid with four rows and four
columns.</p>
</li>
</ol>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/grid.py">http://thinkpython2.com/code/grid.py</a>. Credit: This exercise is
based on an exercise in Oualline, <em>Practical C Programming, Third
Edition</em>, O’Reilly Media, 1997.</p>
</div>
</div>
<div class="section" id="case-study-interface-design">
<h1>Case study: interface design<a class="headerlink" href="#case-study-interface-design" title="Permalink to this headline">¶</a></h1>
<p>This chapter presents a case study that demonstrates a process for
designing functions that work together.</p>
<p>It introduces the turtle module, which allows you to create images using
turtle graphics. The turtle module is included in most Python
installations, but if you are running Python using PythonAnywhere, you
won’t be able to run the turtle examples (at least you couldn’t when I
wrote this).</p>
<p>If you have already installed Python on your computer, you should be
able to run the examples. Otherwise, now is a good time to install. I
have posted instructions at <a class="reference external" href="http://tinyurl.com/thinkpython2e">http://tinyurl.com/thinkpython2e</a>.</p>
<p>Code examples from this chapter are available from
<a class="reference external" href="http://thinkpython2.com/code/polygon.py">http://thinkpython2.com/code/polygon.py</a>.</p>
<div class="section" id="the-turtle-module">
<h2>The turtle module<a class="headerlink" href="#the-turtle-module" title="Permalink to this headline">¶</a></h2>
<p>To check whether you have the turtle module, open the Python interpreter
and type</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">turtle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Turtle</span><span class="p">()</span>
</pre></div>
</div>
<p>When you run this code, it should create a new window with small arrow
that represents the turtle. Close the window.</p>
<p>Create a file named mypolygon.py and type in the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">turtle</span>
<span class="n">bob</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Turtle</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">bob</span><span class="p">)</span>
<span class="n">turtle</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</pre></div>
</div>
<p>The turtle module (with a lowercase ’t’) provides a function called
Turtle (with an uppercase ’T’) that creates a Turtle object, which we
assign to a variable named bob. Printing bob displays something like:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;turtle.Turtle object at 0xb7bfbf4c&gt;
</pre></div>
</div>
<p>This means that bob refers to an object with type Turtle as defined in
module turtle.</p>
<p><code class="docutils literal"><span class="pre">mainloop</span></code> tells the window to wait for the user to do something,
although in this case there’s not much for the user to do except close
the window.</p>
<p>Once you create a Turtle, you can call a <strong>method</strong> to move it around
the window. A method is similar to a function, but it uses slightly
different syntax. For example, to move the turtle forward:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">bob</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>The method, fd, is associated with the turtle object we’re calling bob.
Calling a method is like making a request: you are asking bob to move
forward.</p>
<p>The argument of fd is a distance in pixels, so the actual size depends
on your display.</p>
<p>Other methods you can call on a Turtle are bk to move backward, lt for
left turn, and rt right turn. The argument for lt and rt is an angle in
degrees.</p>
<p>Also, each Turtle is holding a pen, which is either down or up; if the
pen is down, the Turtle leaves a trail when it moves. The methods pu and
pd stand for “pen up” and “pen down”.</p>
<p>To draw a right angle, add these lines to the program (after creating
bob and before calling <code class="docutils literal"><span class="pre">mainloop</span></code>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">bob</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">bob</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
<span class="n">bob</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>When you run this program, you should see bob move east and then north,
leaving two line segments behind.</p>
<p>Now modify the program to draw a square. Don’t go on until you’ve got it
working!</p>
</div>
<div class="section" id="simple-repetition">
<h2>Simple repetition<a class="headerlink" href="#simple-repetition" title="Permalink to this headline">¶</a></h2>
<p>Chances are you wrote something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">bob</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">bob</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>

<span class="n">bob</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">bob</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>

<span class="n">bob</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">bob</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>

<span class="n">bob</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>We can do the same thing more concisely with a for statement. Add this
example to mypolygon.py and run it again:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Hello!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You should see something like this:</p>
<div class="highlight-python"><div class="highlight"><pre>Hello!
Hello!
Hello!
Hello!
</pre></div>
</div>
<p>This is the simplest use of the for statement; we will see more later.
But that should be enough to let you rewrite your square-drawing
program. Don’t go on until you do.</p>
<p>Here is a for statement that draws a square:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">bob</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">bob</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
<p>The syntax of a for statement is similar to a function definition. It
has a header that ends with a colon and an indented body. The body can
contain any number of statements.</p>
<p>A for statement is also called a <strong>loop</strong> because the flow of execution
runs through the body and then loops back to the top. In this case, it
runs the body four times.</p>
<p>This version is actually a little different from the previous
square-drawing code because it makes another turn after drawing the last
side of the square. The extra turn takes more time, but it simplifies
the code if we do the same thing every time through the loop. This
version also has the effect of leaving the turtle back in the starting
position, facing in the starting direction.</p>
</div>
<div class="section" id="id7">
<h2>Exercises<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>The following is a series of exercises using TurtleWorld. They are meant
to be fun, but they have a point, too. While you are working on them,
think about what the point is.</p>
<p>The following sections have solutions to the exercises, so don’t look
until you have finished (or at least tried).</p>
<ol class="arabic">
<li><p class="first">Write a function called square that takes a parameter named t, which
is a turtle. It should use the turtle to draw a square.</p>
<p>Write a function call that passes bob as an argument to square, and
then run the program again.</p>
</li>
<li><p class="first">Add another parameter, named length, to square. Modify the body so
length of the sides is length, and then modify the function call to
provide a second argument. Run the program again. Test your program
with a range of values for length.</p>
</li>
<li><p class="first">Make a copy of square and change the name to polygon. Add another
parameter named n and modify the body so it draws an n-sided regular
polygon. Hint: The exterior angles of an n-sided regular polygon are
<span class="math">360/n</span> degrees.</p>
</li>
<li><p class="first">Write a function called circle that takes a turtle, t, and radius, r,
as parameters and that draws an approximate circle by calling polygon
with an appropriate length and number of sides. Test your function
with a range of values of r.</p>
<p>Hint: figure out the circumference of the circle and make sure that
length * n = circumference.</p>
</li>
<li><p class="first">Make a more general version of circle called arc that takes an
additional parameter angle, which determines what fraction of a
circle to draw. angle is in units of degrees, so when angle=360, arc
should draw a complete circle.</p>
</li>
</ol>
</div>
<div class="section" id="encapsulation">
<h2>Encapsulation<a class="headerlink" href="#encapsulation" title="Permalink to this headline">¶</a></h2>
<p>The first exercise asks you to put your square-drawing code into a
function definition and then call the function, passing the turtle as a
parameter. Here is a solution:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">t</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>

<span class="n">square</span><span class="p">(</span><span class="n">bob</span><span class="p">)</span>
</pre></div>
</div>
<p>The innermost statements, fd and lt are indented twice to show that they
are inside the for loop, which is inside the function definition. The
next line, square(bob), is flush with the left margin, which indicates
the end of both the for loop and the function definition.</p>
<p>Inside the function, t refers to the same turtle bob, so t.lt(90) has
the same effect as bob.lt(90). In that case, why not call the parameter
bob? The idea is that t can be any turtle, not just bob, so you could
create a second turtle and pass it as an argument to square:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">alice</span> <span class="o">=</span> <span class="n">Turtle</span><span class="p">()</span>
<span class="n">square</span><span class="p">(</span><span class="n">alice</span><span class="p">)</span>
</pre></div>
</div>
<p>Wrapping a piece of code up in a function is called <strong>encapsulation</strong>.
One of the benefits of encapsulation is that it attaches a name to the
code, which serves as a kind of documentation. Another advantage is that
if you re-use the code, it is more concise to call a function twice than
to copy and paste the body!</p>
</div>
<div class="section" id="generalization">
<h2>Generalization<a class="headerlink" href="#generalization" title="Permalink to this headline">¶</a></h2>
<p>The next step is to add a length parameter to square. Here is a
solution:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">t</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>

<span class="n">square</span><span class="p">(</span><span class="n">bob</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>Adding a parameter to a function is called <strong>generalization</strong> because it
makes the function more general: in the previous version, the square is
always the same size; in this version it can be any size.</p>
<p>The next step is also a generalization. Instead of drawing squares,
polygon draws regular polygons with any number of sides. Here is a
solution:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">polygon</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">t</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

<span class="n">polygon</span><span class="p">(</span><span class="n">bob</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</pre></div>
</div>
<p>This example draws a 7-sided polygon with side length 70.</p>
<p>If you are using Python 2, the value of angle might be off because of
integer division. A simple solution is to compute angle = 360.0 / n.
Because the numerator is a floating-point number, the result is floating
point.</p>
<p>When a function has more than a few numeric arguments, it is easy to
forget what they are, or what order they should be in. In that case it
is often a good idea to include the names of the parameters in the
argument list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">polygon</span><span class="p">(</span><span class="n">bob</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
</pre></div>
</div>
<p>These are called <strong>keyword arguments</strong> because they include the
parameter names as “keywords” (not to be confused with Python keywords
like while and def).</p>
<p>This syntax makes the program more readable. It is also a reminder about
how arguments and parameters work: when you call a function, the
arguments are assigned to the parameters.</p>
</div>
<div class="section" id="interface-design">
<h2>Interface design<a class="headerlink" href="#interface-design" title="Permalink to this headline">¶</a></h2>
<p>The next step is to write circle, which takes a radius, r, as a
parameter. Here is a simple solution that uses polygon to draw a
50-sided polygon:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">circle</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="n">circumference</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">circumference</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">polygon</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</pre></div>
</div>
<p>The first line computes the circumference of a circle with radius r
using the formula <span class="math">2 \pi r</span>. Since we use math.pi, we have to
import math. By convention, import statements are usually at the
beginning of the script.</p>
<p>n is the number of line segments in our approximation of a circle, so
length is the length of each segment. Thus, polygon draws a 50-sides
polygon that approximates a circle with radius r.</p>
<p>One limitation of this solution is that n is a constant, which means
that for very big circles, the line segments are too long, and for small
circles, we waste time drawing very small segments. One solution would
be to generalize the function by taking n as a parameter. This would
give the user (whoever calls circle) more control, but the interface
would be less clean.</p>
<p>The <strong>interface</strong> of a function is a summary of how it is used: what are
the parameters? What does the function do? And what is the return value?
An interface is “clean” if it allows the caller to do what they want
without dealing with unnecessary details.</p>
<p>In this example, r belongs in the interface because it specifies the
circle to be drawn. n is less appropriate because it pertains to the
details of <em>how</em> the circle should be rendered.</p>
<p>Rather than clutter up the interface, it is better to choose an
appropriate value of n depending on circumference:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">circle</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="n">circumference</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">circumference</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">circumference</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">polygon</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</pre></div>
</div>
<p>Now the number of segments is an integer near circumference/3, so the
length of each segment is approximately 3, which is small enough that
the circles look good, but big enough to be efficient, and acceptable
for any size circle.</p>
</div>
<div class="section" id="refactoring">
<h2>Refactoring<a class="headerlink" href="#refactoring" title="Permalink to this headline">¶</a></h2>
<p>When I wrote circle, I was able to re-use polygon because a many-sided
polygon is a good approximation of a circle. But arc is not as
cooperative; we can’t use polygon or circle to draw an arc.</p>
<p>One alternative is to start with a copy of polygon and transform it into
arc. The result might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">arc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
    <span class="n">arc_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">360</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arc_length</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">step_length</span> <span class="o">=</span> <span class="n">arc_length</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">step_angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">/</span> <span class="n">n</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">t</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="n">step_length</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="n">step_angle</span><span class="p">)</span>
</pre></div>
</div>
<p>The second half of this function looks like polygon, but we can’t re-use
polygon without changing the interface. We could generalize polygon to
take an angle as a third argument, but then polygon would no longer be
an appropriate name! Instead, let’s call the more general function
polyline:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">polyline</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">t</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can rewrite polygon and arc to use polyline:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">polygon</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="mf">360.0</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">polyline</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">arc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
    <span class="n">arc_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">360</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arc_length</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">step_length</span> <span class="o">=</span> <span class="n">arc_length</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">step_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">polyline</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">step_length</span><span class="p">,</span> <span class="n">step_angle</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we can rewrite circle to use arc:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">circle</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="n">arc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</pre></div>
</div>
<p>This process—rearranging a program to improve interfaces and facilitate
code re-use—is called <strong>refactoring</strong>. In this case, we noticed that
there was similar code in arc and polygon, so we “factored it out” into
polyline.</p>
<p>If we had planned ahead, we might have written polyline first and
avoided refactoring, but often you don’t know enough at the beginning of
a project to design all the interfaces. Once you start coding, you
understand the problem better. Sometimes refactoring is a sign that you
have learned something.</p>
</div>
<div class="section" id="a-development-plan">
<h2>A development plan<a class="headerlink" href="#a-development-plan" title="Permalink to this headline">¶</a></h2>
<p>A <strong>development plan</strong> is a process for writing programs. The process we
used in this case study is “encapsulation and generalization”. The steps
of this process are:</p>
<ol class="arabic simple">
<li>Start by writing a small program with no function definitions.</li>
<li>Once you get the program working, identify a coherent piece of it,
encapsulate the piece in a function and give it a name.</li>
<li>Generalize the function by adding appropriate parameters.</li>
<li>Repeat steps 1–3 until you have a set of working functions. Copy and
paste working code to avoid retyping (and re-debugging).</li>
<li>Look for opportunities to improve the program by refactoring. For
example, if you have similar code in several places, consider
factoring it into an appropriately general function.</li>
</ol>
<p>This process has some drawbacks—we will see alternatives later—but it
can be useful if you don’t know ahead of time how to divide the program
into functions. This approach lets you design as you go along.</p>
</div>
<div class="section" id="docstring">
<h2>docstring<a class="headerlink" href="#docstring" title="Permalink to this headline">¶</a></h2>
<p>A <strong>docstring</strong> is a string at the beginning of a function that explains
the interface (“doc” is short for “documentation”). Here is an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">polyline</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws n line segments with the given length and</span>
<span class="sd">    angle (in degrees) between them.  t is a turtle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">t</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</pre></div>
</div>
<p>By convention, all docstrings are triple-quoted strings, also known as
multiline strings because the triple quotes allow the string to span
more than one line.</p>
<p>It is terse, but it contains the essential information someone would
need to use this function. It explains concisely what the function does
(without getting into the details of how it does it). It explains what
effect each parameter has on the behavior of the function and what type
each parameter should be (if it is not obvious).</p>
<p>Writing this kind of documentation is an important part of interface
design. A well-designed interface should be simple to explain; if you
have a hard time explaining one of your functions, maybe the interface
could be improved.</p>
</div>
<div class="section" id="id8">
<h2>Debugging<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>An interface is like a contract between a function and a caller. The
caller agrees to provide certain parameters and the function agrees to
do certain work.</p>
<p>For example, polyline requires four arguments: t has to be a Turtle; n
has to be an integer; length should be a positive number; and angle has
to be a number, which is understood to be in degrees.</p>
<p>These requirements are called <strong>preconditions</strong> because they are
supposed to be true before the function starts executing. Conversely,
conditions at the end of the function are <strong>postconditions</strong>.
Postconditions include the intended effect of the function (like drawing
line segments) and any side effects (like moving the Turtle or making
other changes).</p>
<p>Preconditions are the responsibility of the caller. If the caller
violates a (properly documented!) precondition and the function doesn’t
work correctly, the bug is in the caller, not the function.</p>
<p>If the preconditions are satisfied and the postconditions are not, the
bug is in the function. If your pre- and postconditions are clear, they
can help with debugging.</p>
</div>
<div class="section" id="id9">
<h2>Glossary<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>method:</dt>
<dd>A function that is associated with an object and called using dot
notation.</dd>
<dt>loop:</dt>
<dd>A part of a program that can run repeatedly.</dd>
<dt>encapsulation:</dt>
<dd>The process of transforming a sequence of statements into a function
definition.</dd>
<dt>generalization:</dt>
<dd>The process of replacing something unnecessarily specific (like a
number) with something appropriately general (like a variable or
parameter).</dd>
<dt>keyword argument:</dt>
<dd>An argument that includes the name of the parameter as a “keyword”.</dd>
<dt>interface:</dt>
<dd>A description of how to use a function, including the name and
descriptions of the arguments and return value.</dd>
<dt>refactoring:</dt>
<dd>The process of modifying a working program to improve function
interfaces and other qualities of the code.</dd>
<dt>development plan:</dt>
<dd>A process for writing programs.</dd>
<dt>docstring:</dt>
<dd>A string that appears at the top of a function definition to
document the function’s interface.</dd>
<dt>precondition:</dt>
<dd>A requirement that should be satisfied by the caller before a
function starts.</dd>
<dt>postcondition:</dt>
<dd>A requirement that should be satisfied by the function before it
ends.</dd>
</dl>
</div>
<div class="section" id="id10">
<h2>Exercises<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>Download the code in this chapter from
<a class="reference external" href="http://thinkpython2.com/code/polygon.py">http://thinkpython2.com/code/polygon.py</a>.</p>
<ol class="arabic simple">
<li>Draw a stack diagram that shows the state of the program while
executing circle(bob, radius). You can do the arithmetic by hand or
add print statements to the code.</li>
<li>The version of arc in Section&nbsp;[refactoring] is not very accurate
because the linear approximation of the circle is always outside the
true circle. As a result, the Turtle ends up a few pixels away from
the correct destination. My solution shows a way to reduce the effect
of this error. Read the code and see if it makes sense to you. If you
draw a diagram, you might see how it works.</li>
</ol>
<div class="figure" id="id68">
<img alt="Turtle flowers." src="_images/flowers.pdf" />
<p class="caption"><span class="caption-text">Turtle flowers.</span></p>
</div>
<p>Write an appropriately general set of functions that can draw flowers as
in Figure&nbsp;[fig.flowers].</p>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/flower.py">http://thinkpython2.com/code/flower.py</a>, also requires
<a class="reference external" href="http://thinkpython2.com/code/polygon.py">http://thinkpython2.com/code/polygon.py</a>.</p>
<div class="figure" id="id69">
<img alt="Turtle pies." src="_images/pies.pdf" />
<p class="caption"><span class="caption-text">Turtle pies.</span></p>
</div>
<p>Write an appropriately general set of functions that can draw shapes as
in Figure&nbsp;[fig.pies].</p>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/pie.py">http://thinkpython2.com/code/pie.py</a>.</p>
<p>The letters of the alphabet can be constructed from a moderate number of
basic elements, like vertical and horizontal lines and a few curves.
Design an alphabet that can be drawn with a minimal number of basic
elements and then write functions that draw the letters.</p>
<p>You should write one function for each letter, with names <code class="docutils literal"><span class="pre">draw_a</span></code>,
<code class="docutils literal"><span class="pre">draw_b</span></code>, etc., and put your functions in a file named letters.py. You
can download a “turtle typewriter” from
<a class="reference external" href="http://thinkpython2.com/code/typewriter.py">http://thinkpython2.com/code/typewriter.py</a> to help you test your code.</p>
<p>You can get a solution from <a class="reference external" href="http://thinkpython2.com/code/letters.py">http://thinkpython2.com/code/letters.py</a>; it
also requires <a class="reference external" href="http://thinkpython2.com/code/polygon.py">http://thinkpython2.com/code/polygon.py</a>.</p>
<p>Read about spirals at <a class="reference external" href="http://en.wikipedia.org/wiki/Spiral">http://en.wikipedia.org/wiki/Spiral</a>; then write a
program that draws an Archimedian spiral (or one of the other kinds).
Solution: <a class="reference external" href="http://thinkpython2.com/code/spiral.py">http://thinkpython2.com/code/spiral.py</a>.</p>
</div>
</div>
<div class="section" id="conditionals-and-recursion">
<h1>Conditionals and recursion<a class="headerlink" href="#conditionals-and-recursion" title="Permalink to this headline">¶</a></h1>
<p>The main topic of this chapter is the if statement, which executes
different code depending on the state of the program. But first I want
to introduce two new operators: floor division and modulus.</p>
<div class="section" id="floor-division-and-modulus">
<h2>Floor division and modulus<a class="headerlink" href="#floor-division-and-modulus" title="Permalink to this headline">¶</a></h2>
<p>The <strong>floor division</strong> operator, <code class="docutils literal"><span class="pre">//</span></code>, divides two numbers and rounds
down to an integer. For example, suppose the run time of a movie is 105
minutes. You might want to know how long that is in hours. Conventional
division returns a floating-point number:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">minutes</span> <span class="o">=</span> <span class="mi">105</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">minutes</span> <span class="o">/</span> <span class="mi">60</span>
<span class="go">1.75</span>
</pre></div>
</div>
<p>But we don’t normally write hours with decimal points. Floor division
returns the integer number of hours, dropping the fraction part:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">minutes</span> <span class="o">=</span> <span class="mi">105</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hours</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">//</span> <span class="mi">60</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hours</span>
<span class="go">1</span>
</pre></div>
</div>
<p>To get the remainder, you could subtract off one hour in minutes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">remainder</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">-</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">60</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">remainder</span>
<span class="go">45</span>
</pre></div>
</div>
<p>An alternative is to use the <strong>modulus operator</strong>, <code class="docutils literal"><span class="pre">%</span></code>, which divides
two numbers and returns the remainder.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">remainder</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">%</span> <span class="mi">60</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">remainder</span>
<span class="go">45</span>
</pre></div>
</div>
<p>The modulus operator is more useful than it seems. For example, you can
check whether one number is divisible by another—if x % y is zero, then
x is divisible by y.</p>
<p>Also, you can extract the right-most digit or digits from a number. For
example, x % 10 yields the right-most digit of x (in base 10). Similarly
x % 100 yields the last two digits.</p>
<p>If you are using Python 2, division works differently. The division
operator, <code class="docutils literal"><span class="pre">/</span></code>, performs floor division if both operands are integers,
and floating-point division if either operand is a float.</p>
</div>
<div class="section" id="boolean-expressions">
<h2>Boolean expressions<a class="headerlink" href="#boolean-expressions" title="Permalink to this headline">¶</a></h2>
<p>A <strong>boolean expression</strong> is an expression that is either true or false.
The following examples use the operator ==, which compares two operands
and produces True if they are equal and False otherwise:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">5</span> <span class="o">==</span> <span class="mi">5</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">5</span> <span class="o">==</span> <span class="mi">6</span>
<span class="go">False</span>
</pre></div>
</div>
<p>True and False are special values that belong to the type bool; they are
not strings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="go">&lt;class &#39;bool&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="go">&lt;class &#39;bool&#39;&gt;</span>
</pre></div>
</div>
<p>The == operator is one of the <strong>relational operators</strong>; the others are:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">!=</span> <span class="n">y</span>               <span class="c"># x is not equal to y</span>
<span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span>                <span class="c"># x is greater than y</span>
<span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span>                <span class="c"># x is less than y</span>
<span class="n">x</span> <span class="o">&gt;=</span> <span class="n">y</span>               <span class="c"># x is greater than or equal to y</span>
<span class="n">x</span> <span class="o">&lt;=</span> <span class="n">y</span>               <span class="c"># x is less than or equal to y</span>
</pre></div>
</div>
<p>Although these operations are probably familiar to you, the Python
symbols are different from the mathematical symbols. A common error is
to use a single equal sign (=) instead of a double equal sign (==).
Remember that = is an assignment operator and == is a relational
operator. There is no such thing as =&lt; or =&gt;.</p>
</div>
<div class="section" id="logical-operators">
<h2>Logical operators<a class="headerlink" href="#logical-operators" title="Permalink to this headline">¶</a></h2>
<p>There are three <strong>logical operators</strong>: and, or, and not. The semantics
(meaning) of these operators is similar to their meaning in English. For
example, x &gt; 0 and x &lt; 10 is true only if x is greater than 0 <em>and</em> less
than 10.</p>
<p>n%2 == 0 or n%3 == 0 is true if <em>either or both</em> of the conditions is
true, that is, if the number is divisible by 2 <em>or</em> 3.</p>
<p>Finally, the not operator negates a boolean expression, so not (x &gt; y)
is true if x &gt; y is false, that is, if x is less than or equal to y.</p>
<p>Strictly speaking, the operands of the logical operators should be
boolean expressions, but Python is not very strict. Any nonzero number
is interpreted as True:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">42</span> <span class="ow">and</span> <span class="bp">True</span>
<span class="go">True</span>
</pre></div>
</div>
<p>This flexibility can be useful, but there are some subtleties to it that
might be confusing. You might want to avoid it (unless you know what you
are doing).</p>
</div>
<div class="section" id="conditional-execution">
<h2>Conditional execution<a class="headerlink" href="#conditional-execution" title="Permalink to this headline">¶</a></h2>
<p>In order to write useful programs, we almost always need the ability to
check conditions and change the behavior of the program accordingly.
<strong>Conditional statements</strong> give us this ability. The simplest form is
the if statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;x is positive&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The boolean expression after if is called the <strong>condition</strong>. If it is
true, the indented statement runs. If not, nothing happens.</p>
<p>if statements have the same structure as function definitions: a header
followed by an indented body. Statements like this are called <strong>compound
statements</strong>.</p>
<p>There is no limit on the number of statements that can appear in the
body, but there has to be at least one. Occasionally, it is useful to
have a body with no statements (usually as a place keeper for code you
haven’t written yet). In that case, you can use the pass statement,
which does nothing.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">pass</span>          <span class="c"># TODO: need to handle negative values!</span>
</pre></div>
</div>
</div>
<div class="section" id="alternative-execution">
<h2>Alternative execution<a class="headerlink" href="#alternative-execution" title="Permalink to this headline">¶</a></h2>
<p>A second form of the if statement is “alternative execution”, in which
there are two possibilities and the condition determines which one runs.
The syntax looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;x is even&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;x is odd&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the remainder when x is divided by 2 is 0, then we know that x is
even, and the program displays an appropriate message. If the condition
is false, the second set of statements runs. Since the condition must be
true or false, exactly one of the alternatives will run. The
alternatives are called <strong>branches</strong>, because they are branches in the
flow of execution.</p>
</div>
<div class="section" id="chained-conditionals">
<h2>Chained conditionals<a class="headerlink" href="#chained-conditionals" title="Permalink to this headline">¶</a></h2>
<p>Sometimes there are more than two possibilities and we need more than
two branches. One way to express a computation like that is a <strong>chained
conditional</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;x is less than y&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;x is greater than y&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;x and y are equal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>elif is an abbreviation of “else if”. Again, exactly one branch will
run. There is no limit on the number of elif statements. If there is an
else clause, it has to be at the end, but there doesn’t have to be one.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
    <span class="n">draw_a</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="s">&#39;b&#39;</span><span class="p">:</span>
    <span class="n">draw_b</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="s">&#39;c&#39;</span><span class="p">:</span>
    <span class="n">draw_c</span><span class="p">()</span>
</pre></div>
</div>
<p>Each condition is checked in order. If the first is false, the next is
checked, and so on. If one of them is true, the corresponding branch
runs and the statement ends. Even if more than one condition is true,
only the first true branch runs.</p>
</div>
<div class="section" id="nested-conditionals">
<h2>Nested conditionals<a class="headerlink" href="#nested-conditionals" title="Permalink to this headline">¶</a></h2>
<p>One conditional can also be nested within another. We could have written
the example in the previous section like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;x and y are equal&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;x is less than y&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;x is greater than y&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The outer conditional contains two branches. The first branch contains a
simple statement. The second branch contains another if statement, which
has two branches of its own. Those two branches are both simple
statements, although they could have been conditional statements as
well.</p>
<p>Although the indentation of the statements makes the structure apparent,
<strong>nested conditionals</strong> become difficult to read very quickly. It is a
good idea to avoid them when you can.</p>
<p>Logical operators often provide a way to simplify nested conditional
statements. For example, we can rewrite the following code using a
single conditional:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;x is a positive single-digit number.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The print statement runs only if we make it past both conditionals, so
we can get the same effect with the and operator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;x is a positive single-digit number.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For this kind of condition, Python provides a more concise option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;x is a positive single-digit number.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="recursion">
<h2>Recursion<a class="headerlink" href="#recursion" title="Permalink to this headline">¶</a></h2>
<p>It is legal for one function to call another; it is also legal for a
function to call itself. It may not be obvious why that is a good thing,
but it turns out to be one of the most magical things a program can do.
For example, look at the following function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Blastoff!&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">countdown</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>If n is 0 or negative, it outputs the word, “Blastoff!” Otherwise, it
outputs n and then calls a function named countdown—itself—passing n-1
as an argument.</p>
<p>What happens if we call this function like this?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">countdown</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The execution of countdown begins with n=3, and since n is greater than
0, it outputs the value 3, and then calls itself...</p>
<blockquote>
<div><p>The execution of countdown begins with n=2, and since n is greater
than 0, it outputs the value 2, and then calls itself...</p>
<blockquote>
<div><p>The execution of countdown begins with n=1, and since n is
greater than 0, it outputs the value 1, and then calls itself...</p>
<blockquote>
<div>The execution of countdown begins with n=0, and since n is
not greater than 0, it outputs the word, “Blastoff!” and
then returns.</div></blockquote>
<p>The countdown that got n=1 returns.</p>
</div></blockquote>
<p>The countdown that got n=2 returns.</p>
</div></blockquote>
<p>The countdown that got n=3 returns.</p>
<p>And then you’re back in <code class="docutils literal"><span class="pre">__main__</span></code>. So, the total output looks like
this:</p>
<div class="highlight-python"><div class="highlight"><pre>3
2
1
Blastoff!
</pre></div>
</div>
<p>A function that calls itself is <strong>recursive</strong>; the process of executing
it is called <strong>recursion</strong>.</p>
<p>As another example, we can write a function that prints a string n
times.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">print_n</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">print_n</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>If n &lt;= 0 the <strong>return statement</strong> exits the function. The flow of
execution immediately returns to the caller, and the remaining lines of
the function don’t run.</p>
<p>The rest of the function is similar to countdown: it displays s and then
calls itself to display s <span class="math">n-1</span> additional times. So the number of
lines of output is 1 + (n - 1), which adds up to n.</p>
<p>For simple examples like this, it is probably easier to use a for loop.
But we will see examples later that are hard to write with a for loop
and easy to write with recursion, so it is good to start early.</p>
</div>
<div class="section" id="stack-diagrams-for-recursive-functions">
<h2>Stack diagrams for recursive functions<a class="headerlink" href="#stack-diagrams-for-recursive-functions" title="Permalink to this headline">¶</a></h2>
<p>In Section&nbsp;[stackdiagram], we used a stack diagram to represent the
state of a program during a function call. The same kind of diagram can
help interpret a recursive function.</p>
<p>Every time a function gets called, Python creates a frame to contain the
function’s local variables and parameters. For a recursive function,
there might be more than one frame on the stack at the same time.</p>
<p>Figure&nbsp;[fig.stack2] shows a stack diagram for countdown called with n =
3.</p>
<div class="figure" id="id70">
<img alt="Stack diagram." src="_images/stack2.pdf" />
<p class="caption"><span class="caption-text">Stack diagram.</span></p>
</div>
<p>As usual, the top of the stack is the frame for <code class="docutils literal"><span class="pre">__main__</span></code>. It is
empty because we did not create any variables in <code class="docutils literal"><span class="pre">__main__</span></code> or pass
any arguments to it.</p>
<p>The four countdown frames have different values for the parameter n. The
bottom of the stack, where n=0, is called the <strong>base case</strong>. It does not
make a recursive call, so there are no more frames.</p>
<p>As an exercise, draw a stack diagram for <code class="docutils literal"><span class="pre">print_n</span></code> called with
<code class="docutils literal"><span class="pre">s</span> <span class="pre">=</span> <span class="pre">'Hello'</span></code> and n=2. Then write a function called <code class="docutils literal"><span class="pre">do_n</span></code> that
takes a function object and a number, n, as arguments, and that calls
the given function n times.</p>
</div>
<div class="section" id="infinite-recursion">
<h2>Infinite recursion<a class="headerlink" href="#infinite-recursion" title="Permalink to this headline">¶</a></h2>
<p>If a recursion never reaches a base case, it goes on making recursive
calls forever, and the program never terminates. This is known as
<strong>infinite recursion</strong>, and it is generally not a good idea. Here is a
minimal program with an infinite recursion:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">recurse</span><span class="p">():</span>
    <span class="n">recurse</span><span class="p">()</span>
</pre></div>
</div>
<p>In most programming environments, a program with infinite recursion does
not really run forever. Python reports an error message when the maximum
recursion depth is reached:</p>
<div class="highlight-python"><div class="highlight"><pre>  File &quot;&lt;stdin&gt;&quot;, line 2, in recurse
  File &quot;&lt;stdin&gt;&quot;, line 2, in recurse
  File &quot;&lt;stdin&gt;&quot;, line 2, in recurse
                  .
                  .
                  .
  File &quot;&lt;stdin&gt;&quot;, line 2, in recurse
RuntimeError: Maximum recursion depth exceeded
</pre></div>
</div>
<p>This traceback is a little bigger than the one we saw in the previous
chapter. When the error occurs, there are 1000 recurse frames on the
stack!</p>
<p>If you write encounter an infinite recursion by accident, review your
function to confirm that there is a base case that does not make a
recursive call. And if there is a base case, check whether you are
guaranteed to reach it.</p>
</div>
<div class="section" id="keyboard-input">
<h2>Keyboard input<a class="headerlink" href="#keyboard-input" title="Permalink to this headline">¶</a></h2>
<p>The programs we have written so far accept no input from the user. They
just do the same thing every time.</p>
<p>Python provides a built-in function called input that stops the program
and waits for the user to type something. When the user presses Return
or Enter, the program resumes and <code class="docutils literal"><span class="pre">input</span></code> returns what the user typed
as a string. In Python 2, the same function is called <code class="docutils literal"><span class="pre">raw_input</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">text</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
<span class="go">What are you waiting for?</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text</span>
<span class="go">What are you waiting for?</span>
</pre></div>
</div>
<p>Before getting input from the user, it is a good idea to print a prompt
telling the user what to type. <code class="docutils literal"><span class="pre">input</span></code> can take a prompt as an
argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">&#39;What...is your name?</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="go">What...is your name?</span>
<span class="go">Arthur, King of the Britons!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name</span>
<span class="go">Arthur, King of the Britons!</span>
</pre></div>
</div>
<p>The sequence <code class="docutils literal"><span class="pre">\n</span></code> at the end of the prompt represents a <strong>newline</strong>,
which is a special character that causes a line break. That’s why the
user’s input appears below the prompt.</p>
<p>If you expect the user to type an integer, you can try to convert the
return value to int:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">prompt</span> <span class="o">=</span> <span class="s">&#39;What...is the airspeed velocity of an unladen swallow?</span><span class="se">\n</span><span class="s">&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">speed</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
<span class="go">What...is the airspeed velocity of an unladen swallow?</span>
<span class="go">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
<span class="go">42</span>
</pre></div>
</div>
<p>But if the user types something other than a string of digits, you get
an error:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">speed</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
<span class="go">What...is the airspeed velocity of an unladen swallow?</span>
<span class="go">What do you mean, an African or a European swallow?</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
<span class="go">ValueError: invalid literal for int() with base 10</span>
</pre></div>
</div>
<p>We will see how to handle this kind of error later.</p>
</div>
<div class="section" id="id11">
<h2>Debugging<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>When a syntax or runtime error occurs, the error message contains a lot
of information, but it can be overwhelming. The most useful parts are
usually:</p>
<ul class="simple">
<li>What kind of error it was, and</li>
<li>Where it occurred.</li>
</ul>
<p>Syntax errors are usually easy to find, but there are a few gotchas.
Whitespace errors can be tricky because spaces and tabs are invisible
and we are used to ignoring them.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">y</span> <span class="o">=</span> <span class="mi">6</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="o">^</span>
<span class="gr">IndentationError</span>: <span class="n">unexpected indent</span>
</pre></div>
</div>
<p>In this example, the problem is that the second line is indented by one
space. But the error message points to y, which is misleading. In
general, error messages indicate where the problem was discovered, but
the actual error might be earlier in the code, sometimes on a previous
line.</p>
<p>The same is true of runtime errors. Suppose you are trying to compute a
signal-to-noise ratio in decibels. The formula is
<span class="math">SNR_{db} = 10 \log_{10} (P_{signal} / P_{noise})</span>. In Python, you
might write something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">math</span>
<span class="n">signal_power</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">noise_power</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">signal_power</span> <span class="o">//</span> <span class="n">noise_power</span>
<span class="n">decibels</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">decibels</span><span class="p">)</span>
</pre></div>
</div>
<p>When you run this program, you get an exception:</p>
<div class="highlight-python"><div class="highlight"><pre>Traceback (most recent call last):
  File &quot;snr.py&quot;, line 5, in ?
    decibels = 10 * math.log10(ratio)
ValueError: math domain error
</pre></div>
</div>
<p>The error message indicates line 5, but there is nothing wrong with that
line. To find the real error, it might be useful to print the value of
ratio, which turns out to be 0. The problem is in line 4, which uses
floor division instead of floating-point division.</p>
<p>You should take the time to read error messages carefully, but don’t
assume that everything they say is correct.</p>
</div>
<div class="section" id="id12">
<h2>Glossary<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>floor division:</dt>
<dd>An operator, denoted //, that divides two numbers and rounds down
(toward zero) to an integer.</dd>
<dt>modulus operator:</dt>
<dd>An operator, denoted with a percent sign (%), that works on integers
and returns the remainder when one number is divided by another.</dd>
<dt>boolean expression:</dt>
<dd>An expression whose value is either True or False.</dd>
<dt>relational operator:</dt>
<dd>One of the operators that compares its operands: ==, !=, &gt;, &lt;, &gt;=,
and &lt;=.</dd>
<dt>logical operator:</dt>
<dd>One of the operators that combines boolean expressions: and, or, and
not.</dd>
<dt>conditional statement:</dt>
<dd>A statement that controls the flow of execution depending on some
condition.</dd>
<dt>condition:</dt>
<dd>The boolean expression in a conditional statement that determines
which branch runs.</dd>
<dt>compound statement:</dt>
<dd>A statement that consists of a header and a body. The header ends
with a colon (:). The body is indented relative to the header.</dd>
<dt>branch:</dt>
<dd>One of the alternative sequences of statements in a conditional
statement.</dd>
<dt>chained conditional:</dt>
<dd>A conditional statement with a series of alternative branches.</dd>
<dt>nested conditional:</dt>
<dd>A conditional statement that appears in one of the branches of
another conditional statement.</dd>
<dt>return statement:</dt>
<dd>A statement that causes a function to end immediately and return to
the caller.</dd>
<dt>recursion:</dt>
<dd>The process of calling the function that is currently executing.</dd>
<dt>base case:</dt>
<dd>A conditional branch in a recursive function that does not make a
recursive call.</dd>
<dt>infinite recursion:</dt>
<dd>A recursion that doesn’t have a base case, or never reaches it.
Eventually, an infinite recursion causes a runtime error.</dd>
</dl>
</div>
<div class="section" id="id13">
<h2>Exercises<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<p>The time module provides a function, also named time, that returns the
current Greenwich Mean Time in “the epoch”, which is an arbitrary time
used as a reference point. On UNIX systems, the epoch is 1 January 1970.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="go">1437746094.5735958</span>
</pre></div>
</div>
<p>Write a script that reads the current time and converts it to a time of
day in hours, minutes, and seconds, plus the number of days since the
epoch.</p>
<p>Fermat’s Last Theorem says that there are no positive integers
<span class="math">a</span>, <span class="math">b</span>, and <span class="math">c</span> such that</p>
<div class="math">
<p><span class="math">a^n + b^n = c^n</span></p>
</div><p>for any values of <span class="math">n</span> greater than 2.</p>
<ol class="arabic">
<li><p class="first">Write a function named <code class="docutils literal"><span class="pre">check_fermat</span></code> that takes four parameters—a,
b, c and n—and checks to see if Fermat’s theorem holds. If <span class="math">n</span>
is greater than 2 and</p>
<div class="math">
<p><span class="math">a^n + b^n = c^n</span></p>
</div><p>the program should print, “Holy smokes, Fermat was wrong!” Otherwise
the program should print, “No, that doesn’t work.”</p>
</li>
<li><p class="first">Write a function that prompts the user to input values for a, b, c
and n, converts them to integers, and uses <code class="docutils literal"><span class="pre">check_fermat</span></code> to check
whether they violate Fermat’s theorem.</p>
</li>
</ol>
<p>If you are given three sticks, you may or may not be able to arrange
them in a triangle. For example, if one of the sticks is 12 inches long
and the other two are one inch long, you will not be able to get the
short sticks to meet in the middle. For any three lengths, there is a
simple test to see if it is possible to form a triangle:</p>
<blockquote>
<div>If any of the three lengths is greater than the sum of the other
two, then you cannot form a triangle. Otherwise, you can. (If the
sum of two lengths equals the third, they form what is called a
“degenerate” triangle.)</div></blockquote>
<ol class="arabic simple">
<li>Write a function named <code class="docutils literal"><span class="pre">is_triangle</span></code> that takes three integers as
arguments, and that prints either “Yes” or “No”, depending on whether
you can or cannot form a triangle from sticks with the given lengths.</li>
<li>Write a function that prompts the user to input three stick lengths,
converts them to integers, and uses <code class="docutils literal"><span class="pre">is_triangle</span></code> to check whether
sticks with the given lengths can form a triangle.</li>
</ol>
<p>What is the output of the following program? Draw a stack diagram that
shows the state of the program when it prints the result.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">recurse</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">recurse</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="n">s</span><span class="p">)</span>

<span class="n">recurse</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>What would happen if you called this function like this: recurse(-1,
0)?</li>
<li>Write a docstring that explains everything someone would need to know
in order to use this function (and nothing else).</li>
</ol>
<p>The following exercises use the turtle module, described in
Chapter&nbsp;[turtlechap]:</p>
<p>Read the following function and see if you can figure out what it does.
Then run it (see the examples in Chapter&nbsp;[turtlechap]).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">t</span><span class="o">.</span><span class="n">fd</span><span class="p">(</span><span class="n">length</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">draw</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">rt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">draw</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">bk</span><span class="p">(</span><span class="n">length</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id71">
<img alt="A Koch curve." src="_images/koch.pdf" />
<p class="caption"><span class="caption-text">A Koch curve.</span></p>
</div>
<p>The Koch curve is a fractal that looks something like Figure&nbsp;[fig.koch].
To draw a Koch curve with length <span class="math">x</span>, all you have to do is</p>
<ol class="arabic simple">
<li>Draw a Koch curve with length <span class="math">x/3</span>.</li>
<li>Turn left 60 degrees.</li>
<li>Draw a Koch curve with length <span class="math">x/3</span>.</li>
<li>Turn right 120 degrees.</li>
<li>Draw a Koch curve with length <span class="math">x/3</span>.</li>
<li>Turn left 60 degrees.</li>
<li>Draw a Koch curve with length <span class="math">x/3</span>.</li>
</ol>
<p>The exception is if <span class="math">x</span> is less than 3: in that case, you can just
draw a straight line with length <span class="math">x</span>.</p>
<ol class="arabic">
<li><p class="first">Write a function called koch that takes a turtle and a length as
parameters, and that uses the turtle to draw a Koch curve with the
given length.</p>
</li>
<li><p class="first">Write a function called snowflake that draws three Koch curves to
make the outline of a snowflake.</p>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/koch.py">http://thinkpython2.com/code/koch.py</a>.</p>
</li>
<li><p class="first">The Koch curve can be generalized in several ways. See
<a class="reference external" href="http://en.wikipedia.org/wiki/Koch_snowflake">http://en.wikipedia.org/wiki/Koch_snowflake</a> for examples and
implement your favorite.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="fruitful-functions">
<h1>Fruitful functions<a class="headerlink" href="#fruitful-functions" title="Permalink to this headline">¶</a></h1>
<p>Many of the Python functions we have used, such as the math functions,
produce return values. But the functions we’ve written are all void:
they have an effect, like printing a value or moving a turtle, but they
don’t have a return value. In this chapter you will learn to write
fruitful functions.</p>
<div class="section" id="return-values">
<h2>Return values<a class="headerlink" href="#return-values" title="Permalink to this headline">¶</a></h2>
<p>Calling the function generates a return value, which we usually assign
to a variable or use as part of an expression.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">e</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">height</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span>
</pre></div>
</div>
<p>The functions we have written so far are void. Speaking casually, they
have no return value; more precisely, their return value is None.</p>
<p>In this chapter, we are (finally) going to write fruitful functions. The
first example is area, which returns the area of a circle with the given
radius:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="n">radius</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">a</span>
</pre></div>
</div>
<p>We have seen the return statement before, but in a fruitful function the
return statement includes an expression. This statement means: “Return
immediately from this function and use the following expression as a
return value.” The expression can be arbitrarily complicated, so we
could have written this function more concisely:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="n">radius</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
<p>On the other hand, <strong>temporary variables</strong> like a can make debugging
easier.</p>
<p>Sometimes it is useful to have multiple return statements, one in each
branch of a conditional:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">absolute_value</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>Since these return statements are in an alternative conditional, only
one runs.</p>
<p>As soon as a return statement runs, the function terminates without
executing any subsequent statements. Code that appears after a return
statement, or any other place the flow of execution can never reach, is
called <strong>dead code</strong>.</p>
<p>In a fruitful function, it is a good idea to ensure that every possible
path through the program hits a return statement. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">absolute_value</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">x</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>This function is incorrect because if x happens to be 0, neither
condition is true, and the function ends without hitting a return
statement. If the flow of execution gets to the end of a function, the
return value is None, which is not the absolute value of 0.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">absolute_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">None</span>
</pre></div>
</div>
<p>By the way, Python provides a built-in function called abs that computes
absolute values.</p>
<p>As an exercise, write a compare function takes two values, x and y, and
returns 1 if x &gt; y, 0 if x == y, and -1 if x &lt; y.</p>
</div>
<div class="section" id="incremental-development">
<h2>Incremental development<a class="headerlink" href="#incremental-development" title="Permalink to this headline">¶</a></h2>
<p>As you write larger functions, you might find yourself spending more
time debugging.</p>
<p>To deal with increasingly complex programs, you might want to try a
process called <strong>incremental development</strong>. The goal of incremental
development is to avoid long debugging sessions by adding and testing
only a small amount of code at a time.</p>
<p>As an example, suppose you want to find the distance between two points,
given by the coordinates <span class="math">(x_1, y_1)</span> and <span class="math">(x_2, y_2)</span>. By
the Pythagorean theorem, the distance is:</p>
<div class="math">
<p><span class="math">\mathrm{distance} = \sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2}</span></p>
</div><p>The first step is to consider what a distance function should look like
in Python. In other words, what are the inputs (parameters) and what is
the output (return value)?</p>
<p>In this case, the inputs are two points, which you can represent using
four numbers. The return value is the distance represented by a
floating-point value.</p>
<p>Immediately you can write an outline of the function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.0</span>
</pre></div>
</div>
<p>Obviously, this version doesn’t compute distances; it always returns
zero. But it is syntactically correct, and it runs, which means that you
can test it before you make it more complicated.</p>
<p>To test the new function, call it with sample arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>I chose these values so that the horizontal distance is 3 and the
vertical distance is 4; that way, the result is 5, the hypotenuse of a
3-4-5 triangle. When testing a function, it is useful to know the right
answer.</p>
<p>At this point we have confirmed that the function is syntactically
correct, and we can start adding code to the body. A reasonable next
step is to find the differences <span class="math">x_2 - x_1</span> and <span class="math">y_2 - y_1</span>.
The next version stores those values in temporary variables and prints
them.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;dx is&#39;</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;dy is&#39;</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.0</span>
</pre></div>
</div>
<p>If the function is working, it should display <code class="docutils literal"><span class="pre">dx</span> <span class="pre">is</span> <span class="pre">3</span></code> and
<code class="docutils literal"><span class="pre">dy</span> <span class="pre">is</span> <span class="pre">4</span></code>. If so, we know that the function is getting the right
arguments and performing the first computation correctly. If not, there
are only a few lines to check.</p>
<p>Next we compute the sum of squares of dx and dy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">dsquared</span> <span class="o">=</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;dsquared is: &#39;</span><span class="p">,</span> <span class="n">dsquared</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.0</span>
</pre></div>
</div>
<p>Again, you would run the program at this stage and check the output
(which should be 25). Finally, you can use math.sqrt to compute and
return the result:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">dsquared</span> <span class="o">=</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dsquared</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>If that works correctly, you are done. Otherwise, you might want to
print the value of result before the return statement.</p>
<p>The final version of the function doesn’t display anything when it runs;
it only returns a value. The print statements we wrote are useful for
debugging, but once you get the function working, you should remove
them. Code like that is called <strong>scaffolding</strong> because it is helpful for
building the program but is not part of the final product.</p>
<p>When you start out, you should add only a line or two of code at a time.
As you gain more experience, you might find yourself writing and
debugging bigger chunks. Either way, incremental development can save
you a lot of debugging time.</p>
<p>The key aspects of the process are:</p>
<ol class="arabic simple">
<li>Start with a working program and make small incremental changes. At
any point, if there is an error, you should have a good idea where it
is.</li>
<li>Use variables to hold intermediate values so you can display and
check them.</li>
<li>Once the program is working, you might want to remove some of the
scaffolding or consolidate multiple statements into compound
expressions, but only if it does not make the program difficult to
read.</li>
</ol>
<p>As an exercise, use incremental development to write a function called
hypotenuse that returns the length of the hypotenuse of a right triangle
given the lengths of the other two legs as arguments. Record each stage
of the development process as you go.</p>
</div>
<div class="section" id="id14">
<h2>Composition<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<p>As you should expect by now, you can call one function from within
another. As an example, we’ll write a function that takes two points,
the center of the circle and a point on the perimeter, and computes the
area of the circle.</p>
<p>Assume that the center point is stored in the variables xc and yc, and
the perimeter point is in xp and yp. The first step is to find the
radius of the circle, which is the distance between the two points. We
just wrote a function, distance, that does that:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">radius</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>
</pre></div>
</div>
<p>The next step is to find the area of a circle with that radius; we just
wrote that, too:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">result</span> <span class="o">=</span> <span class="n">area</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
</pre></div>
</div>
<p>Encapsulating these steps in a function, we get:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">circle_area</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">):</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">area</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>The temporary variables radius and result are useful for development and
debugging, but once the program is working, we can make it more concise
by composing the function calls:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">circle_area</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">area</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="boolean-functions">
<h2>Boolean functions<a class="headerlink" href="#boolean-functions" title="Permalink to this headline">¶</a></h2>
<p>Functions can return booleans, which is often convenient for hiding
complicated tests inside functions. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_divisible</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
<p>It is common to give boolean functions names that sound like yes/no
questions; <code class="docutils literal"><span class="pre">is_divisible</span></code> returns either True or False to indicate
whether x is divisible by y.</p>
<p>Here is an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">is_divisible</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_divisible</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The result of the == operator is a boolean, so we can write the function
more concisely by returning it directly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_divisible</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">%</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Boolean functions are often used in conditional statements:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">is_divisible</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;x is divisible by y&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It might be tempting to write something like:</p>
<div class="highlight-python"><div class="highlight"><pre>if is_divisible(x, y) == True:
    print(&#39;x is divisible by y&#39;
</pre></div>
</div>
<p>But the extra comparison is unnecessary.</p>
<p>As an exercise, write a function <code class="docutils literal"><span class="pre">is_between(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code> that returns
True if <span class="math">x \le y \le z</span> or False otherwise.</p>
</div>
<div class="section" id="more-recursion">
<h2>More recursion<a class="headerlink" href="#more-recursion" title="Permalink to this headline">¶</a></h2>
<p>We have only covered a small subset of Python, but you might be
interested to know that this subset is a <em>complete</em> programming
language, which means that anything that can be computed can be
expressed in this language. Any program ever written could be rewritten
using only the language features you have learned so far (actually, you
would need a few commands to control devices like the mouse, disks,
etc., but that’s all).</p>
<p>Proving that claim is a nontrivial exercise first accomplished by Alan
Turing, one of the first computer scientists (some would argue that he
was a mathematician, but a lot of early computer scientists started as
mathematicians). Accordingly, it is known as the Turing Thesis. For a
more complete (and accurate) discussion of the Turing Thesis, I
recommend Michael Sipser’s book <em>Introduction to the Theory of
Computation</em>.</p>
<p>To give you an idea of what you can do with the tools you have learned
so far, we’ll evaluate a few recursively defined mathematical functions.
A recursive definition is similar to a circular definition, in the sense
that the definition contains a reference to the thing being defined. A
truly circular definition is not very useful:</p>
<dl class="docutils">
<dt>vorpal:</dt>
<dd>An adjective used to describe something that is vorpal.</dd>
</dl>
<p>If you saw that definition in the dictionary, you might be annoyed. On
the other hand, if you looked up the definition of the factorial
function, denoted with the symbol <span class="math">!</span>, you might get something
like this:</p>
<div class="math">
<p><span class="math">\begin{aligned}
&amp;&amp;  0! = 1 \\
&amp;&amp;  n! = n (n-1)!\end{aligned}</span></p>
</div><p>This definition says that the factorial of 0 is 1, and the factorial of
any other value, <span class="math">n</span>, is <span class="math">n</span> multiplied by the factorial of
<span class="math">n-1</span>.</p>
<p>So <span class="math">3!</span> is 3 times <span class="math">2!</span>, which is 2 times <span class="math">1!</span>, which
is 1 times <span class="math">0!</span>. Putting it all together, <span class="math">3!</span> equals 3
times 2 times 1 times 1, which is 6.</p>
<p>If you can write a recursive definition of something, you can write a
Python program to evaluate it. The first step is to decide what the
parameters should be. In this case it should be clear that factorial
takes an integer:</p>
<div class="highlight-python"><div class="highlight"><pre>def factorial(n):
</pre></div>
</div>
<p>If the argument happens to be 0, all we have to do is return 1:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Otherwise, and this is the interesting part, we have to make a recursive
call to find the factorial of <span class="math">n-1</span> and then multiply it by
<span class="math">n</span>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">recurse</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">recurse</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>The flow of execution for this program is similar to the flow of
countdown in Section&nbsp;[recursion]. If we call factorial with the value 3:</p>
<p>Since 3 is not 0, we take the second branch and calculate the factorial
of n-1...</p>
<blockquote>
<div><p>Since 2 is not 0, we take the second branch and calculate the
factorial of n-1...</p>
<blockquote>
<div><p>Since 1 is not 0, we take the second branch and calculate the
factorial of n-1...</p>
<blockquote>
<div>Since 0 equals 0, we take the first branch and return 1
without making any more recursive calls.</div></blockquote>
<p>The return value, 1, is multiplied by <span class="math">n</span>, which is 1, and
the result is returned.</p>
</div></blockquote>
<p>The return value, 1, is multiplied by <span class="math">n</span>, which is 2, and the
result is returned.</p>
</div></blockquote>
<p>The return value (2) is multiplied by <span class="math">n</span>, which is 3, and the
result, 6, becomes the return value of the function call that started
the whole process.</p>
<p>Figure&nbsp;[fig.stack3] shows what the stack diagram looks like for this
sequence of function calls.</p>
<div class="figure" id="id72">
<img alt="Stack diagram." src="_images/stack3.pdf" />
<p class="caption"><span class="caption-text">Stack diagram.</span></p>
</div>
<p>The return values are shown being passed back up the stack. In each
frame, the return value is the value of result, which is the product of
n and recurse.</p>
<p>In the last frame, the local variables recurse and result do not exist,
because the branch that creates them does not run.</p>
</div>
<div class="section" id="leap-of-faith">
<h2>Leap of faith<a class="headerlink" href="#leap-of-faith" title="Permalink to this headline">¶</a></h2>
<p>Following the flow of execution is one way to read programs, but it can
quickly become overwhelming. An alternative is what I call the “leap of
faith”. When you come to a function call, instead of following the flow
of execution, you <em>assume</em> that the function works correctly and returns
the right result.</p>
<p>In fact, you are already practicing this leap of faith when you use
built-in functions. When you call math.cos or math.exp, you don’t
examine the bodies of those functions. You just assume that they work
because the people who wrote the built-in functions were good
programmers.</p>
<p>The same is true when you call one of your own functions. For example,
in Section&nbsp;[boolean], we wrote a function called <code class="docutils literal"><span class="pre">is_divisible</span></code> that
determines whether one number is divisible by another. Once we have
convinced ourselves that this function is correct—by examining the code
and testing—we can use the function without looking at the body again.</p>
<p>The same is true of recursive programs. When you get to the recursive
call, instead of following the flow of execution, you should assume that
the recursive call works (returns the correct result) and then ask
yourself, “Assuming that I can find the factorial of <span class="math">n-1</span>, can I
compute the factorial of <span class="math">n</span>?” It is clear that you can, by
multiplying by <span class="math">n</span>.</p>
<p>Of course, it’s a bit strange to assume that the function works
correctly when you haven’t finished writing it, but that’s why it’s
called a leap of faith!</p>
</div>
<div class="section" id="one-more-example">
<h2>One more example<a class="headerlink" href="#one-more-example" title="Permalink to this headline">¶</a></h2>
<p>After factorial, the most common example of a recursively defined
mathematical function is fibonacci, which has the following definition
(see <a class="reference external" href="http://en.wikipedia.org/wiki/Fibonacci_number">http://en.wikipedia.org/wiki/Fibonacci_number</a>):</p>
<div class="math">
<p><span class="math">\begin{aligned}
&amp;&amp; \mathrm{fibonacci}(0) = 0 \\
&amp;&amp; \mathrm{fibonacci}(1) = 1 \\
&amp;&amp; \mathrm{fibonacci}(n) = \mathrm{fibonacci}(n-1) + \mathrm{fibonacci}(n-2)\end{aligned}</span></p>
</div><p>Translated into Python, it looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span>  <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>If you try to follow the flow of execution here, even for fairly small
values of <span class="math">n</span>, your head explodes. But according to the leap of
faith, if you assume that the two recursive calls work correctly, then
it is clear that you get the right result by adding them together.</p>
</div>
<div class="section" id="checking-types">
<h2>Checking types<a class="headerlink" href="#checking-types" title="Permalink to this headline">¶</a></h2>
<p>What happens if we call factorial and give it 1.5 as an argument?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">factorial</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="go">RuntimeError: Maximum recursion depth exceeded</span>
</pre></div>
</div>
<p>It looks like an infinite recursion. How can that be? The function has a
base case—when n == 0. But if n is not an integer, we can <em>miss</em> the
base case and recurse forever.</p>
<p>In the first recursive call, the value of n is 0.5. In the next, it is
-0.5. From there, it gets smaller (more negative), but it will never be
0.</p>
<p>We have two choices. We can try to generalize the factorial function to
work with floating-point numbers, or we can make factorial check the
type of its argument. The first option is called the gamma function and
it’s a little beyond the scope of this book. So we’ll go for the second.</p>
<p>We can use the built-in function isinstance to verify the type of the
argument. While we’re at it, we can also make sure the argument is
positive:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">factorial</span> <span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Factorial is only defined for integers.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Factorial is not defined for negative integers.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The first base case handles nonintegers; the second handles negative
integers. In both cases, the program prints an error message and returns
None to indicate that something went wrong:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">factorial</span><span class="p">(</span><span class="s">&#39;fred&#39;</span><span class="p">)</span>
<span class="go">Factorial is only defined for integers.</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">factorial</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="go">Factorial is not defined for negative integers.</span>
<span class="go">None</span>
</pre></div>
</div>
<p>If we get past both checks, we know that <span class="math">n</span> is positive or zero,
so we can prove that the recursion terminates.</p>
<p>This program demonstrates a pattern sometimes called a <strong>guardian</strong>. The
first two conditionals act as guardians, protecting the code that
follows from values that might cause an error. The guardians make it
possible to prove the correctness of the code.</p>
<p>In Section&nbsp;[raise] we will see a more flexible alternative to printing
an error message: raising an exception.</p>
</div>
<div class="section" id="id15">
<h2>Debugging<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>Breaking a large program into smaller functions creates natural
checkpoints for debugging. If a function is not working, there are three
possibilities to consider:</p>
<ul class="simple">
<li>There is something wrong with the arguments the function is getting;
a precondition is violated.</li>
<li>There is something wrong with the function; a postcondition is
violated.</li>
<li>There is something wrong with the return value or the way it is being
used.</li>
</ul>
<p>To rule out the first possibility, you can add a print statement at the
beginning of the function and display the values of the parameters (and
maybe their types). Or you can write code that checks the preconditions
explicitly.</p>
<p>If the parameters look good, add a print statement before each return
statement and display the return value. If possible, check the result by
hand. Consider calling the function with values that make it easy to
check the result (as in Section&nbsp;[incremental.development]).</p>
<p>If the function seems to be working, look at the function call to make
sure the return value is being used correctly (or used at all!).</p>
<p>Adding print statements at the beginning and end of a function can help
make the flow of execution more visible. For example, here is a version
of factorial with print statements:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">space</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="s">&#39;factorial&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="s">&#39;returning 1&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">recurse</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">recurse</span>
        <span class="k">print</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="s">&#39;returning&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>space is a string of space characters that controls the indentation of
the output. Here is the result of factorial(4) :</p>
<div class="highlight-python"><div class="highlight"><pre>                factorial 4
            factorial 3
        factorial 2
    factorial 1
factorial 0
returning 1
    returning 1
        returning 2
            returning 6
                returning 24
</pre></div>
</div>
<p>If you are confused about the flow of execution, this kind of output can
be helpful. It takes some time to develop effective scaffolding, but a
little bit of scaffolding can save a lot of debugging.</p>
</div>
<div class="section" id="id16">
<h2>Glossary<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>temporary variable:</dt>
<dd>A variable used to store an intermediate value in a complex
calculation.</dd>
<dt>dead code:</dt>
<dd>Part of a program that can never run, often because it appears after
a return statement.</dd>
<dt>incremental development:</dt>
<dd>A program development plan intended to avoid debugging by adding and
testing only a small amount of code at a time.</dd>
<dt>scaffolding:</dt>
<dd>Code that is used during program development but is not part of the
final version.</dd>
<dt>guardian:</dt>
<dd>A programming pattern that uses a conditional statement to check for
and handle circumstances that might cause an error.</dd>
</dl>
</div>
<div class="section" id="id17">
<h2>Exercises<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<p>Draw a stack diagram for the following program. What does the program
print?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">prod</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prod</span>

<span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
    <span class="n">square</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">square</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p>[ackermann]</p>
<p>The Ackermann function, <span class="math">A(m, n)</span>, is defined:</p>
<div class="math">
<p><span class="math">\begin{aligned}
A(m, n) = \begin{cases}
              n+1 &amp; \mbox{if } m = 0 \\
        A(m-1, 1) &amp; \mbox{if } m &gt; 0 \mbox{ and } n = 0 \\
A(m-1, A(m, n-1)) &amp; \mbox{if } m &gt; 0 \mbox{ and } n &gt; 0.
\end{cases} \end{aligned}</span></p>
</div><p>See <a class="reference external" href="http://en.wikipedia.org/wiki/Ackermann_function">http://en.wikipedia.org/wiki/Ackermann_function</a>. Write a function
named ack that evaluates the Ackermann function. Use your function to
evaluate ack(3, 4), which should be 125. What happens for larger values
of m and n? Solution: <a class="reference external" href="http://thinkpython2.com/code/ackermann.py">http://thinkpython2.com/code/ackermann.py</a>.</p>
<p>[palindrome]</p>
<p>A palindrome is a word that is spelled the same backward and forward,
like “noon” and “redivider”. Recursively, a word is a palindrome if the
first and last letters are the same and the middle is a palindrome.</p>
<p>The following are functions that take a string argument and return the
first, last, and middle letters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">last</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>We’ll see how they work in Chapter&nbsp;[strings].</p>
<ol class="arabic simple">
<li>Type these functions into a file named palindrome.py and test them
out. What happens if you call middle with a string with two letters?
One letter? What about the empty string, which is written <code class="docutils literal"><span class="pre">''</span></code> and
contains no letters?</li>
<li>Write a function called <code class="docutils literal"><span class="pre">is_palindrome</span></code> that takes a string
argument and returns True if it is a palindrome and False otherwise.
Remember that you can use the built-in function len to check the
length of a string.</li>
</ol>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/palindrome_soln.py">http://thinkpython2.com/code/palindrome_soln.py</a>.</p>
<p>A number, <span class="math">a</span>, is a power of <span class="math">b</span> if it is divisible by
<span class="math">b</span> and <span class="math">a/b</span> is a power of <span class="math">b</span>. Write a function
called <code class="docutils literal"><span class="pre">is_power</span></code> that takes parameters a and b and returns True if a
is a power of b. Note: you will have to think about the base case.</p>
<p>The greatest common divisor (GCD) of <span class="math">a</span> and <span class="math">b</span> is the
largest number that divides both of them with no remainder.</p>
<p>One way to find the GCD of two numbers is based on the observation that
if <span class="math">r</span> is the remainder when <span class="math">a</span> is divided by <span class="math">b</span>,
then <span class="math">gcd(a,
b) = gcd(b, r)</span>. As a base case, we can use <span class="math">gcd(a, 0) = a</span>.</p>
<p>Write a function called <code class="docutils literal"><span class="pre">gcd</span></code> that takes parameters a and b and
returns their greatest common divisor.</p>
<p>Credit: This exercise is based on an example from Abelson and Sussman’s
<em>Structure and Interpretation of Computer Programs</em>.</p>
</div>
</div>
<div class="section" id="iteration">
<h1>Iteration<a class="headerlink" href="#iteration" title="Permalink to this headline">¶</a></h1>
<p>This chapter is about iteration, which is the ability to run a block of
statements repeatedly. We saw a kind of iteration, using recursion, in
Section&nbsp;[recursion]. We saw another kind, using a for loop, in
Section&nbsp;[repetition]. In this chapter we’ll see yet another kind, using
a while statement. But first I want to say a little more about variable
assignment.</p>
<div class="section" id="reassignment">
<h2>Reassignment<a class="headerlink" href="#reassignment" title="Permalink to this headline">¶</a></h2>
<p>As you may have discovered, it is legal to make more than one assignment
to the same variable. A new assignment makes an existing variable refer
to a new value (and stop referring to the old value).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mi">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">7</span>
</pre></div>
</div>
<p>The first time we display x, its value is 5; the second time, its value
is 7.</p>
<p>Figure&nbsp;[fig.assign2] shows what <strong>reassignment</strong> looks like in a state
diagram.</p>
<p>At this point I want to address a common source of confusion. Because
Python uses the equal sign (=) for assignment, it is tempting to
interpret a statement like a = b as a mathematical proposition of
equality; that is, the claim that a and b are equal. But this
interpretation is wrong.</p>
<p>First, equality is a symmetric relationship and assignment is not. For
example, in mathematics, if <span class="math">a=7</span> then <span class="math">7=a</span>. But in Python,
the statement a = 7 is legal and 7 = a is not.</p>
<p>Also, in mathematics, a proposition of equality is either true or false
for all time. If <span class="math">a=b</span> now, then <span class="math">a</span> will always equal
<span class="math">b</span>. In Python, an assignment statement can make two variables
equal, but they don’t have to stay that way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>    <span class="c"># a and b are now equal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>    <span class="c"># a and b are no longer equal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">5</span>
</pre></div>
</div>
<p>The third line changes the value of a but does not change the value of
b, so they are no longer equal.</p>
<p>Reassigning variables is often useful, but you should use it with
caution. If the values of variables change frequently, it can make the
code difficult to read and debug.</p>
<div class="figure" id="id73">
<img alt="State diagram." src="_images/assign2.pdf" />
<p class="caption"><span class="caption-text">State diagram.</span></p>
</div>
</div>
<div class="section" id="updating-variables">
<h2>Updating variables<a class="headerlink" href="#updating-variables" title="Permalink to this headline">¶</a></h2>
<p>A common kind of reassignment is an <strong>update</strong>, where the new value of
the variable depends on the old.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>This means “get the current value of x, add one, and then update x with
the new value.”</p>
<p>If you try to update a variable that doesn’t exist, you get an error,
because Python evaluates the right side before it assigns a value to x:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="go">NameError: name &#39;x&#39; is not defined</span>
</pre></div>
</div>
<p>Before you can update a variable, you have to <strong>initialize</strong> it, usually
with a simple assignment:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Updating a variable by adding 1 is called an <strong>increment</strong>; subtracting
1 is called a <strong>decrement</strong>.</p>
</div>
<div class="section" id="the-while-statement">
<h2>The while statement<a class="headerlink" href="#the-while-statement" title="Permalink to this headline">¶</a></h2>
<p>Computers are often used to automate repetitive tasks. Repeating
identical or similar tasks without making errors is something that
computers do well and people do poorly. In a computer program,
repetition is also called <strong>iteration</strong>.</p>
<p>We have already seen two functions, countdown and <code class="docutils literal"><span class="pre">print_n</span></code>, that
iterate using recursion. Because iteration is so common, Python provides
language features to make it easier. One is the for statement we saw in
Section&nbsp;[repetition]. We’ll get back to that later.</p>
<p>Another is the while statement. Here is a version of countdown that uses
a while statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Blastoff!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can almost read the while statement as if it were English. It means,
“While n is greater than 0, display the value of n and then decrement n.
When you get to 0, display the word Blastoff!”</p>
<p>More formally, here is the flow of execution for a while statement:</p>
<ol class="arabic simple">
<li>Determine whether the condition is true or false.</li>
<li>If false, exit the while statement and continue execution at the next
statement.</li>
<li>If the condition is true, run the body and then go back to step 1.</li>
</ol>
<p>This type of flow is called a loop because the third step loops back
around to the top.</p>
<p>The body of the loop should change the value of one or more variables so
that the condition becomes false eventually and the loop terminates.
Otherwise the loop will repeat forever, which is called an <strong>infinite
loop</strong>. An endless source of amusement for computer scientists is the
observation that the directions on shampoo, “Lather, rinse, repeat”, are
an infinite loop.</p>
<p>In the case of countdown, we can prove that the loop terminates: if n is
zero or negative, the loop never runs. Otherwise, n gets smaller each
time through the loop, so eventually we have to get to 0.</p>
<p>For some other loops, it is not so easy to tell. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">sequence</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>        <span class="c"># n is even</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>                 <span class="c"># n is odd</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The condition for this loop is n != 1, so the loop will continue until n
is 1, which makes the condition false.</p>
<p>Each time through the loop, the program outputs the value of n and then
checks whether it is even or odd. If it is even, n is divided by 2. If
it is odd, the value of n is replaced with n*3 + 1. For example, if the
argument passed to sequence is 3, the resulting values of n are 3, 10,
5, 16, 8, 4, 2, 1.</p>
<p>Since n sometimes increases and sometimes decreases, there is no obvious
proof that n will ever reach 1, or that the program terminates. For some
particular values of n, we can prove termination. For example, if the
starting value is a power of two, n will be even every time through the
loop until it reaches 1. The previous example ends with such a sequence,
starting with 16.</p>
<p>The hard question is whether we can prove that this program terminates
for <em>all</em> positive values of n. So far, no one has been able to prove it
<em>or</em> disprove it! (See <a class="reference external" href="http://en.wikipedia.org/wiki/Collatz_conjecture">http://en.wikipedia.org/wiki/Collatz_conjecture</a>.)</p>
<p>As an exercise, rewrite the function <code class="docutils literal"><span class="pre">print_n</span></code> from
Section&nbsp;[recursion] using iteration instead of recursion.</p>
</div>
<div class="section" id="break">
<h2>break<a class="headerlink" href="#break" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you don’t know it’s time to end a loop until you get half way
through the body. In that case you can use the break statement to jump
out of the loop.</p>
<p>For example, suppose you want to take input from the user until they
type done. You could write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">&#39;&gt; &#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s">&#39;done&#39;</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Done!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The loop condition is True, which is always true, so the loop runs until
it hits the break statement.</p>
<p>Each time through, it prompts the user with an angle bracket. If the
user types done, the break statement exits the loop. Otherwise the
program echoes whatever the user types and goes back to the top of the
loop. Here’s a sample run:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; not done
not done
&gt; done
Done!
</pre></div>
</div>
<p>This way of writing while loops is common because you can check the
condition anywhere in the loop (not just at the top) and you can express
the stop condition affirmatively (“stop when this happens”) rather than
negatively (“keep going until that happens”).</p>
</div>
<div class="section" id="square-roots">
<h2>Square roots<a class="headerlink" href="#square-roots" title="Permalink to this headline">¶</a></h2>
<p>Loops are often used in programs that compute numerical results by
starting with an approximate answer and iteratively improving it.</p>
<p>For example, one way of computing square roots is Newton’s method.
Suppose that you want to know the square root of <span class="math">a</span>. If you start
with almost any estimate, <span class="math">x</span>, you can compute a better estimate
with the following formula:</p>
<div class="math">
<p><span class="math">y = \frac{x + a/x}{2}</span></p>
</div><p>For example, if <span class="math">a</span> is 4 and <span class="math">x</span> is 3:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">2.16666666667</span>
</pre></div>
</div>
<p>The result is closer to the correct answer (<span class="math">\sqrt{4} = 2</span>). If we
repeat the process with the new estimate, it gets even closer:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">2.00641025641</span>
</pre></div>
</div>
<p>After a few more updates, the estimate is almost exact:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">2.00001024003</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">2.00000000003</span>
</pre></div>
</div>
<p>In general we don’t know ahead of time how many steps it takes to get to
the right answer, but we know when we get there because the estimate
stops changing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">2.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">2.0</span>
</pre></div>
</div>
<p>When y == x, we can stop. Here is a loop that starts with an initial
estimate, x, and improves it until it stops changing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
</pre></div>
</div>
<p>For most values of a this works fine, but in general it is dangerous to
test float equality. Floating-point values are only approximately right:
most rational numbers, like <span class="math">1/3</span>, and irrational numbers, like
<span class="math">\sqrt{2}</span>, can’t be represented exactly with a float.</p>
<p>Rather than checking whether x and y are exactly equal, it is safer to
use the built-in function abs to compute the absolute value, or
magnitude, of the difference between them:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
    <span class="k">break</span>
</pre></div>
</div>
<p>Where <code class="docutils literal"><span class="pre">epsilon</span></code> has a value like 0.0000001 that determines how close
is close enough.</p>
</div>
<div class="section" id="algorithms">
<h2>Algorithms<a class="headerlink" href="#algorithms" title="Permalink to this headline">¶</a></h2>
<p>Newton’s method is an example of an <strong>algorithm</strong>: it is a mechanical
process for solving a category of problems (in this case, computing
square roots).</p>
<p>To understand what an algorithm is, it might help to start with
something that is not an algorithm. When you learned to multiply
single-digit numbers, you probably memorized the multiplication table.
In effect, you memorized 100 specific solutions. That kind of knowledge
is not algorithmic.</p>
<p>But if you were “lazy”, you might have learned a few tricks. For
example, to find the product of <span class="math">n</span> and 9, you can write
<span class="math">n-1</span> as the first digit and <span class="math">10-n</span> as the second digit.
This trick is a general solution for multiplying any single-digit number
by 9. That’s an algorithm!</p>
<p>Similarly, the techniques you learned for addition with carrying,
subtraction with borrowing, and long division are all algorithms. One of
the characteristics of algorithms is that they do not require any
intelligence to carry out. They are mechanical processes where each step
follows from the last according to a simple set of rules.</p>
<p>Executing algorithms is boring, but designing them is interesting,
intellectually challenging, and a central part of computer science.</p>
<p>Some of the things that people do naturally, without difficulty or
conscious thought, are the hardest to express algorithmically.
Understanding natural language is a good example. We all do it, but so
far no one has been able to explain <em>how</em> we do it, at least not in the
form of an algorithm.</p>
</div>
<div class="section" id="id18">
<h2>Debugging<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<p>As you start writing bigger programs, you might find yourself spending
more time debugging. More code means more chances to make an error and
more places for bugs to hide.</p>
<p>One way to cut your debugging time is “debugging by bisection”. For
example, if there are 100 lines in your program and you check them one
at a time, it would take 100 steps.</p>
<p>Instead, try to break the problem in half. Look at the middle of the
program, or near it, for an intermediate value you can check. Add a
print statement (or something else that has a verifiable effect) and run
the program.</p>
<p>If the mid-point check is incorrect, there must be a problem in the
first half of the program. If it is correct, the problem is in the
second half.</p>
<p>Every time you perform a check like this, you halve the number of lines
you have to search. After six steps (which is fewer than 100), you would
be down to one or two lines of code, at least in theory.</p>
<p>In practice it is not always clear what the “middle of the program” is
and not always possible to check it. It doesn’t make sense to count
lines and find the exact midpoint. Instead, think about places in the
program where there might be errors and places where it is easy to put a
check. Then choose a spot where you think the chances are about the same
that the bug is before or after the check.</p>
</div>
<div class="section" id="id19">
<h2>Glossary<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>reassignment:</dt>
<dd>Assigning a new value to a variable that already exists.</dd>
<dt>update:</dt>
<dd>An assignment where the new value of the variable depends on the
old.</dd>
<dt>initialization:</dt>
<dd>An assignment that gives an initial value to a variable that will be
updated.</dd>
<dt>increment:</dt>
<dd>An update that increases the value of a variable (often by one).</dd>
<dt>decrement:</dt>
<dd>An update that decreases the value of a variable.</dd>
<dt>iteration:</dt>
<dd>Repeated execution of a set of statements using either a recursive
function call or a loop.</dd>
<dt>infinite loop:</dt>
<dd>A loop in which the terminating condition is never satisfied.</dd>
<dt>algorithm:</dt>
<dd>A general process for solving a category of problems.</dd>
</dl>
</div>
<div class="section" id="id20">
<h2>Exercises<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h2>
<p>Copy the loop from Section&nbsp;[squareroot] and encapsulate it in a function
called <code class="docutils literal"><span class="pre">mysqrt</span></code> that takes a as a parameter, chooses a reasonable
value of x, and returns an estimate of the square root of a.</p>
<p>To test it, write a function named <code class="docutils literal"><span class="pre">test_square_root</span></code> that prints a
table like this:</p>
<div class="highlight-python"><div class="highlight"><pre>a   mysqrt(a)     math.sqrt(a)  diff
-   ---------     ------------  ----
1.0 1.0           1.0           0.0
2.0 1.41421356237 1.41421356237 2.22044604925e-16
3.0 1.73205080757 1.73205080757 0.0
4.0 2.0           2.0           0.0
5.0 2.2360679775  2.2360679775  0.0
6.0 2.44948974278 2.44948974278 0.0
7.0 2.64575131106 2.64575131106 0.0
8.0 2.82842712475 2.82842712475 4.4408920985e-16
9.0 3.0           3.0           0.0
</pre></div>
</div>
<p>The first column is a number, <span class="math">a</span>; the second column is the square
root of <span class="math">a</span> computed with <code class="docutils literal"><span class="pre">mysqrt</span></code>; the third column is the
square root computed by math.sqrt; the fourth column is the absolute
value of the difference between the two estimates.</p>
<p>The built-in function eval takes a string and evaluates it using the
Python interpreter. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">eval</span><span class="p">(</span><span class="s">&#39;1 + 2 * 3&#39;</span><span class="p">)</span>
<span class="go">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">math</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">eval</span><span class="p">(</span><span class="s">&#39;math.sqrt(5)&#39;</span><span class="p">)</span>
<span class="go">2.2360679774997898</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">eval</span><span class="p">(</span><span class="s">&#39;type(math.pi)&#39;</span><span class="p">)</span>
<span class="go">&lt;class &#39;float&#39;&gt;</span>
</pre></div>
</div>
<p>Write a function called <code class="docutils literal"><span class="pre">eval_loop</span></code> that iteratively prompts the user,
takes the resulting input and evaluates it using eval, and prints the
result.</p>
<p>It should continue until the user enters <code class="docutils literal"><span class="pre">'done'</span></code>, and then return the
value of the last expression it evaluated.</p>
<p>The mathematician Srinivasa Ramanujan found an infinite series that can
be used to generate a numerical approximation of <span class="math">1 / \pi</span>:</p>
<div class="math">
<p><span class="math">\frac{1}{\pi} = \frac{2\sqrt{2}}{9801}
\sum^\infty_{k=0} \frac{(4k)!(1103+26390k)}{(k!)^4 396^{4k}}</span></p>
</div><p>Write a function called <code class="docutils literal"><span class="pre">estimate_pi</span></code> that uses this formula to
compute and return an estimate of <span class="math">\pi</span>. It should use a while
loop to compute terms of the summation until the last term is smaller
than 1e-15 (which is Python notation for <span class="math">10^{-15}</span>). You can
check the result by comparing it to math.pi.</p>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/pi.py">http://thinkpython2.com/code/pi.py</a>.</p>
</div>
</div>
<div class="section" id="strings">
<h1>Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h1>
<p>Strings are not like integers, floats, and booleans. A string is a
<strong>sequence</strong>, which means it is an ordered collection of other values.
In this chapter you’ll see how to access the characters that make up a
string, and you’ll learn about some of the methods strings provide.</p>
<div class="section" id="a-string-is-a-sequence">
<h2>A string is a sequence<a class="headerlink" href="#a-string-is-a-sequence" title="Permalink to this headline">¶</a></h2>
<p>A string is a sequence of characters. You can access the characters one
at a time with the bracket operator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fruit</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">letter</span> <span class="o">=</span> <span class="n">fruit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>The second statement selects character number 1 from fruit and assigns
it to letter.</p>
<p>The expression in brackets is called an <strong>index</strong>. The index indicates
which character in the sequence you want (hence the name).</p>
<p>But you might not get what you expect:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">letter</span>
<span class="go">&#39;a&#39;</span>
</pre></div>
</div>
<p>For most people, the first letter of <code class="docutils literal"><span class="pre">'banana'</span></code> is b, not a. But for
computer scientists, the index is an offset from the beginning of the
string, and the offset of the first letter is zero.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">letter</span> <span class="o">=</span> <span class="n">fruit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">letter</span>
<span class="go">&#39;b&#39;</span>
</pre></div>
</div>
<p>So b is the 0th letter (“zero-eth”) of <code class="docutils literal"><span class="pre">'banana'</span></code>, a is the 1th letter
(“one-eth”), and n is the 2th letter (“two-eth”).</p>
<p>As an index you can use an expression that contains variables and
operators:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fruit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="go">&#39;a&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fruit</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="go">&#39;n&#39;</span>
</pre></div>
</div>
<p>But the value of the index has to be an integer. Otherwise you get:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">letter</span> <span class="o">=</span> <span class="n">fruit</span><span class="p">[</span><span class="mf">1.5</span><span class="p">]</span>
<span class="go">TypeError: string indices must be integers</span>
</pre></div>
</div>
</div>
<div class="section" id="len">
<h2>len<a class="headerlink" href="#len" title="Permalink to this headline">¶</a></h2>
<p>len is a built-in function that returns the number of characters in a
string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fruit</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">fruit</span><span class="p">)</span>
<span class="go">6</span>
</pre></div>
</div>
<p>To get the last letter of a string, you might be tempted to try
something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fruit</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">last</span> <span class="o">=</span> <span class="n">fruit</span><span class="p">[</span><span class="n">length</span><span class="p">]</span>
<span class="go">IndexError: string index out of range</span>
</pre></div>
</div>
<p>The reason for the IndexError is that there is no letter in ’banana’
with the index 6. Since we started counting at zero, the six letters are
numbered 0 to 5. To get the last character, you have to subtract 1 from
length:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">last</span> <span class="o">=</span> <span class="n">fruit</span><span class="p">[</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">last</span>
<span class="go">&#39;a&#39;</span>
</pre></div>
</div>
<p>Or you can use negative indices, which count backward from the end of
the string. The expression fruit[-1] yields the last letter, fruit[-2]
yields the second to last, and so on.</p>
</div>
<div class="section" id="traversal-with-a-for-loop">
<h2>Traversal with a for loop<a class="headerlink" href="#traversal-with-a-for-loop" title="Permalink to this headline">¶</a></h2>
<p>A lot of computations involve processing a string one character at a
time. Often they start at the beginning, select each character in turn,
do something to it, and continue until the end. This pattern of
processing is called a <strong>traversal</strong>. One way to write a traversal is
with a while loop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">fruit</span><span class="p">):</span>
    <span class="n">letter</span> <span class="o">=</span> <span class="n">fruit</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>This loop traverses the string and displays each letter on a line by
itself. The loop condition is index &lt; len(fruit), so when index is equal
to the length of the string, the condition is false, and the body of the
loop doesn’t run. The last character accessed is the one with the index
len(fruit)-1, which is the last character in the string.</p>
<p>As an exercise, write a function that takes a string as an argument and
displays the letters backward, one per line.</p>
<p>Another way to write a traversal is with a for loop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">fruit</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
</pre></div>
</div>
<p>Each time through the loop, the next character in the string is assigned
to the variable letter. The loop continues until no characters are left.</p>
<p>The following example shows how to use concatenation (string addition)
and a for loop to generate an abecedarian series (that is, in
alphabetical order). In Robert McCloskey’s book <em>Make Way for
Ducklings</em>, the names of the ducklings are Jack, Kack, Lack, Mack, Nack,
Ouack, Pack, and Quack. This loop outputs these names in order:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">prefixes</span> <span class="o">=</span> <span class="s">&#39;JKLMNOPQ&#39;</span>
<span class="n">suffix</span> <span class="o">=</span> <span class="s">&#39;ack&#39;</span>

<span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">letter</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Jack</span>
<span class="n">Kack</span>
<span class="n">Lack</span>
<span class="n">Mack</span>
<span class="n">Nack</span>
<span class="n">Oack</span>
<span class="n">Pack</span>
<span class="n">Qack</span>
</pre></div>
</div>
<p>Of course, that’s not quite right because “Ouack” and “Quack” are
misspelled. As an exercise, modify the program to fix this error.</p>
</div>
<div class="section" id="string-slices">
<h2>String slices<a class="headerlink" href="#string-slices" title="Permalink to this headline">¶</a></h2>
<p>A segment of a string is called a <strong>slice</strong>. Selecting a slice is
similar to selecting a character:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s">&#39;Monty Python&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="go">&#39;Monty&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
<span class="go">&#39;Python&#39;</span>
</pre></div>
</div>
<p>The operator returns the part of the string from the “n-eth” character
to the “m-eth” character, including the first but excluding the last.
This behavior is counterintuitive, but it might help to imagine the
indices pointing <em>between</em> the characters, as in Figure&nbsp;[fig.banana].</p>
<div class="figure" id="id74">
<img alt="Slice indices." src="_images/banana.pdf" />
<p class="caption"><span class="caption-text">Slice indices.</span></p>
</div>
<p>If you omit the first index (before the colon), the slice starts at the
beginning of the string. If you omit the second index, the slice goes to
the end of the string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fruit</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fruit</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">&#39;ban&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fruit</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
<span class="go">&#39;ana&#39;</span>
</pre></div>
</div>
<p>If the first index is greater than or equal to the second the result is
an <strong>empty string</strong>, represented by two quotation marks:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fruit</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fruit</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">&#39;&#39;</span>
</pre></div>
</div>
<p>An empty string contains no characters and has length 0, but other than
that, it is the same as any other string.</p>
<p>Continuing this example, what do you think fruit[:] means? Try it and
see.</p>
</div>
<div class="section" id="strings-are-immutable">
<h2>Strings are immutable<a class="headerlink" href="#strings-are-immutable" title="Permalink to this headline">¶</a></h2>
<p>It is tempting to use the operator on the left side of an assignment,
with the intention of changing a character in a string. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">greeting</span> <span class="o">=</span> <span class="s">&#39;Hello, world!&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">greeting</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span>
<span class="go">TypeError: &#39;str&#39; object does not support item assignment</span>
</pre></div>
</div>
<p>The “object” in this case is the string and the “item” is the character
you tried to assign. For now, an object is the same thing as a value,
but we will refine that definition later (Section&nbsp;[equivalence]).</p>
<p>The reason for the error is that strings are <strong>immutable</strong>, which means
you can’t change an existing string. The best you can do is create a new
string that is a variation on the original:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">greeting</span> <span class="o">=</span> <span class="s">&#39;Hello, world!&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_greeting</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="n">greeting</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_greeting</span>
<span class="go">&#39;Jello, world!&#39;</span>
</pre></div>
</div>
<p>This example concatenates a new first letter onto a slice of greeting.
It has no effect on the original string.</p>
</div>
<div class="section" id="searching">
<h2>Searching<a class="headerlink" href="#searching" title="Permalink to this headline">¶</a></h2>
<p>What does the following function do?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">letter</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">word</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="n">letter</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">index</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>In a sense, find is the inverse of the operator. Instead of taking an
index and extracting the corresponding character, it takes a character
and finds the index where that character appears. If the character is
not found, the function returns -1.</p>
<p>This is the first example we have seen of a return statement inside a
loop. If word[index] == letter, the function breaks out of the loop and
returns immediately.</p>
<p>If the character doesn’t appear in the string, the program exits the
loop normally and returns -1.</p>
<p>This pattern of computation—traversing a sequence and returning when we
find what we are looking for—is called a <strong>search</strong>.</p>
<p>As an exercise, modify find so that it has a third parameter, the index
in word where it should start looking.</p>
</div>
<div class="section" id="looping-and-counting">
<h2>Looping and counting<a class="headerlink" href="#looping-and-counting" title="Permalink to this headline">¶</a></h2>
<p>The following program counts the number of times the letter a appears in
a string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">word</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">letter</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</pre></div>
</div>
<p>This program demonstrates another pattern of computation called a
<strong>counter</strong>. The variable count is initialized to 0 and then incremented
each time an a is found. When the loop exits, count contains the
result—the total number of a’s.</p>
<p>As an exercise, encapsulate this code in a function named count, and
generalize it so that it accepts the string and the letter as arguments.</p>
<p>Then rewrite the function so that instead of traversing the string, it
uses the three-parameter version of find from the previous section.</p>
</div>
<div class="section" id="string-methods">
<h2>String methods<a class="headerlink" href="#string-methods" title="Permalink to this headline">¶</a></h2>
<p>Strings provide methods that perform a variety of useful operations. A
method is similar to a function—it takes arguments and returns a
value—but the syntax is different. For example, the method upper takes a
string and returns a new string with all uppercase letters.</p>
<p>Instead of the function syntax upper(word), it uses the method syntax
word.upper().</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">word</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_word</span>
<span class="go">&#39;BANANA&#39;</span>
</pre></div>
</div>
<p>This form of dot notation specifies the name of the method, upper, and
the name of the string to apply the method to, word. The empty
parentheses indicate that this method takes no arguments.</p>
<p>A method call is called an <strong>invocation</strong>; in this case, we would say
that we are invoking upper on word.</p>
<p>As it turns out, there is a string method named find that is remarkably
similar to the function we wrote:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">word</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index</span>
<span class="go">1</span>
</pre></div>
</div>
<p>In this example, we invoke find on word and pass the letter we are
looking for as a parameter.</p>
<p>Actually, the find method is more general than our function; it can find
substrings, not just characters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;na&#39;</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>By default, find starts at the beginning of the string, but it can take
a second argument, the index where it should start:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">word</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;na&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">4</span>
</pre></div>
</div>
<p>This is an example of an <strong>optional argument</strong>; find can also take a
third argument, the index where it should stop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;bob&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">-1</span>
</pre></div>
</div>
<p>This search fails because b does not appear in the index range from 1 to
2, not including 2. Searching up to, but not including, the second index
makes find consistent with the slice operator.</p>
</div>
<div class="section" id="the-in-operator">
<h2>The in operator<a class="headerlink" href="#the-in-operator" title="Permalink to this headline">¶</a></h2>
<p>The word in is a boolean operator that takes two strings and returns
True if the first appears as a substring in the second:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;a&#39;</span> <span class="ow">in</span> <span class="s">&#39;banana&#39;</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;seed&#39;</span> <span class="ow">in</span> <span class="s">&#39;banana&#39;</span>
<span class="go">False</span>
</pre></div>
</div>
<p>For example, the following function prints all the letters from word1
that also appear in word2:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">in_both</span><span class="p">(</span><span class="n">word1</span><span class="p">,</span> <span class="n">word2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word2</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
</pre></div>
</div>
<p>With well-chosen variable names, Python sometimes reads like English.
You could read this loop, “for (each) letter in (the first) word, if
(the) letter (appears) in (the second) word, print (the) letter.”</p>
<p>Here’s what you get if you compare apples and oranges:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">in_both</span><span class="p">(</span><span class="s">&#39;apples&#39;</span><span class="p">,</span> <span class="s">&#39;oranges&#39;</span><span class="p">)</span>
<span class="go">a</span>
<span class="go">e</span>
<span class="go">s</span>
</pre></div>
</div>
</div>
<div class="section" id="string-comparison">
<h2>String comparison<a class="headerlink" href="#string-comparison" title="Permalink to this headline">¶</a></h2>
<p>The relational operators work on strings. To see if two strings are
equal:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">word</span> <span class="o">==</span> <span class="s">&#39;banana&#39;</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;All right, bananas.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Other relational operations are useful for putting words in alphabetical
order:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">word</span> <span class="o">&lt;</span> <span class="s">&#39;banana&#39;</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Your word, &#39;</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s">&#39;, comes before banana.&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">word</span> <span class="o">&gt;</span> <span class="s">&#39;banana&#39;</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Your word, &#39;</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s">&#39;, comes after banana.&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;All right, bananas.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Python does not handle uppercase and lowercase letters the same way
people do. All the uppercase letters come before all the lowercase
letters, so:</p>
<div class="highlight-python"><div class="highlight"><pre>Your word, Pineapple, comes before banana.
</pre></div>
</div>
<p>A common way to address this problem is to convert strings to a standard
format, such as all lowercase, before performing the comparison. Keep
that in mind in case you have to defend yourself against a man armed
with a Pineapple.</p>
</div>
<div class="section" id="id21">
<h2>Debugging<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<p>When you use indices to traverse the values in a sequence, it is tricky
to get the beginning and end of the traversal right. Here is a function
that is supposed to compare two words and return True if one of the
words is the reverse of the other, but it contains two errors:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_reverse</span><span class="p">(</span><span class="n">word1</span><span class="p">,</span> <span class="n">word2</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word2</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">j</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word2</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">word2</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span>

    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>The first if statement checks whether the words are the same length. If
not, we can return False immediately. Otherwise, for the rest of the
function, we can assume that the words are the same length. This is an
example of the guardian pattern in Section&nbsp;[guardian].</p>
<p>i and j are indices: i traverses word1 forward while j traverses word2
backward. If we find two letters that don’t match, we can return False
immediately. If we get through the whole loop and all the letters match,
we return True.</p>
<p>If we test this function with the words “pots” and “stop”, we expect the
return value True, but we get an IndexError:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">is_reverse</span><span class="p">(</span><span class="s">&#39;pots&#39;</span><span class="p">,</span> <span class="s">&#39;stop&#39;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">  File &quot;reverse.py&quot;, line 15, in is_reverse</span>
<span class="go">    if word1[i] != word2[j]:</span>
<span class="go">IndexError: string index out of range</span>
</pre></div>
</div>
<p>For debugging this kind of error, my first move is to print the values
of the indices immediately before the line where the error appears.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">while</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>        <span class="c"># print here</span>

    <span class="k">if</span> <span class="n">word1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">word2</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>Now when I run the program again, I get more information:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">is_reverse</span><span class="p">(</span><span class="s">&#39;pots&#39;</span><span class="p">,</span> <span class="s">&#39;stop&#39;</span><span class="p">)</span>
<span class="go">0 4</span>
<span class="gp">...</span>
<span class="go">IndexError: string index out of range</span>
</pre></div>
</div>
<p>The first time through the loop, the value of j is 4, which is out of
range for the string <code class="docutils literal"><span class="pre">'pots'</span></code>. The index of the last character is 3,
so the initial value for j should be len(word2)-1.</p>
<p>If I fix that error and run the program again, I get:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">is_reverse</span><span class="p">(</span><span class="s">&#39;pots&#39;</span><span class="p">,</span> <span class="s">&#39;stop&#39;</span><span class="p">)</span>
<span class="go">0 3</span>
<span class="go">1 2</span>
<span class="go">2 1</span>
<span class="go">True</span>
</pre></div>
</div>
<p>This time we get the right answer, but it looks like the loop only ran
three times, which is suspicious. To get a better idea of what is
happening, it is useful to draw a state diagram. During the first
iteration, the frame for <code class="docutils literal"><span class="pre">is_reverse</span></code> is shown in Figure&nbsp;[fig.state4].</p>
<div class="figure" id="id75">
<img alt="State diagram." src="_images/state4.pdf" />
<p class="caption"><span class="caption-text">State diagram.</span></p>
</div>
<p>I took some license by arranging the variables in the frame and adding
dotted lines to show that the values of i and j indicate characters in
word1 and word2.</p>
<p>Starting with this diagram, run the program on paper, changing the
values of i and j during each iteration. Find and fix the second error
in this function. [isreverse]</p>
</div>
<div class="section" id="id22">
<h2>Glossary<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>object:</dt>
<dd>Something a variable can refer to. For now, you can use “object” and
“value” interchangeably.</dd>
<dt>sequence:</dt>
<dd>An ordered collection of values where each value is identified by an
integer index.</dd>
<dt>item:</dt>
<dd>One of the values in a sequence.</dd>
<dt>index:</dt>
<dd>An integer value used to select an item in a sequence, such as a
character in a string. In Python indices start from 0.</dd>
<dt>slice:</dt>
<dd>A part of a string specified by a range of indices.</dd>
<dt>empty string:</dt>
<dd>A string with no characters and length 0, represented by two
quotation marks.</dd>
<dt>immutable:</dt>
<dd>The property of a sequence whose items cannot be changed.</dd>
<dt>traverse:</dt>
<dd>To iterate through the items in a sequence, performing a similar
operation on each.</dd>
<dt>search:</dt>
<dd>A pattern of traversal that stops when it finds what it is looking
for.</dd>
<dt>counter:</dt>
<dd>A variable used to count something, usually initialized to zero and
then incremented.</dd>
<dt>invocation:</dt>
<dd>A statement that calls a method.</dd>
<dt>optional argument:</dt>
<dd>A function or method argument that is not required.</dd>
</dl>
</div>
<div class="section" id="id23">
<h2>Exercises<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<p>Read the documentation of the string methods at
<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#string-methods">http://docs.python.org/3/library/stdtypes.html#string-methods</a>. You might
want to experiment with some of them to make sure you understand how
they work. strip and replace are particularly useful.</p>
<p>The documentation uses a syntax that might be confusing. For example, in
<code class="docutils literal"><span class="pre">find(sub[,</span> <span class="pre">start[,</span> <span class="pre">end]])</span></code>, the brackets indicate optional arguments.
So sub is required, but start is optional, and if you include start,
then end is optional.</p>
<p>There is a string method called count that is similar to the function in
Section&nbsp;[counter]. Read the documentation of this method and write an
invocation that counts the number of a’s in <code class="docutils literal"><span class="pre">'banana'</span></code>.</p>
<p>A string slice can take a third index that specifies the “step size”;
that is, the number of spaces between successive characters. A step size
of 2 means every other character; 3 means every third, etc.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fruit</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fruit</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="go">&#39;bnn&#39;</span>
</pre></div>
</div>
<p>A step size of -1 goes through the word backwards, so the slice
<code class="docutils literal"><span class="pre">[::-1]</span></code> generates a reversed string.</p>
<p>Use this idiom to write a one-line version of <code class="docutils literal"><span class="pre">is_palindrome</span></code> from
Exercise&nbsp;[palindrome].</p>
<p>The following functions are all <em>intended</em> to check whether a string
contains any lowercase letters, but at least some of them are wrong. For
each function, describe what the function actually does (assuming that
the parameter is a string).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">any_lowercase1</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">any_lowercase2</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;c&#39;</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
            <span class="k">return</span> <span class="s">&#39;True&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;False&#39;</span>

<span class="k">def</span> <span class="nf">any_lowercase3</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">flag</span>

<span class="k">def</span> <span class="nf">any_lowercase4</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="ow">or</span> <span class="n">c</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">flag</span>

<span class="k">def</span> <span class="nf">any_lowercase5</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>[exrotate] A Caesar cypher is a weak form of encryption that involves
“rotating” each letter by a fixed number of places. To rotate a letter
means to shift it through the alphabet, wrapping around to the beginning
if necessary, so ’A’ rotated by 3 is ’D’ and ’Z’ rotated by 1 is ’A’.</p>
<p>To rotate a word, rotate each letter by the same amount. For example,
“cheer” rotated by 7 is “jolly” and “melon” rotated by -10 is “cubed”.
In the movie <em>2001: A Space Odyssey</em>, the ship computer is called HAL,
which is IBM rotated by -1.</p>
<p>Write a function called <code class="docutils literal"><span class="pre">rotate_word</span></code> that takes a string and an
integer as parameters, and returns a new string that contains the
letters from the original string rotated by the given amount.</p>
<p>You might want to use the built-in function ord, which converts a
character to a numeric code, and chr, which converts numeric codes to
characters. Letters of the alphabet are encoded in alphabetical order,
so for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>Because <code class="docutils literal"><span class="pre">'c'</span></code> is the two-eth letter of the alphabet. But beware: the
numeric codes for upper case letters are different.</p>
<p>Potentially offensive jokes on the Internet are sometimes encoded in
ROT13, which is a Caesar cypher with rotation 13. If you are not easily
offended, find and decode some of them. Solution:
<a class="reference external" href="http://thinkpython2.com/code/rotate.py">http://thinkpython2.com/code/rotate.py</a>.</p>
</div>
</div>
<div class="section" id="case-study-word-play">
<h1>Case study: word play<a class="headerlink" href="#case-study-word-play" title="Permalink to this headline">¶</a></h1>
<p>This chapter presents the second case study, which involves solving word
puzzles by searching for words that have certain properties. For
example, we’ll find the longest palindromes in English and search for
words whose letters appear in alphabetical order. And I will present
another program development plan: reduction to a previously solved
problem.</p>
<div class="section" id="reading-word-lists">
<h2>Reading word lists<a class="headerlink" href="#reading-word-lists" title="Permalink to this headline">¶</a></h2>
<p>For the exercises in this chapter we need a list of English words. There
are lots of word lists available on the Web, but the one most suitable
for our purpose is one of the word lists collected and contributed to
the public domain by Grady Ward as part of the Moby lexicon project (see
<a class="reference external" href="http://wikipedia.org/wiki/Moby_Project">http://wikipedia.org/wiki/Moby_Project</a>). It is a list of 113,809
official crosswords; that is, words that are considered valid in
crossword puzzles and other word games. In the Moby collection, the
filename is 113809of.fic; you can download a copy, with the simpler name
words.txt, from <a class="reference external" href="http://thinkpython2.com/code/words.txt">http://thinkpython2.com/code/words.txt</a>.</p>
<p>This file is in plain text, so you can open it with a text editor, but
you can also read it from Python. The built-in function open takes the
name of the file as a parameter and returns a <strong>file object</strong> you can
use to read the file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;words.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>fin is a common name for a file object used for input. The file object
provides several methods for reading, including readline, which reads
characters from the file until it gets to a newline and returns the
result as a string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="go">&#39;aa\r\n&#39;</span>
</pre></div>
</div>
<p>The first word in this particular list is “aa”, which is a kind of lava.
The sequence <code class="docutils literal"><span class="pre">\r\n</span></code> represents two whitespace characters, a carriage
return and a newline, that separate this word from the next.</p>
<p>The file object keeps track of where it is in the file, so if you call
readline again, you get the next word:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="go">&#39;aah\r\n&#39;</span>
</pre></div>
</div>
<p>The next word is “aah”, which is a perfectly legitimate word, so stop
looking at me like that. Or, if it’s the whitespace that’s bothering
you, we can get rid of it with the string method strip:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">line</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word</span>
<span class="go">&#39;aahed&#39;</span>
</pre></div>
</div>
<p>You can also use a file object as part of a for loop. This program reads
words.txt and prints each word, one per line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;words.txt&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id24">
<h2>Exercises<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h2>
<p>There are solutions to these exercises in the next section. You should
at least attempt each one before you read the solutions.</p>
<p>Write a program that reads words.txt and prints only the words with more
than 20 characters (not counting whitespace).</p>
<p>In 1939 Ernest Vincent Wright published a 50,000 word novel called
<em>Gadsby</em> that does not contain the letter “e”. Since “e” is the most
common letter in English, that’s not easy to do.</p>
<p>In fact, it is difficult to construct a solitary thought without using
that most common symbol. It is slow going at first, but with caution and
hours of training you can gradually gain facility.</p>
<p>All right, I’ll stop now.</p>
<p>Write a function called <code class="docutils literal"><span class="pre">has_no_e</span></code> that returns True if the given word
doesn’t have the letter “e” in it.</p>
<p>Modify your program from the previous section to print only the words
that have no “e” and compute the percentage of the words in the list
that have no “e”.</p>
<p>Write a function named avoids that takes a word and a string of
forbidden letters, and that returns True if the word doesn’t use any of
the forbidden letters.</p>
<p>Modify your program to prompt the user to enter a string of forbidden
letters and then print the number of words that don’t contain any of
them. Can you find a combination of 5 forbidden letters that excludes
the smallest number of words?</p>
<p>Write a function named <code class="docutils literal"><span class="pre">uses_only</span></code> that takes a word and a string of
letters, and that returns True if the word contains only letters in the
list. Can you make a sentence using only the letters acefhlo? Other than
“Hoe alfalfa?”</p>
<p>Write a function named <code class="docutils literal"><span class="pre">uses_all</span></code> that takes a word and a string of
required letters, and that returns True if the word uses all the
required letters at least once. How many words are there that use all
the vowels aeiou? How about aeiouy?</p>
<p>Write a function called <code class="docutils literal"><span class="pre">is_abecedarian</span></code> that returns True if the
letters in a word appear in alphabetical order (double letters are ok).
How many abecedarian words are there?</p>
</div>
<div class="section" id="search">
<h2>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h2>
<p>All of the exercises in the previous section have something in common;
they can be solved with the search pattern we saw in Section&nbsp;[find]. The
simplest example is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">has_no_e</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">letter</span> <span class="o">==</span> <span class="s">&#39;e&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>The for loop traverses the characters in word. If we find the letter
“e”, we can immediately return False; otherwise we have to go to the
next letter. If we exit the loop normally, that means we didn’t find an
“e”, so we return True.</p>
<p>You could write this function more concisely using the in operator, but
I started with this version because it demonstrates the logic of the
search pattern.</p>
<p>is a more general version of <code class="docutils literal"><span class="pre">has_no_e</span></code> but it has the same structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">avoids</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">forbidden</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">forbidden</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>We can return False as soon as we find a forbidden letter; if we get to
the end of the loop, we return True.</p>
<p><code class="docutils literal"><span class="pre">uses_only</span></code> is similar except that the sense of the condition is
reversed:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">uses_only</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">letter</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>Instead of a list of forbidden letters, we have a list of available
letters. If we find a letter in word that is not in available, we can
return False.</p>
<p><code class="docutils literal"><span class="pre">uses_all</span></code> is similar except that we reverse the role of the word and
the string of letters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">uses_all</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">required</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">required</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">letter</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>Instead of traversing the letters in word, the loop traverses the
required letters. If any of the required letters do not appear in the
word, we can return False.</p>
<p>If you were really thinking like a computer scientist, you would have
recognized that <code class="docutils literal"><span class="pre">uses_all</span></code> was an instance of a previously solved
problem, and you would have written:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">uses_all</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">required</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">uses_only</span><span class="p">(</span><span class="n">required</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
</pre></div>
</div>
<p>This is an example of a program development plan called <strong>reduction to a
previously solved problem</strong>, which means that you recognize the problem
you are working on as an instance of a solved problem and apply an
existing solution.</p>
</div>
<div class="section" id="looping-with-indices">
<h2>Looping with indices<a class="headerlink" href="#looping-with-indices" title="Permalink to this headline">¶</a></h2>
<p>I wrote the functions in the previous section with for loops because I
only needed the characters in the strings; I didn’t have to do anything
with the indices.</p>
<p>For <code class="docutils literal"><span class="pre">is_abecedarian</span></code> we have to compare adjacent letters, which is a
little tricky with a for loop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_abecedarian</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="n">previous</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">previous</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>An alternative is to use recursion:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_abecedarian</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">is_abecedarian</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
<p>Another option is to use a while loop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_abecedarian</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>The loop starts at i=0 and ends when i=len(word)-1. Each time through
the loop, it compares the <span class="math">i</span>th character (which you can think
of as the current character) to the <span class="math">i+1</span>th character (which you
can think of as the next).</p>
<p>If the next character is less than (alphabetically before) the current
one, then we have discovered a break in the abecedarian trend, and we
return False.</p>
<p>If we get to the end of the loop without finding a fault, then the word
passes the test. To convince yourself that the loop ends correctly,
consider an example like <code class="docutils literal"><span class="pre">'flossy'</span></code>. The length of the word is 6, so
the last time the loop runs is when i is 4, which is the index of the
second-to-last character. On the last iteration, it compares the
second-to-last character to the last, which is what we want.</p>
<p>Here is a version of <code class="docutils literal"><span class="pre">is_palindrome</span></code> (see Exercise&nbsp;[palindrome]) that
uses two indices; one starts at the beginning and goes up; the other
starts at the end and goes down.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_palindrome</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">j</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

    <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">j</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">word</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span>

    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>Or we could reduce to a previously solved problem and write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_palindrome</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">is_reverse</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
</pre></div>
</div>
<p>Using <code class="docutils literal"><span class="pre">is_reverse</span></code> from Section&nbsp;[isreverse].</p>
</div>
<div class="section" id="id25">
<h2>Debugging<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h2>
<p>Testing programs is hard. The functions in this chapter are relatively
easy to test because you can check the results by hand. Even so, it is
somewhere between difficult and impossible to choose a set of words that
test for all possible errors.</p>
<p>Taking <code class="docutils literal"><span class="pre">has_no_e</span></code> as an example, there are two obvious cases to check:
words that have an ‘e’ should return False, and words that don’t should
return True. You should have no trouble coming up with one of each.</p>
<p>Within each case, there are some less obvious subcases. Among the words
that have an “e”, you should test words with an “e” at the beginning,
the end, and somewhere in the middle. You should test long words, short
words, and very short words, like the empty string. The empty string is
an example of a <strong>special case</strong>, which is one of the non-obvious cases
where errors often lurk.</p>
<p>In addition to the test cases you generate, you can also test your
program with a word list like words.txt. By scanning the output, you
might be able to catch errors, but be careful: you might catch one kind
of error (words that should not be included, but are) and not another
(words that should be included, but aren’t).</p>
<p>In general, testing can help you find bugs, but it is not easy to
generate a good set of test cases, and even if you do, you can’t be sure
your program is correct. According to a legendary computer scientist:</p>
<blockquote>
<div><p>Program testing can be used to show the presence of bugs, but never
to show their absence!</p>
<p class="attribution">&mdash;Edsger W. Dijkstra</p>
</div></blockquote>
</div>
<div class="section" id="id26">
<h2>Glossary<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>file object:</dt>
<dd>A value that represents an open file.</dd>
<dt>reduction to a previously solved problem:</dt>
<dd>A way of solving a problem by expressing it as an instance of a
previously solved problem.</dd>
<dt>special case:</dt>
<dd>A test case that is atypical or non-obvious (and less likely to be
handled correctly).</dd>
</dl>
</div>
<div class="section" id="id27">
<h2>Exercises<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h2>
<p>This question is based on a Puzzler that was broadcast on the radio
program <em>Car Talk</em> (<a class="reference external" href="http://www.cartalk.com/content/puzzlers">http://www.cartalk.com/content/puzzlers</a>):</p>
<blockquote>
<div>Give me a word with three consecutive double letters. I’ll give you
a couple of words that almost qualify, but don’t. For example, the
word committee, c-o-m-m-i-t-t-e-e. It would be great except for the
‘i’ that sneaks in there. Or Mississippi: M-i-s-s-i-s-s-i-p-p-i. If
you could take out those i’s it would work. But there is a word that
has three consecutive pairs of letters and to the best of my
knowledge this may be the only word. Of course there are probably
500 more but I can only think of one. What is the word?</div></blockquote>
<p>Write a program to find it. Solution:
<a class="reference external" href="http://thinkpython2.com/code/cartalk1.py">http://thinkpython2.com/code/cartalk1.py</a>.</p>
<p>Here’s another <em>Car Talk</em> Puzzler
(<a class="reference external" href="http://www.cartalk.com/content/puzzlers">http://www.cartalk.com/content/puzzlers</a>):</p>
<blockquote>
<div><p>``I was driving on the highway the other day and I happened to
notice my odometer. Like most odometers, it shows six digits, in
whole miles only. So, if my car had 300,000 miles, for example, I’d
see 3-0-0-0-0-0.</p>
<p>``Now, what I saw that day was very interesting. I noticed that
the last 4 digits were palindromic; that is, they read the same
forward as backward. For example, 5-4-4-5 is a palindrome, so my
odometer could have read 3-1-5-4-4-5.</p>
<p>``One mile later, the last 5 numbers were palindromic. For
example, it could have read 3-6-5-4-5-6. One mile after that, the
middle 4 out of 6 numbers were palindromic. And you ready for this?
One mile later, all 6 were palindromic!</p>
<p>“The question is, what was on the odometer when I first looked?”</p>
</div></blockquote>
<p>Write a Python program that tests all the six-digit numbers and prints
any numbers that satisfy these requirements. Solution:
<a class="reference external" href="http://thinkpython2.com/code/cartalk2.py">http://thinkpython2.com/code/cartalk2.py</a>.</p>
<p>Here’s another <em>Car Talk</em> Puzzler you can solve with a search
(<a class="reference external" href="http://www.cartalk.com/content/puzzlers">http://www.cartalk.com/content/puzzlers</a>):</p>
<blockquote>
<div><p>``Recently I had a visit with my mom and we realized that the two
digits that make up my age when reversed resulted in her age. For
example, if she’s 73, I’m 37. We wondered how often this has
happened over the years but we got sidetracked with other topics and
we never came up with an answer.</p>
<p>“When I got home I figured out that the digits of our ages have been
reversible six times so far. I also figured out that if we’re lucky
it would happen again in a few years, and if we’re really lucky it
would happen one more time after that. In other words, it would have
happened 8 times over all. So the question is, how old am I now?”</p>
</div></blockquote>
<p>Write a Python program that searches for solutions to this Puzzler.
Hint: you might find the string method zfill useful.</p>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/cartalk3.py">http://thinkpython2.com/code/cartalk3.py</a>.</p>
</div>
</div>
<div class="section" id="lists">
<h1>Lists<a class="headerlink" href="#lists" title="Permalink to this headline">¶</a></h1>
<p>This chapter presents one of Python’s most useful built-in types, lists.
You will also learn more about objects and what can happen when you have
more than one name for the same object.</p>
<div class="section" id="a-list-is-a-sequence">
<h2>A list is a sequence<a class="headerlink" href="#a-list-is-a-sequence" title="Permalink to this headline">¶</a></h2>
<p>Like a string, a <strong>list</strong> is a sequence of values. In a string, the
values are characters; in a list, they can be any type. The values in a
list are called <strong>elements</strong> or sometimes <strong>items</strong>.</p>
<p>There are several ways to create a new list; the simplest is to enclose
the elements in square brackets (<code class="docutils literal"><span class="pre">[</span></code> and <code class="docutils literal"><span class="pre">]</span></code>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
<span class="p">[</span><span class="s">&#39;crunchy frog&#39;</span><span class="p">,</span> <span class="s">&#39;ram bladder&#39;</span><span class="p">,</span> <span class="s">&#39;lark vomit&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The first example is a list of four integers. The second is a list of
three strings. The elements of a list don’t have to be the same type.
The following list contains a string, a float, an integer, and (lo!)
another list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;spam&#39;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]]</span>
</pre></div>
</div>
<p>A list within another list is <strong>nested</strong>.</p>
<p>A list that contains no elements is called an empty list; you can create
one with empty brackets, <code class="docutils literal"><span class="pre">[]</span></code>.</p>
<p>As you might expect, you can assign list values to variables:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cheeses</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Cheddar&#39;</span><span class="p">,</span> <span class="s">&#39;Edam&#39;</span><span class="p">,</span> <span class="s">&#39;Gouda&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">123</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">empty</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">cheeses</span><span class="p">,</span> <span class="n">numbers</span><span class="p">,</span> <span class="n">empty</span><span class="p">)</span>
<span class="go">[&#39;Cheddar&#39;, &#39;Edam&#39;, &#39;Gouda&#39;] [42, 123] []</span>
</pre></div>
</div>
</div>
<div class="section" id="lists-are-mutable">
<h2>Lists are mutable<a class="headerlink" href="#lists-are-mutable" title="Permalink to this headline">¶</a></h2>
<p>The syntax for accessing the elements of a list is the same as for
accessing the characters of a string—the bracket operator. The
expression inside the brackets specifies the index. Remember that the
indices start at 0:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cheeses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;Cheddar&#39;</span>
</pre></div>
</div>
<p>Unlike strings, lists are mutable. When the bracket operator appears on
the left side of an assignment, it identifies the element of the list
that will be assigned.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">123</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">numbers</span>
<span class="go">[42, 5]</span>
</pre></div>
</div>
<p>The one-eth element of numbers, which used to be 123, is now 5.</p>
<p>Figure&nbsp;[fig.liststate] shows the state diagram for cheeses, numbers and
empty:</p>
<div class="figure" id="id76">
<img alt="State diagram." src="_images/liststate.pdf" />
<p class="caption"><span class="caption-text">State diagram.</span></p>
</div>
<p>Lists are represented by boxes with the word “list” outside and the
elements of the list inside. cheeses refers to a list with three
elements indexed 0, 1 and 2. numbers contains two elements; the diagram
shows that the value of the second element has been reassigned from 123
to 5. empty refers to a list with no elements.</p>
<p>List indices work the same way as string indices:</p>
<ul class="simple">
<li>Any integer expression can be used as an index.</li>
<li>If you try to read or write an element that does not exist, you get
an IndexError.</li>
<li>If an index has a negative value, it counts backward from the end of
the list.</li>
</ul>
<p>The in operator also works on lists.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cheeses</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Cheddar&#39;</span><span class="p">,</span> <span class="s">&#39;Edam&#39;</span><span class="p">,</span> <span class="s">&#39;Gouda&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;Edam&#39;</span> <span class="ow">in</span> <span class="n">cheeses</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;Brie&#39;</span> <span class="ow">in</span> <span class="n">cheeses</span>
<span class="go">False</span>
</pre></div>
</div>
</div>
<div class="section" id="traversing-a-list">
<h2>Traversing a list<a class="headerlink" href="#traversing-a-list" title="Permalink to this headline">¶</a></h2>
<p>The most common way to traverse the elements of a list is with a for
loop. The syntax is the same as for strings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">cheese</span> <span class="ow">in</span> <span class="n">cheeses</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">cheese</span><span class="p">)</span>
</pre></div>
</div>
<p>This works well if you only need to read the elements of the list. But
if you want to write or update the elements, you need the indices. A
common way to do that is to combine the built-in functions range and
len:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">)):</span>
    <span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
</pre></div>
</div>
<p>This loop traverses the list and updates each element. len returns the
number of elements in the list. range returns a list of indices from 0
to <span class="math">n-1</span>, where <span class="math">n</span> is the length of the list. Each time
through the loop i gets the index of the next element. The assignment
statement in the body uses i to read the old value of the element and to
assign the new value.</p>
<p>A for loop over an empty list never runs the body:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[]:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;This never happens.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Although a list can contain another list, the nested list still counts
as a single element. The length of this list is four:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;spam&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Brie&#39;</span><span class="p">,</span> <span class="s">&#39;Roquefort&#39;</span><span class="p">,</span> <span class="s">&#39;Pol le Veq&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="section" id="list-operations">
<h2>List operations<a class="headerlink" href="#list-operations" title="Permalink to this headline">¶</a></h2>
<p>The + operator concatenates lists:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span>
<span class="go">[1, 2, 3, 4, 5, 6]</span>
</pre></div>
</div>
<p>The operator repeats a list a given number of times:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
<span class="go">[0, 0, 0, 0]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
<span class="go">[1, 2, 3, 1, 2, 3, 1, 2, 3]</span>
</pre></div>
</div>
<p>The first example repeats four times. The second example repeats the
list three times.</p>
</div>
<div class="section" id="list-slices">
<h2>List slices<a class="headerlink" href="#list-slices" title="Permalink to this headline">¶</a></h2>
<p>The slice operator also works on lists:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">[&#39;b&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
<span class="go">[&#39;d&#39;, &#39;e&#39;, &#39;f&#39;]</span>
</pre></div>
</div>
<p>If you omit the first index, the slice starts at the beginning. If you
omit the second, the slice goes to the end. So if you omit both, the
slice is a copy of the whole list.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[:]</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;]</span>
</pre></div>
</div>
<p>Since lists are mutable, it is often useful to make a copy before
performing operations that modify lists.</p>
<p>A slice operator on the left side of an assignment can update multiple
elements:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[&#39;a&#39;, &#39;x&#39;, &#39;y&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="list-methods">
<h2>List methods<a class="headerlink" href="#list-methods" title="Permalink to this headline">¶</a></h2>
<p>Python provides methods that operate on lists. For example, append adds
a new element to the end of a list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
</pre></div>
</div>
<p>extend takes a list as an argument and appends all of the elements:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;]</span>
</pre></div>
</div>
<p>This example leaves t2 unmodified.</p>
<p>sort arranges the elements of the list from low to high:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;]</span>
</pre></div>
</div>
<p>Most list methods are void; they modify the list and return None. If you
accidentally write t = t.sort(), you will be disappointed with the
result.</p>
</div>
<div class="section" id="map-filter-and-reduce">
<h2>Map, filter and reduce<a class="headerlink" href="#map-filter-and-reduce" title="Permalink to this headline">¶</a></h2>
<p>To add up all the numbers in a list, you can use a loop like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">add_all</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">total</span>
</pre></div>
</div>
<p>total is initialized to 0. Each time through the loop, x gets one
element from the list. The += operator provides a short way to update a
variable. This <strong>augmented assignment statement</strong>,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">total</span> <span class="o">+=</span> <span class="n">x</span>
</pre></div>
</div>
<p>is equivalent to</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">total</span> <span class="o">=</span> <span class="n">total</span> <span class="o">+</span> <span class="n">x</span>
</pre></div>
</div>
<p>As the loop runs, total accumulates the sum of the elements; a variable
used this way is sometimes called an <strong>accumulator</strong>.</p>
<p>Adding up the elements of a list is such a common operation that Python
provides it as a built-in function, sum:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">6</span>
</pre></div>
</div>
<p>An operation like this that combines a sequence of elements into a
single value is sometimes called <strong>reduce</strong>.</p>
<p>Sometimes you want to traverse one list while building another. For
example, the following function takes a list of strings and returns a
new list that contains capitalized strings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">capitalize_all</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p>res is initialized with an empty list; each time through the loop, we
append the next element. So res is another kind of accumulator.</p>
<p>An operation like <code class="docutils literal"><span class="pre">capitalize_all</span></code> is sometimes called a <strong>map</strong>
because it “maps” a function (in this case the method capitalize) onto
each of the elements in a sequence.</p>
<p>Another common operation is to select some of the elements from a list
and return a sublist. For example, the following function takes a list
of strings and returns a list that contains only the uppercase strings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">only_upper</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p>isupper is a string method that returns True if the string contains only
upper case letters.</p>
<p>An operation like <code class="docutils literal"><span class="pre">only_upper</span></code> is called a <strong>filter</strong> because it
selects some of the elements and filters out the others.</p>
<p>Most common list operations can be expressed as a combination of map,
filter and reduce.</p>
</div>
<div class="section" id="deleting-elements">
<h2>Deleting elements<a class="headerlink" href="#deleting-elements" title="Permalink to this headline">¶</a></h2>
<p>There are several ways to delete elements from a list. If you know the
index of the element you want, you can use pop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[&#39;a&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">&#39;b&#39;</span>
</pre></div>
</div>
<p>pop modifies the list and returns the element that was removed. If you
don’t provide an index, it deletes and returns the last element.</p>
<p>If you don’t need the removed value, you can use the del operator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[&#39;a&#39;, &#39;c&#39;]</span>
</pre></div>
</div>
<p>If you know the element you want to remove (but not the index), you can
use remove:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[&#39;a&#39;, &#39;c&#39;]</span>
</pre></div>
</div>
<p>The return value from remove is None.</p>
<p>To remove more than one element, you can use del with a slice index:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[&#39;a&#39;, &#39;f&#39;]</span>
</pre></div>
</div>
<p>As usual, the slice selects all the elements up to but not including the
second index.</p>
</div>
<div class="section" id="lists-and-strings">
<h2>Lists and strings<a class="headerlink" href="#lists-and-strings" title="Permalink to this headline">¶</a></h2>
<p>A string is a sequence of characters and a list is a sequence of values,
but a list of characters is not the same as a string. To convert from a
string to a list of characters, you can use list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s">&#39;spam&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[&#39;s&#39;, &#39;p&#39;, &#39;a&#39;, &#39;m&#39;]</span>
</pre></div>
</div>
<p>Because list is the name of a built-in function, you should avoid using
it as a variable name. I also avoid l because it looks too much like 1.
So that’s why I use t.</p>
<p>The list function breaks a string into individual letters. If you want
to break a string into words, you can use the split method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s">&#39;pining for the fjords&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[&#39;pining&#39;, &#39;for&#39;, &#39;the&#39;, &#39;fjords&#39;]</span>
</pre></div>
</div>
<p>An optional argument called a <strong>delimiter</strong> specifies which characters
to use as word boundaries. The following example uses a hyphen as a
delimiter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s">&#39;spam-spam-spam&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">delimiter</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[&#39;spam&#39;, &#39;spam&#39;, &#39;spam&#39;]</span>
</pre></div>
</div>
<p>join is the inverse of split. It takes a list of strings and
concatenates the elements. join is a string method, so you have to
invoke it on the delimiter and pass the list as a parameter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;pining&#39;</span><span class="p">,</span> <span class="s">&#39;for&#39;</span><span class="p">,</span> <span class="s">&#39;the&#39;</span><span class="p">,</span> <span class="s">&#39;fjords&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">delimiter</span> <span class="o">=</span> <span class="s">&#39; &#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">&#39;pining for the fjords&#39;</span>
</pre></div>
</div>
<p>In this case the delimiter is a space character, so join puts a space
between words. To concatenate strings without spaces, you can use the
empty string, <code class="docutils literal"><span class="pre">''</span></code>, as a delimiter.</p>
</div>
<div class="section" id="objects-and-values">
<h2>Objects and values<a class="headerlink" href="#objects-and-values" title="Permalink to this headline">¶</a></h2>
<p>If we run these assignment statements:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="n">b</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
</pre></div>
</div>
<p>We know that a and b both refer to a string, but we don’t know whether
they refer to the <em>same</em> string. There are two possible states, shown in
Figure&nbsp;[fig.list1].</p>
<div class="figure" id="id77">
<img alt="State diagram." src="_images/list1.pdf" />
<p class="caption"><span class="caption-text">State diagram.</span></p>
</div>
<p>In one case, a and b refer to two different objects that have the same
value. In the second case, they refer to the same object.</p>
<p>To check whether two variables refer to the same object, you can use the
is operator.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="ow">is</span> <span class="n">b</span>
<span class="go">True</span>
</pre></div>
</div>
<p>In this example, Python only created one string object, and both a and b
refer to it. But when you create two lists, you get two objects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="ow">is</span> <span class="n">b</span>
<span class="go">False</span>
</pre></div>
</div>
<p>So the state diagram looks like Figure&nbsp;[fig.list2].</p>
<div class="figure" id="id78">
<img alt="State diagram." src="_images/list2.pdf" />
<p class="caption"><span class="caption-text">State diagram.</span></p>
</div>
<p>In this case we would say that the two lists are <strong>equivalent</strong>, because
they have the same elements, but not <strong>identical</strong>, because they are not
the same object. If two objects are identical, they are also equivalent,
but if they are equivalent, they are not necessarily identical.</p>
<p>Until now, we have been using “object” and “value” interchangeably, but
it is more precise to say that an object has a value. If you evaluate ,
you get a list object whose value is a sequence of integers. If another
list has the same elements, we say it has the same value, but it is not
the same object.</p>
</div>
<div class="section" id="aliasing">
<h2>Aliasing<a class="headerlink" href="#aliasing" title="Permalink to this headline">¶</a></h2>
<p>If a refers to an object and you assign b = a, then both variables refer
to the same object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="ow">is</span> <span class="n">a</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The state diagram looks like Figure&nbsp;[fig.list3].</p>
<div class="figure" id="id79">
<img alt="State diagram." src="_images/list3.pdf" />
<p class="caption"><span class="caption-text">State diagram.</span></p>
</div>
<p>The association of a variable with an object is called a <strong>reference</strong>.
In this example, there are two references to the same object.</p>
<p>An object with more than one reference has more than one name, so we say
that the object is <strong>aliased</strong>.</p>
<p>If the aliased object is mutable, changes made with one alias affect the
other:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">[42, 2, 3]</span>
</pre></div>
</div>
<p>Although this behavior can be useful, it is error-prone. In general, it
is safer to avoid aliasing when you are working with mutable objects.</p>
<p>For immutable objects like strings, aliasing is not as much of a
problem. In this example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
<span class="n">b</span> <span class="o">=</span> <span class="s">&#39;banana&#39;</span>
</pre></div>
</div>
<p>It almost never makes a difference whether a and b refer to the same
string or not.</p>
</div>
<div class="section" id="list-arguments">
<h2>List arguments<a class="headerlink" href="#list-arguments" title="Permalink to this headline">¶</a></h2>
<p>When you pass a list to a function, the function gets a reference to the
list. If the function modifies the list, the caller sees the change. For
example, <code class="docutils literal"><span class="pre">delete_head</span></code> removes the first element from a list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">delete_head</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">del</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Here’s how it is used:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">letters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">delete_head</span><span class="p">(</span><span class="n">letters</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">letters</span>
<span class="go">[&#39;b&#39;, &#39;c&#39;]</span>
</pre></div>
</div>
<p>The parameter t and the variable letters are aliases for the same
object. The stack diagram looks like Figure&nbsp;[fig.stack5].</p>
<div class="figure" id="id80">
<img alt="Stack diagram." src="_images/stack5.pdf" />
<p class="caption"><span class="caption-text">Stack diagram.</span></p>
</div>
<p>Since the list is shared by two frames, I drew it between them.</p>
<p>It is important to distinguish between operations that modify lists and
operations that create new lists. For example, the append method
modifies a list, but the + operator creates a new list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span>
<span class="go">None</span>
</pre></div>
</div>
<p>append modifies the list and returns None.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t3</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">+</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t3</span>
<span class="go">[1, 2, 3, 4]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span>
</pre></div>
</div>
<p>The + operator creates a new list and leaves the original list
unchanged.</p>
<p>This difference is important when you write functions that are supposed
to modify lists. For example, this function <em>does not</em> delete the head
of a list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">bad_delete_head</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>              <span class="c"># WRONG!</span>
</pre></div>
</div>
<p>The slice operator creates a new list and the assignment makes t refer
to it, but that doesn’t affect the caller.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t4</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bad_delete_head</span><span class="p">(</span><span class="n">t4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t4</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<p>At the beginning of <code class="docutils literal"><span class="pre">bad_delete_head</span></code>, t and t4 refer to the same
list. At the end, t refers to a new list, but t4 still refers to the
original, unmodified list.</p>
<p>An alternative is to write a function that creates and returns a new
list. For example, tail returns all but the first element of a list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">tail</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>
</div>
<p>This function leaves the original list unmodified. Here’s how it is
used:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">letters</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rest</span> <span class="o">=</span> <span class="n">tail</span><span class="p">(</span><span class="n">letters</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rest</span>
<span class="go">[&#39;b&#39;, &#39;c&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="id28">
<h2>Debugging<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h2>
<p>Careless use of lists (and other mutable objects) can lead to long hours
of debugging. Here are some common pitfalls and ways to avoid them:</p>
<ol class="arabic">
<li><p class="first">Most list methods modify the argument and return None. This is the
opposite of the string methods, which return a new string and leave
the original alone.</p>
<p>If you are used to writing string code like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>
</div>
<p>It is tempting to write list code like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>           <span class="c"># WRONG!</span>
</pre></div>
</div>
<p>Because sort returns None, the next operation you perform with t is
likely to fail.</p>
<p>Before using list methods and operators, you should read the
documentation carefully and then test them in interactive mode.</p>
</li>
<li><p class="first">Pick an idiom and stick with it.</p>
<p>Part of the problem with lists is that there are too many ways to do
things. For example, to remove an element from a list, you can use
pop, remove, del, or even a slice assignment.</p>
<p>To add an element, you can use the append method or the + operator.
Assuming that t is a list and x is a list element, these are correct:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">t</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
</pre></div>
</div>
<p>And these are wrong:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>          <span class="c"># WRONG!</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>        <span class="c"># WRONG!</span>
<span class="n">t</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>                <span class="c"># WRONG!</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">x</span>              <span class="c"># WRONG!</span>
</pre></div>
</div>
<p>Try out each of these examples in interactive mode to make sure you
understand what they do. Notice that only the last one causes a
runtime error; the other three are legal, but they do the wrong
thing.</p>
</li>
<li><p class="first">Make copies to avoid aliasing.</p>
<p>If you want to use a method like sort that modifies the argument, but
you need to keep the original list as well, you can make a copy.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[3, 1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<p>In this example you could also use the built-in function sorted,
which returns a new, sorted list and leaves the original alone.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[3, 1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id29">
<h2>Glossary<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>list:</dt>
<dd>A sequence of values.</dd>
<dt>element:</dt>
<dd>One of the values in a list (or other sequence), also called items.</dd>
<dt>nested list:</dt>
<dd>A list that is an element of another list.</dd>
<dt>accumulator:</dt>
<dd>A variable used in a loop to add up or accumulate a result.</dd>
<dt>augmented assignment:</dt>
<dd>A statement that updates the value of a variable using an operator
like <code class="docutils literal"><span class="pre">+=</span></code>.</dd>
<dt>reduce:</dt>
<dd>A processing pattern that traverses a sequence and accumulates the
elements into a single result.</dd>
<dt>map:</dt>
<dd>A processing pattern that traverses a sequence and performs an
operation on each element.</dd>
<dt>filter:</dt>
<dd>A processing pattern that traverses a list and selects the elements
that satisfy some criterion.</dd>
<dt>object:</dt>
<dd>Something a variable can refer to. An object has a type and a value.</dd>
<dt>equivalent:</dt>
<dd>Having the same value.</dd>
<dt>identical:</dt>
<dd>Being the same object (which implies equivalence).</dd>
<dt>reference:</dt>
<dd>The association between a variable and its value.</dd>
<dt>aliasing:</dt>
<dd>A circumstance where two or more variables refer to the same object.</dd>
<dt>delimiter:</dt>
<dd>A character or string used to indicate where a string should be
split.</dd>
</dl>
</div>
<div class="section" id="id30">
<h2>Exercises<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h2>
<p>You can download solutions to these exercises from
<a class="reference external" href="http://thinkpython2.com/code/list_exercises.py">http://thinkpython2.com/code/list_exercises.py</a>.</p>
<p>Write a function called <code class="docutils literal"><span class="pre">nested_sum</span></code> that takes a list of lists of
integers and adds up the elements from all of the nested lists. For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nested_sum</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">21</span>
</pre></div>
</div>
<p>[cumulative]</p>
<p>Write a function called cumsum that takes a list of numbers and returns
the cumulative sum; that is, a new list where the <span class="math">i</span>th element
is the sum of the first <span class="math">i+1</span> elements from the original list. For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cumsum</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">[1, 3, 6]</span>
</pre></div>
</div>
<p>Write a function called <code class="docutils literal"><span class="pre">middle</span></code> that takes a list and returns a new
list that contains all but the first and last elements. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">middle</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">[2, 3]</span>
</pre></div>
</div>
<p>Write a function called <code class="docutils literal"><span class="pre">chop</span></code> that takes a list, modifies it by
removing the first and last elements, and returns None. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chop</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[2, 3]</span>
</pre></div>
</div>
<p>Write a function called <code class="docutils literal"><span class="pre">is_sorted</span></code> that takes a list as a parameter
and returns True if the list is sorted in ascending order and False
otherwise. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">is_sorted</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_sorted</span><span class="p">([</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">])</span>
<span class="go">False</span>
</pre></div>
</div>
<p>[anagram]</p>
<p>Two words are anagrams if you can rearrange the letters from one to
spell the other. Write a function called <code class="docutils literal"><span class="pre">is_anagram</span></code> that takes two
strings and returns True if they are anagrams.</p>
<p>[duplicate]</p>
<p>Write a function called <code class="docutils literal"><span class="pre">has_duplicates</span></code> that takes a list and returns
True if there is any element that appears more than once. It should not
modify the original list.</p>
<p>This exercise pertains to the so-called Birthday Paradox, which you can
read about at <a class="reference external" href="http://en.wikipedia.org/wiki/Birthday_paradox">http://en.wikipedia.org/wiki/Birthday_paradox</a>.</p>
<p>If there are 23 students in your class, what are the chances that two of
you have the same birthday? You can estimate this probability by
generating random samples of 23 birthdays and checking for matches.
Hint: you can generate random birthdays with the randint function in the
random module.</p>
<p>You can download my solution from
<a class="reference external" href="http://thinkpython2.com/code/birthday.py">http://thinkpython2.com/code/birthday.py</a>.</p>
<p>Write a function that reads the file words.txt and builds a list with
one element per word. Write two versions of this function, one using the
append method and the other using the idiom t = t + [x]. Which one takes
longer to run? Why?</p>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/wordlist.py">http://thinkpython2.com/code/wordlist.py</a>.</p>
<p>[wordlist1] [bisection]</p>
<p>To check whether a word is in the word list, you could use the in
operator, but it would be slow because it searches through the words in
order.</p>
<p>Because the words are in alphabetical order, we can speed things up with
a bisection search (also known as binary search), which is similar to
what you do when you look a word up in the dictionary. You start in the
middle and check to see whether the word you are looking for comes
before the word in the middle of the list. If so, you search the first
half of the list the same way. Otherwise you search the second half.</p>
<p>Either way, you cut the remaining search space in half. If the word list
has 113,809 words, it will take about 17 steps to find the word or
conclude that it’s not there.</p>
<p>Write a function called <code class="docutils literal"><span class="pre">in_bisect</span></code> that takes a sorted list and a
target value and returns the index of the value in the list if it’s
there, or None if it’s not.</p>
<p>Or you could read the documentation of the bisect module and use that!
Solution: <a class="reference external" href="http://thinkpython2.com/code/inlist.py">http://thinkpython2.com/code/inlist.py</a>.</p>
<p>Two words are a “reverse pair” if each is the reverse of the other.
Write a program that finds all the reverse pairs in the word list.
Solution: <a class="reference external" href="http://thinkpython2.com/code/reverse_pair.py">http://thinkpython2.com/code/reverse_pair.py</a>.</p>
<p>Two words “interlock” if taking alternating letters from each forms a
new word. For example, “shoe” and “cold” interlock to form “schooled”.
Solution: <a class="reference external" href="http://thinkpython2.com/code/interlock.py">http://thinkpython2.com/code/interlock.py</a>. Credit: This
exercise is inspired by an example at <a class="reference external" href="http://puzzlers.org">http://puzzlers.org</a>.</p>
<ol class="arabic simple">
<li>Write a program that finds all pairs of words that interlock. Hint:
don’t enumerate all pairs!</li>
<li>Can you find any words that are three-way interlocked; that is, every
third letter forms a word, starting from the first, second or third?</li>
</ol>
</div>
</div>
<div class="section" id="dictionaries">
<h1>Dictionaries<a class="headerlink" href="#dictionaries" title="Permalink to this headline">¶</a></h1>
<p>This chapter presents another built-in type called a dictionary.
Dictionaries are one of Python’s best features; they are the building
blocks of many efficient and elegant algorithms.</p>
<div class="section" id="a-dictionary-is-a-mapping">
<h2>A dictionary is a mapping<a class="headerlink" href="#a-dictionary-is-a-mapping" title="Permalink to this headline">¶</a></h2>
<p>A <strong>dictionary</strong> is like a list, but more general. In a list, the
indices have to be integers; in a dictionary they can be (almost) any
type.</p>
<p>A dictionary contains a collection of indices, which are called
<strong>keys</strong>, and a collection of values. Each key is associated with a
single value. The association of a key and a value is called a
<strong>key-value pair</strong> or sometimes an <strong>item</strong>.</p>
<p>In mathematical language, a dictionary represents a <strong>mapping</strong> from
keys to values, so you can also say that each key “maps to” a value. As
an example, we’ll build a dictionary that maps from English to Spanish
words, so the keys and the values are all strings.</p>
<p>The function dict creates a new dictionary with no items. Because dict
is the name of a built-in function, you should avoid using it as a
variable name.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">eng2sp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eng2sp</span>
<span class="go">{}</span>
</pre></div>
</div>
<p>The squiggly-brackets, <code class="docutils literal"><span class="pre">{}</span></code>, represent an empty dictionary. To add
items to the dictionary, you can use square brackets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">eng2sp</span><span class="p">[</span><span class="s">&#39;one&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;uno&#39;</span>
</pre></div>
</div>
<p>This line creates an item that maps from the key <code class="docutils literal"><span class="pre">'one'</span></code> to the value
<code class="docutils literal"><span class="pre">'uno'</span></code>. If we print the dictionary again, we see a key-value pair
with a colon between the key and value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">eng2sp</span>
<span class="go">{&#39;one&#39;: &#39;uno&#39;}</span>
</pre></div>
</div>
<p>This output format is also an input format. For example, you can create
a new dictionary with three items:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">eng2sp</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;one&#39;</span><span class="p">:</span> <span class="s">&#39;uno&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">:</span> <span class="s">&#39;dos&#39;</span><span class="p">,</span> <span class="s">&#39;three&#39;</span><span class="p">:</span> <span class="s">&#39;tres&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>But if you print eng2sp, you might be surprised:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">eng2sp</span>
<span class="go">{&#39;one&#39;: &#39;uno&#39;, &#39;three&#39;: &#39;tres&#39;, &#39;two&#39;: &#39;dos&#39;}</span>
</pre></div>
</div>
<p>The order of the key-value pairs might not be the same. If you type the
same example on your computer, you might get a different result. In
general, the order of items in a dictionary is unpredictable.</p>
<p>But that’s not a problem because the elements of a dictionary are never
indexed with integer indices. Instead, you use the keys to look up the
corresponding values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">eng2sp</span><span class="p">[</span><span class="s">&#39;two&#39;</span><span class="p">]</span>
<span class="go">&#39;dos&#39;</span>
</pre></div>
</div>
<p>The key <code class="docutils literal"><span class="pre">'two'</span></code> always maps to the value <code class="docutils literal"><span class="pre">'dos'</span></code> so the order of the
items doesn’t matter.</p>
<p>If the key isn’t in the dictionary, you get an exception:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">eng2sp</span><span class="p">[</span><span class="s">&#39;four&#39;</span><span class="p">]</span>
<span class="go">KeyError: &#39;four&#39;</span>
</pre></div>
</div>
<p>The len function works on dictionaries; it returns the number of
key-value pairs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">eng2sp</span><span class="p">)</span>
<span class="go">3</span>
</pre></div>
</div>
<p>The in operator works on dictionaries, too; it tells you whether
something appears as a <em>key</em> in the dictionary (appearing as a value is
not good enough).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;one&#39;</span> <span class="ow">in</span> <span class="n">eng2sp</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;uno&#39;</span> <span class="ow">in</span> <span class="n">eng2sp</span>
<span class="go">False</span>
</pre></div>
</div>
<p>To see whether something appears as a value in a dictionary, you can use
the method values, which returns a collection of values, and then use
the in operator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">vals</span> <span class="o">=</span> <span class="n">eng2sp</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;uno&#39;</span> <span class="ow">in</span> <span class="n">vals</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The in operator uses different algorithms for lists and dictionaries.
For lists, it searches the elements of the list in order, as in
Section&nbsp;[find]. As the list gets longer, the search time gets longer in
direct proportion.</p>
<p>For dictionaries, Python uses an algorithm called a <strong>hashtable</strong> that
has a remarkable property: the in operator takes about the same amount
of time no matter how many items are in the dictionary. I explain how
that’s possible in Section&nbsp;[hashtable], but the explanation might not
make sense until you’ve read a few more chapters.</p>
</div>
<div class="section" id="dictionary-as-a-collection-of-counters">
<h2>Dictionary as a collection of counters<a class="headerlink" href="#dictionary-as-a-collection-of-counters" title="Permalink to this headline">¶</a></h2>
<p>Suppose you are given a string and you want to count how many times each
letter appears. There are several ways you could do it:</p>
<ol class="arabic simple">
<li>You could create 26 variables, one for each letter of the alphabet.
Then you could traverse the string and, for each character, increment
the corresponding counter, probably using a chained conditional.</li>
<li>You could create a list with 26 elements. Then you could convert each
character to a number (using the built-in function ord), use the
number as an index into the list, and increment the appropriate
counter.</li>
<li>You could create a dictionary with characters as keys and counters as
the corresponding values. The first time you see a character, you
would add an item to the dictionary. After that you would increment
the value of an existing item.</li>
</ol>
<p>Each of these options performs the same computation, but each of them
implements that computation in a different way.</p>
<p>An <strong>implementation</strong> is a way of performing a computation; some
implementations are better than others. For example, an advantage of the
dictionary implementation is that we don’t have to know ahead of time
which letters appear in the string and we only have to make room for the
letters that do appear.</p>
<p>Here is what the code might look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">histogram</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>The name of the function is histogram, which is a statistical term for a
collection of counters (or frequencies).</p>
<p>The first line of the function creates an empty dictionary. The for loop
traverses the string. Each time through the loop, if the character c is
not in the dictionary, we create a new item with key c and the initial
value 1 (since we have seen this letter once). If c is already in the
dictionary we increment d[c].</p>
<p>Here’s how it works:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="s">&#39;brontosaurus&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span>
<span class="go">{&#39;a&#39;: 1, &#39;b&#39;: 1, &#39;o&#39;: 2, &#39;n&#39;: 1, &#39;s&#39;: 2, &#39;r&#39;: 2, &#39;u&#39;: 2, &#39;t&#39;: 1}</span>
</pre></div>
</div>
<p>The histogram indicates that the letters <code class="docutils literal"><span class="pre">'a'</span></code> and <code class="docutils literal"><span class="pre">'b'</span></code> appear
once; <code class="docutils literal"><span class="pre">'o'</span></code> appears twice, and so on.</p>
<p>Dictionaries have a method called get that takes a key and a default
value. If the key appears in the dictionary, get returns the
corresponding value; otherwise it returns the default value. For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span>
<span class="go">{&#39;a&#39;: 1}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
<p>As an exercise, use get to write histogram more concisely. You should be
able to eliminate the if statement.</p>
</div>
<div class="section" id="looping-and-dictionaries">
<h2>Looping and dictionaries<a class="headerlink" href="#looping-and-dictionaries" title="Permalink to this headline">¶</a></h2>
<p>If you use a dictionary in a for statement, it traverses the keys of the
dictionary. For example, <code class="docutils literal"><span class="pre">print_hist</span></code> prints each key and the
corresponding value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">print_hist</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">h</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
</pre></div>
</div>
<p>Here’s what the output looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="s">&#39;parrot&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_hist</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="go">a 1</span>
<span class="go">p 1</span>
<span class="go">r 2</span>
<span class="go">t 1</span>
<span class="go">o 1</span>
</pre></div>
</div>
<p>Again, the keys are in no particular order. To traverse the keys in
sorted order, you can use the built-in function sorted:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
<span class="go">a 1</span>
<span class="go">o 1</span>
<span class="go">p 1</span>
<span class="go">r 2</span>
<span class="go">t 1</span>
</pre></div>
</div>
</div>
<div class="section" id="reverse-lookup">
<h2>Reverse lookup<a class="headerlink" href="#reverse-lookup" title="Permalink to this headline">¶</a></h2>
<p>Given a dictionary d and a key k, it is easy to find the corresponding
value v = d[k]. This operation is called a <strong>lookup</strong>.</p>
<p>But what if you have v and you want to find k? You have two problems:
first, there might be more than one key that maps to the value v.
Depending on the application, you might be able to pick one, or you
might have to make a list that contains all of them. Second, there is no
simple syntax to do a <strong>reverse lookup</strong>; you have to search.</p>
<p>Here is a function that takes a value and returns the first key that
maps to that value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">reverse_lookup</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">k</span>
    <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">()</span>
</pre></div>
</div>
<p>This function is yet another example of the search pattern, but it uses
a feature we haven’t seen before, raise. The <strong>raise statement</strong> causes
an exception; in this case it causes a LookupError, which is a built-in
exception used to indicate that a lookup operation failed.</p>
<p>If we get to the end of the loop, that means v doesn’t appear in the
dictionary as a value, so we raise an exception.</p>
<p>Here is an example of a successful reverse lookup:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="s">&#39;parrot&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key</span> <span class="o">=</span> <span class="n">reverse_lookup</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key</span>
<span class="go">&#39;r&#39;</span>
</pre></div>
</div>
<p>And an unsuccessful one:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">key</span> <span class="o">=</span> <span class="n">reverse_lookup</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">5</span>, in <span class="n">reverse_lookup</span>
<span class="gr">LookupError</span>
</pre></div>
</div>
<p>The effect when you raise an exception is the same as when Python raises
one: it prints a traceback and an error message.</p>
<p>The raise statement can take a detailed error message as an optional
argument. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="s">&#39;value does not appear in the dictionary&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">?</span>
<span class="gr">LookupError</span>: <span class="n">value does not appear in the dictionary</span>
</pre></div>
</div>
<p>A reverse lookup is much slower than a forward lookup; if you have to do
it often, or if the dictionary gets big, the performance of your program
will suffer.</p>
</div>
<div class="section" id="dictionaries-and-lists">
<h2>Dictionaries and lists<a class="headerlink" href="#dictionaries-and-lists" title="Permalink to this headline">¶</a></h2>
<p>Lists can appear as values in a dictionary. For example, if you are
given a dictionary that maps from letters to frequencies, you might want
to invert it; that is, create a dictionary that maps from frequencies to
letters. Since there might be several letters with the same frequency,
each value in the inverted dictionary should be a list of letters.</p>
<p>Here is a function that inverts a dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">invert_dict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">inverse</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inverse</span><span class="p">:</span>
            <span class="n">inverse</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inverse</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">inverse</span>
</pre></div>
</div>
<p>Each time through the loop, key gets a key from d and val gets the
corresponding value. If val is not in inverse, that means we haven’t
seen it before, so we create a new item and initialize it with a
<strong>singleton</strong> (a list that contains a single element). Otherwise we have
seen this value before, so we append the corresponding key to the list.</p>
<p>Here is an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">hist</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="s">&#39;parrot&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hist</span>
<span class="go">{&#39;a&#39;: 1, &#39;p&#39;: 1, &#39;r&#39;: 2, &#39;t&#39;: 1, &#39;o&#39;: 1}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inverse</span> <span class="o">=</span> <span class="n">invert_dict</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inverse</span>
<span class="go">{1: [&#39;a&#39;, &#39;p&#39;, &#39;t&#39;, &#39;o&#39;], 2: [&#39;r&#39;]}</span>
</pre></div>
</div>
<div class="figure" id="id81">
<img alt="State diagram." src="_images/dict1.pdf" />
<p class="caption"><span class="caption-text">State diagram.</span></p>
</div>
<p>Figure&nbsp;[fig.dict1] is a state diagram showing hist and inverse. A
dictionary is represented as a box with the type dict above it and the
key-value pairs inside. If the values are integers, floats or strings, I
draw them inside the box, but I usually draw lists outside the box, just
to keep the diagram simple.</p>
<p>Lists can be values in a dictionary, as this example shows, but they
cannot be keys. Here’s what happens if you try:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;oops&#39;</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">?</span>
<span class="gr">TypeError</span>: <span class="n">list objects are unhashable</span>
</pre></div>
</div>
<p>I mentioned earlier that a dictionary is implemented using a hashtable
and that means that the keys have to be <strong>hashable</strong>.</p>
<p>A <strong>hash</strong> is a function that takes a value (of any kind) and returns an
integer. Dictionaries use these integers, called hash values, to store
and look up key-value pairs.</p>
<p>This system works fine if the keys are immutable. But if the keys are
mutable, like lists, bad things happen. For example, when you create a
key-value pair, Python hashes the key and stores it in the corresponding
location. If you modify the key and then hash it again, it would go to a
different location. In that case you might have two entries for the same
key, or you might not be able to find a key. Either way, the dictionary
wouldn’t work correctly.</p>
<p>That’s why keys have to be hashable, and why mutable types like lists
aren’t. The simplest way to get around this limitation is to use tuples,
which we will see in the next chapter.</p>
<p>Since dictionaries are mutable, they can’t be used as keys, but they
<em>can</em> be used as values.</p>
</div>
<div class="section" id="memos">
<h2>Memos<a class="headerlink" href="#memos" title="Permalink to this headline">¶</a></h2>
<p>If you played with the fibonacci function from
Section&nbsp;[one.more.example], you might have noticed that the bigger the
argument you provide, the longer the function takes to run. Furthermore,
the run time increases quickly.</p>
<p>To understand why, consider Figure&nbsp;[fig.fibonacci], which shows the
<strong>call graph</strong> for fibonacci with n=4:</p>
<div class="figure" id="id82">
<img alt="Call graph." src="_images/fibonacci.pdf" />
<p class="caption"><span class="caption-text">Call graph.</span></p>
</div>
<p>A call graph shows a set of function frames, with lines connecting each
frame to the frames of the functions it calls. At the top of the graph,
fibonacci with n=4 calls fibonacci with n=3 and n=2. In turn, fibonacci
with n=3 calls fibonacci with n=2 and n=1. And so on.</p>
<p>Count how many times fibonacci(0) and fibonacci(1) are called. This is
an inefficient solution to the problem, and it gets worse as the
argument gets bigger.</p>
<p>One solution is to keep track of values that have already been computed
by storing them in a dictionary. A previously computed value that is
stored for later use is called a <strong>memo</strong>. Here is a “memoized” version
of fibonacci:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">known</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">known</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">known</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">known</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p>known is a dictionary that keeps track of the Fibonacci numbers we
already know. It starts with two items: 0 maps to 0 and 1 maps to 1.</p>
<p>Whenever fibonacci is called, it checks known. If the result is already
there, it can return immediately. Otherwise it has to compute the new
value, add it to the dictionary, and return it.</p>
<p>If you run this version of fibonacci and compare it with the original,
you will find that it is much faster.</p>
</div>
<div class="section" id="global-variables">
<h2>Global variables<a class="headerlink" href="#global-variables" title="Permalink to this headline">¶</a></h2>
<p>In the previous example, known is created outside the function, so it
belongs to the special frame called <code class="docutils literal"><span class="pre">__main__</span></code>. Variables in
<code class="docutils literal"><span class="pre">__main__</span></code> are sometimes called <strong>global</strong> because they can be
accessed from any function. Unlike local variables, which disappear when
their function ends, global variables persist from one function call to
the next.</p>
<p>It is common to use global variables for <strong>flags</strong>; that is, boolean
variables that indicate (“flag”) whether a condition is true. For
example, some programs use a flag named verbose to control the level of
detail in the output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">example1</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Running example1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you try to reassign a global variable, you might be surprised. The
following example is supposed to keep track of whether the function has
been called:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">been_called</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">example2</span><span class="p">():</span>
    <span class="n">been_called</span> <span class="o">=</span> <span class="bp">True</span>         <span class="c"># WRONG</span>
</pre></div>
</div>
<p>But if you run it you will see that the value of <code class="docutils literal"><span class="pre">been_called</span></code> doesn’t
change. The problem is that example2 creates a new local variable named
<code class="docutils literal"><span class="pre">been_called</span></code>. The local variable goes away when the function ends,
and has no effect on the global variable.</p>
<p>To reassign a global variable inside a function you have to <strong>declare</strong>
the global variable before you use it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">been_called</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">example2</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">been_called</span>
    <span class="n">been_called</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>The <strong>global statement</strong> tells the interpreter something like, “In this
function, when I say <code class="docutils literal"><span class="pre">been_called</span></code>, I mean the global variable; don’t
create a local one.”</p>
<p>Here’s an example that tries to update a global variable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">example3</span><span class="p">():</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>          <span class="c"># WRONG</span>
</pre></div>
</div>
<p>If you run it you get:</p>
<div class="highlight-python"><div class="highlight"><pre>UnboundLocalError: local variable &#39;count&#39; referenced before assignment
</pre></div>
</div>
<p>Python assumes that count is local, and under that assumption you are
reading it before writing it. The solution, again, is to declare count
global.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">example3</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">count</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>If a global variable refers to a mutable value, you can modify the value
without declaring the variable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">known</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">example4</span><span class="p">():</span>
    <span class="n">known</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>So you can add, remove and replace elements of a global list or
dictionary, but if you want to reassign the variable, you have to
declare it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">example5</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">known</span>
    <span class="n">known</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</pre></div>
</div>
<p>Global variables can be useful, but if you have a lot of them, and you
modify them frequently, they can make programs hard to debug.</p>
</div>
<div class="section" id="id31">
<h2>Debugging<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h2>
<p>As you work with bigger datasets it can become unwieldy to debug by
printing and checking the output by hand. Here are some suggestions for
debugging large datasets:</p>
<dl class="docutils">
<dt>Scale down the input:</dt>
<dd><p class="first">If possible, reduce the size of the dataset. For example if the
program reads a text file, start with just the first 10 lines, or
with the smallest example you can find. You can either edit the
files themselves, or (better) modify the program so it reads only
the first n lines.</p>
<p class="last">If there is an error, you can reduce n to the smallest value that
manifests the error, and then increase it gradually as you find and
correct errors.</p>
</dd>
<dt>Check summaries and types:</dt>
<dd><p class="first">Instead of printing and checking the entire dataset, consider
printing summaries of the data: for example, the number of items in
a dictionary or the total of a list of numbers.</p>
<p class="last">A common cause of runtime errors is a value that is not the right
type. For debugging this kind of error, it is often enough to print
the type of a value.</p>
</dd>
<dt>Write self-checks:</dt>
<dd><p class="first">Sometimes you can write code to check for errors automatically. For
example, if you are computing the average of a list of numbers, you
could check that the result is not greater than the largest element
in the list or less than the smallest. This is called a “sanity
check” because it detects results that are “insane”.</p>
<p class="last">Another kind of check compares the results of two different
computations to see if they are consistent. This is called a
“consistency check”.</p>
</dd>
<dt>Format the output:</dt>
<dd>Formatting debugging output can make it easier to spot an error. We
saw an example in Section&nbsp;[factdebug]. The pprint module provides a
pprint function that displays built-in types in a more
human-readable format (pprint stands for “pretty print”).</dd>
</dl>
<p>Again, time you spend building scaffolding can reduce the time you spend
debugging.</p>
</div>
<div class="section" id="id32">
<h2>Glossary<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>mapping:</dt>
<dd>A relationship in which each element of one set corresponds to an
element of another set.</dd>
<dt>dictionary:</dt>
<dd>A mapping from keys to their corresponding values.</dd>
<dt>key-value pair:</dt>
<dd>The representation of the mapping from a key to a value.</dd>
<dt>item:</dt>
<dd>In a dictionary, another name for a key-value pair.</dd>
<dt>key:</dt>
<dd>An object that appears in a dictionary as the first part of a
key-value pair.</dd>
<dt>value:</dt>
<dd>An object that appears in a dictionary as the second part of a
key-value pair. This is more specific than our previous use of the
word “value”.</dd>
<dt>implementation:</dt>
<dd>A way of performing a computation.</dd>
<dt>hashtable:</dt>
<dd>The algorithm used to implement Python dictionaries.</dd>
<dt>hash function:</dt>
<dd>A function used by a hashtable to compute the location for a key.</dd>
<dt>hashable:</dt>
<dd>A type that has a hash function. Immutable types like integers,
floats and strings are hashable; mutable types like lists and
dictionaries are not.</dd>
<dt>lookup:</dt>
<dd>A dictionary operation that takes a key and finds the corresponding
value.</dd>
<dt>reverse lookup:</dt>
<dd>A dictionary operation that takes a value and finds one or more keys
that map to it.</dd>
<dt>raise statement:</dt>
<dd>A statement that (deliberately) raises an exception.</dd>
<dt>singleton:</dt>
<dd>A list (or other sequence) with a single element.</dd>
<dt>call graph:</dt>
<dd>A diagram that shows every frame created during the execution of a
program, with an arrow from each caller to each callee.</dd>
<dt>memo:</dt>
<dd>A computed value stored to avoid unnecessary future computation.</dd>
<dt>global variable:</dt>
<dd>A variable defined outside a function. Global variables can be
accessed from any function.</dd>
<dt>global statement:</dt>
<dd>A statement that declares a variable name global.</dd>
<dt>flag:</dt>
<dd>A boolean variable used to indicate whether a condition is true.</dd>
<dt>declaration:</dt>
<dd>A statement like global that tells the interpreter something about a
variable.</dd>
</dl>
</div>
<div class="section" id="id33">
<h2>Exercises<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h2>
<p>[wordlist2]</p>
<p>Write a function that reads the words in words.txt and stores them as
keys in a dictionary. It doesn’t matter what the values are. Then you
can use the in operator as a fast way to check whether a string is in
the dictionary.</p>
<p>If you did Exercise&nbsp;[wordlist1], you can compare the speed of this
implementation with the list in operator and the bisection search.</p>
<p>[setdefault]</p>
<p>Read the documentation of the dictionary method setdefault and use it to
write a more concise version of <code class="docutils literal"><span class="pre">invert_dict</span></code>. Solution:
<a class="reference external" href="http://thinkpython2.com/code/invert_dict.py">http://thinkpython2.com/code/invert_dict.py</a>.</p>
<p>Memoize the Ackermann function from Exercise&nbsp;[ackermann] and see if
memoization makes it possible to evaluate the function with bigger
arguments. Hint: no. Solution:
<a class="reference external" href="http://thinkpython2.com/code/ackermann_memo.py">http://thinkpython2.com/code/ackermann_memo.py</a>.</p>
<p>If you did Exercise&nbsp;[duplicate], you already have a function named
<code class="docutils literal"><span class="pre">has_duplicates</span></code> that takes a list as a parameter and returns True if
there is any object that appears more than once in the list.</p>
<p>Use a dictionary to write a faster, simpler version of
<code class="docutils literal"><span class="pre">has_duplicates</span></code>. Solution:
<a class="reference external" href="http://thinkpython2.com/code/has_duplicates.py">http://thinkpython2.com/code/has_duplicates.py</a>.</p>
<p>[exrotatepairs]</p>
<p>Two words are “rotate pairs” if you can rotate one of them and get the
other (see <code class="docutils literal"><span class="pre">rotate_word</span></code> in Exercise&nbsp;[exrotate]).</p>
<p>Write a program that reads a wordlist and finds all the rotate pairs.
Solution: <a class="reference external" href="http://thinkpython2.com/code/rotate_pairs.py">http://thinkpython2.com/code/rotate_pairs.py</a>.</p>
<p>Here’s another Puzzler from <em>Car Talk</em>
(<a class="reference external" href="http://www.cartalk.com/content/puzzlers">http://www.cartalk.com/content/puzzlers</a>):</p>
<blockquote>
<div><p>This was sent in by a fellow named Dan O’Leary. He came upon a
common one-syllable, five-letter word recently that has the
following unique property. When you remove the first letter, the
remaining letters form a homophone of the original word, that is a
word that sounds exactly the same. Replace the first letter, that
is, put it back and remove the second letter and the result is yet
another homophone of the original word. And the question is, what’s
the word?</p>
<p>Now I’m going to give you an example that doesn’t work. Let’s look
at the five-letter word, ‘wrack.’ W-R-A-C-K, you know like to ‘wrack
with pain.’ If I remove the first letter, I am left with a
four-letter word, ’R-A-C-K.’ As in, ‘Holy cow, did you see the rack
on that buck! It must have been a nine-pointer!’ It’s a perfect
homophone. If you put the ‘w’ back, and remove the ‘r,’ instead,
you’re left with the word, ‘wack,’ which is a real word, it’s just
not a homophone of the other two words.</p>
<p>But there is, however, at least one word that Dan and we know of,
which will yield two homophones if you remove either of the first
two letters to make two, new four-letter words. The question is,
what’s the word?</p>
</div></blockquote>
<p>You can use the dictionary from Exercise&nbsp;[wordlist2] to check whether a
string is in the word list.</p>
<p>To check whether two words are homophones, you can use the CMU
Pronouncing Dictionary. You can download it from
<a class="reference external" href="http://www.speech.cs.cmu.edu/cgi-bin/cmudict">http://www.speech.cs.cmu.edu/cgi-bin/cmudict</a> or from
<a class="reference external" href="http://thinkpython2.com/code/c06d">http://thinkpython2.com/code/c06d</a> and you can also download
<a class="reference external" href="http://thinkpython2.com/code/pronounce.py">http://thinkpython2.com/code/pronounce.py</a>, which provides a function
named <code class="docutils literal"><span class="pre">read_dictionary</span></code> that reads the pronouncing dictionary and
returns a Python dictionary that maps from each word to a string that
describes its primary pronunciation.</p>
<p>Write a program that lists all the words that solve the Puzzler.
Solution: <a class="reference external" href="http://thinkpython2.com/code/homophone.py">http://thinkpython2.com/code/homophone.py</a>.</p>
</div>
</div>
<div class="section" id="tuples">
<h1>Tuples<a class="headerlink" href="#tuples" title="Permalink to this headline">¶</a></h1>
<p>This chapter presents one more built-in type, the tuple, and then shows
how lists, dictionaries, and tuples work together. I also present a
useful feature for variable-length argument lists, the gather and
scatter operators.</p>
<p>One note: there is no consensus on how to pronounce “tuple”. Some people
say “tuh-ple”, which rhymes with “supple”. But in the context of
programming, most people say “too-ple”, which rhymes with “quadruple”.</p>
<div class="section" id="tuples-are-immutable">
<h2>Tuples are immutable<a class="headerlink" href="#tuples-are-immutable" title="Permalink to this headline">¶</a></h2>
<p>A tuple is a sequence of values. The values can be any type, and they
are indexed by integers, so in that respect tuples are a lot like lists.
The important difference is that tuples are immutable.</p>
<p>Syntactically, a tuple is a comma-separated list of values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span>
</pre></div>
</div>
<p>Although it is not necessary, it is common to enclose tuples in
parentheses:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To create a tuple with a single element, you have to include a final
comma:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="s">&#39;a&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
<span class="go">&lt;class &#39;tuple&#39;&gt;</span>
</pre></div>
</div>
<p>A value in parentheses is not a tuple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
<span class="go">&lt;class &#39;str&#39;&gt;</span>
</pre></div>
</div>
<p>Another way to create a tuple is the built-in function tuple. With no
argument, it creates an empty tuple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">()</span>
</pre></div>
</div>
<p>If the argument is a sequence (string, list or tuple), the result is a
tuple with the elements of the sequence:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s">&#39;lupins&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">(&#39;l&#39;, &#39;u&#39;, &#39;p&#39;, &#39;i&#39;, &#39;n&#39;, &#39;s&#39;)</span>
</pre></div>
</div>
<p>Because tuple is the name of a built-in function, you should avoid using
it as a variable name.</p>
<p>Most list operators also work on tuples. The bracket operator indexes an
element:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;a&#39;</span>
</pre></div>
</div>
<p>And the slice operator selects a range of elements.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">(&#39;b&#39;, &#39;c&#39;)</span>
</pre></div>
</div>
<p>But if you try to modify one of the elements of the tuple, you get an
error:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A&#39;</span>
<span class="go">TypeError: object doesn&#39;t support item assignment</span>
</pre></div>
</div>
<p>Because tuples are immutable, you can’t modify the elements. But you can
replace one tuple with another:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,)</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">(&#39;A&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;)</span>
</pre></div>
</div>
<p>This statement makes a new tuple and then makes t refer to it.</p>
<p>The relational operators work with tuples and other sequences; Python
starts by comparing the first element from each sequence. If they are
equal, it goes on to the next elements, and so on, until it finds
elements that differ. Subsequent elements are not considered (even if
they are really big).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2000000</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="tuple-assignment">
<h2>Tuple assignment<a class="headerlink" href="#tuple-assignment" title="Permalink to this headline">¶</a></h2>
<p>It is often useful to swap the values of two variables. With
conventional assignments, you have to use a temporary variable. For
example, to swap a and b:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span> <span class="o">=</span> <span class="n">a</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">temp</span>
</pre></div>
</div>
<p>This solution is cumbersome; <strong>tuple assignment</strong> is more elegant:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
</pre></div>
</div>
<p>The left side is a tuple of variables; the right side is a tuple of
expressions. Each value is assigned to its respective variable. All the
expressions on the right side are evaluated before any of the
assignments.</p>
<p>The number of variables on the left and the number of values on the
right have to be the same:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
<span class="go">ValueError: too many values to unpack</span>
</pre></div>
</div>
<p>More generally, the right side can be any kind of sequence (string, list
or tuple). For example, to split an email address into a user name and a
domain, you could write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">addr</span> <span class="o">=</span> <span class="s">&#39;monty@python.org&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uname</span><span class="p">,</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">addr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;@&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The return value from split is a list with two elements; the first
element is assigned to uname, the second to domain.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">uname</span>
<span class="go">&#39;monty&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">domain</span>
<span class="go">&#39;python.org&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="tuples-as-return-values">
<h2>Tuples as return values<a class="headerlink" href="#tuples-as-return-values" title="Permalink to this headline">¶</a></h2>
<p>Strictly speaking, a function can only return one value, but if the
value is a tuple, the effect is the same as returning multiple values.
For example, if you want to divide two integers and compute the quotient
and remainder, it is inefficient to compute x/y and then x%y. It is
better to compute them both at the same time.</p>
<p>The built-in function divmod takes two arguments and returns a tuple of
two values, the quotient and remainder. You can store the result as a
tuple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">(2, 1)</span>
</pre></div>
</div>
<p>Or use tuple assignment to store the elements separately:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">quot</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">quot</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rem</span>
<span class="go">1</span>
</pre></div>
</div>
<p>Here is an example of a function that returns a tuple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">min_max</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>max and min are built-in functions that find the largest and smallest
elements of a sequence. <code class="docutils literal"><span class="pre">min_max</span></code> computes both and returns a tuple of
two values.</p>
</div>
<div class="section" id="variable-length-argument-tuples">
<h2>Variable-length argument tuples<a class="headerlink" href="#variable-length-argument-tuples" title="Permalink to this headline">¶</a></h2>
<p>Functions can take a variable number of arguments. A parameter name that
begins with <strong>gathers</strong> arguments into a tuple. For example, printall
takes any number of arguments and prints them:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">printall</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>The gather parameter can have any name you like, but args is
conventional. Here’s how the function works:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">printall</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">)</span>
<span class="go">(1, 2.0, &#39;3&#39;)</span>
</pre></div>
</div>
<p>The complement of gather is <strong>scatter</strong>. If you have a sequence of
values and you want to pass it to a function as multiple arguments, you
can use the operator. For example, divmod takes exactly two arguments;
it doesn’t work with a tuple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">divmod</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">TypeError: divmod expected 2 arguments, got 1</span>
</pre></div>
</div>
<p>But if you scatter the tuple, it works:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">divmod</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="go">(2, 1)</span>
</pre></div>
</div>
<p>Many of the built-in functions use variable-length argument tuples. For
example, max and min can take any number of arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">3</span>
</pre></div>
</div>
<p>But sum does not.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">TypeError: sum expected at most 2 arguments, got 3</span>
</pre></div>
</div>
<p>As an exercise, write a function called sumall that takes any number of
arguments and returns their sum.</p>
</div>
<div class="section" id="lists-and-tuples">
<h2>Lists and tuples<a class="headerlink" href="#lists-and-tuples" title="Permalink to this headline">¶</a></h2>
<p>zip is a built-in function that takes two or more sequences and returns
a list of tuples where each tuple contains one element from each
sequence. The name of the function refers to a zipper, which joins and
interleaves two rows of teeth.</p>
<p>This example zips a string and a list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s">&#39;abc&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="go">&lt;zip object at 0x7f7d0a9e7c48&gt;</span>
</pre></div>
</div>
<p>The result is a <strong>zip object</strong> that knows how to iterate through the
pairs. The most common use of zip is in a for loop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">(&#39;a&#39;, 0)</span>
<span class="go">(&#39;b&#39;, 1)</span>
<span class="go">(&#39;c&#39;, 2)</span>
</pre></div>
</div>
<p>A zip object is a kind of <strong>iterator</strong>, which is any object that
iterates through a sequence. Iterators are similar to lists in some
ways, but unlike lists, you can’t use an index to select an element from
an iterator.</p>
<p>If you want to use list operators and methods, you can use a zip object
to make a list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
<span class="go">[(&#39;a&#39;, 0), (&#39;b&#39;, 1), (&#39;c&#39;, 2)]</span>
</pre></div>
</div>
<p>The result is a list of tuples; in this example, each tuple contains a
character from the string and the corresponding element from the list.</p>
<p>If the sequences are not the same length, the result has the length of
the shorter one.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="s">&#39;Anne&#39;</span><span class="p">,</span> <span class="s">&#39;Elk&#39;</span><span class="p">))</span>
<span class="go">[(&#39;A&#39;, &#39;E&#39;), (&#39;n&#39;, &#39;l&#39;), (&#39;n&#39;, &#39;k&#39;)]</span>
</pre></div>
</div>
<p>You can use tuple assignment in a for loop to traverse a list of tuples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">letter</span><span class="p">,</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">letter</span><span class="p">)</span>
</pre></div>
</div>
<p>Each time through the loop, Python selects the next tuple in the list
and assigns the elements to letter and number. The output of this loop
is:</p>
<div class="highlight-python"><div class="highlight"><pre>0 a
1 b
2 c
</pre></div>
</div>
<p>If you combine zip, for and tuple assignment, you get a useful idiom for
traversing two (or more) sequences at the same time. For example,
<code class="docutils literal"><span class="pre">has_match</span></code> takes two sequences, t1 and t2, and returns True if there
is an index i such that t1[i] == t2[i]:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">has_match</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
<p>If you need to traverse the elements of a sequence and their indices,
you can use the built-in function enumerate:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
</pre></div>
</div>
<p>The result from enumerate is an enumerate object, which iterates a
sequence of pairs; each pair contains an index (starting from 0) and an
element from the given sequence. In this example, the output is</p>
<div class="highlight-python"><div class="highlight"><pre>0 a
1 b
2 c
</pre></div>
</div>
<p>Again.</p>
</div>
<div class="section" id="dictionaries-and-tuples">
<h2>Dictionaries and tuples<a class="headerlink" href="#dictionaries-and-tuples" title="Permalink to this headline">¶</a></h2>
<p>Dictionaries have a method called items that returns a sequence of
tuples, where each tuple is a key-value pair.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">dict_items([(&#39;c&#39;, 2), (&#39;a&#39;, 0), (&#39;b&#39;, 1)])</span>
</pre></div>
</div>
<p>The result is a <code class="docutils literal"><span class="pre">dict_items</span></code> object, which is an iterator that
iterates the key-value pairs. You can use it in a for loop like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">c 2</span>
<span class="go">a 0</span>
<span class="go">b 1</span>
</pre></div>
</div>
<p>As you should expect from a dictionary, the items are in no particular
order.</p>
<p>Going in the other direction, you can use a list of tuples to initialize
a new dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{&#39;a&#39;: 0, &#39;c&#39;: 2, &#39;b&#39;: 1}</span>
</pre></div>
</div>
<p>Combining dict with zip yields a concise way to create a dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{&#39;a&#39;: 0, &#39;c&#39;: 2, &#39;b&#39;: 1}</span>
</pre></div>
</div>
<p>The dictionary method update also takes a list of tuples and adds them,
as key-value pairs, to an existing dictionary.</p>
<p>It is common to use tuples as keys in dictionaries (primarily because
you can’t use lists). For example, a telephone directory might map from
last-name, first-name pairs to telephone numbers. Assuming that we have
defined last, first and number, we could write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">directory</span><span class="p">[</span><span class="n">last</span><span class="p">,</span> <span class="n">first</span><span class="p">]</span> <span class="o">=</span> <span class="n">number</span>
</pre></div>
</div>
<p>The expression in brackets is a tuple. We could use tuple assignment to
traverse this dictionary.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">last</span><span class="p">,</span> <span class="n">first</span> <span class="ow">in</span> <span class="n">directory</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">directory</span><span class="p">[</span><span class="n">last</span><span class="p">,</span><span class="n">first</span><span class="p">])</span>
</pre></div>
</div>
<p>This loop traverses the keys in directory, which are tuples. It assigns
the elements of each tuple to last and first, then prints the name and
corresponding telephone number.</p>
<p>There are two ways to represent tuples in a state diagram. The more
detailed version shows the indices and elements just as they appear in a
list. For example, the tuple <code class="docutils literal"><span class="pre">('Cleese',</span> <span class="pre">'John')</span></code> would appear as in
Figure&nbsp;[fig.tuple1].</p>
<div class="figure" id="id83">
<img alt="State diagram." src="_images/tuple1.pdf" />
<p class="caption"><span class="caption-text">State diagram.</span></p>
</div>
<p>But in a larger diagram you might want to leave out the details. For
example, a diagram of the telephone directory might appear as in
Figure&nbsp;[fig.dict2].</p>
<div class="figure" id="id84">
<img alt="State diagram." src="_images/dict2.pdf" />
<p class="caption"><span class="caption-text">State diagram.</span></p>
</div>
<p>Here the tuples are shown using Python syntax as a graphical shorthand.
The telephone number in the diagram is the complaints line for the BBC,
so please don’t call it.</p>
</div>
<div class="section" id="sequences-of-sequences">
<h2>Sequences of sequences<a class="headerlink" href="#sequences-of-sequences" title="Permalink to this headline">¶</a></h2>
<p>I have focused on lists of tuples, but almost all of the examples in
this chapter also work with lists of lists, tuples of tuples, and tuples
of lists. To avoid enumerating the possible combinations, it is
sometimes easier to talk about sequences of sequences.</p>
<p>In many contexts, the different kinds of sequences (strings, lists and
tuples) can be used interchangeably. So how should you choose one over
the others?</p>
<p>To start with the obvious, strings are more limited than other sequences
because the elements have to be characters. They are also immutable. If
you need the ability to change the characters in a string (as opposed to
creating a new string), you might want to use a list of characters
instead.</p>
<p>Lists are more common than tuples, mostly because they are mutable. But
there are a few cases where you might prefer tuples:</p>
<ol class="arabic simple">
<li>In some contexts, like a return statement, it is syntactically
simpler to create a tuple than a list.</li>
<li>If you want to use a sequence as a dictionary key, you have to use an
immutable type like a tuple or string.</li>
<li>If you are passing a sequence as an argument to a function, using
tuples reduces the potential for unexpected behavior due to aliasing.</li>
</ol>
<p>Because tuples are immutable, they don’t provide methods like sort and
reverse, which modify existing lists. But Python provides the built-in
function sorted, which takes any sequence and returns a new list with
the same elements in sorted order, and reversed, which takes a sequence
and returns an iterator that traverses the list in reverse order.</p>
</div>
<div class="section" id="id34">
<h2>Debugging<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h2>
<p>Lists, dictionaries and tuples are examples of <strong>data structures</strong>; in
this chapter we are starting to see compound data structures, like lists
of tuples, or dictionaries that contain tuples as keys and lists as
values. Compound data structures are useful, but they are prone to what
I call <strong>shape errors</strong>; that is, errors caused when a data structure
has the wrong type, size, or structure. For example, if you are
expecting a list with one integer and I give you a plain old integer
(not in a list), it won’t work.</p>
<p>To help debug these kinds of errors, I have written a module called
structshape that provides a function, also called structshape, that
takes any kind of data structure as an argument and returns a string
that summarizes its shape. You can download it from
<a class="reference external" href="http://thinkpython2.com/code/structshape.py">http://thinkpython2.com/code/structshape.py</a></p>
<p>Here’s the result for a simple list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">structshape</span> <span class="kn">import</span> <span class="n">structshape</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">structshape</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">&#39;list of 3 int&#39;</span>
</pre></div>
</div>
<p>A fancier program might write “list of 3 int<em>s</em>”, but it was easier
not to deal with plurals. Here’s a list of lists:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">structshape</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
<span class="go">&#39;list of 3 list of 2 int&#39;</span>
</pre></div>
</div>
<p>If the elements of the list are not the same type, structshape groups
them, in order, by type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="s">&#39;5&#39;</span><span class="p">,</span> <span class="s">&#39;6&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="mi">9</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">structshape</span><span class="p">(</span><span class="n">t3</span><span class="p">)</span>
<span class="go">&#39;list of (3 int, float, 2 str, 2 list of int, int)&#39;</span>
</pre></div>
</div>
<p>Here’s a list of tuples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s">&#39;abc&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">structshape</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>
<span class="go">&#39;list of 3 tuple of (int, str)&#39;</span>
</pre></div>
</div>
<p>And here’s a dictionary with 3 items that map integers to strings.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">structshape</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">&#39;dict of 3 int-&gt;str&#39;</span>
</pre></div>
</div>
<p>If you are having trouble keeping track of your data structures,
structshape can help.</p>
</div>
<div class="section" id="id35">
<h2>Glossary<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>tuple:</dt>
<dd>An immutable sequence of elements.</dd>
<dt>tuple assignment:</dt>
<dd>An assignment with a sequence on the right side and a tuple of
variables on the left. The right side is evaluated and then its
elements are assigned to the variables on the left.</dd>
<dt>gather:</dt>
<dd>The operation of assembling a variable-length argument tuple.</dd>
<dt>scatter:</dt>
<dd>The operation of treating a sequence as a list of arguments.</dd>
<dt>zip object:</dt>
<dd>The result of calling a built-in function zip; an object that
iterates through a sequence of tuples.</dd>
<dt>iterator:</dt>
<dd>An object that can iterate through a sequence, but which does not
provide list operators and methods.</dd>
<dt>data structure:</dt>
<dd>A collection of related values, often organized in lists,
dictionaries, tuples, etc.</dd>
<dt>shape error:</dt>
<dd>An error caused because a value has the wrong shape; that is, the
wrong type or size.</dd>
</dl>
</div>
<div class="section" id="id36">
<h2>Exercises<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h2>
<p>Write a function called <code class="docutils literal"><span class="pre">most_frequent</span></code> that takes a string and prints
the letters in decreasing order of frequency. Find text samples from
several different languages and see how letter frequency varies between
languages. Compare your results with the tables at
<a class="reference external" href="http://en.wikipedia.org/wiki/Letter_frequencies">http://en.wikipedia.org/wiki/Letter_frequencies</a>. Solution:
<a class="reference external" href="http://thinkpython2.com/code/most_frequent.py">http://thinkpython2.com/code/most_frequent.py</a>.</p>
<p>[anagrams]</p>
<p>More anagrams!</p>
<ol class="arabic">
<li><p class="first">Write a program that reads a word list from a file (see
Section&nbsp;[wordlist]) and prints all the sets of words that are
anagrams.</p>
<p>Here is an example of what the output might look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;deltas&#39;</span><span class="p">,</span> <span class="s">&#39;desalt&#39;</span><span class="p">,</span> <span class="s">&#39;lasted&#39;</span><span class="p">,</span> <span class="s">&#39;salted&#39;</span><span class="p">,</span> <span class="s">&#39;slated&#39;</span><span class="p">,</span> <span class="s">&#39;staled&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s">&#39;retainers&#39;</span><span class="p">,</span> <span class="s">&#39;ternaries&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s">&#39;generating&#39;</span><span class="p">,</span> <span class="s">&#39;greatening&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s">&#39;resmelts&#39;</span><span class="p">,</span> <span class="s">&#39;smelters&#39;</span><span class="p">,</span> <span class="s">&#39;termless&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Hint: you might want to build a dictionary that maps from a
collection of letters to a list of words that can be spelled with
those letters. The question is, how can you represent the collection
of letters in a way that can be used as a key?</p>
</li>
<li><p class="first">Modify the previous program so that it prints the longest list of
anagrams first, followed by the second longest, and so on.</p>
</li>
<li><p class="first">In Scrabble a “bingo” is when you play all seven tiles in your rack,
along with a letter on the board, to form an eight-letter word. What
collection of 8 letters forms the most possible bingos? Hint: there
are seven.</p>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/anagram_sets.py">http://thinkpython2.com/code/anagram_sets.py</a>.</p>
</li>
</ol>
<p>Two words form a “metathesis pair” if you can transform one into the
other by swapping two letters; for example, “converse” and “conserve”.
Write a program that finds all of the metathesis pairs in the
dictionary. Hint: don’t test all pairs of words, and don’t test all
possible swaps. Solution: <a class="reference external" href="http://thinkpython2.com/code/metathesis.py">http://thinkpython2.com/code/metathesis.py</a>.
Credit: This exercise is inspired by an example at <a class="reference external" href="http://puzzlers.org">http://puzzlers.org</a>.</p>
<p>Here’s another Car Talk Puzzler
(<a class="reference external" href="http://www.cartalk.com/content/puzzlers">http://www.cartalk.com/content/puzzlers</a>):</p>
<blockquote>
<div><p>What is the longest English word, that remains a valid English word,
as you remove its letters one at a time?</p>
<p>Now, letters can be removed from either end, or the middle, but you
can’t rearrange any of the letters. Every time you drop a letter,
you wind up with another English word. If you do that, you’re
eventually going to wind up with one letter and that too is going to
be an English word—one that’s found in the dictionary. I want to
know what’s the longest word and how many letters does it have?</p>
<p>I’m going to give you a little modest example: Sprite. Ok? You start
off with sprite, you take a letter off, one from the interior of the
word, take the r away, and we’re left with the word spite, then we
take the e off the end, we’re left with spit, we take the s off,
we’re left with pit, it, and I.</p>
</div></blockquote>
<p>Write a program to find all words that can be reduced in this way, and
then find the longest one.</p>
<p>This exercise is a little more challenging than most, so here are some
suggestions:</p>
<ol class="arabic simple">
<li>You might want to write a function that takes a word and computes a
list of all the words that can be formed by removing one letter.
These are the “children” of the word.</li>
<li>Recursively, a word is reducible if any of its children are
reducible. As a base case, you can consider the empty string
reducible.</li>
<li>The wordlist I provided, words.txt, doesn’t contain single letter
words. So you might want to add “I”, “a”, and the empty string.</li>
<li>To improve the performance of your program, you might want to memoize
the words that are known to be reducible.</li>
</ol>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/reducible.py">http://thinkpython2.com/code/reducible.py</a>.</p>
</div>
</div>
<div class="section" id="case-study-data-structure-selection">
<h1>Case study: data structure selection<a class="headerlink" href="#case-study-data-structure-selection" title="Permalink to this headline">¶</a></h1>
<p>At this point you have learned about Python’s core data structures, and
you have seen some of the algorithms that use them. If you would like to
know more about algorithms, this might be a good time to read
Chapter&nbsp;[algorithms]. But you don’t have to read it before you go on;
you can read it whenever you are interested.</p>
<p>This chapter presents a case study with exercises that let you think
about choosing data structures and practice using them.</p>
<div class="section" id="word-frequency-analysis">
<h2>Word frequency analysis<a class="headerlink" href="#word-frequency-analysis" title="Permalink to this headline">¶</a></h2>
<p>As usual, you should at least attempt the exercises before you read my
solutions.</p>
<p>Write a program that reads a file, breaks each line into words, strips
whitespace and punctuation from the words, and converts them to
lowercase.</p>
<p>Hint: The string module provides a string named whitespace, which
contains space, tab, newline, etc., and punctuation which contains the
punctuation characters. Let’s see if we can make Python swear:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">string</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span>
<span class="go">&#39;!&quot;#$%&amp;&#39;()*+,-./:;&lt;=&gt;?@[\]^_`{|}~&#39;</span>
</pre></div>
</div>
<p>Also, you might consider using the string methods strip, replace and
translate.</p>
<p>Go to Project Gutenberg (<a class="reference external" href="http://gutenberg.org">http://gutenberg.org</a>) and download your
favorite out-of-copyright book in plain text format.</p>
<p>Modify your program from the previous exercise to read the book you
downloaded, skip over the header information at the beginning of the
file, and process the rest of the words as before.</p>
<p>Then modify the program to count the total number of words in the book,
and the number of times each word is used.</p>
<p>Print the number of different words used in the book. Compare different
books by different authors, written in different eras. Which author uses
the most extensive vocabulary?</p>
<p>Modify the program from the previous exercise to print the 20 most
frequently used words in the book.</p>
<p>Modify the previous program to read a word list (see Section&nbsp;[wordlist])
and then print all the words in the book that are not in the word list.
How many of them are typos? How many of them are common words that
<em>should</em> be in the word list, and how many of them are really obscure?</p>
</div>
<div class="section" id="random-numbers">
<h2>Random numbers<a class="headerlink" href="#random-numbers" title="Permalink to this headline">¶</a></h2>
<p>Given the same inputs, most computer programs generate the same outputs
every time, so they are said to be <strong>deterministic</strong>. Determinism is
usually a good thing, since we expect the same calculation to yield the
same result. For some applications, though, we want the computer to be
unpredictable. Games are an obvious example, but there are more.</p>
<p>Making a program truly nondeterministic turns out to be difficult, but
there are ways to make it at least seem nondeterministic. One of them is
to use algorithms that generate <strong>pseudorandom</strong> numbers. Pseudorandom
numbers are not truly random because they are generated by a
deterministic computation, but just by looking at the numbers it is all
but impossible to distinguish them from random.</p>
<p>The random module provides functions that generate pseudorandom numbers
(which I will simply call “random” from here on).</p>
<p>The function random returns a random float between 0.0 and 1.0
(including 0.0 but not 1.0). Each time you call random, you get the next
number in a long series. To see a sample, run this loop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">random</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>The function randint takes parameters low and high and returns an
integer between low and high (including both).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="go">9</span>
</pre></div>
</div>
<p>To choose an element from a sequence at random, you can use choice:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">3</span>
</pre></div>
</div>
<p>The random module also provides functions to generate random values from
continuous distributions including Gaussian, exponential, gamma, and a
few more.</p>
<p>Write a function named <code class="docutils literal"><span class="pre">choose_from_hist</span></code> that takes a histogram as
defined in Section&nbsp;[histogram] and returns a random value from the
histogram, chosen with probability in proportion to frequency. For
example, for this histogram:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hist</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hist</span>
<span class="go">{&#39;a&#39;: 2, &#39;b&#39;: 1}</span>
</pre></div>
</div>
<p>your function should return <code class="docutils literal"><span class="pre">'a'</span></code> with probability <span class="math">2/3</span> and
<code class="docutils literal"><span class="pre">'b'</span></code> with probability <span class="math">1/3</span>.</p>
</div>
<div class="section" id="word-histogram">
<h2>Word histogram<a class="headerlink" href="#word-histogram" title="Permalink to this headline">¶</a></h2>
<p>You should attempt the previous exercises before you go on. You can
download my solution from <a class="reference external" href="http://thinkpython2.com/code/analyze_book1.py">http://thinkpython2.com/code/analyze_book1.py</a>.
You will also need <a class="reference external" href="http://thinkpython2.com/code/emma.txt">http://thinkpython2.com/code/emma.txt</a>.</p>
<p>Here is a program that reads a file and builds a histogram of the words
in the file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">string</span>

<span class="k">def</span> <span class="nf">process_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">process_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">hist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hist</span>

<span class="k">def</span> <span class="nf">process_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">hist</span><span class="p">):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">whitespace</span><span class="p">)</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">hist</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">hist</span> <span class="o">=</span> <span class="n">process_file</span><span class="p">(</span><span class="s">&#39;emma.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This program reads emma.txt, which contains the text of <em>Emma</em> by Jane
Austen.</p>
<p><code class="docutils literal"><span class="pre">process_file</span></code> loops through the lines of the file, passing them one
at a time to <code class="docutils literal"><span class="pre">process_line</span></code>. The histogram hist is being used as an
accumulator.</p>
<p><code class="docutils literal"><span class="pre">process_line</span></code> uses the string method replace to replace hyphens with
spaces before using split to break the line into a list of strings. It
traverses the list of words and uses strip and lower to remove
punctuation and convert to lower case. (It is a shorthand to say that
strings are “converted”; remember that strings are immutable, so methods
like strip and lower return new strings.)</p>
<p>Finally, <code class="docutils literal"><span class="pre">process_line</span></code> updates the histogram by creating a new item
or incrementing an existing one.</p>
<p>To count the total number of words in the file, we can add up the
frequencies in the histogram:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">total_words</span><span class="p">(</span><span class="n">hist</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</pre></div>
</div>
<p>The number of different words is just the number of items in the
dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">different_words</span><span class="p">(</span><span class="n">hist</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is some code to print the results:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="s">&#39;Total number of words:&#39;</span><span class="p">,</span> <span class="n">total_words</span><span class="p">(</span><span class="n">hist</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Number of different words:&#39;</span><span class="p">,</span> <span class="n">different_words</span><span class="p">(</span><span class="n">hist</span><span class="p">))</span>
</pre></div>
</div>
<p>And the results:</p>
<div class="highlight-python"><div class="highlight"><pre>Total number of words: 161080
Number of different words: 7214
</pre></div>
</div>
</div>
<div class="section" id="most-common-words">
<h2>Most common words<a class="headerlink" href="#most-common-words" title="Permalink to this headline">¶</a></h2>
<p>To find the most common words, we can make a list of tuples, where each
tuple contains a word and its frequency, and sort it.</p>
<p>The following function takes a histogram and returns a list of
word-frequency tuples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">most_common</span><span class="p">(</span><span class="n">hist</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">hist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>

    <span class="n">t</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span>
</pre></div>
</div>
<p>In each tuple, the frequency appears first, so the resulting list is
sorted by frequency. Here is a loop that prints the ten most common
words:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">most_common</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;The most common words are:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">freq</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>I use the keyword argument sep to tell print to use a tab character as a
“separator”, rather than a space, so the second column is lined up. Here
are the results from <em>Emma</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>The most common words are:
to      5242
the     5205
and     4897
of      4295
i       3191
a       3130
it      2529
her     2483
was     2400
she     2364
</pre></div>
</div>
<p>This code can be simplified using the key parameter of the sort
function. If you are curious, you can read about it at
<a class="reference external" href="https://wiki.python.org/moin/HowTo/Sorting">https://wiki.python.org/moin/HowTo/Sorting</a>.</p>
</div>
<div class="section" id="optional-parameters">
<h2>Optional parameters<a class="headerlink" href="#optional-parameters" title="Permalink to this headline">¶</a></h2>
<p>We have seen built-in functions and methods that take optional
arguments. It is possible to write programmer-defined functions with
optional arguments, too. For example, here is a function that prints the
most common words in a histogram</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">print_most_common</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">most_common</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;The most common words are:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">freq</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[:</span><span class="n">num</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The first parameter is required; the second is optional. The <strong>default
value</strong> of num is 10.</p>
<p>If you only provide one argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">print_most_common</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
</pre></div>
</div>
<p>num gets the default value. If you provide two arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">print_most_common</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>num gets the value of the argument instead. In other words, the optional
argument <strong>overrides</strong> the default value.</p>
<p>If a function has both required and optional parameters, all the
required parameters have to come first, followed by the optional ones.</p>
</div>
<div class="section" id="dictionary-subtraction">
<h2>Dictionary subtraction<a class="headerlink" href="#dictionary-subtraction" title="Permalink to this headline">¶</a></h2>
<p>Finding the words from the book that are not in the word list from
words.txt is a problem you might recognize as set subtraction; that is,
we want to find all the words from one set (the words in the book) that
are not in the other (the words in the list).</p>
<p>subtract takes dictionaries d1 and d2 and returns a new dictionary that
contains all the keys from d1 that are not in d2. Since we don’t really
care about the values, we set them all to None.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">subtract</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d2</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p>To find the words in the book that are not in words.txt, we can use
<code class="docutils literal"><span class="pre">process_file</span></code> to build a histogram for words.txt, and then subtract:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">words</span> <span class="o">=</span> <span class="n">process_file</span><span class="p">(</span><span class="s">&#39;words.txt&#39;</span><span class="p">)</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">subtract</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;Words in the book that aren&#39;t in the word list:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">diff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here are some of the results from <em>Emma</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>Words in the book that aren&#39;t in the word list:
rencontre jane&#39;s blanche woodhouses disingenuousness
friend&#39;s venice apartment ...
</pre></div>
</div>
<p>Some of these words are names and possessives. Others, like “rencontre”,
are no longer in common use. But a few are common words that should
really be in the list!</p>
<p>Python provides a data structure called set that provides many common
set operations. You can read about them in Section&nbsp;[sets], or read the
documentation at
<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#types-set">http://docs.python.org/3/library/stdtypes.html#types-set</a>.</p>
<p>Write a program that uses set subtraction to find words in the book that
are not in the word list. Solution:
<a class="reference external" href="http://thinkpython2.com/code/analyze_book2.py">http://thinkpython2.com/code/analyze_book2.py</a>.</p>
</div>
<div class="section" id="random-words">
<h2>Random words<a class="headerlink" href="#random-words" title="Permalink to this headline">¶</a></h2>
<p>To choose a random word from the histogram, the simplest algorithm is to
build a list with multiple copies of each word, according to the
observed frequency, and then choose from the list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">random_word</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">word</span><span class="p">]</span> <span class="o">*</span> <span class="n">freq</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>The expression * freq creates a list with freq copies of the string
word. The extend method is similar to append except that the argument is
a sequence.</p>
<p>This algorithm works, but it is not very efficient; each time you choose
a random word, it rebuilds the list, which is as big as the original
book. An obvious improvement is to build the list once and then make
multiple selections, but the list is still big.</p>
<p>An alternative is:</p>
<ol class="arabic simple">
<li>Use keys to get a list of the words in the book.</li>
<li>Build a list that contains the cumulative sum of the word frequencies
(see Exercise&nbsp;[cumulative]). The last item in this list is the total
number of words in the book, <span class="math">n</span>.</li>
<li>Choose a random number from 1 to <span class="math">n</span>. Use a bisection search
(See Exercise&nbsp;[bisection]) to find the index where the random number
would be inserted in the cumulative sum.</li>
<li>Use the index to find the corresponding word in the word list.</li>
</ol>
<p>[randhist]</p>
<p>Write a program that uses this algorithm to choose a random word from
the book. Solution: <a class="reference external" href="http://thinkpython2.com/code/analyze_book3.py">http://thinkpython2.com/code/analyze_book3.py</a>.</p>
</div>
<div class="section" id="markov-analysis">
<h2>Markov analysis<a class="headerlink" href="#markov-analysis" title="Permalink to this headline">¶</a></h2>
<p>If you choose words from the book at random, you can get a sense of the
vocabulary, but you probably won’t get a sentence:</p>
<div class="highlight-python"><div class="highlight"><pre>this the small regard harriet which knightley&#39;s it most things
</pre></div>
</div>
<p>A series of random words seldom makes sense because there is no
relationship between successive words. For example, in a real sentence
you would expect an article like “the” to be followed by an adjective or
a noun, and probably not a verb or adverb.</p>
<p>One way to measure these kinds of relationships is Markov analysis,
which characterizes, for a given sequence of words, the probability of
the words that might come next. For example, the song <em>Eric, the Half a
Bee</em> begins:</p>
<blockquote>
<div><div class="line-block">
<div class="line">Half a bee, philosophically,</div>
<div class="line">Must, ipso facto, half not be.</div>
<div class="line">But half the bee has got to be</div>
<div class="line">Vis a vis, its entity. D’you see?</div>
<div class="line">But can a bee be said to be</div>
<div class="line">Or not to be an entire bee</div>
<div class="line">When half the bee is not a bee</div>
<div class="line">Due to some ancient injury?</div>
</div>
</div></blockquote>
<p>In this text, the phrase “half the” is always followed by the word
“bee”, but the phrase “the bee” might be followed by either “has” or
“is”.</p>
<p>The result of Markov analysis is a mapping from each prefix (like “half
the” and “the bee”) to all possible suffixes (like “has” and “is”).</p>
<p>Given this mapping, you can generate a random text by starting with any
prefix and choosing at random from the possible suffixes. Next, you can
combine the end of the prefix and the new suffix to form the next
prefix, and repeat.</p>
<p>For example, if you start with the prefix “Half a”, then the next word
has to be “bee”, because the prefix only appears once in the text. The
next prefix is “a bee”, so the next suffix might be “philosophically”,
“be” or “due”.</p>
<p>In this example the length of the prefix is always two, but you can do
Markov analysis with any prefix length.</p>
<p>Markov analysis:</p>
<ol class="arabic">
<li><p class="first">Write a program to read a text from a file and perform Markov
analysis. The result should be a dictionary that maps from prefixes
to a collection of possible suffixes. The collection might be a list,
tuple, or dictionary; it is up to you to make an appropriate choice.
You can test your program with prefix length two, but you should
write the program in a way that makes it easy to try other lengths.</p>
</li>
<li><p class="first">Add a function to the previous program to generate random text based
on the Markov analysis. Here is an example from <em>Emma</em> with prefix
length 2:</p>
<blockquote>
<div><p>He was very clever, be it sweetness or be angry, ashamed or only
amused, at such a stroke. She had never thought of Hannah till
you were never meant for me?“ ”I cannot make speeches, Emma:&#8221; he
soon cut it all himself.</p>
</div></blockquote>
<p>For this example, I left the punctuation attached to the words. The
result is almost syntactically correct, but not quite. Semantically,
it almost makes sense, but not quite.</p>
<p>What happens if you increase the prefix length? Does the random text
make more sense?</p>
</li>
<li><p class="first">Once your program is working, you might want to try a mash-up: if you
combine text from two or more books, the random text you generate
will blend the vocabulary and phrases from the sources in interesting
ways.</p>
</li>
</ol>
<p>Credit: This case study is based on an example from Kernighan and Pike,
<em>The Practice of Programming</em>, Addison-Wesley, 1999.</p>
<p>You should attempt this exercise before you go on; then you can can
download my solution from <a class="reference external" href="http://thinkpython2.com/code/markov.py">http://thinkpython2.com/code/markov.py</a>. You
will also need <a class="reference external" href="http://thinkpython2.com/code/emma.txt">http://thinkpython2.com/code/emma.txt</a>.</p>
</div>
<div class="section" id="data-structures">
<h2>Data structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">¶</a></h2>
<p>Using Markov analysis to generate random text is fun, but there is also
a point to this exercise: data structure selection. In your solution to
the previous exercises, you had to choose:</p>
<ul class="simple">
<li>How to represent the prefixes.</li>
<li>How to represent the collection of possible suffixes.</li>
<li>How to represent the mapping from each prefix to the collection of
possible suffixes.</li>
</ul>
<p>The last one is easy: a dictionary is the obvious choice for a mapping
from keys to corresponding values.</p>
<p>For the prefixes, the most obvious options are string, list of strings,
or tuple of strings.</p>
<p>For the suffixes, one option is a list; another is a histogram
(dictionary).</p>
<p>How should you choose? The first step is to think about the operations
you will need to implement for each data structure. For the prefixes, we
need to be able to remove words from the beginning and add to the end.
For example, if the current prefix is “Half a”, and the next word is
“bee”, you need to be able to form the next prefix, “a bee”.</p>
<p>Your first choice might be a list, since it is easy to add and remove
elements, but we also need to be able to use the prefixes as keys in a
dictionary, so that rules out lists. With tuples, you can’t append or
remove, but you can use the addition operator to form a new tuple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">prefix</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="p">(</span><span class="n">word</span><span class="p">,)</span>
</pre></div>
</div>
<p>shift takes a tuple of words, prefix, and a string, word, and forms a
new tuple that has all the words in prefix except the first, and word
added to the end.</p>
<p>For the collection of suffixes, the operations we need to perform
include adding a new suffix (or increasing the frequency of an existing
one), and choosing a random suffix.</p>
<p>Adding a new suffix is equally easy for the list implementation or the
histogram. Choosing a random element from a list is easy; choosing from
a histogram is harder to do efficiently (see Exercise&nbsp;[randhist]).</p>
<p>So far we have been talking mostly about ease of implementation, but
there are other factors to consider in choosing data structures. One is
run time. Sometimes there is a theoretical reason to expect one data
structure to be faster than other; for example, I mentioned that the in
operator is faster for dictionaries than for lists, at least when the
number of elements is large.</p>
<p>But often you don’t know ahead of time which implementation will be
faster. One option is to implement both of them and see which is better.
This approach is called <strong>benchmarking</strong>. A practical alternative is to
choose the data structure that is easiest to implement, and then see if
it is fast enough for the intended application. If so, there is no need
to go on. If not, there are tools, like the profile module, that can
identify the places in a program that take the most time.</p>
<p>The other factor to consider is storage space. For example, using a
histogram for the collection of suffixes might take less space because
you only have to store each word once, no matter how many times it
appears in the text. In some cases, saving space can also make your
program run faster, and in the extreme, your program might not run at
all if you run out of memory. But for many applications, space is a
secondary consideration after run time.</p>
<p>One final thought: in this discussion, I have implied that we should use
one data structure for both analysis and generation. But since these are
separate phases, it would also be possible to use one structure for
analysis and then convert to another structure for generation. This
would be a net win if the time saved during generation exceeded the time
spent in conversion.</p>
</div>
<div class="section" id="id37">
<h2>Debugging<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h2>
<p>When you are debugging a program, and especially if you are working on a
hard bug, there are five things to try:</p>
<dl class="docutils">
<dt>Reading:</dt>
<dd>Examine your code, read it back to yourself, and check that it says
what you meant to say.</dd>
<dt>Running:</dt>
<dd>Experiment by making changes and running different versions. Often
if you display the right thing at the right place in the program,
the problem becomes obvious, but sometimes you have to build
scaffolding.</dd>
<dt>Ruminating:</dt>
<dd>Take some time to think! What kind of error is it: syntax, runtime,
or semantic? What information can you get from the error messages,
or from the output of the program? What kind of error could cause
the problem you’re seeing? What did you change last, before the
problem appeared?</dd>
<dt>Rubberducking:</dt>
<dd>If you explain the problem to someone else, you sometimes find the
answer before you finish asking the question. Often you don’t need
the other person; you could just talk to a rubber duck. And that’s
the origin of the well-known strategy called <strong>rubber duck
debugging</strong>. I am not making this up; see
<a class="reference external" href="https://en.wikipedia.org/wiki/Rubber_duck_debugging">https://en.wikipedia.org/wiki/Rubber_duck_debugging</a>.</dd>
<dt>Retreating:</dt>
<dd>At some point, the best thing to do is back off, undoing recent
changes, until you get back to a program that works and that you
understand. Then you can start rebuilding.</dd>
</dl>
<p>Beginning programmers sometimes get stuck on one of these activities and
forget the others. Each activity comes with its own failure mode.</p>
<p>For example, reading your code might help if the problem is a
typographical error, but not if the problem is a conceptual
misunderstanding. If you don’t understand what your program does, you
can read it 100 times and never see the error, because the error is in
your head.</p>
<p>Running experiments can help, especially if you run small, simple tests.
But if you run experiments without thinking or reading your code, you
might fall into a pattern I call “random walk programming”, which is the
process of making random changes until the program does the right thing.
Needless to say, random walk programming can take a long time.</p>
<p>You have to take time to think. Debugging is like an experimental
science. You should have at least one hypothesis about what the problem
is. If there are two or more possibilities, try to think of a test that
would eliminate one of them.</p>
<p>But even the best debugging techniques will fail if there are too many
errors, or if the code you are trying to fix is too big and complicated.
Sometimes the best option is to retreat, simplifying the program until
you get to something that works and that you understand.</p>
<p>Beginning programmers are often reluctant to retreat because they can’t
stand to delete a line of code (even if it’s wrong). If it makes you
feel better, copy your program into another file before you start
stripping it down. Then you can copy the pieces back one at a time.</p>
<p>Finding a hard bug requires reading, running, ruminating, and sometimes
retreating. If you get stuck on one of these activities, try the others.</p>
</div>
<div class="section" id="id38">
<h2>Glossary<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>deterministic:</dt>
<dd>Pertaining to a program that does the same thing each time it runs,
given the same inputs.</dd>
<dt>pseudorandom:</dt>
<dd>Pertaining to a sequence of numbers that appears to be random, but
is generated by a deterministic program.</dd>
<dt>default value:</dt>
<dd>The value given to an optional parameter if no argument is provided.</dd>
<dt>override:</dt>
<dd>To replace a default value with an argument.</dd>
<dt>benchmarking:</dt>
<dd>The process of choosing between data structures by implementing
alternatives and testing them on a sample of the possible inputs.</dd>
<dt>rubber duck debugging:</dt>
<dd>Debugging by explaining your problem to an inanimate object such as
a rubber duck. Articulating the problem can help you solve it, even
if the rubber duck doesn’t know Python.</dd>
</dl>
</div>
<div class="section" id="id39">
<h2>Exercises<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h2>
<p>The “rank” of a word is its position in a list of words sorted by
frequency: the most common word has rank 1, the second most common has
rank 2, etc.</p>
<p>Zipf’s law describes a relationship between the ranks and frequencies of
words in natural languages (<a class="reference external" href="http://en.wikipedia.org/wiki/Zipf's_law">http://en.wikipedia.org/wiki/Zipf&#8217;s_law</a>).
Specifically, it predicts that the frequency, <span class="math">f</span>, of the word
with rank <span class="math">r</span> is:</p>
<div class="math">
<p><span class="math">f = c r^{-s}</span></p>
</div><p>where <span class="math">s</span> and <span class="math">c</span> are parameters that depend on the language
and the text. If you take the logarithm of both sides of this equation,
you get:</p>
<div class="math">
<p><span class="math">\log f = \log c - s \log r</span></p>
</div><p>So if you plot log <span class="math">f</span> versus log <span class="math">r</span>, you should get a
straight line with slope <span class="math">-s</span> and intercept log <span class="math">c</span>.</p>
<p>Write a program that reads a text from a file, counts word frequencies,
and prints one line for each word, in descending order of frequency,
with log <span class="math">f</span> and log <span class="math">r</span>. Use the graphing program of your
choice to plot the results and check whether they form a straight line.
Can you estimate the value of <span class="math">s</span>?</p>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/zipf.py">http://thinkpython2.com/code/zipf.py</a>. To run my solution, you
need the plotting module matplotlib. If you installed Anaconda, you
already have matplotlib; otherwise you might have to install it.</p>
</div>
</div>
<div class="section" id="files">
<h1>Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h1>
<p>This chapter introduces the idea of “persistent” programs that keep data
in permanent storage, and shows how to use different kinds of permanent
storage, like files and databases.</p>
<div class="section" id="persistence">
<h2>Persistence<a class="headerlink" href="#persistence" title="Permalink to this headline">¶</a></h2>
<p>Most of the programs we have seen so far are transient in the sense that
they run for a short time and produce some output, but when they end,
their data disappears. If you run the program again, it starts with a
clean slate.</p>
<p>Other programs are <strong>persistent</strong>: they run for a long time (or all the
time); they keep at least some of their data in permanent storage (a
hard drive, for example); and if they shut down and restart, they pick
up where they left off.</p>
<p>Examples of persistent programs are operating systems, which run pretty
much whenever a computer is on, and web servers, which run all the time,
waiting for requests to come in on the network.</p>
<p>One of the simplest ways for programs to maintain their data is by
reading and writing text files. We have already seen programs that read
text files; in this chapter we will see programs that write them.</p>
<p>An alternative is to store the state of the program in a database. In
this chapter I will present a simple database and a module, pickle, that
makes it easy to store program data.</p>
</div>
<div class="section" id="reading-and-writing">
<h2>Reading and writing<a class="headerlink" href="#reading-and-writing" title="Permalink to this headline">¶</a></h2>
<p>A text file is a sequence of characters stored on a permanent medium
like a hard drive, flash memory, or CD-ROM. We saw how to open and read
a file in Section&nbsp;[wordlist].</p>
<p>To write a file, you have to open it with mode <code class="docutils literal"><span class="pre">'w'</span></code> as a second
parameter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;output.txt&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the file already exists, opening it in write mode clears out the old
data and starts fresh, so be careful! If the file doesn’t exist, a new
one is created.</p>
<p>open returns a file object that provides methods for working with the
file. The write method puts data into the file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">line1</span> <span class="o">=</span> <span class="s">&quot;This here&#39;s the wattle,</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
<span class="go">24</span>
</pre></div>
</div>
<p>The return value is the number of characters that were written. The file
object keeps track of where it is, so if you call write again, it adds
the new data to the end of the file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">line2</span> <span class="o">=</span> <span class="s">&quot;the emblem of our land.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>
<span class="go">24</span>
</pre></div>
</div>
<p>When you are done writing, you should close the file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>If you don’t close the file, it gets closed for you when the program
ends.</p>
</div>
<div class="section" id="format-operator">
<h2>Format operator<a class="headerlink" href="#format-operator" title="Permalink to this headline">¶</a></h2>
<p>The argument of write has to be a string, so if we want to put other
values in a file, we have to convert them to strings. The easiest way to
do that is with str:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mi">52</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>An alternative is to use the <strong>format operator</strong>, %. When applied to
integers, % is the modulus operator. But when the first operand is a
string, % is the format operator.</p>
<p>The first operand is the <strong>format string</strong>, which contains one or more
<strong>format sequences</strong>, which specify how the second operand is formatted.
The result is a string.</p>
<p>For example, the format sequence <code class="docutils literal"><span class="pre">'%d'</span></code> means that the second operand
should be formatted as a decimal integer:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">camels</span> <span class="o">=</span> <span class="mi">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">camels</span>
<span class="go">&#39;42&#39;</span>
</pre></div>
</div>
<p>The result is the string <code class="docutils literal"><span class="pre">'42'</span></code>, which is not to be confused with the
integer value 42.</p>
<p>A format sequence can appear anywhere in the string, so you can embed a
value in a sentence:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;I have spotted </span><span class="si">%d</span><span class="s"> camels.&#39;</span> <span class="o">%</span> <span class="n">camels</span>
<span class="go">&#39;I have spotted 42 camels.&#39;</span>
</pre></div>
</div>
<p>If there is more than one format sequence in the string, the second
argument has to be a tuple. Each format sequence is matched with an
element of the tuple, in order.</p>
<p>The following example uses <code class="docutils literal"><span class="pre">'%d'</span></code> to format an integer, <code class="docutils literal"><span class="pre">'%g'</span></code> to
format a floating-point number, and <code class="docutils literal"><span class="pre">'%s'</span></code> to format a string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;In </span><span class="si">%d</span><span class="s"> years I have spotted </span><span class="si">%g</span><span class="s"> </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s">&#39;camels&#39;</span><span class="p">)</span>
<span class="go">&#39;In 3 years I have spotted 0.1 camels.&#39;</span>
</pre></div>
</div>
<p>The number of elements in the tuple has to match the number of format
sequences in the string. Also, the types of the elements have to match
the format sequences:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">TypeError: not enough arguments for format string</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39;dollars&#39;</span>
<span class="go">TypeError: %d format: a number is required, not str</span>
</pre></div>
</div>
<p>In the first example, there aren’t enough elements; in the second, the
element is the wrong type.</p>
<p>For more information on the format operator, see
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting">https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting</a>.
A more powerful alternative is the string format method, which you can
read about at
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str.format">https://docs.python.org/3/library/stdtypes.html#str.format</a>.</p>
</div>
<div class="section" id="filenames-and-paths">
<h2>Filenames and paths<a class="headerlink" href="#filenames-and-paths" title="Permalink to this headline">¶</a></h2>
<p>Files are organized into <strong>directories</strong> (also called “folders”). Every
running program has a “current directory”, which is the default
directory for most operations. For example, when you open a file for
reading, Python looks for it in the current directory.</p>
<p>The os module provides functions for working with files and directories
(“os” stands for “operating system”). os.getcwd returns the name of the
current directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cwd</span>
<span class="go">&#39;/home/dinsdale&#39;</span>
</pre></div>
</div>
<p>cwd stands for “current working directory”. The result in this example
is /home/dinsdale, which is the home directory of a user named dinsdale.</p>
<p>A string like <code class="docutils literal"><span class="pre">'/home/dinsdale'</span></code> that identifies a file or directory
is called a <strong>path</strong>.</p>
<p>A simple filename, like memo.txt is also considered a path, but it is a
<strong>relative path</strong> because it relates to the current directory. If the
current directory is /home/dinsdale, the filename memo.txt would refer
to /home/dinsdale/memo.txt.</p>
<p>A path that begins with / does not depend on the current directory; it
is called an <strong>absolute path</strong>. To find the absolute path to a file, you
can use os.path.abspath:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;memo.txt&#39;</span><span class="p">)</span>
<span class="go">&#39;/home/dinsdale/memo.txt&#39;</span>
</pre></div>
</div>
<p>os.path provides other functions for working with filenames and paths.
For example, os.path.exists checks whether a file or directory exists:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;memo.txt&#39;</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>If it exists, os.path.isdir checks whether it’s a directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s">&#39;memo.txt&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s">&#39;/home/dinsdale&#39;</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Similarly, os.path.isfile checks whether it’s a file.</p>
<p>os.listdir returns a list of the files (and other directories) in the
given directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
<span class="go">[&#39;music&#39;, &#39;photos&#39;, &#39;memo.txt&#39;]</span>
</pre></div>
</div>
<p>To demonstrate these functions, the following example “walks” through a
directory, prints the names of all the files, and calls itself
recursively on all the directories.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>os.path.join takes a directory and a file name and joins them into a
complete path.</p>
<p>The os module provides a function called walk that is similar to this
one but more versatile. As an exercise, read the documentation and use
it to print the names of the files in a given directory and its
subdirectories. You can download my solution from
<a class="reference external" href="http://thinkpython2.com/code/walk.py">http://thinkpython2.com/code/walk.py</a>.</p>
</div>
<div class="section" id="catching-exceptions">
<h2>Catching exceptions<a class="headerlink" href="#catching-exceptions" title="Permalink to this headline">¶</a></h2>
<p>A lot of things can go wrong when you try to read and write files. If
you try to open a file that doesn’t exist, you get an IOError:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;bad_file&#39;</span><span class="p">)</span>
<span class="go">IOError: [Errno 2] No such file or directory: &#39;bad_file&#39;</span>
</pre></div>
</div>
<p>If you don’t have permission to access a file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/etc/passwd&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
<span class="go">PermissionError: [Errno 13] Permission denied: &#39;/etc/passwd&#39;</span>
</pre></div>
</div>
<p>And if you try to open a directory for reading, you get</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/home&#39;</span><span class="p">)</span>
<span class="go">IsADirectoryError: [Errno 21] Is a directory: &#39;/home&#39;</span>
</pre></div>
</div>
<p>To avoid these errors, you could use functions like os.path.exists and
os.path.isfile, but it would take a lot of time and code to check all
the possibilities (if “Errno 21” is any indication, there are at least
21 things that can go wrong).</p>
<p>It is better to go ahead and try—and deal with problems if they
happen—which is exactly what the try statement does. The syntax is
similar to an if...else statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">fin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;bad_file&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Something went wrong.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Python starts by executing the try clause. If all goes well, it skips
the except clause and proceeds. If an exception occurs, it jumps out of
the try clause and runs the except clause.</p>
<p>Handling an exception with a try statement is called <strong>catching</strong> an
exception. In this example, the except clause prints an error message
that is not very helpful. In general, catching an exception gives you a
chance to fix the problem, or try again, or at least end the program
gracefully.</p>
</div>
<div class="section" id="databases">
<h2>Databases<a class="headerlink" href="#databases" title="Permalink to this headline">¶</a></h2>
<p>A <strong>database</strong> is a file that is organized for storing data. Many
databases are organized like a dictionary in the sense that they map
from keys to values. The biggest difference between a database and a
dictionary is that the database is on disk (or other permanent storage),
so it persists after the program ends.</p>
<p>The module dbm provides an interface for creating and updating database
files. As an example, I’ll create a database that contains captions for
image files.</p>
<p>Opening a database is similar to opening other files:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dbm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">dbm</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;captions&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The mode <code class="docutils literal"><span class="pre">'c'</span></code> means that the database should be created if it doesn’t
already exist. The result is a database object that can be used (for
most operations) like a dictionary.</p>
<p>When you create a new item, dbm updates the database file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="p">[</span><span class="s">&#39;cleese.png&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Photo of John Cleese.&#39;</span>
</pre></div>
</div>
<p>When you access one of the items, dbm reads the file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="p">[</span><span class="s">&#39;cleese.png&#39;</span><span class="p">]</span>
<span class="go">b&#39;Photo of John Cleese.&#39;</span>
</pre></div>
</div>
<p>The result is a <strong>bytes object</strong>, which is why it begins with b. A bytes
object is similar to a string in many ways. When you get farther into
Python, the difference becomes important, but for now we can ignore it.</p>
<p>If you make another assignment to an existing key, dbm replaces the old
value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="p">[</span><span class="s">&#39;cleese.png&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Photo of John Cleese doing a silly walk.&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="p">[</span><span class="s">&#39;cleese.png&#39;</span><span class="p">]</span>
<span class="go">b&#39;Photo of John Cleese doing a silly walk.&#39;</span>
</pre></div>
</div>
<p>Some dictionary methods, like keys and items, don’t work with database
objects. But iteration with a for loop works:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">db</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</pre></div>
</div>
<p>As with other files, you should close the database when you are done:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="pickling">
<h2>Pickling<a class="headerlink" href="#pickling" title="Permalink to this headline">¶</a></h2>
<p>A limitation of dbm is that the keys and values have to be strings or
bytes. If you try to use any other type, you get an error.</p>
<p>The pickle module can help. It translates almost any type of object into
a string suitable for storage in a database, and then translates strings
back into objects.</p>
<p>pickle.dumps takes an object as a parameter and returns a string
representation (dumps is short for “dump string”):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">b&#39;\x80\x03]q\x00(K\x01K\x02K\x03e.&#39;</span>
</pre></div>
</div>
<p>The format isn’t obvious to human readers; it is meant to be easy for
pickle to interpret. pickle.loads (“load string”) reconstitutes the
object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<p>Although the new object has the same value as the old, it is not (in
general) the same object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">==</span> <span class="n">t2</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="ow">is</span> <span class="n">t2</span>
<span class="go">False</span>
</pre></div>
</div>
<p>In other words, pickling and then unpickling has the same effect as
copying the object.</p>
<p>You can use pickle to store non-strings in a database. In fact, this
combination is so common that it has been encapsulated in a module
called shelve.</p>
</div>
<div class="section" id="pipes">
<h2>Pipes<a class="headerlink" href="#pipes" title="Permalink to this headline">¶</a></h2>
<p>Most operating systems provide a command-line interface, also known as a
<strong>shell</strong>. Shells usually provide commands to navigate the file system
and launch applications. For example, in Unix you can change directories
with cd, display the contents of a directory with ls, and launch a web
browser by typing (for example) firefox.</p>
<p>Any program that you can launch from the shell can also be launched from
Python using a <strong>pipe object</strong>, which represents a running program.</p>
<p>For example, the Unix command ls -l normally displays the contents of
the current directory in long format. You can launch ls with
os.popen <a class="footnote-reference" href="#id64" id="id40">[1]</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;ls -l&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
<p>The argument is a string that contains a shell command. The return value
is an object that behaves like an open file. You can read the output
from the ls process one line at a time with readline or get the whole
thing at once with read:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>When you are done, you close the pipe like a file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stat</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
<span class="go">None</span>
</pre></div>
</div>
<p>The return value is the final status of the ls process; None means that
it ended normally (with no errors).</p>
<p>For example, most Unix systems provide a command called md5sum that
reads the contents of a file and computes a “checksum”. You can read
about MD5 at <a class="reference external" href="http://en.wikipedia.org/wiki/Md5">http://en.wikipedia.org/wiki/Md5</a>. This command provides an
efficient way to check whether two files have the same contents. The
probability that different contents yield the same checksum is very
small (that is, unlikely to happen before the universe collapses).</p>
<p>You can use a pipe to run md5sum from Python and get the result:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;book.tex&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;md5sum &#39;</span> <span class="o">+</span> <span class="n">filename</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stat</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="go">1e0033f0ed0656636de0d75144ba32e0  book.tex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
<span class="go">None</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-modules">
<h2>Writing modules<a class="headerlink" href="#writing-modules" title="Permalink to this headline">¶</a></h2>
<p>Any file that contains Python code can be imported as a module. For
example, suppose you have a file named wc.py with the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">linecount</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">count</span>

<span class="k">print</span><span class="p">(</span><span class="n">linecount</span><span class="p">(</span><span class="s">&#39;wc.py&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>If you run this program, it reads itself and prints the number of lines
in the file, which is 7. You can also import it like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">wc</span>
<span class="go">7</span>
</pre></div>
</div>
<p>Now you have a module object wc:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">wc</span>
<span class="go">&lt;module &#39;wc&#39; from &#39;wc.py&#39;&gt;</span>
</pre></div>
</div>
<p>The module object provides <code class="docutils literal"><span class="pre">linecount</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">wc</span><span class="o">.</span><span class="n">linecount</span><span class="p">(</span><span class="s">&#39;wc.py&#39;</span><span class="p">)</span>
<span class="go">7</span>
</pre></div>
</div>
<p>So that’s how you write modules in Python.</p>
<p>The only problem with this example is that when you import the module it
runs the test code at the bottom. Normally when you import a module, it
defines new functions but it doesn’t run them.</p>
<p>Programs that will be imported as modules often use the following idiom:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">linecount</span><span class="p">(</span><span class="s">&#39;wc.py&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">__name__</span></code> is a built-in variable that is set when the program starts.
If the program is running as a script, <code class="docutils literal"><span class="pre">__name__</span></code> has the value
<code class="docutils literal"><span class="pre">'__main__'</span></code>; in that case, the test code runs. Otherwise, if the
module is being imported, the test code is skipped.</p>
<p>As an exercise, type this example into a file named wc.py and run it as
a script. Then run the Python interpreter and import wc. What is the
value of <code class="docutils literal"><span class="pre">__name__</span></code> when the module is being imported?</p>
<p>Warning: If you import a module that has already been imported, Python
does nothing. It does not re-read the file, even if it has changed.</p>
<p>If you want to reload a module, you can use the built-in function
reload, but it can be tricky, so the safest thing to do is restart the
interpreter and then import the module again.</p>
</div>
<div class="section" id="id41">
<h2>Debugging<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h2>
<p>When you are reading and writing files, you might run into problems with
whitespace. These errors can be hard to debug because spaces, tabs and
newlines are normally invisible:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s">&#39;1 2</span><span class="se">\t</span><span class="s"> 3</span><span class="se">\n</span><span class="s"> 4&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">1 2  3</span>
<span class="go"> 4</span>
</pre></div>
</div>
<p>The built-in function repr can help. It takes any object as an argument
and returns a string representation of the object. For strings, it
represents whitespace characters with backslash sequences:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="go">&#39;1 2\t 3\n 4&#39;</span>
</pre></div>
</div>
<p>This can be helpful for debugging.</p>
<p>One other problem you might run into is that different systems use
different characters to indicate the end of a line. Some systems use a
newline, represented <code class="docutils literal"><span class="pre">\n</span></code>. Others use a return character, represented
<code class="docutils literal"><span class="pre">\r</span></code>. Some use both. If you move files between different systems,
these inconsistencies can cause problems.</p>
<p>For most systems, there are applications to convert from one format to
another. You can find them (and read more about this issue) at
<a class="reference external" href="http://en.wikipedia.org/wiki/Newline">http://en.wikipedia.org/wiki/Newline</a>. Or, of course, you could write one
yourself.</p>
</div>
<div class="section" id="id42">
<h2>Glossary<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>persistent:</dt>
<dd>Pertaining to a program that runs indefinitely and keeps at least
some of its data in permanent storage.</dd>
<dt>format operator:</dt>
<dd>An operator, %, that takes a format string and a tuple and generates
a string that includes the elements of the tuple formatted as
specified by the format string.</dd>
<dt>format string:</dt>
<dd>A string, used with the format operator, that contains format
sequences.</dd>
<dt>format sequence:</dt>
<dd>A sequence of characters in a format string, like %d, that specifies
how a value should be formatted.</dd>
<dt>text file:</dt>
<dd>A sequence of characters stored in permanent storage like a hard
drive.</dd>
<dt>directory:</dt>
<dd>A named collection of files, also called a folder.</dd>
<dt>path:</dt>
<dd>A string that identifies a file.</dd>
<dt>relative path:</dt>
<dd>A path that starts from the current directory.</dd>
<dt>absolute path:</dt>
<dd>A path that starts from the topmost directory in the file system.</dd>
<dt>catch:</dt>
<dd>To prevent an exception from terminating a program using the try and
except statements.</dd>
<dt>database:</dt>
<dd>A file whose contents are organized like a dictionary with keys that
correspond to values.</dd>
<dt>bytes object:</dt>
<dd>An object similar to a string.</dd>
<dt>shell:</dt>
<dd>A program that allows users to type commands and then executes them
by starting other programs.</dd>
<dt>pipe object:</dt>
<dd>An object that represents a running program, allowing a Python
program to run commands and read the results.</dd>
</dl>
</div>
<div class="section" id="id43">
<h2>Exercises<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h2>
<p>Write a function called sed that takes as arguments a pattern string, a
replacement string, and two filenames; it should read the first file and
write the contents into the second file (creating it if necessary). If
the pattern string appears anywhere in the file, it should be replaced
with the replacement string.</p>
<p>If an error occurs while opening, reading, writing or closing files,
your program should catch the exception, print an error message, and
exit. Solution: <a class="reference external" href="http://thinkpython2.com/code/sed.py">http://thinkpython2.com/code/sed.py</a>.</p>
<p>If you download my solution to Exercise&nbsp;[anagrams] from
<a class="reference external" href="http://thinkpython2.com/code/anagram_sets.py">http://thinkpython2.com/code/anagram_sets.py</a>, you’ll see that it creates
a dictionary that maps from a sorted string of letters to the list of
words that can be spelled with those letters. For example, <code class="docutils literal"><span class="pre">'opst'</span></code>
maps to the list <code class="docutils literal"><span class="pre">['opts',</span> <span class="pre">'post',</span> <span class="pre">'pots',</span> <span class="pre">'spot',</span> <span class="pre">'stop',</span> <span class="pre">'tops']</span></code>.</p>
<p>Write a module that imports <code class="docutils literal"><span class="pre">anagram_sets</span></code> and provides two new
functions: <code class="docutils literal"><span class="pre">store_anagrams</span></code> should store the anagram dictionary in a
“shelf”; <code class="docutils literal"><span class="pre">read_anagrams</span></code> should look up a word and return a list of
its anagrams. Solution: <a class="reference external" href="http://thinkpython2.com/code/anagram_db.py">http://thinkpython2.com/code/anagram_db.py</a>.</p>
<p>[checksum]</p>
<p>In a large collection of MP3 files, there may be more than one copy of
the same song, stored in different directories or with different file
names. The goal of this exercise is to search for duplicates.</p>
<ol class="arabic simple">
<li>Write a program that searches a directory and all of its
subdirectories, recursively, and returns a list of complete paths for
all files with a given suffix (like .mp3). Hint: os.path provides
several useful functions for manipulating file and path names.</li>
<li>To recognize duplicates, you can use md5sum to compute a “checksum”
for each files. If two files have the same checksum, they probably
have the same contents.</li>
<li>To double-check, you can use the Unix command diff.</li>
</ol>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/find_duplicates.py">http://thinkpython2.com/code/find_duplicates.py</a>.</p>
</div>
</div>
<div class="section" id="classes-and-objects">
<h1>Classes and objects<a class="headerlink" href="#classes-and-objects" title="Permalink to this headline">¶</a></h1>
<p>At this point you know how to use functions to organize code and
built-in types to organize data. The next step is to learn
“object-oriented programming”, which uses programmer-defined types to
organize both code and data. Object-oriented programming is a big topic;
it will take a few chapters to get there.</p>
<p>Code examples from this chapter are available from
<a class="reference external" href="http://thinkpython2.com/code/Point1.py">http://thinkpython2.com/code/Point1.py</a>; solutions to the exercises are
available from <a class="reference external" href="http://thinkpython2.com/code/Point1_soln.py">http://thinkpython2.com/code/Point1_soln.py</a>.</p>
<div class="section" id="programmer-defined-types">
<h2>Programmer-defined types<a class="headerlink" href="#programmer-defined-types" title="Permalink to this headline">¶</a></h2>
<p>We have used many of Python’s built-in types; now we are going to define
a new type. As an example, we will create a type called Point that
represents a point in two-dimensional space.</p>
<p>In mathematical notation, points are often written in parentheses with a
comma separating the coordinates. For example, <span class="math">(0,0)</span> represents
the origin, and <span class="math">(x,y)</span> represents the point <span class="math">x</span> units to
the right and <span class="math">y</span> units up from the origin.</p>
<p>There are several ways we might represent points in Python:</p>
<ul class="simple">
<li>We could store the coordinates separately in two variables, x and y.</li>
<li>We could store the coordinates as elements in a list or tuple.</li>
<li>We could create a new type to represent points as objects.</li>
</ul>
<p>Creating a new type is more complicated than the other options, but it
has advantages that will be apparent soon.</p>
<p>A programmer-defined type is also called a <strong>class</strong>. A class definition
looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Represents a point in 2-D space.&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The header indicates that the new class is called Point. The body is a
docstring that explains what the class is for. You can define variables
and methods inside a class definition, but we will get back to that
later.</p>
<p>Defining a class named Point creates a <strong>class object</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Point</span>
<span class="go">&lt;class &#39;__main__.Point&#39;&gt;</span>
</pre></div>
</div>
<p>Because Point is defined at the top level, its “full name” is
<code class="docutils literal"><span class="pre">__main__.Point</span></code>.</p>
<p>The class object is like a factory for creating objects. To create a
Point, you call Point as if it were a function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blank</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blank</span>
<span class="go">&lt;__main__.Point object at 0xb7e9d3ac&gt;</span>
</pre></div>
</div>
<p>The return value is a reference to a Point object, which we assign to
blank.</p>
<p>Creating a new object is called <strong>instantiation</strong>, and the object is an
<strong>instance</strong> of the class.</p>
<p>When you print an instance, Python tells you what class it belongs to
and where it is stored in memory (the prefix 0x means that the following
number is in hexadecimal).</p>
<p>Every object is an instance of some class, so “object” and “instance”
are interchangeable. But in this chapter I use “instance” to indicate
that I am talking about a programmer-defined type.</p>
</div>
<div class="section" id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<p>You can assign values to an instance using dot notation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blank</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blank</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">4.0</span>
</pre></div>
</div>
<p>This syntax is similar to the syntax for selecting a variable from a
module, such as math.pi or string.whitespace. In this case, though, we
are assigning values to named elements of an object. These elements are
called <strong>attributes</strong>.</p>
<p>As a noun, “AT-trib-ute” is pronounced with emphasis on the first
syllable, as opposed to “a-TRIB-ute”, which is a verb.</p>
<p>The following diagram shows the result of these assignments. A state
diagram that shows an object and its attributes is called an <strong>object
diagram</strong>; see Figure&nbsp;[fig.point].</p>
<div class="figure" id="id85">
<img alt="Object diagram." src="_images/point.pdf" />
<p class="caption"><span class="caption-text">Object diagram.</span></p>
</div>
<p>The variable blank refers to a Point object, which contains two
attributes. Each attribute refers to a floating-point number.</p>
<p>You can read the value of an attribute using the same syntax:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blank</span><span class="o">.</span><span class="n">y</span>
<span class="go">4.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">blank</span><span class="o">.</span><span class="n">x</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">3.0</span>
</pre></div>
</div>
<p>The expression blank.x means, “Go to the object blank refers to and get
the value of x.” In the example, we assign that value to a variable
named x. There is no conflict between the variable x and the attribute
x.</p>
<p>You can use dot notation as part of any expression. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;(</span><span class="si">%g</span><span class="s">, </span><span class="si">%g</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">blank</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">blank</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
<span class="go">&#39;(3.0, 4.0)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">blank</span><span class="o">.</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">blank</span><span class="o">.</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span>
<span class="go">5.0</span>
</pre></div>
</div>
<p>You can pass an instance as an argument in the usual way. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">print_point</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;(</span><span class="si">%g</span><span class="s">, </span><span class="si">%g</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">print_point</span></code> takes a point as an argument and displays it in
mathematical notation. To invoke it, you can pass blank as an argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">print_point</span><span class="p">(</span><span class="n">blank</span><span class="p">)</span>
<span class="go">(3.0, 4.0)</span>
</pre></div>
</div>
<p>Inside the function, p is an alias for blank, so if the function
modifies p, blank changes.</p>
<p>As an exercise, write a function called <code class="docutils literal"><span class="pre">distance_between_points</span></code> that
takes two Points as arguments and returns the distance between them.</p>
</div>
<div class="section" id="rectangles">
<h2>Rectangles<a class="headerlink" href="#rectangles" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it is obvious what the attributes of an object should be, but
other times you have to make decisions. For example, imagine you are
designing a class to represent rectangles. What attributes would you use
to specify the location and size of a rectangle? You can ignore angle;
to keep things simple, assume that the rectangle is either vertical or
horizontal.</p>
<p>There are at least two possibilities:</p>
<ul class="simple">
<li>You could specify one corner of the rectangle (or the center), the
width, and the height.</li>
<li>You could specify two opposing corners.</li>
</ul>
<p>At this point it is hard to say whether either is better than the other,
so we’ll implement the first one, just as an example.</p>
<p>Here is the class definition:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Rectangle</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Represents a rectangle.</span>

<span class="sd">    attributes: width, height, corner.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The docstring lists the attributes: width and height are numbers; corner
is a Point object that specifies the lower-left corner.</p>
<p>To represent a rectangle, you have to instantiate a Rectangle object and
assign values to the attributes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">box</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">()</span>
<span class="n">box</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">box</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mf">200.0</span>
<span class="n">box</span><span class="o">.</span><span class="n">corner</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
<span class="n">box</span><span class="o">.</span><span class="n">corner</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">box</span><span class="o">.</span><span class="n">corner</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
<p>The expression box.corner.x means, “Go to the object box refers to and
select the attribute named corner; then go to that object and select the
attribute named x.”</p>
<div class="figure" id="id86">
<img alt="Object diagram." src="_images/rectangle.pdf" />
<p class="caption"><span class="caption-text">Object diagram.</span></p>
</div>
<p>Figure&nbsp;[fig.rectangle] shows the state of this object. An object that is
an attribute of another object is <strong>embedded</strong>.</p>
</div>
<div class="section" id="instances-as-return-values">
<h2>Instances as return values<a class="headerlink" href="#instances-as-return-values" title="Permalink to this headline">¶</a></h2>
<p>Functions can return instances. For example, <code class="docutils literal"><span class="pre">find_center</span></code> takes a
Rectangle as an argument and returns a Point that contains the
coordinates of the center of the Rectangle:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">find_center</span><span class="p">(</span><span class="n">rect</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">corner</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">corner</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">rect</span><span class="o">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">p</span>
</pre></div>
</div>
<p>Here is an example that passes box as an argument and assigns the
resulting Point to center:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">center</span> <span class="o">=</span> <span class="n">find_center</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_point</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
<span class="go">(50, 100)</span>
</pre></div>
</div>
</div>
<div class="section" id="objects-are-mutable">
<h2>Objects are mutable<a class="headerlink" href="#objects-are-mutable" title="Permalink to this headline">¶</a></h2>
<p>You can change the state of an object by making an assignment to one of
its attributes. For example, to change the size of a rectangle without
changing its position, you can modify the values of width and height:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">box</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="mi">50</span>
<span class="n">box</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="mi">100</span>
</pre></div>
</div>
<p>You can also write functions that modify objects. For example,
<code class="docutils literal"><span class="pre">grow_rectangle</span></code> takes a Rectangle object and two numbers, dwidth and
dheight, and adds the numbers to the width and height of the rectangle:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">grow_rectangle</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">dwidth</span><span class="p">,</span> <span class="n">dheight</span><span class="p">):</span>
    <span class="n">rect</span><span class="o">.</span><span class="n">width</span> <span class="o">+=</span> <span class="n">dwidth</span>
    <span class="n">rect</span><span class="o">.</span><span class="n">height</span> <span class="o">+=</span> <span class="n">dheight</span>
</pre></div>
</div>
<p>Here is an example that demonstrates the effect:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">box</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
<span class="go">(150.0, 300.0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grow_rectangle</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">box</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
<span class="go">(200.0, 400.0)</span>
</pre></div>
</div>
<p>Inside the function, rect is an alias for box, so when the function
modifies rect, box changes.</p>
<p>As an exercise, write a function named <code class="docutils literal"><span class="pre">move_rectangle</span></code> that takes a
Rectangle and two numbers named dx and dy. It should change the location
of the rectangle by adding dx to the x coordinate of corner and adding
dy to the y coordinate of corner.</p>
</div>
<div class="section" id="copying">
<h2>Copying<a class="headerlink" href="#copying" title="Permalink to this headline">¶</a></h2>
<p>Aliasing can make a program difficult to read because changes in one
place might have unexpected effects in another place. It is hard to keep
track of all the variables that might refer to a given object.</p>
<p>Copying an object is often an alternative to aliasing. The copy module
contains a function called copy that can duplicate any object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">4.0</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">copy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
</pre></div>
</div>
<p>p1 and p2 contain the same data, but they are not the same Point.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">print_point</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
<span class="go">(3, 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_point</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
<span class="go">(3, 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="ow">is</span> <span class="n">p2</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">==</span> <span class="n">p2</span>
<span class="go">False</span>
</pre></div>
</div>
<p>The is operator indicates that p1 and p2 are not the same object, which
is what we expected. But you might have expected == to yield True
because these points contain the same data. In that case, you will be
disappointed to learn that for instances, the default behavior of the ==
operator is the same as the is operator; it checks object identity, not
object equivalence. That’s because for programmer-defined types, Python
doesn’t know what should be considered equivalent. At least, not yet.</p>
<p>If you use copy.copy to duplicate a Rectangle, you will find that it
copies the Rectangle object but not the embedded Point.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">box2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">box2</span> <span class="ow">is</span> <span class="n">box</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">box2</span><span class="o">.</span><span class="n">corner</span> <span class="ow">is</span> <span class="n">box</span><span class="o">.</span><span class="n">corner</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="figure" id="id87">
<img alt="Object diagram." src="_images/rectangle2.pdf" />
<p class="caption"><span class="caption-text">Object diagram.</span></p>
</div>
<p>Figure&nbsp;[fig.rectangle2] shows what the object diagram looks like. This
operation is called a <strong>shallow copy</strong> because it copies the object and
any references it contains, but not the embedded objects.</p>
<p>For most applications, this is not what you want. In this example,
invoking <code class="docutils literal"><span class="pre">grow_rectangle</span></code> on one of the Rectangles would not affect
the other, but invoking <code class="docutils literal"><span class="pre">move_rectangle</span></code> on either would affect both!
This behavior is confusing and error-prone.</p>
<p>Fortunately, the copy module provides a method named deepcopy that
copies not only the object but also the objects it refers to, and the
objects <em>they</em> refer to, and so on. You will not be surprised to learn
that this operation is called a <strong>deep copy</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">box3</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">box3</span> <span class="ow">is</span> <span class="n">box</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">box3</span><span class="o">.</span><span class="n">corner</span> <span class="ow">is</span> <span class="n">box</span><span class="o">.</span><span class="n">corner</span>
<span class="go">False</span>
</pre></div>
</div>
<p>box3 and box are completely separate objects.</p>
<p>As an exercise, write a version of <code class="docutils literal"><span class="pre">move_rectangle</span></code> that creates and
returns a new Rectangle instead of modifying the old one.</p>
</div>
<div class="section" id="id44">
<h2>Debugging<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h2>
<p>When you start working with objects, you are likely to encounter some
new exceptions. If you try to access an attribute that doesn’t exist,
you get an AttributeError:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">z</span>
<span class="go">AttributeError: Point instance has no attribute &#39;z&#39;</span>
</pre></div>
</div>
<p>If you are not sure what type an object is, you can ask:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">&lt;class &#39;__main__.Point&#39;&gt;</span>
</pre></div>
</div>
<p>You can also use isinstance to check whether an object is an instance of
a class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Point</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>If you are not sure whether an object has a particular attribute, you
can use the built-in function hasattr:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>The first argument can be any object; the second argument is a <em>string</em>
that contains the name of the attribute.</p>
<p>You can also use a try statement to see if the object has the attributes
you need:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>This approach can make it easier to write functions that work with
different types; more on that topic is coming up in
Section&nbsp;[polymorphism].</p>
</div>
<div class="section" id="id45">
<h2>Glossary<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>class:</dt>
<dd>A programmer-defined type. A class definition creates a new class
object.</dd>
<dt>class object:</dt>
<dd>An object that contains information about a programmer-defined type.
The class object can be used to create instances of the type.</dd>
<dt>instance:</dt>
<dd>An object that belongs to a class.</dd>
<dt>instantiate:</dt>
<dd>To create a new object.</dd>
<dt>attribute:</dt>
<dd>One of the named values associated with an object.</dd>
<dt>embedded object:</dt>
<dd>An object that is stored as an attribute of another object.</dd>
<dt>shallow copy:</dt>
<dd>To copy the contents of an object, including any references to
embedded objects; implemented by the copy function in the copy
module.</dd>
<dt>deep copy:</dt>
<dd>To copy the contents of an object as well as any embedded objects,
and any objects embedded in them, and so on; implemented by the
deepcopy function in the copy module.</dd>
<dt>object diagram:</dt>
<dd>A diagram that shows objects, their attributes, and the values of
the attributes.</dd>
</dl>
</div>
<div class="section" id="id46">
<h2>Exercises<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h2>
<p>Write a definition for a class named Circle with attributes center and
radius, where center is a Point object and radius is a number.</p>
<p>Instantiate a Circle object that represents a circle with its center at
<span class="math">(150, 100)</span> and radius 75.</p>
<p>Write a function named <code class="docutils literal"><span class="pre">point_in_circle</span></code> that takes a Circle and a
Point and returns True if the Point lies in or on the boundary of the
circle.</p>
<p>Write a function named <code class="docutils literal"><span class="pre">rect_in_circle</span></code> that takes a Circle and a
Rectangle and returns True if the Rectangle lies entirely in or on the
boundary of the circle.</p>
<p>Write a function named <code class="docutils literal"><span class="pre">rect_circle_overlap</span></code> that takes a Circle and a
Rectangle and returns True if any of the corners of the Rectangle fall
inside the circle. Or as a more challenging version, return True if any
part of the Rectangle falls inside the circle.</p>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/Circle.py">http://thinkpython2.com/code/Circle.py</a>.</p>
<p>Write a function called <code class="docutils literal"><span class="pre">draw_rect</span></code> that takes a Turtle object and a
Rectangle and uses the Turtle to draw the Rectangle. See
Chapter&nbsp;[turtlechap] for examples using Turtle objects.</p>
<p>Write a function called <code class="docutils literal"><span class="pre">draw_circle</span></code> that takes a Turtle and a Circle
and draws the Circle.</p>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/draw.py">http://thinkpython2.com/code/draw.py</a>.</p>
</div>
</div>
<div class="section" id="classes-and-functions">
<h1>Classes and functions<a class="headerlink" href="#classes-and-functions" title="Permalink to this headline">¶</a></h1>
<p>Now that we know how to create new types, the next step is to write
functions that take programmer-defined objects as parameters and return
them as results. In this chapter I also present “functional programming
style” and two new program development plans.</p>
<p>Code examples from this chapter are available from
<a class="reference external" href="http://thinkpython2.com/code/Time1.py">http://thinkpython2.com/code/Time1.py</a>. Solutions to the exercises are at
<a class="reference external" href="http://thinkpython2.com/code/Time1_soln.py">http://thinkpython2.com/code/Time1_soln.py</a>.</p>
<div class="section" id="time">
<h2>Time<a class="headerlink" href="#time" title="Permalink to this headline">¶</a></h2>
<p>As another example of a programmer-defined type, we’ll define a class
called Time that records the time of day. The class definition looks
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Time</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Represents the time of day.</span>

<span class="sd">    attributes: hour, minute, second</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>We can create a new Time object and assign attributes for hours,
minutes, and seconds:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">time</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="mi">59</span>
<span class="n">time</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
<p>The state diagram for the Time object looks like Figure&nbsp;[fig.time].</p>
<p>As an exercise, write a function called <code class="docutils literal"><span class="pre">print_time</span></code> that takes a Time
object and prints it in the form hour:minute:second. Hint: the format
sequence <code class="docutils literal"><span class="pre">'%.2d'</span></code> prints an integer using at least two digits,
including a leading zero if necessary.</p>
<p>Write a boolean function called <code class="docutils literal"><span class="pre">is_after</span></code> that takes two Time
objects, t1 and t2, and returns True if t1 follows t2 chronologically
and False otherwise. Challenge: don’t use an if statement.</p>
<div class="figure" id="id88">
<img alt="Object diagram." src="_images/time.pdf" />
<p class="caption"><span class="caption-text">Object diagram.</span></p>
</div>
</div>
<div class="section" id="pure-functions">
<h2>Pure functions<a class="headerlink" href="#pure-functions" title="Permalink to this headline">¶</a></h2>
<p>In the next few sections, we’ll write two functions that add time
values. They demonstrate two kinds of functions: pure functions and
modifiers. They also demonstrate a development plan I’ll call
<strong>prototype and patch</strong>, which is a way of tackling a complex problem by
starting with a simple prototype and incrementally dealing with the
complications.</p>
<p>Here is a simple prototype of <code class="docutils literal"><span class="pre">add_time</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">add_time</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">Time</span><span class="p">()</span>
    <span class="nb">sum</span><span class="o">.</span><span class="n">hour</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="n">hour</span>
    <span class="nb">sum</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">minute</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="n">minute</span>
    <span class="nb">sum</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">second</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="n">second</span>
    <span class="k">return</span> <span class="nb">sum</span>
</pre></div>
</div>
<p>The function creates a new Time object, initializes its attributes, and
returns a reference to the new object. This is called a <strong>pure
function</strong> because it does not modify any of the objects passed to it as
arguments and it has no effect, like displaying a value or getting user
input, other than returning a value.</p>
<p>To test this function, I’ll create two Time objects: start contains the
start time of a movie, like <em>Monty Python and the Holy Grail</em>, and
duration contains the run time of the movie, which is one hour 35
minutes.</p>
<p><code class="docutils literal"><span class="pre">add_time</span></code> figures out when the movie will be done.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="n">Time</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start</span><span class="o">.</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="mi">45</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span>  <span class="mi">0</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">duration</span> <span class="o">=</span> <span class="n">Time</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">duration</span><span class="o">.</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">duration</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="mi">35</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">duration</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="mi">0</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">done</span> <span class="o">=</span> <span class="n">add_time</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_time</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
<span class="go">10:80:00</span>
</pre></div>
</div>
<p>The result, 10:80:00 might not be what you were hoping for. The problem
is that this function does not deal with cases where the number of
seconds or minutes adds up to more than sixty. When that happens, we
have to “carry” the extra seconds into the minute column or the extra
minutes into the hour column.</p>
<p>Here’s an improved version:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">add_time</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">Time</span><span class="p">()</span>
    <span class="nb">sum</span><span class="o">.</span><span class="n">hour</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="n">hour</span>
    <span class="nb">sum</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">minute</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="n">minute</span>
    <span class="nb">sum</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">second</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="n">second</span>

    <span class="k">if</span> <span class="nb">sum</span><span class="o">.</span><span class="n">second</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
        <span class="nb">sum</span><span class="o">.</span><span class="n">second</span> <span class="o">-=</span> <span class="mi">60</span>
        <span class="nb">sum</span><span class="o">.</span><span class="n">minute</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="nb">sum</span><span class="o">.</span><span class="n">minute</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
        <span class="nb">sum</span><span class="o">.</span><span class="n">minute</span> <span class="o">-=</span> <span class="mi">60</span>
        <span class="nb">sum</span><span class="o">.</span><span class="n">hour</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="nb">sum</span>
</pre></div>
</div>
<p>Although this function is correct, it is starting to get big. We will
see a shorter alternative later.</p>
</div>
<div class="section" id="modifiers">
<h2>Modifiers<a class="headerlink" href="#modifiers" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it is useful for a function to modify the objects it gets as
parameters. In that case, the changes are visible to the caller.
Functions that work this way are called <strong>modifiers</strong>.</p>
<p>increment, which adds a given number of seconds to a Time object, can be
written naturally as a modifier. Here is a rough draft:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">second</span> <span class="o">+=</span> <span class="n">seconds</span>

    <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">second</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">second</span> <span class="o">-=</span> <span class="mi">60</span>
        <span class="n">time</span><span class="o">.</span><span class="n">minute</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">minute</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">minute</span> <span class="o">-=</span> <span class="mi">60</span>
        <span class="n">time</span><span class="o">.</span><span class="n">hour</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The first line performs the basic operation; the remainder deals with
the special cases we saw before.</p>
<p>Is this function correct? What happens if seconds is much greater than
sixty?</p>
<p>In that case, it is not enough to carry once; we have to keep doing it
until time.second is less than sixty. One solution is to replace the if
statements with while statements. That would make the function correct,
but not very efficient. As an exercise, write a correct version of
increment that doesn’t contain any loops.</p>
<p>Anything that can be done with modifiers can also be done with pure
functions. In fact, some programming languages only allow pure
functions. There is some evidence that programs that use pure functions
are faster to develop and less error-prone than programs that use
modifiers. But modifiers are convenient at times, and functional
programs tend to be less efficient.</p>
<p>In general, I recommend that you write pure functions whenever it is
reasonable and resort to modifiers only if there is a compelling
advantage. This approach might be called a <strong>functional programming
style</strong>.</p>
<p>As an exercise, write a “pure” version of increment that creates and
returns a new Time object rather than modifying the parameter.</p>
</div>
<div class="section" id="prototyping-versus-planning">
<h2>Prototyping versus planning<a class="headerlink" href="#prototyping-versus-planning" title="Permalink to this headline">¶</a></h2>
<p>The development plan I am demonstrating is called “prototype and patch”.
For each function, I wrote a prototype that performed the basic
calculation and then tested it, patching errors along the way.</p>
<p>This approach can be effective, especially if you don’t yet have a deep
understanding of the problem. But incremental corrections can generate
code that is unnecessarily complicated—since it deals with many special
cases—and unreliable—since it is hard to know if you have found all the
errors.</p>
<p>An alternative is <strong>designed development</strong>, in which high-level insight
into the problem can make the programming much easier. In this case, the
insight is that a Time object is really a three-digit number in base 60
(see <a class="reference external" href="http://en.wikipedia.org/wiki/Sexagesimal">http://en.wikipedia.org/wiki/Sexagesimal</a>.)! The second attribute is
the “ones column”, the minute attribute is the “sixties column”, and the
hour attribute is the “thirty-six hundreds column”.</p>
<p>When we wrote <code class="docutils literal"><span class="pre">add_time</span></code> and increment, we were effectively doing
addition in base 60, which is why we had to carry from one column to the
next.</p>
<p>This observation suggests another approach to the whole problem—we can
convert Time objects to integers and take advantage of the fact that the
computer knows how to do integer arithmetic.</p>
<p>Here is a function that converts Times to integers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">time_to_int</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="n">minutes</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">minute</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">second</span>
    <span class="k">return</span> <span class="n">seconds</span>
</pre></div>
</div>
<p>And here is a function that converts an integer to a Time (recall that
divmod divides the first argument by the second and returns the quotient
and remainder as a tuple).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">int_to_time</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">()</span>
    <span class="n">minutes</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time</span>
</pre></div>
</div>
<p>You might have to think a bit, and run some tests, to convince yourself
that these functions are correct. One way to test them is to check that
<code class="docutils literal"><span class="pre">time_to_int(int_to_time(x))</span> <span class="pre">==</span> <span class="pre">x</span></code> for many values of x. This is an
example of a consistency check.</p>
<p>Once you are convinced they are correct, you can use them to rewrite
<code class="docutils literal"><span class="pre">add_time</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">add_time</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="n">time_to_int</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span> <span class="o">+</span> <span class="n">time_to_int</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">int_to_time</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
</pre></div>
</div>
<p>This version is shorter than the original, and easier to verify. As an
exercise, rewrite increment using <code class="docutils literal"><span class="pre">time_to_int</span></code> and <code class="docutils literal"><span class="pre">int_to_time</span></code>.</p>
<p>In some ways, converting from base 60 to base 10 and back is harder than
just dealing with times. Base conversion is more abstract; our intuition
for dealing with time values is better.</p>
<p>But if we have the insight to treat times as base 60 numbers and make
the investment of writing the conversion functions (<code class="docutils literal"><span class="pre">time_to_int</span></code> and
<code class="docutils literal"><span class="pre">int_to_time</span></code>), we get a program that is shorter, easier to read and
debug, and more reliable.</p>
<p>It is also easier to add features later. For example, imagine
subtracting two Times to find the duration between them. The naive
approach would be to implement subtraction with borrowing. Using the
conversion functions would be easier and more likely to be correct.</p>
<p>Ironically, sometimes making a problem harder (or more general) makes it
easier (because there are fewer special cases and fewer opportunities
for error).</p>
</div>
<div class="section" id="id47">
<h2>Debugging<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h2>
<p>A Time object is well-formed if the values of minute and second are
between 0 and 60 (including 0 but not 60) and if hour is positive. hour
and minute should be integral values, but we might allow second to have
a fraction part.</p>
<p>Requirements like these are called <strong>invariants</strong> because they should
always be true. To put it a different way, if they are not true,
something has gone wrong.</p>
<p>Writing code to check invariants can help detect errors and find their
causes. For example, you might have a function like <code class="docutils literal"><span class="pre">valid_time</span></code> that
takes a Time object and returns False if it violates an invariant:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">valid_time</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">time</span><span class="o">.</span><span class="n">minute</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">time</span><span class="o">.</span><span class="n">second</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">minute</span> <span class="o">&gt;=</span> <span class="mi">60</span> <span class="ow">or</span> <span class="n">time</span><span class="o">.</span><span class="n">second</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>At the beginning of each function you could check the arguments to make
sure they are valid:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">add_time</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_time</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">valid_time</span><span class="p">(</span><span class="n">t2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;invalid Time object in add_time&#39;</span><span class="p">)</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="n">time_to_int</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span> <span class="o">+</span> <span class="n">time_to_int</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">int_to_time</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
</pre></div>
</div>
<p>Or you could use an <strong>assert statement</strong>, which checks a given invariant
and raises an exception if it fails:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">add_time</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">valid_time</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">valid_time</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="n">time_to_int</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span> <span class="o">+</span> <span class="n">time_to_int</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">int_to_time</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
</pre></div>
</div>
<p>assert statements are useful because they distinguish code that deals
with normal conditions from code that checks for errors.</p>
</div>
<div class="section" id="id48">
<h2>Glossary<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>prototype and patch:</dt>
<dd>A development plan that involves writing a rough draft of a program,
testing, and correcting errors as they are found.</dd>
<dt>designed development:</dt>
<dd>A development plan that involves high-level insight into the problem
and more planning than incremental development or prototype
development.</dd>
<dt>pure function:</dt>
<dd>A function that does not modify any of the objects it receives as
arguments. Most pure functions are fruitful.</dd>
<dt>modifier:</dt>
<dd>A function that changes one or more of the objects it receives as
arguments. Most modifiers are void; that is, they return None.</dd>
<dt>functional programming style:</dt>
<dd>A style of program design in which the majority of functions are
pure.</dd>
<dt>invariant:</dt>
<dd>A condition that should always be true during the execution of a
program.</dd>
<dt>assert statement:</dt>
<dd>A statement that check a condition and raises an exception if it
fails.</dd>
</dl>
</div>
<div class="section" id="id49">
<h2>Exercises<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h2>
<p>Code examples from this chapter are available from
<a class="reference external" href="http://thinkpython2.com/code/Time1.py">http://thinkpython2.com/code/Time1.py</a>; solutions to the exercises are
available from <a class="reference external" href="http://thinkpython2.com/code/Time1_soln.py">http://thinkpython2.com/code/Time1_soln.py</a>.</p>
<p>Write a function called <code class="docutils literal"><span class="pre">mul_time</span></code> that takes a Time object and a
number and returns a new Time object that contains the product of the
original Time and the number.</p>
<p>Then use <code class="docutils literal"><span class="pre">mul_time</span></code> to write a function that takes a Time object that
represents the finishing time in a race, and a number that represents
the distance, and returns a Time object that represents the average pace
(time per mile).</p>
<p>The datetime module provides time objects that are similar to the Time
objects in this chapter, but they provide a rich set of methods and
operators. Read the documentation at
<a class="reference external" href="http://docs.python.org/3/library/datetime.html">http://docs.python.org/3/library/datetime.html</a>.</p>
<ol class="arabic simple">
<li>Use the datetime module to write a program that gets the current date
and prints the day of the week.</li>
<li>Write a program that takes a birthday as input and prints the user’s
age and the number of days, hours, minutes and seconds until their
next birthday.</li>
<li>For two people born on different days, there is a day when one is
twice as old as the other. That’s their Double Day. Write a program
that takes two birthdays and computes their Double Day.</li>
<li>For a little more challenge, write the more general version that
computes the day when one person is <span class="math">n</span> times older than the
other.</li>
</ol>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/double.py">http://thinkpython2.com/code/double.py</a></p>
</div>
</div>
<div class="section" id="classes-and-methods">
<h1>Classes and methods<a class="headerlink" href="#classes-and-methods" title="Permalink to this headline">¶</a></h1>
<p>Although we are using some of Python’s object-oriented features, the
programs from the last two chapters are not really object-oriented
because they don’t represent the relationships between
programmer-defined types and the functions that operate on them. The
next step is to transform those functions into methods that make the
relationships explicit.</p>
<p>Code examples from this chapter are available from
<a class="reference external" href="http://thinkpython2.com/code/Time2.py">http://thinkpython2.com/code/Time2.py</a>, and solutions to the exercises
are in <a class="reference external" href="http://thinkpython2.com/code/Point2_soln.py">http://thinkpython2.com/code/Point2_soln.py</a>.</p>
<div class="section" id="object-oriented-features">
<h2>Object-oriented features<a class="headerlink" href="#object-oriented-features" title="Permalink to this headline">¶</a></h2>
<p>Python is an <strong>object-oriented programming language</strong>, which means that
it provides features that support object-oriented programming, which has
these defining characteristics:</p>
<ul class="simple">
<li>Programs include class and method definitions.</li>
<li>Most of the computation is expressed in terms of operations on
objects.</li>
<li>Objects often represent things in the real world, and methods often
correspond to the ways things in the real world interact.</li>
</ul>
<p>For example, the Time class defined in Chapter&nbsp;[time] corresponds to the
way people record the time of day, and the functions we defined
correspond to the kinds of things people do with times. Similarly, the
Point and Rectangle classes in Chapter&nbsp;[clobjects] correspond to the
mathematical concepts of a point and a rectangle.</p>
<p>So far, we have not taken advantage of the features Python provides to
support object-oriented programming. These features are not strictly
necessary; most of them provide alternative syntax for things we have
already done. But in many cases, the alternative is more concise and
more accurately conveys the structure of the program.</p>
<p>For example, in Time1.py there is no obvious connection between the
class definition and the function definitions that follow. With some
examination, it is apparent that every function takes at least one Time
object as an argument.</p>
<p>This observation is the motivation for <strong>methods</strong>; a method is a
function that is associated with a particular class. We have seen
methods for strings, lists, dictionaries and tuples. In this chapter, we
will define methods for programmer-defined types.</p>
<p>Methods are semantically the same as functions, but there are two
syntactic differences:</p>
<ul class="simple">
<li>Methods are defined inside a class definition in order to make the
relationship between the class and the method explicit.</li>
<li>The syntax for invoking a method is different from the syntax for
calling a function.</li>
</ul>
<p>In the next few sections, we will take the functions from the previous
two chapters and transform them into methods. This transformation is
purely mechanical; you can do it by following a sequence of steps. If
you are comfortable converting from one form to another, you will be
able to choose the best form for whatever you are doing.</p>
</div>
<div class="section" id="printing-objects">
<h2>Printing objects<a class="headerlink" href="#printing-objects" title="Permalink to this headline">¶</a></h2>
<p>In Chapter&nbsp;[time], we defined a class named Time and in
Section&nbsp;[isafter], you wrote a function named <code class="docutils literal"><span class="pre">print_time</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Time</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Represents the time of day.&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">print_time</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.2d</span><span class="s">:</span><span class="si">%.2d</span><span class="s">:</span><span class="si">%.2d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">second</span><span class="p">))</span>
</pre></div>
</div>
<p>To call this function, you have to pass a Time object as an argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="n">Time</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start</span><span class="o">.</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="mi">45</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="mo">00</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_time</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="go">09:45:00</span>
</pre></div>
</div>
<p>To make <code class="docutils literal"><span class="pre">print_time</span></code> a method, all we have to do is move the function
definition inside the class definition. Notice the change in
indentation.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Time</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">print_time</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.2d</span><span class="s">:</span><span class="si">%.2d</span><span class="s">:</span><span class="si">%.2d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">second</span><span class="p">))</span>
</pre></div>
</div>
<p>Now there are two ways to call <code class="docutils literal"><span class="pre">print_time</span></code>. The first (and less
common) way is to use function syntax:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Time</span><span class="o">.</span><span class="n">print_time</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="go">09:45:00</span>
</pre></div>
</div>
<p>In this use of dot notation, Time is the name of the class, and
<code class="docutils literal"><span class="pre">print_time</span></code> is the name of the method. start is passed as a
parameter.</p>
<p>The second (and more concise) way is to use method syntax:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span><span class="o">.</span><span class="n">print_time</span><span class="p">()</span>
<span class="go">09:45:00</span>
</pre></div>
</div>
<p>In this use of dot notation, <code class="docutils literal"><span class="pre">print_time</span></code> is the name of the method
(again), and start is the object the method is invoked on, which is
called the <strong>subject</strong>. Just as the subject of a sentence is what the
sentence is about, the subject of a method invocation is what the method
is about.</p>
<p>Inside the method, the subject is assigned to the first parameter, so in
this case start is assigned to time.</p>
<p>By convention, the first parameter of a method is called self, so it
would be more common to write <code class="docutils literal"><span class="pre">print_time</span></code> like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Time</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">print_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.2d</span><span class="s">:</span><span class="si">%.2d</span><span class="s">:</span><span class="si">%.2d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="p">))</span>
</pre></div>
</div>
<p>The reason for this convention is an implicit metaphor:</p>
<ul class="simple">
<li>The syntax for a function call, <code class="docutils literal"><span class="pre">print_time(start)</span></code>, suggests that
the function is the active agent. It says something like, “Hey
<code class="docutils literal"><span class="pre">print_time</span></code>! Here’s an object for you to print.”</li>
<li>In object-oriented programming, the objects are the active agents. A
method invocation like <code class="docutils literal"><span class="pre">start.print_time()</span></code> says “Hey start! Please
print yourself.”</li>
</ul>
<p>This change in perspective might be more polite, but it is not obvious
that it is useful. In the examples we have seen so far, it may not be.
But sometimes shifting responsibility from the functions onto the
objects makes it possible to write more versatile functions (or
methods), and makes it easier to maintain and reuse code.</p>
<p>As an exercise, rewrite <code class="docutils literal"><span class="pre">time_to_int</span></code> (from Section&nbsp;[prototype]) as a
method. You might be tempted to rewrite <code class="docutils literal"><span class="pre">int_to_time</span></code> as a method,
too, but that doesn’t really make sense because there would be no object
to invoke it on.</p>
</div>
<div class="section" id="another-example">
<h2>Another example<a class="headerlink" href="#another-example" title="Permalink to this headline">¶</a></h2>
<p>Here’s a version of increment (from Section&nbsp;[increment]) rewritten as a
method:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Time:

    def increment(self, seconds):
        seconds += self.time_to_int()
        return int_to_time(seconds)
</pre></div>
</div>
<p>This version assumes that <code class="docutils literal"><span class="pre">time_to_int</span></code> is written as a method. Also,
note that it is a pure function, not a modifier.</p>
<p>Here’s how you would invoke increment:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span><span class="o">.</span><span class="n">print_time</span><span class="p">()</span>
<span class="go">09:45:00</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span><span class="mi">1337</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end</span><span class="o">.</span><span class="n">print_time</span><span class="p">()</span>
<span class="go">10:07:17</span>
</pre></div>
</div>
<p>The subject, start, gets assigned to the first parameter, self. The
argument, 1337, gets assigned to the second parameter, seconds.</p>
<p>This mechanism can be confusing, especially if you make an error. For
example, if you invoke increment with two arguments, you get:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">end</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span><span class="mi">1337</span><span class="p">,</span> <span class="mi">460</span><span class="p">)</span>
<span class="go">TypeError: increment() takes 2 positional arguments but 3 were given</span>
</pre></div>
</div>
<p>The error message is initially confusing, because there are only two
arguments in parentheses. But the subject is also considered an
argument, so all together that’s three.</p>
<p>By the way, a <strong>positional argument</strong> is an argument that doesn’t have a
parameter name; that is, it is not a keyword argument. In this function
call:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sketch</span><span class="p">(</span><span class="n">parrot</span><span class="p">,</span> <span class="n">cage</span><span class="p">,</span> <span class="n">dead</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>parrot and cage are positional, and dead is a keyword argument.</p>
</div>
<div class="section" id="a-more-complicated-example">
<h2>A more complicated example<a class="headerlink" href="#a-more-complicated-example" title="Permalink to this headline">¶</a></h2>
<p>Rewriting <code class="docutils literal"><span class="pre">is_after</span></code> (from Section&nbsp;[isafter]) is slightly more
complicated because it takes two Time objects as parameters. In this
case it is conventional to name the first parameter self and the second
parameter other:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Time:

    def is_after(self, other):
        return self.time_to_int() &gt; other.time_to_int()
</pre></div>
</div>
<p>To use this method, you have to invoke it on one object and pass the
other as an argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">end</span><span class="o">.</span><span class="n">is_after</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>One nice thing about this syntax is that it almost reads like English:
“end is after start?”</p>
</div>
<div class="section" id="the-init-method">
<h2>The init method<a class="headerlink" href="#the-init-method" title="Permalink to this headline">¶</a></h2>
<p>The init method (short for “initialization”) is a special method that
gets invoked when an object is instantiated. Its full name is
<code class="docutils literal"><span class="pre">__init__</span></code> (two underscore characters, followed by init, and then two
more underscores). An init method for the Time class might look like
this:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Time:

    def __init__(self, hour=0, minute=0, second=0):
        self.hour = hour
        self.minute = minute
        self.second = second
</pre></div>
</div>
<p>It is common for the parameters of <code class="docutils literal"><span class="pre">__init__</span></code> to have the same names
as the attributes. The statement</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">hour</span> <span class="o">=</span> <span class="n">hour</span>
</pre></div>
</div>
<p>stores the value of the parameter hour as an attribute of self.</p>
<p>The parameters are optional, so if you call Time with no arguments, you
get the default values.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">print_time</span><span class="p">()</span>
<span class="go">00:00:00</span>
</pre></div>
</div>
<p>If you provide one argument, it overrides hour:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">=</span> <span class="n">Time</span> <span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">print_time</span><span class="p">()</span>
<span class="go">09:00:00</span>
</pre></div>
</div>
<p>If you provide two arguments, they override hour and minute.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">print_time</span><span class="p">()</span>
<span class="go">09:45:00</span>
</pre></div>
</div>
<p>And if you provide three arguments, they override all three default
values.</p>
<p>As an exercise, write an init method for the Point class that takes x
and y as optional parameters and assigns them to the corresponding
attributes.</p>
</div>
<div class="section" id="the-str-method">
<h2>The __str__ method<a class="headerlink" href="#the-str-method" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">__str__</span></code> is a special method, like <code class="docutils literal"><span class="pre">__init__</span></code>, that is supposed to
return a string representation of an object.</p>
<p>For example, here is a str method for Time objects:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Time:

    def __str__(self):
        return &#39;%.2d:%.2d:%.2d&#39; % (self.hour, self.minute, self.second)
</pre></div>
</div>
<p>When you print an object, Python invokes the str method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
<span class="go">09:45:00</span>
</pre></div>
</div>
<p>When I write a new class, I almost always start by writing <code class="docutils literal"><span class="pre">__init__</span></code>,
which makes it easier to instantiate objects, and <code class="docutils literal"><span class="pre">__str__</span></code>, which is
useful for debugging.</p>
<p>As an exercise, write a str method for the Point class. Create a Point
object and print it.</p>
</div>
<div class="section" id="operator-overloading">
<h2>Operator overloading<a class="headerlink" href="#operator-overloading" title="Permalink to this headline">¶</a></h2>
<p>By defining other special methods, you can specify the behavior of
operators on programmer-defined types. For example, if you define a
method named <code class="docutils literal"><span class="pre">__add__</span></code> for the Time class, you can use the + operator
on Time objects.</p>
<p>Here is what the definition might look like:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Time:

    def __add__(self, other):
        seconds = self.time_to_int() + other.time_to_int()
        return int_to_time(seconds)
</pre></div>
</div>
<p>And here is how you could use it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">duration</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">duration</span><span class="p">)</span>
<span class="go">11:20:00</span>
</pre></div>
</div>
<p>When you apply the + operator to Time objects, Python invokes
<code class="docutils literal"><span class="pre">__add__</span></code>. When you print the result, Python invokes <code class="docutils literal"><span class="pre">__str__</span></code>. So
there is a lot happening behind the scenes!</p>
<p>Changing the behavior of an operator so that it works with
programmer-defined types is called <strong>operator overloading</strong>. For every
operator in Python there is a corresponding special method, like
<code class="docutils literal"><span class="pre">__add__</span></code>. For more details, see
<a class="reference external" href="http://docs.python.org/3/reference/datamodel.html#specialnames">http://docs.python.org/3/reference/datamodel.html#specialnames</a>.</p>
<p>As an exercise, write an add method for the Point class.</p>
</div>
<div class="section" id="type-based-dispatch">
<h2>Type-based dispatch<a class="headerlink" href="#type-based-dispatch" title="Permalink to this headline">¶</a></h2>
<p>In the previous section we added two Time objects, but you also might
want to add an integer to a Time object. The following is a version of
<code class="docutils literal"><span class="pre">__add__</span></code> that checks the type of other and invokes either
<code class="docutils literal"><span class="pre">add_time</span></code> or increment:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Time:

    def __add__(self, other):
        if isinstance(other, Time):
            return self.add_time(other)
        else:
            return self.increment(other)

    def add_time(self, other):
        seconds = self.time_to_int() + other.time_to_int()
        return int_to_time(seconds)

    def increment(self, seconds):
        seconds += self.time_to_int()
        return int_to_time(seconds)
</pre></div>
</div>
<p>The built-in function isinstance takes a value and a class object, and
returns True if the value is an instance of the class.</p>
<p>If other is a Time object, <code class="docutils literal"><span class="pre">__add__</span></code> invokes <code class="docutils literal"><span class="pre">add_time</span></code>. Otherwise
it assumes that the parameter is a number and invokes increment. This
operation is called a <strong>type-based dispatch</strong> because it dispatches the
computation to different methods based on the type of the arguments.</p>
<p>Here are examples that use the + operator with different types:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">duration</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">duration</span><span class="p">)</span>
<span class="go">11:20:00</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1337</span><span class="p">)</span>
<span class="go">10:07:17</span>
</pre></div>
</div>
<p>Unfortunately, this implementation of addition is not commutative. If
the integer is the first operand, you get</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="mi">1337</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
<span class="go">TypeError: unsupported operand type(s) for +: &#39;int&#39; and &#39;instance&#39;</span>
</pre></div>
</div>
<p>The problem is, instead of asking the Time object to add an integer,
Python is asking an integer to add a Time object, and it doesn’t know
how. But there is a clever solution for this problem: the special method
<code class="docutils literal"><span class="pre">__radd__</span></code>, which stands for “right-side add”. This method is invoked
when a Time object appears on the right side of the + operator. Here’s
the definition:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Time:

    def __radd__(self, other):
        return self.__add__(other)
</pre></div>
</div>
<p>And here’s how it’s used:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="mi">1337</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
<span class="go">10:07:17</span>
</pre></div>
</div>
<p>As an exercise, write an add method for Points that works with either a
Point object or a tuple:</p>
<ul class="simple">
<li>If the second operand is a Point, the method should return a new
Point whose <span class="math">x</span> coordinate is the sum of the <span class="math">x</span>
coordinates of the operands, and likewise for the <span class="math">y</span>
coordinates.</li>
<li>If the second operand is a tuple, the method should add the first
element of the tuple to the <span class="math">x</span> coordinate and the second
element to the <span class="math">y</span> coordinate, and return a new Point with the
result.</li>
</ul>
</div>
<div class="section" id="polymorphism">
<h2>Polymorphism<a class="headerlink" href="#polymorphism" title="Permalink to this headline">¶</a></h2>
<p>Type-based dispatch is useful when it is necessary, but (fortunately) it
is not always necessary. Often you can avoid it by writing functions
that work correctly for arguments with different types.</p>
<p>Many of the functions we wrote for strings also work for other sequence
types. For example, in Section&nbsp;[histogram] we used histogram to count
the number of times each letter appears in a word.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">histogram</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>This function also works for lists, tuples, and even dictionaries, as
long as the elements of s are hashable, so they can be used as keys in
d.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;spam&#39;</span><span class="p">,</span> <span class="s">&#39;egg&#39;</span><span class="p">,</span> <span class="s">&#39;spam&#39;</span><span class="p">,</span> <span class="s">&#39;spam&#39;</span><span class="p">,</span> <span class="s">&#39;bacon&#39;</span><span class="p">,</span> <span class="s">&#39;spam&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">histogram</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">{&#39;bacon&#39;: 1, &#39;egg&#39;: 1, &#39;spam&#39;: 4}</span>
</pre></div>
</div>
<p>Functions that work with several types are called <strong>polymorphic</strong>.
Polymorphism can facilitate code reuse. For example, the built-in
function sum, which adds the elements of a sequence, works as long as
the elements of the sequence support addition.</p>
<p>Since Time objects provide an add method, they work with sum:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">43</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">41</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t3</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">37</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
<span class="go">23:01:00</span>
</pre></div>
</div>
<p>In general, if all of the operations inside a function work with a given
type, the function works with that type.</p>
<p>The best kind of polymorphism is the unintentional kind, where you
discover that a function you already wrote can be applied to a type you
never planned for.</p>
</div>
<div class="section" id="id50">
<h2>Debugging<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h2>
<p>It is legal to add attributes to objects at any point in the execution
of a program, but if you have objects with the same type that don’t have
the same attributes, it is easy to make mistakes. It is considered a
good idea to initialize all of an object’s attributes in the init
method.</p>
<p>If you are not sure whether an object has a particular attribute, you
can use the built-in function hasattr (see Section&nbsp;[hasattr]).</p>
<p>Another way to access attributes is the built-in function vars, which
takes an object and returns a dictionary that maps from attribute names
(as strings) to their values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">vars</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">{&#39;y&#39;: 4, &#39;x&#39;: 3}</span>
</pre></div>
</div>
<p>For purposes of debugging, you might find it useful to keep this
function handy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">print_attributes</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">print_attributes</span></code> traverses the dictionary and prints each attribute
name and its corresponding value.</p>
<p>The built-in function getattr takes an object and an attribute name (as
a string) and returns the attribute’s value.</p>
</div>
<div class="section" id="interface-and-implementation">
<h2>Interface and implementation<a class="headerlink" href="#interface-and-implementation" title="Permalink to this headline">¶</a></h2>
<p>One of the goals of object-oriented design is to make software more
maintainable, which means that you can keep the program working when
other parts of the system change, and modify the program to meet new
requirements.</p>
<p>A design principle that helps achieve that goal is to keep interfaces
separate from implementations. For objects, that means that the methods
a class provides should not depend on how the attributes are
represented.</p>
<p>For example, in this chapter we developed a class that represents a time
of day. Methods provided by this class include <code class="docutils literal"><span class="pre">time_to_int</span></code>,
<code class="docutils literal"><span class="pre">is_after</span></code>, and <code class="docutils literal"><span class="pre">add_time</span></code>.</p>
<p>We could implement those methods in several ways. The details of the
implementation depend on how we represent time. In this chapter, the
attributes of a Time object are hour, minute, and second.</p>
<p>As an alternative, we could replace these attributes with a single
integer representing the number of seconds since midnight. This
implementation would make some methods, like <code class="docutils literal"><span class="pre">is_after</span></code>, easier to
write, but it makes other methods harder.</p>
<p>After you deploy a new class, you might discover a better
implementation. If other parts of the program are using your class, it
might be time-consuming and error-prone to change the interface.</p>
<p>But if you designed the interface carefully, you can change the
implementation without changing the interface, which means that other
parts of the program don’t have to change.</p>
</div>
<div class="section" id="id51">
<h2>Glossary<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>object-oriented language:</dt>
<dd>A language that provides features, such as programmer-defined types
and methods, that facilitate object-oriented programming.</dd>
<dt>object-oriented programming:</dt>
<dd>A style of programming in which data and the operations that
manipulate it are organized into classes and methods.</dd>
<dt>method:</dt>
<dd>A function that is defined inside a class definition and is invoked
on instances of that class.</dd>
<dt>subject:</dt>
<dd>The object a method is invoked on.</dd>
<dt>positional argument:</dt>
<dd>An argument that does not include a parameter name, so it is not a
keyword argument.</dd>
<dt>operator overloading:</dt>
<dd>Changing the behavior of an operator like + so it works with a
programmer-defined type.</dd>
<dt>type-based dispatch:</dt>
<dd>A programming pattern that checks the type of an operand and invokes
different functions for different types.</dd>
<dt>polymorphic:</dt>
<dd>Pertaining to a function that can work with more than one type.</dd>
<dt>information hiding:</dt>
<dd>The principle that the interface provided by an object should not
depend on its implementation, in particular the representation of
its attributes.</dd>
</dl>
</div>
<div class="section" id="id52">
<h2>Exercises<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h2>
<p>Download the code from this chapter from
<a class="reference external" href="http://thinkpython2.com/code/Time2.py">http://thinkpython2.com/code/Time2.py</a>. Change the attributes of Time to
be a single integer representing seconds since midnight. Then modify the
methods (and the function <code class="docutils literal"><span class="pre">int_to_time</span></code>) to work with the new
implementation. You should not have to modify the test code in main.
When you are done, the output should be the same as before. Solution:
<a class="reference external" href="http://thinkpython2.com/code/Time2_soln.py">http://thinkpython2.com/code/Time2_soln.py</a>.</p>
<p>[kangaroo]</p>
<p>This exercise is a cautionary tale about one of the most common, and
difficult to find, errors in Python. Write a definition for a class
named Kangaroo with the following methods:</p>
<ol class="arabic simple">
<li>An <code class="docutils literal"><span class="pre">__init__</span></code> method that initializes an attribute named
<code class="docutils literal"><span class="pre">pouch_contents</span></code> to an empty list.</li>
<li>A method named <code class="docutils literal"><span class="pre">put_in_pouch</span></code> that takes an object of any type and
adds it to <code class="docutils literal"><span class="pre">pouch_contents</span></code>.</li>
<li>A <code class="docutils literal"><span class="pre">__str__</span></code> method that returns a string representation of the
Kangaroo object and the contents of the pouch.</li>
</ol>
<p>Test your code by creating two Kangaroo objects, assigning them to
variables named kanga and roo, and then adding roo to the contents of
kanga’s pouch.</p>
<p>Download <a class="reference external" href="http://thinkpython2.com/code/BadKangaroo.py">http://thinkpython2.com/code/BadKangaroo.py</a>. It contains a
solution to the previous problem with one big, nasty bug. Find and fix
the bug.</p>
<p>If you get stuck, you can download
<a class="reference external" href="http://thinkpython2.com/code/GoodKangaroo.py">http://thinkpython2.com/code/GoodKangaroo.py</a>, which explains the problem
and demonstrates a solution.</p>
</div>
</div>
<div class="section" id="inheritance">
<h1>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h1>
<p>The language feature most often associated with object-oriented
programming is <strong>inheritance</strong>. Inheritance is the ability to define a
new class that is a modified version of an existing class. In this
chapter I demonstrate inheritance using classes that represent playing
cards, decks of cards, and poker hands.</p>
<p>If you don’t play poker, you can read about it at
<a class="reference external" href="http://en.wikipedia.org/wiki/Poker">http://en.wikipedia.org/wiki/Poker</a>, but you don’t have to; I’ll tell you
what you need to know for the exercises.</p>
<p>Code examples from this chapter are available from
<a class="reference external" href="http://thinkpython2.com/code/Card.py">http://thinkpython2.com/code/Card.py</a>.</p>
<div class="section" id="card-objects">
<h2>Card objects<a class="headerlink" href="#card-objects" title="Permalink to this headline">¶</a></h2>
<p>There are fifty-two cards in a deck, each of which belongs to one of
four suits and one of thirteen ranks. The suits are Spades, Hearts,
Diamonds, and Clubs (in descending order in bridge). The ranks are Ace,
2, 3, 4, 5, 6, 7, 8, 9, 10, Jack, Queen, and King. Depending on the game
that you are playing, an Ace may be higher than King or lower than 2.</p>
<p>If we want to define a new object to represent a playing card, it is
obvious what the attributes should be: rank and suit. It is not as
obvious what type the attributes should be. One possibility is to use
strings containing words like <code class="docutils literal"><span class="pre">'Spade'</span></code> for suits and <code class="docutils literal"><span class="pre">'Queen'</span></code> for
ranks. One problem with this implementation is that it would not be easy
to compare cards to see which had a higher rank or suit.</p>
<p>An alternative is to use integers to <strong>encode</strong> the ranks and suits. In
this context, “encode” means that we are going to define a mapping
between numbers and suits, or between numbers and ranks. This kind of
encoding is not meant to be a secret (that would be “encryption”).</p>
<p>For example, this table shows the suits and the corresponding integer
codes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="53%" />
<col width="14%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Spades</td>
<td><span class="math">\mapsto</span></td>
<td>3</td>
</tr>
<tr class="row-even"><td>Hearts</td>
<td><span class="math">\mapsto</span></td>
<td>2</td>
</tr>
<tr class="row-odd"><td>Diamonds</td>
<td><span class="math">\mapsto</span></td>
<td>1</td>
</tr>
<tr class="row-even"><td>Clubs</td>
<td><span class="math">\mapsto</span></td>
<td>0</td>
</tr>
</tbody>
</table>
<p>This code makes it easy to compare cards; because higher suits map to
higher numbers, we can compare suits by comparing their codes.</p>
<p>The mapping for ranks is fairly obvious; each of the numerical ranks
maps to the corresponding integer, and for face cards:</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="56%" />
<col width="18%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Jack</td>
<td><span class="math">\mapsto</span></td>
<td>11</td>
</tr>
<tr class="row-even"><td>Queen</td>
<td><span class="math">\mapsto</span></td>
<td>12</td>
</tr>
<tr class="row-odd"><td>King</td>
<td><span class="math">\mapsto</span></td>
<td>13</td>
</tr>
</tbody>
</table>
<p>I am using the <span class="math">\mapsto</span>&nbsp;symbol to make it clear that these
mappings are not part of the Python program. They are part of the
program design, but they don’t appear explicitly in the code.</p>
<p>The class definition for Card looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Card</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Represents a standard playing card.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suit</span> <span class="o">=</span> <span class="n">suit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">rank</span>
</pre></div>
</div>
<p>As usual, the init method takes an optional parameter for each
attribute. The default card is the 2 of Clubs.</p>
<p>To create a Card, you call Card with the suit and rank of the card you
want.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">queen_of_diamonds</span> <span class="o">=</span> <span class="n">Card</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="class-attributes">
<h2>Class attributes<a class="headerlink" href="#class-attributes" title="Permalink to this headline">¶</a></h2>
<p>In order to print Card objects in a way that people can easily read, we
need a mapping from the integer codes to the corresponding ranks and
suits. A natural way to do that is with lists of strings. We assign
these lists to <strong>class attributes</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Card:

    suit_names = [&#39;Clubs&#39;, &#39;Diamonds&#39;, &#39;Hearts&#39;, &#39;Spades&#39;]
    rank_names = [None, &#39;Ace&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;,
              &#39;8&#39;, &#39;9&#39;, &#39;10&#39;, &#39;Jack&#39;, &#39;Queen&#39;, &#39;King&#39;]

    def __str__(self):
        return &#39;%s of %s&#39; % (Card.rank_names[self.rank],
                             Card.suit_names[self.suit])
</pre></div>
</div>
<p>Variables like <code class="docutils literal"><span class="pre">suit_names</span></code> and <code class="docutils literal"><span class="pre">rank_names</span></code>, which are defined
inside a class but outside of any method, are called class attributes
because they are associated with the class object Card.</p>
<p>This term distinguishes them from variables like suit and rank, which
are called <strong>instance attributes</strong> because they are associated with a
particular instance.</p>
<p>Both kinds of attribute are accessed using dot notation. For example, in
<code class="docutils literal"><span class="pre">__str__</span></code>, self is a Card object, and self.rank is its rank.
Similarly, Card is a class object, and <code class="docutils literal"><span class="pre">Card.rank_names</span></code> is a list of
strings associated with the class.</p>
<p>Every card has its own suit and rank, but there is only one copy of
<code class="docutils literal"><span class="pre">suit_names</span></code> and <code class="docutils literal"><span class="pre">rank_names</span></code>.</p>
<p>Putting it all together, the expression <code class="docutils literal"><span class="pre">Card.rank_names[self.rank]</span></code>
means “use the attribute rank from the object self as an index into the
list <code class="docutils literal"><span class="pre">rank_names</span></code> from the class Card, and select the appropriate
string.”</p>
<p>The first element of <code class="docutils literal"><span class="pre">rank_names</span></code> is None because there is no card
with rank zero. By including None as a place-keeper, we get a mapping
with the nice property that the index 2 maps to the string <code class="docutils literal"><span class="pre">'2'</span></code>, and
so on. To avoid this tweak, we could have used a dictionary instead of a
list.</p>
<p>With the methods we have so far, we can create and print cards:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">card1</span> <span class="o">=</span> <span class="n">Card</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">card1</span><span class="p">)</span>
<span class="go">Jack of Hearts</span>
</pre></div>
</div>
<div class="figure" id="id89">
<img alt="Object diagram." src="_images/card1.pdf" />
<p class="caption"><span class="caption-text">Object diagram.</span></p>
</div>
<p>Figure&nbsp;[fig.card1] is a diagram of the Card class object and one Card
instance. Card is a class object; its type is type. card1 is an instance
of Card, so its type is Card. To save space, I didn’t draw the contents
of <code class="docutils literal"><span class="pre">suit_names</span></code> and <code class="docutils literal"><span class="pre">rank_names</span></code>.</p>
</div>
<div class="section" id="comparing-cards">
<h2>Comparing cards<a class="headerlink" href="#comparing-cards" title="Permalink to this headline">¶</a></h2>
<p>For built-in types, there are relational operators (&lt;, &gt;, ==, etc.) that
compare values and determine when one is greater than, less than, or
equal to another. For programmer-defined types, we can override the
behavior of the built-in operators by providing a method named
<code class="docutils literal"><span class="pre">__lt__</span></code>, which stands for “less than”.</p>
<p><code class="docutils literal"><span class="pre">__lt__</span></code> takes two parameters, self and other, and True if self is
strictly less than other.</p>
<p>The correct ordering for cards is not obvious. For example, which is
better, the 3 of Clubs or the 2 of Diamonds? One has a higher rank, but
the other has a higher suit. In order to compare cards, you have to
decide whether rank or suit is more important.</p>
<p>The answer might depend on what game you are playing, but to keep things
simple, we’ll make the arbitrary choice that suit is more important, so
all of the Spades outrank all of the Diamonds, and so on.</p>
<p>With that decided, we can write <code class="docutils literal"><span class="pre">__lt__</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Card:

    def __lt__(self, other):
        # check the suits
        if self.suit &lt; other.suit: return True
        if self.suit &gt; other.suit: return False

        # suits are the same... check ranks
        return self.rank &lt; other.rank
</pre></div>
</div>
<p>You can write this more concisely using tuple comparison:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Card:

    def __lt__(self, other):
        t1 = self.suit, self.rank
        t2 = other.suit, other.rank
        return t1 &lt; t2
</pre></div>
</div>
<p>As an exercise, write an <code class="docutils literal"><span class="pre">__lt__</span></code> method for Time objects. You can use
tuple comparison, but you also might consider comparing integers.</p>
</div>
<div class="section" id="decks">
<h2>Decks<a class="headerlink" href="#decks" title="Permalink to this headline">¶</a></h2>
<p>Now that we have Cards, the next step is to define Decks. Since a deck
is made up of cards, it is natural for each Deck to contain a list of
cards as an attribute.</p>
<p>The following is a class definition for Deck. The init method creates
the attribute cards and generates the standard set of fifty-two cards:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Deck</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">suit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">):</span>
                <span class="n">card</span> <span class="o">=</span> <span class="n">Card</span><span class="p">(</span><span class="n">suit</span><span class="p">,</span> <span class="n">rank</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
</pre></div>
</div>
<p>The easiest way to populate the deck is with a nested loop. The outer
loop enumerates the suits from 0 to 3. The inner loop enumerates the
ranks from 1 to 13. Each iteration creates a new Card with the current
suit and rank, and appends it to self.cards.</p>
</div>
<div class="section" id="printing-the-deck">
<h2>Printing the deck<a class="headerlink" href="#printing-the-deck" title="Permalink to this headline">¶</a></h2>
<p>Here is a <code class="docutils literal"><span class="pre">__str__</span></code> method for Deck:</p>
<div class="highlight-python"><div class="highlight"><pre>#inside class Deck:

    def __str__(self):
        res = []
        for card in self.cards:
            res.append(str(card))
        return &#39;\n&#39;.join(res)
</pre></div>
</div>
<p>This method demonstrates an efficient way to accumulate a large string:
building a list of strings and then using the string method join. The
built-in function str invokes the <code class="docutils literal"><span class="pre">__str__</span></code> method on each card and
returns the string representation.</p>
<p>Since we invoke join on a newline character, the cards are separated by
newlines. Here’s what the result looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">deck</span> <span class="o">=</span> <span class="n">Deck</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">deck</span><span class="p">)</span>
<span class="go">Ace of Clubs</span>
<span class="go">2 of Clubs</span>
<span class="go">3 of Clubs</span>
<span class="gp">...</span>
<span class="go">10 of Spades</span>
<span class="go">Jack of Spades</span>
<span class="go">Queen of Spades</span>
<span class="go">King of Spades</span>
</pre></div>
</div>
<p>Even though the result appears on 52 lines, it is one long string that
contains newlines.</p>
</div>
<div class="section" id="add-remove-shuffle-and-sort">
<h2>Add, remove, shuffle and sort<a class="headerlink" href="#add-remove-shuffle-and-sort" title="Permalink to this headline">¶</a></h2>
<p>To deal cards, we would like a method that removes a card from the deck
and returns it. The list method pop provides a convenient way to do
that:</p>
<div class="highlight-python"><div class="highlight"><pre>#inside class Deck:

    def pop_card(self):
        return self.cards.pop()
</pre></div>
</div>
<p>Since pop removes the <em>last</em> card in the list, we are dealing from the
bottom of the deck.</p>
<p>To add a card, we can use the list method append:</p>
<div class="highlight-python"><div class="highlight"><pre>#inside class Deck:

    def add_card(self, card):
        self.cards.append(card)
</pre></div>
</div>
<p>A method like this that uses another method without doing much work is
sometimes called a <strong>veneer</strong>. The metaphor comes from woodworking,
where a veneer is a thin layer of good quality wood glued to the surface
of a cheaper piece of wood to improve the appearance.</p>
<p>In this case <code class="docutils literal"><span class="pre">add_card</span></code> is a “thin” method that expresses a list
operation in terms appropriate for decks. It improves the appearance, or
interface, of the implementation.</p>
<p>As another example, we can write a Deck method named shuffle using the
function shuffle from the random module:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Deck:

    def shuffle(self):
        random.shuffle(self.cards)
</pre></div>
</div>
<p>Don’t forget to import random.</p>
<p>As an exercise, write a Deck method named sort that uses the list method
sort to sort the cards in a Deck. sort uses the <code class="docutils literal"><span class="pre">__lt__</span></code> method we
defined to determine the order.</p>
</div>
<div class="section" id="id53">
<h2>Inheritance<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h2>
<p>Inheritance is the ability to define a new class that is a modified
version of an existing class. As an example, let’s say we want a class
to represent a “hand”, that is, the cards held by one player. A hand is
similar to a deck: both are made up of a collection of cards, and both
require operations like adding and removing cards.</p>
<p>A hand is also different from a deck; there are operations we want for
hands that don’t make sense for a deck. For example, in poker we might
compare two hands to see which one wins. In bridge, we might compute a
score for a hand in order to make a bid.</p>
<p>This relationship between classes—similar, but different—lends itself to
inheritance. To define a new class that inherits from an existing class,
you put the name of the existing class in parentheses:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Hand</span><span class="p">(</span><span class="n">Deck</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a hand of playing cards.&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This definition indicates that Hand inherits from Deck; that means we
can use methods like <code class="docutils literal"><span class="pre">pop_card</span></code> and <code class="docutils literal"><span class="pre">add_card</span></code> for Hands as well as
Decks.</p>
<p>When a new class inherits from an existing one, the existing one is
called the <strong>parent</strong> and the new class is called the <strong>child</strong>.</p>
<p>In this example, Hand inherits <code class="docutils literal"><span class="pre">__init__</span></code> from Deck, but it doesn’t
really do what we want: instead of populating the hand with 52 new
cards, the init method for Hands should initialize cards with an empty
list.</p>
<p>If we provide an init method in the Hand class, it overrides the one in
the Deck class:</p>
<div class="highlight-python"><div class="highlight"><pre># inside class Hand:

    def __init__(self, label=&#39;&#39;):
        self.cards = []
        self.label = label
</pre></div>
</div>
<p>When you create a Hand, Python invokes this init method, not the one in
Deck.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">hand</span> <span class="o">=</span> <span class="n">Hand</span><span class="p">(</span><span class="s">&#39;new hand&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hand</span><span class="o">.</span><span class="n">cards</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hand</span><span class="o">.</span><span class="n">label</span>
<span class="go">&#39;new hand&#39;</span>
</pre></div>
</div>
<p>The other methods are inherited from Deck, so we can use <code class="docutils literal"><span class="pre">pop_card</span></code>
and <code class="docutils literal"><span class="pre">add_card</span></code> to deal a card:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">deck</span> <span class="o">=</span> <span class="n">Deck</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">card</span> <span class="o">=</span> <span class="n">deck</span><span class="o">.</span><span class="n">pop_card</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hand</span><span class="o">.</span><span class="n">add_card</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">hand</span><span class="p">)</span>
<span class="go">King of Spades</span>
</pre></div>
</div>
<p>A natural next step is to encapsulate this code in a method called
<code class="docutils literal"><span class="pre">move_cards</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>#inside class Deck:

    def move_cards(self, hand, num):
        for i in range(num):
            hand.add_card(self.pop_card())
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">move_cards</span></code> takes two arguments, a Hand object and the number of
cards to deal. It modifies both self and hand, and returns None.</p>
<p>In some games, cards are moved from one hand to another, or from a hand
back to the deck. You can use <code class="docutils literal"><span class="pre">move_cards</span></code> for any of these
operations: self can be either a Deck or a Hand, and hand, despite the
name, can also be a Deck.</p>
<p>Inheritance is a useful feature. Some programs that would be repetitive
without inheritance can be written more elegantly with it. Inheritance
can facilitate code reuse, since you can customize the behavior of
parent classes without having to modify them. In some cases, the
inheritance structure reflects the natural structure of the problem,
which makes the design easier to understand.</p>
<p>On the other hand, inheritance can make programs difficult to read. When
a method is invoked, it is sometimes not clear where to find its
definition. The relevant code may be spread across several modules.
Also, many of the things that can be done using inheritance can be done
as well or better without it.</p>
</div>
<div class="section" id="class-diagrams">
<h2>Class diagrams<a class="headerlink" href="#class-diagrams" title="Permalink to this headline">¶</a></h2>
<p>So far we have seen stack diagrams, which show the state of a program,
and object diagrams, which show the attributes of an object and their
values. These diagrams represent a snapshot in the execution of a
program, so they change as the program runs.</p>
<p>They are also highly detailed; for some purposes, too detailed. A class
diagram is a more abstract representation of the structure of a program.
Instead of showing individual objects, it shows classes and the
relationships between them.</p>
<p>There are several kinds of relationship between classes:</p>
<ul class="simple">
<li>Objects in one class might contain references to objects in another
class. For example, each Rectangle contains a reference to a Point,
and each Deck contains references to many Cards. This kind of
relationship is called <strong>HAS-A</strong>, as in, “a Rectangle has a Point.”</li>
<li>One class might inherit from another. This relationship is called
<strong>IS-A</strong>, as in, “a Hand is a kind of a Deck.”</li>
<li>One class might depend on another in the sense that objects in one
class take objects in the second class as parameters, or use objects
in the second class as part of a computation. This kind of
relationship is called a <strong>dependency</strong>.</li>
</ul>
<p>A <strong>class diagram</strong> is a graphical representation of these
relationships. For example, Figure&nbsp;[fig.class1] shows the relationships
between Card, Deck and Hand.</p>
<div class="figure" id="id90">
<img alt="Class diagram." src="_images/class1.pdf" />
<p class="caption"><span class="caption-text">Class diagram.</span></p>
</div>
<p>The arrow with a hollow triangle head represents an IS-A relationship;
in this case it indicates that Hand inherits from Deck.</p>
<p>The standard arrow head represents a HAS-A relationship; in this case a
Deck has references to Card objects.</p>
<p>The star () near the arrow head is a <strong>multiplicity</strong>; it indicates how
many Cards a Deck has. A multiplicity can be a simple number, like 52, a
range, like 5..7 or a star, which indicates that a Deck can have any
number of Cards.</p>
<p>There are no dependencies in this diagram. They would normally be shown
with a dashed arrow. Or if there are a lot of dependencies, they are
sometimes omitted.</p>
<p>A more detailed diagram might show that a Deck actually contains a
<em>list</em> of Cards, but built-in types like list and dict are usually not
included in class diagrams.</p>
</div>
<div class="section" id="id54">
<h2>Debugging<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h2>
<p>Inheritance can make debugging difficult because when you invoke a
method on an object, it might be hard to figure out which method will be
invoked.</p>
<p>Suppose you are writing a function that works with Hand objects. You
would like it to work with all kinds of Hands, like PokerHands,
BridgeHands, etc. If you invoke a method like shuffle, you might get the
one defined in Deck, but if any of the subclasses override this method,
you’ll get that version instead. This behavior is usually a good thing,
but it can be confusing.</p>
<p>Any time you are unsure about the flow of execution through your
program, the simplest solution is to add print statements at the
beginning of the relevant methods. If Deck.shuffle prints a message that
says something like Running Deck.shuffle, then as the program runs it
traces the flow of execution.</p>
<p>As an alternative, you could use this function, which takes an object
and a method name (as a string) and returns the class that provides the
definition of the method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">find_defining_class</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">meth_name</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ty</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">mro</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">meth_name</span> <span class="ow">in</span> <span class="n">ty</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ty</span>
</pre></div>
</div>
<p>Here’s an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">hand</span> <span class="o">=</span> <span class="n">Hand</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">find_defining_class</span><span class="p">(</span><span class="n">hand</span><span class="p">,</span> <span class="s">&#39;shuffle&#39;</span><span class="p">)</span>
<span class="go">&lt;class &#39;Card.Deck&#39;&gt;</span>
</pre></div>
</div>
<p>So the shuffle method for this Hand is the one in Deck.</p>
<p><code class="docutils literal"><span class="pre">find_defining_class</span></code> uses the mro method to get the list of class
objects (types) that will be searched for methods. “MRO” stands for
“method resolution order”, which is the sequence of classes Python
searches to “resolve” a method name.</p>
<p>Here’s a design suggestion: when you override a method, the interface of
the new method should be the same as the old. It should take the same
parameters, return the same type, and obey the same preconditions and
postconditions. If you follow this rule, you will find that any function
designed to work with an instance of a parent class, like a Deck, will
also work with instances of child classes like a Hand and PokerHand.</p>
<p>If you violate this rule, which is called the “Liskov substitution
principle”, your code will collapse like (sorry) a house of cards.</p>
</div>
<div class="section" id="data-encapsulation">
<h2>Data encapsulation<a class="headerlink" href="#data-encapsulation" title="Permalink to this headline">¶</a></h2>
<p>The previous chapters demonstrate a development plan we might call
“object-oriented design”. We identified objects we needed—like Point,
Rectangle and Time—and defined classes to represent them. In each case
there is an obvious correspondence between the object and some entity in
the real world (or at least a mathematical world).</p>
<p>But sometimes it is less obvious what objects you need and how they
should interact. In that case you need a different development plan. In
the same way that we discovered function interfaces by encapsulation and
generalization, we can discover class interfaces by <strong>data
encapsulation</strong>.</p>
<p>Markov analysis, from Section&nbsp;[markov], provides a good example. If you
download my code from <a class="reference external" href="http://thinkpython2.com/code/markov.py">http://thinkpython2.com/code/markov.py</a>, you’ll see
that it uses two global variables—<code class="docutils literal"><span class="pre">suffix_map</span></code> and <code class="docutils literal"><span class="pre">prefix</span></code>—that
are read and written from several functions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">suffix_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="p">()</span>
</pre></div>
</div>
<p>Because these variables are global, we can only run one analysis at a
time. If we read two texts, their prefixes and suffixes would be added
to the same data structures (which makes for some interesting generated
text).</p>
<p>To run multiple analyses, and keep them separate, we can encapsulate the
state of each analysis in an object. Here’s what that looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Markov</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="p">()</span>
</pre></div>
</div>
<p>Next, we transform the functions into methods. For example, here’s
<code class="docutils literal"><span class="pre">process_word</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">process_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">order</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+=</span> <span class="p">(</span><span class="n">word</span><span class="p">,)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c"># if there is no entry for this prefix, make one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
</pre></div>
</div>
<p>Transforming a program like this—changing the design without changing
the behavior—is another example of refactoring (see
Section&nbsp;[refactoring]).</p>
<p>This example suggests a development plan for designing objects and
methods:</p>
<ol class="arabic simple">
<li>Start by writing functions that read and write global variables (when
necessary).</li>
<li>Once you get the program working, look for associations between
global variables and the functions that use them.</li>
<li>Encapsulate related variables as attributes of an object.</li>
<li>Transform the associated functions into methods of the new class.</li>
</ol>
<p>As an exercise, download my Markov code from
<a class="reference external" href="http://thinkpython2.com/code/markov.py">http://thinkpython2.com/code/markov.py</a>, and follow the steps described
above to encapsulate the global variables as attributes of a new class
called Markov. Solution: <a class="reference external" href="http://thinkpython2.com/code/Markov.py">http://thinkpython2.com/code/Markov.py</a> (note
the capital M).</p>
</div>
<div class="section" id="id55">
<h2>Glossary<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>encode:</dt>
<dd>To represent one set of values using another set of values by
constructing a mapping between them.</dd>
<dt>class attribute:</dt>
<dd>An attribute associated with a class object. Class attributes are
defined inside a class definition but outside any method.</dd>
<dt>instance attribute:</dt>
<dd>An attribute associated with an instance of a class.</dd>
<dt>veneer:</dt>
<dd>A method or function that provides a different interface to another
function without doing much computation.</dd>
<dt>inheritance:</dt>
<dd>The ability to define a new class that is a modified version of a
previously defined class.</dd>
<dt>parent class:</dt>
<dd>The class from which a child class inherits.</dd>
<dt>child class:</dt>
<dd>A new class created by inheriting from an existing class; also
called a “subclass”.</dd>
<dt>IS-A relationship:</dt>
<dd>A relationship between a child class and its parent class.</dd>
<dt>HAS-A relationship:</dt>
<dd>A relationship between two classes where instances of one class
contain references to instances of the other.</dd>
<dt>dependency:</dt>
<dd>A relationship between two classes where instances of one class use
instances of the other class, but do not store them as attributes.</dd>
<dt>class diagram:</dt>
<dd>A diagram that shows the classes in a program and the relationships
between them.</dd>
<dt>multiplicity:</dt>
<dd>A notation in a class diagram that shows, for a HAS-A relationship,
how many references there are to instances of another class.</dd>
<dt>data encapsulation:</dt>
<dd>A program development plan that involves a prototype using global
variables and a final version that makes the global variables into
instance attributes.</dd>
</dl>
</div>
<div class="section" id="id56">
<h2>Exercises<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h2>
<p>For the following program, draw a UML class diagram that shows these
classes and the relationships among them.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PingPongParent</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Ping</span><span class="p">(</span><span class="n">PingPongParent</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pong</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pong</span> <span class="o">=</span> <span class="n">pong</span>


<span class="k">class</span> <span class="nc">Pong</span><span class="p">(</span><span class="n">PingPongParent</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pings</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pings</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pings</span> <span class="o">=</span> <span class="n">pings</span>

    <span class="k">def</span> <span class="nf">add_ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ping</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ping</span><span class="p">)</span>

<span class="n">pong</span> <span class="o">=</span> <span class="n">Pong</span><span class="p">()</span>
<span class="n">ping</span> <span class="o">=</span> <span class="n">Ping</span><span class="p">(</span><span class="n">pong</span><span class="p">)</span>
<span class="n">pong</span><span class="o">.</span><span class="n">add_ping</span><span class="p">(</span><span class="n">ping</span><span class="p">)</span>
</pre></div>
</div>
<p>Write a Deck method called <code class="docutils literal"><span class="pre">deal_hands</span></code> that takes two parameters, the
number of hands and the number of cards per hand. It should create the
appropriate number of Hand objects, deal the appropriate number of cards
per hand, and return a list of Hands.</p>
<p>[poker]</p>
<p>The following are the possible hands in poker, in increasing order of
value and decreasing order of probability:</p>
<dl class="docutils">
<dt>pair:</dt>
<dd>two cards with the same rank</dd>
<dt>two pair:</dt>
<dd>two pairs of cards with the same rank</dd>
<dt>three of a kind:</dt>
<dd>three cards with the same rank</dd>
<dt>straight:</dt>
<dd>five cards with ranks in sequence (aces can be high or low, so
Ace-2-3-4-5 is a straight and so is 10-Jack-Queen-King-Ace, but
Queen-King-Ace-2-3 is not.)</dd>
<dt>flush:</dt>
<dd>five cards with the same suit</dd>
<dt>full house:</dt>
<dd>three cards with one rank, two cards with another</dd>
<dt>four of a kind:</dt>
<dd>four cards with the same rank</dd>
<dt>straight flush:</dt>
<dd>five cards in sequence (as defined above) and with the same suit</dd>
</dl>
<p>The goal of these exercises is to estimate the probability of drawing
these various hands.</p>
<ol class="arabic">
<li><p class="first">Download the following files from <a class="reference external" href="http://thinkpython2.com/code">http://thinkpython2.com/code</a>:</p>
<dl class="docutils">
<dt>Card.py</dt>
<dd><p class="first last">: A complete version of the Card, Deck and Hand classes in this
chapter.</p>
</dd>
<dt>PokerHand.py</dt>
<dd><p class="first last">: An incomplete implementation of a class that represents a poker
hand, and some code that tests it.</p>
</dd>
</dl>
</li>
<li><p class="first">If you run PokerHand.py, it deals seven 7-card poker hands and checks
to see if any of them contains a flush. Read this code carefully
before you go on.</p>
</li>
<li><p class="first">Add methods to PokerHand.py named <code class="docutils literal"><span class="pre">has_pair</span></code>, <code class="docutils literal"><span class="pre">has_twopair</span></code>, etc.
that return True or False according to whether or not the hand meets
the relevant criteria. Your code should work correctly for “hands”
that contain any number of cards (although 5 and 7 are the most
common sizes).</p>
</li>
<li><p class="first">Write a method named classify that figures out the highest-value
classification for a hand and sets the label attribute accordingly.
For example, a 7-card hand might contain a flush and a pair; it
should be labeled “flush”.</p>
</li>
<li><p class="first">When you are convinced that your classification methods are working,
the next step is to estimate the probabilities of the various hands.
Write a function in PokerHand.py that shuffles a deck of cards,
divides it into hands, classifies the hands, and counts the number of
times various classifications appear.</p>
</li>
<li><p class="first">Print a table of the classifications and their probabilities. Run
your program with larger and larger numbers of hands until the output
values converge to a reasonable degree of accuracy. Compare your
results to the values at <a class="reference external" href="http://en.wikipedia.org/wiki/Hand_rankings">http://en.wikipedia.org/wiki/Hand_rankings</a>.</p>
</li>
</ol>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/PokerHandSoln.py">http://thinkpython2.com/code/PokerHandSoln.py</a>.</p>
</div>
</div>
<div class="section" id="the-goodies">
<h1>The Goodies<a class="headerlink" href="#the-goodies" title="Permalink to this headline">¶</a></h1>
<p>One of my goals for this book has been to teach you as little Python as
possible. When there were two ways to do something, I picked one and
avoided mentioning the other. Or sometimes I put the second one into an
exercise.</p>
<p>Now I want to go back for some of the good bits that got left behind.
Python provides a number of features that are not really necessary—you
can write good code without them—but with them you can sometimes write
code that’s more concise, readable or efficient, and sometimes all
three.</p>
<div class="section" id="conditional-expressions">
<h2>Conditional expressions<a class="headerlink" href="#conditional-expressions" title="Permalink to this headline">¶</a></h2>
<p>We saw conditional statements in Section&nbsp;[conditional.execution].
Conditional statements are often used to choose one of two values; for
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This statement checks whether x is positive. If so, it computes
math.log. If not, math.log would raise a ValueError. To avoid stopping
the program, we generate a “NaN”, which is a special floating-point
value that represents “Not a Number”.</p>
<p>We can write this statement more concisely using a <strong>conditional
expression</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">y</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can almost read this line like English: “y gets log-x if x is
greater than 0; otherwise it gets NaN”.</p>
<p>Recursive functions can sometimes be rewritten using conditional
expressions. For example, here is a recursive version of factorial:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>We can rewrite it like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Another use of conditional expressions is handling optional arguments.
For example, here is the init method from GoodKangaroo (see
Exercise&nbsp;[kangaroo]):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">contents</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">if</span> <span class="n">contents</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pouch_contents</span> <span class="o">=</span> <span class="n">contents</span>
</pre></div>
</div>
<p>We can rewrite this one like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">contents</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pouch_contents</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">contents</span> <span class="o">==</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">contents</span>
</pre></div>
</div>
<p>In general, you can replace a conditional statement with a conditional
expression if both branches contain simple expressions that are either
returned or assigned to the same variable.</p>
</div>
<div class="section" id="list-comprehensions">
<h2>List comprehensions<a class="headerlink" href="#list-comprehensions" title="Permalink to this headline">¶</a></h2>
<p>In Section&nbsp;[filter] we saw the map and filter patterns. For example,
this function takes a list of strings, maps the string method capitalize
to the elements, and returns a new list of strings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">capitalize_all</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p>We can write this more concisely using a <strong>list comprehension</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">capitalize_all</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]</span>
</pre></div>
</div>
<p>The bracket operators indicate that we are constructing a new list. The
expression inside the brackets specifies the elements of the list, and
the for clause indicates what sequence we are traversing.</p>
<p>The syntax of a list comprehension is a little awkward because the loop
variable, s in this example, appears in the expression before we get to
the definition.</p>
<p>List comprehensions can also be used for filtering. For example, this
function selects only the elements of t that are upper case, and returns
a new list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">only_upper</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p>We can rewrite it using a list comprehension</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">only_upper</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">t</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">isupper</span><span class="p">()]</span>
</pre></div>
</div>
<p>List comprehensions are concise and easy to read, at least for simple
expressions. And they are usually faster than the equivalent for loops,
sometimes much faster. So if you are mad at me for not mentioning them
earlier, I understand.</p>
<p>But, in my defense, list comprehensions are harder to debug because you
can’t put a print statement inside the loop. I suggest that you use them
only if the computation is simple enough that you are likely to get it
right the first time. And for beginners that means never.</p>
</div>
<div class="section" id="generator-expressions">
<h2>Generator expressions<a class="headerlink" href="#generator-expressions" title="Permalink to this headline">¶</a></h2>
<p><strong>Generator expressions</strong> are similar to list comprehensions, but with
parentheses instead of square brackets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span>
<span class="go">&lt;generator object &lt;genexpr&gt; at 0x7f4c45a786c0&gt;</span>
</pre></div>
</div>
<p>The result is a generator object that knows how to iterate through a
sequence of values. But unlike a list comprehension, it does not compute
the values all at once; it waits to be asked. The built-in function next
gets the next value from the generator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
<p>When you get to the end of the sequence, next raises a StopIteration
exception. You can also use a for loop to iterate through the values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<span class="go">4</span>
<span class="go">9</span>
<span class="go">16</span>
</pre></div>
</div>
<p>The generator object keeps track of where it is in the sequence, so the
for loop picks up where next left off. Once the generator is exhausted,
it continues to raise StopException:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">StopIteration</span>
</pre></div>
</div>
<p>Generator expressions are often used with functions like sum, max, and
min:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="go">30</span>
</pre></div>
</div>
</div>
<div class="section" id="any-and-all">
<h2>any and all<a class="headerlink" href="#any-and-all" title="Permalink to this headline">¶</a></h2>
<p>Python provides a built-in function, any, that takes a sequence of
boolean values and returns True if any of the values are True. It works
on lists:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">any</span><span class="p">([</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
<p>But it is often used with generator expressions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">any</span><span class="p">(</span><span class="n">letter</span> <span class="o">==</span> <span class="s">&#39;t&#39;</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="s">&#39;monty&#39;</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>That example isn’t very useful because it does the same thing as the in
operator. But we could use any to rewrite some of the search functions
we wrote in Section&nbsp;[search]. For example, we could write avoids like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">avoids</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">forbidden</span><span class="p">):</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">letter</span> <span class="ow">in</span> <span class="n">forbidden</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word</span><span class="p">)</span>
</pre></div>
</div>
<p>The function almost reads like English, “word avoids forbidden if there
are not any forbidden letters in word.”</p>
<p>Using any with a generator expression is efficient because it stops
immediately if it finds a True value, so it doesn’t have to evaluate the
whole sequence.</p>
<p>Python provides another built-in function, all, that returns True if
every element of the sequence is True. As an exercise, use all to
re-write <code class="docutils literal"><span class="pre">uses_all</span></code> from Section&nbsp;[search].</p>
</div>
<div class="section" id="sets">
<h2>Sets<a class="headerlink" href="#sets" title="Permalink to this headline">¶</a></h2>
<p>In Section&nbsp;[dictsub] I use dictionaries to find the words that appear in
a document but not in a word list. The function I wrote takes d1, which
contains the words from the document as keys, and d2, which contains the
list of words. It returns a dictionary that contains the keys from d1
that are not in d2.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">subtract</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d2</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p>In all of these dictionaries, the values are None because we never use
them. As a result, we waste some storage space.</p>
<p>Python provides another built-in type, called a set, that behaves like a
collection of dictionary keys with no values. Adding elements to a set
is fast; so is checking membership. And sets provide methods and
operators to compute common set operations.</p>
<p>For example, set subtraction is available as a method called difference
or as an operator, -. So we can rewrite subtract like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">subtract</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is a set instead of a dictionary, but for operations like
iteration, the behavior is the same.</p>
<p>Some of the exercises in this book can be done concisely and efficiently
with sets. For example, here is a solution to <code class="docutils literal"><span class="pre">has_duplicates</span></code>, from
Exercise&nbsp;[duplicate], that uses a dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">has_duplicates</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">d</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
<p>When an element appears for the first time, it is added to the
dictionary. If the same element appears again, the function returns
True.</p>
<p>Using sets, we can write the same function like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">has_duplicates</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>An element can only appear in a set once, so if an element in t appears
more than once, the set will be smaller than t. If there are no
duplicates, the set will be the same size as t.</p>
<p>We can also use sets to do some of the exercises in Chapter&nbsp;[wordplay].
For example, here’s a version of <code class="docutils literal"><span class="pre">uses_only</span></code> with a loop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">uses_only</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">letter</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">uses_only</span></code> checks whether all letters in word are in available. We
can rewrite it like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">uses_only</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">&lt;=</span></code> operator checks whether one set is a subset or another,
including the possibility that they are equal, which is true if all the
letters in word appear in available.</p>
<p>As an exercise, rewrite <code class="docutils literal"><span class="pre">avoids</span></code> using sets.</p>
</div>
<div class="section" id="counters">
<h2>Counters<a class="headerlink" href="#counters" title="Permalink to this headline">¶</a></h2>
<p>A Counter is like a set, except that if an element appears more than
once, the Counter keeps track of how many times it appears. If you are
familiar with the mathematical idea of a <strong>multiset</strong>, a Counter is a
natural way to represent a multiset.</p>
<p>Counter is defined in a standard module called collections, so you have
to import it. You can initialize a Counter with a string, list, or
anything else that supports iteration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s">&#39;parrot&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">count</span>
<span class="go">Counter({&#39;r&#39;: 2, &#39;t&#39;: 1, &#39;o&#39;: 1, &#39;p&#39;: 1, &#39;a&#39;: 1})</span>
</pre></div>
</div>
<p>Counters behave like dictionaries in many ways; they map from each key
to the number of times it appears. As in dictionaries, the keys have to
be hashable.</p>
<p>Unlike dictionaries, Counters don’t raise an exception if you access an
element that doesn’t appear. Instead, they return 0:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">count</span><span class="p">[</span><span class="s">&#39;d&#39;</span><span class="p">]</span>
<span class="go">0</span>
</pre></div>
</div>
<p>We can use Counters to rewrite <code class="docutils literal"><span class="pre">is_anagram</span></code> from Exercise&nbsp;[anagram]:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_anagram</span><span class="p">(</span><span class="n">word1</span><span class="p">,</span> <span class="n">word2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Counter</span><span class="p">(</span><span class="n">word1</span><span class="p">)</span> <span class="o">==</span> <span class="n">Counter</span><span class="p">(</span><span class="n">word2</span><span class="p">)</span>
</pre></div>
</div>
<p>If two words are anagrams, they contain the same letters with the same
counts, so their Counters are equivalent.</p>
<p>Counters provide methods and operators to perform set-like operations,
including addition, subtraction, union and intersection. And they
provide an often-useful method, <code class="docutils literal"><span class="pre">most_common</span></code>, which returns a list of
value-frequency pairs, sorted from most common to least:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s">&#39;parrot&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span>
<span class="go">r 2</span>
<span class="go">p 1</span>
<span class="go">a 1</span>
</pre></div>
</div>
</div>
<div class="section" id="defaultdict">
<h2>defaultdict<a class="headerlink" href="#defaultdict" title="Permalink to this headline">¶</a></h2>
<p>The collections module also provides defaultdict, which is like a
dictionary except that if you access a key that doesn’t exist, it can
generate a new value on the fly.</p>
<p>When you create a defaultdict, you provide a function that’s used to
create new values. A function used to create objects is sometimes called
a <strong>factory</strong>. The built-in functions that create lists, sets, and other
types can be used as factories:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that the argument is list, which is a class object, not list(),
which is a new list. The function you provide doesn’t get called unless
you access a key that doesn’t exist.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;new key&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">[]</span>
</pre></div>
</div>
<p>The new list, which we’re calling t, is also added to the dictionary. So
if we modify t, the change appears in d:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;new value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">defaultdict(&lt;class &#39;list&#39;&gt;, {&#39;new key&#39;: [&#39;new value&#39;]})</span>
</pre></div>
</div>
<p>If you are making a dictionary of lists, you can often write simpler
code using defaultdict. In my solution to Exercise&nbsp;[anagrams], which you
can get from <a class="reference external" href="http://thinkpython2.com/code/anagram_sets.py">http://thinkpython2.com/code/anagram_sets.py</a>, I make a
dictionary that maps from a sorted string of letters to the list of
words that can be spelled with those letters. For example, ’opst’ maps
to the list .</p>
<p>Here’s the original code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">all_anagrams</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>This can be simplified using setdefault, which you might have used in
Exercise&nbsp;[setdefault]:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">all_anagrams</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>This solution has the drawback that it makes a new list every time,
regardless of whether it is needed. For lists, that’s no big deal, but
if the factory function is complicated, it might be.</p>
<p>We can avoid this problem and simplify the code using a defaultdict:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">all_anagrams</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>My solution to Exercise&nbsp;[poker], which you can download from
<a class="reference external" href="http://thinkpython2.com/code/PokerHandSoln.py">http://thinkpython2.com/code/PokerHandSoln.py</a>, uses setdefault in the
function <code class="docutils literal"><span class="pre">has_straightflush</span></code>. This solution has the drawback of
creating a Hand object every time through the loop, whether it is needed
or not. As an exercise, rewrite it using a defaultdict.</p>
</div>
<div class="section" id="named-tuples">
<h2>Named tuples<a class="headerlink" href="#named-tuples" title="Permalink to this headline">¶</a></h2>
<p>Many simple objects are basically collections of related values. For
example, the Point object defined in Chapter&nbsp;[clobjects] contains two
numbers, x and y. When you define a class like this, you usually start
with an init method and a str method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%g</span><span class="s">, </span><span class="si">%g</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a lot of code to convey a small amount of information. Python
provides a more concise way to say the same thing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="n">Point</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;Point&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The first argument is the name of the class you want to create. The
second is a list of the attributes Point objects should have, as
strings. The return value from namedtuple is a class object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Point</span>
<span class="go">&lt;class &#39;__main__.Point&#39;&gt;</span>
</pre></div>
</div>
<p>Point automatically provides methods like <code class="docutils literal"><span class="pre">__init__</span></code> and <code class="docutils literal"><span class="pre">__str__</span></code>
so you don’t have to write them.</p>
<p>To create a Point object, you use the Point class as a function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span>
<span class="go">Point(x=1, y=2)</span>
</pre></div>
</div>
<p>The init method assigns the arguments to attributes using the names you
provided. The str method prints a representation of the Point object and
its attributes.</p>
<p>You can access the elements of the named tuple by name:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span>
<span class="go">(1, 2)</span>
</pre></div>
</div>
<p>But you can also treat a named tuple as a tuple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">(1, 2)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<span class="go">(1, 2)</span>
</pre></div>
</div>
<p>Named tuples provide a quick way to define simple classes. The drawback
is that simple classes don’t always stay simple. You might decide later
that you want to add methods to a named tuple. In that case, you could
define a new class that inherits from the named tuple:</p>
<div class="highlight-python"><div class="highlight"><pre>class Pointier(Point):
    # add more methods here
</pre></div>
</div>
<p>Or you could switch to a conventional class definition.</p>
</div>
<div class="section" id="gathering-keyword-args">
<h2>Gathering keyword args<a class="headerlink" href="#gathering-keyword-args" title="Permalink to this headline">¶</a></h2>
<p>In Section&nbsp;[gather], we saw how to write a function that gathers its
arguments into a tuple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">printall</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>You can call this function with any number of positional arguments (that
is, arguments that don’t have keywords):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">printall</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">)</span>
<span class="go">(1, 2.0, &#39;3&#39;)</span>
</pre></div>
</div>
<p>But the operator doesn’t gather keyword arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">printall</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">third</span><span class="o">=</span><span class="s">&#39;3&#39;</span><span class="p">)</span>
<span class="go">TypeError: printall() got an unexpected keyword argument &#39;third&#39;</span>
</pre></div>
</div>
<p>To gather keyword arguments, you can use the * operator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">printall</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>You can call the keyword gathering parameter anything you want, but
kwargs is a common choice. The result is a dictionary that maps keywords
to values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">printall</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">third</span><span class="o">=</span><span class="s">&#39;3&#39;</span><span class="p">)</span>
<span class="go">(1, 2.0) {&#39;third&#39;: &#39;3&#39;}</span>
</pre></div>
</div>
<p>If you have a dictionary of keywords and values, you can use the scatter
operator, * to call a function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Point</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
<span class="go">Point(x=1, y=2)</span>
</pre></div>
</div>
<p>Without the scatter operator, the function would treat d as a single
positional argument, so it would assign d to x and complain because
there’s nothing to assign to y:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Point</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">__new__() missing 1 required positional argument: &#39;y&#39;</span>
</pre></div>
</div>
<p>When you are working with functions that have a large number of
parameters, it is often useful to create and pass around dictionaries
that specify frequently used options.</p>
</div>
<div class="section" id="id57">
<h2>Glossary<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>conditional expression:</dt>
<dd>An expression that has one of two values, depending on a condition.</dd>
<dt>list comprehension:</dt>
<dd>An expression with a for loop in square brackets that yields a new
list.</dd>
<dt>generator expression:</dt>
<dd>An expression with a for loop in parentheses that yields a generator
object.</dd>
<dt>multiset:</dt>
<dd>A mathematical entity that represents a mapping between the elements
of a set and the number of times they appear.</dd>
<dt>factory:</dt>
<dd>A function, usually passed as a parameter, used to create objects.</dd>
</dl>
</div>
<div class="section" id="id58">
<h2>Exercises<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h2>
<p>The following is a function computes the binomial coefficient
recursively.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">binomial_coeff</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the binomial coefficient &quot;n choose k&quot;.</span>

<span class="sd">    n: number of trials</span>
<span class="sd">    k: number of successes</span>

<span class="sd">    returns: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">binomial_coeff</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">binomial_coeff</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p>Rewrite the body of the function using nested conditional expressions.</p>
<p>One note: this function is not very efficient because it ends up
computing the same values over and over. You could make it more
efficient by memoizing (see Section&nbsp;[memoize]). But you will find that
it’s harder to memoize if you write it using conditional expressions.</p>
</div>
</div>
<div class="section" id="id59">
<h1>Debugging<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h1>
<p>When you are debugging, you should distinguish among different kinds of
errors in order to track them down more quickly:</p>
<ul class="simple">
<li>Syntax errors are discovered by the interpreter when it is
translating the source code into byte code. They indicate that there
is something wrong with the structure of the program. Example:
Omitting the colon at the end of a def statement generates the
somewhat redundant message SyntaxError: invalid syntax.</li>
<li>Runtime errors are produced by the interpreter if something goes
wrong while the program is running. Most runtime error messages
include information about where the error occurred and what functions
were executing. Example: An infinite recursion eventually causes the
runtime error “maximum recursion depth exceeded”.</li>
<li>Semantic errors are problems with a program that runs without
producing error messages but doesn’t do the right thing. Example: An
expression may not be evaluated in the order you expect, yielding an
incorrect result.</li>
</ul>
<p>The first step in debugging is to figure out which kind of error you are
dealing with. Although the following sections are organized by error
type, some techniques are applicable in more than one situation.</p>
<div class="section" id="syntax-errors">
<h2>Syntax errors<a class="headerlink" href="#syntax-errors" title="Permalink to this headline">¶</a></h2>
<p>Syntax errors are usually easy to fix once you figure out what they are.
Unfortunately, the error messages are often not helpful. The most common
messages are SyntaxError: invalid syntax and SyntaxError: invalid token,
neither of which is very informative.</p>
<p>On the other hand, the message does tell you where in the program the
problem occurred. Actually, it tells you where Python noticed a problem,
which is not necessarily where the error is. Sometimes the error is
prior to the location of the error message, often on the preceding line.</p>
<p>If you are building the program incrementally, you should have a good
idea about where the error is. It will be in the last line you added.</p>
<p>If you are copying code from a book, start by comparing your code to the
book’s code very carefully. Check every character. At the same time,
remember that the book might be wrong, so if you see something that
looks like a syntax error, it might be.</p>
<p>Here are some ways to avoid the most common syntax errors:</p>
<ol class="arabic simple">
<li>Make sure you are not using a Python keyword for a variable name.</li>
<li>Check that you have a colon at the end of the header of every
compound statement, including for, while, if, and def statements.</li>
<li>Make sure that any strings in the code have matching quotation marks.
Make sure that all quotation marks are “straight quotes”, not “curly
quotes”.</li>
<li>If you have multiline strings with triple quotes (single or double),
make sure you have terminated the string properly. An unterminated
string may cause an invalid token error at the end of your program,
or it may treat the following part of the program as a string until
it comes to the next string. In the second case, it might not produce
an error message at all!</li>
<li>An unclosed opening operator—<code class="docutils literal"><span class="pre">(</span></code>, <code class="docutils literal"><span class="pre">{</span></code>, or <code class="docutils literal"><span class="pre">[</span></code>—makes Python
continue with the next line as part of the current statement.
Generally, an error occurs almost immediately in the next line.</li>
<li>Check for the classic = instead of == inside a conditional.</li>
<li>Check the indentation to make sure it lines up the way it is supposed
to. Python can handle space and tabs, but if you mix them it can
cause problems. The best way to avoid this problem is to use a text
editor that knows about Python and generates consistent indentation.</li>
<li>If you have non-ASCII characters in the code (including strings and
comments), that might cause a problem, although Python 3 usually
handles non-ASCII characters. Be careful if you paste in text from a
web page or other source.</li>
</ol>
<p>If nothing works, move on to the next section...</p>
<div class="section" id="i-keep-making-changes-and-it-makes-no-difference">
<h3>I keep making changes and it makes no difference.<a class="headerlink" href="#i-keep-making-changes-and-it-makes-no-difference" title="Permalink to this headline">¶</a></h3>
<p>If the interpreter says there is an error and you don’t see it, that
might be because you and the interpreter are not looking at the same
code. Check your programming environment to make sure that the program
you are editing is the one Python is trying to run.</p>
<p>If you are not sure, try putting an obvious and deliberate syntax error
at the beginning of the program. Now run it again. If the interpreter
doesn’t find the new error, you are not running the new code.</p>
<p>There are a few likely culprits:</p>
<ul class="simple">
<li>You edited the file and forgot to save the changes before running it
again. Some programming environments do this for you, but some don’t.</li>
<li>You changed the name of the file, but you are still running the old
name.</li>
<li>Something in your development environment is configured incorrectly.</li>
<li>If you are writing a module and using import, make sure you don’t
give your module the same name as one of the standard Python modules.</li>
<li>If you are using import to read a module, remember that you have to
restart the interpreter or use reload to read a modified file. If you
import the module again, it doesn’t do anything.</li>
</ul>
<p>If you get stuck and you can’t figure out what is going on, one approach
is to start again with a new program like “Hello, World!”, and make sure
you can get a known program to run. Then gradually add the pieces of the
original program to the new one.</p>
</div>
</div>
<div class="section" id="runtime-errors">
<h2>Runtime errors<a class="headerlink" href="#runtime-errors" title="Permalink to this headline">¶</a></h2>
<p>Once your program is syntactically correct, Python can read it and at
least start running it. What could possibly go wrong?</p>
<div class="section" id="my-program-does-absolutely-nothing">
<h3>My program does absolutely nothing.<a class="headerlink" href="#my-program-does-absolutely-nothing" title="Permalink to this headline">¶</a></h3>
<p>This problem is most common when your file consists of functions and
classes but does not actually invoke a function to start execution. This
may be intentional if you only plan to import this module to supply
classes and functions.</p>
<p>If it is not intentional, make sure there is a function call in the
program, and make sure the flow of execution reaches it (see “Flow of
Execution” below).</p>
</div>
<div class="section" id="my-program-hangs">
<h3>My program hangs.<a class="headerlink" href="#my-program-hangs" title="Permalink to this headline">¶</a></h3>
<p>If a program stops and seems to be doing nothing, it is “hanging”. Often
that means that it is caught in an infinite loop or infinite recursion.</p>
<ul>
<li><p class="first">If there is a particular loop that you suspect is the problem, add a
print statement immediately before the loop that says “entering the
loop” and another immediately after that says “exiting the loop”.</p>
<p>Run the program. If you get the first message and not the second,
you’ve got an infinite loop. Go to the “Infinite Loop” section below.</p>
</li>
<li><p class="first">Most of the time, an infinite recursion will cause the program to run
for a while and then produce a “RuntimeError: Maximum recursion depth
exceeded” error. If that happens, go to the “Infinite Recursion”
section below.</p>
<p>If you are not getting this error but you suspect there is a problem
with a recursive method or function, you can still use the techniques
in the “Infinite Recursion” section.</p>
</li>
<li><p class="first">If neither of those steps works, start testing other loops and other
recursive functions and methods.</p>
</li>
<li><p class="first">If that doesn’t work, then it is possible that you don’t understand
the flow of execution in your program. Go to the “Flow of Execution”
section below.</p>
</li>
</ul>
<div class="section" id="infinite-loop">
<h4>Infinite Loop<a class="headerlink" href="#infinite-loop" title="Permalink to this headline">¶</a></h4>
<p>If you think you have an infinite loop and you think you know what loop
is causing the problem, add a print statement at the end of the loop
that prints the values of the variables in the condition and the value
of the condition.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">while</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span>
    <span class="c"># do something to x</span>
    <span class="c"># do something to y</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;x: &#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;y: &#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;condition: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>Now when you run the program, you will see three lines of output for
each time through the loop. The last time through the loop, the
condition should be False. If the loop keeps going, you will be able to
see the values of x and y, and you might figure out why they are not
being updated correctly.</p>
</div>
<div class="section" id="id60">
<h4>Infinite Recursion<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h4>
<p>Most of the time, infinite recursion causes the program to run for a
while and then produce a Maximum recursion depth exceeded error.</p>
<p>If you suspect that a function is causing an infinite recursion, make
sure that there is a base case. There should be some condition that
causes the function to return without making a recursive invocation. If
not, you need to rethink the algorithm and identify a base case.</p>
<p>If there is a base case but the program doesn’t seem to be reaching it,
add a print statement at the beginning of the function that prints the
parameters. Now when you run the program, you will see a few lines of
output every time the function is invoked, and you will see the
parameter values. If the parameters are not moving toward the base case,
you will get some ideas about why not.</p>
</div>
<div class="section" id="id61">
<h4>Flow of Execution<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h4>
<p>If you are not sure how the flow of execution is moving through your
program, add print statements to the beginning of each function with a
message like “entering function foo”, where foo is the name of the
function.</p>
<p>Now when you run the program, it will print a trace of each function as
it is invoked.</p>
</div>
</div>
<div class="section" id="when-i-run-the-program-i-get-an-exception">
<h3>When I run the program I get an exception.<a class="headerlink" href="#when-i-run-the-program-i-get-an-exception" title="Permalink to this headline">¶</a></h3>
<p>If something goes wrong during runtime, Python prints a message that
includes the name of the exception, the line of the program where the
problem occurred, and a traceback.</p>
<p>The traceback identifies the function that is currently running, and
then the function that called it, and then the function that called
<em>that</em>, and so on. In other words, it traces the sequence of function
calls that got you to where you are, including the line number in your
file where each call occurred.</p>
<p>The first step is to examine the place in the program where the error
occurred and see if you can figure out what happened. These are some of
the most common runtime errors:</p>
<dl class="docutils">
<dt>NameError:</dt>
<dd>You are trying to use a variable that doesn’t exist in the current
environment. Check if the name is spelled right, or at least
consistently. And remember that local variables are local; you
cannot refer to them from outside the function where they are
defined.</dd>
<dt>TypeError:</dt>
<dd><p class="first">There are several possible causes:</p>
<ul class="last simple">
<li>You are trying to use a value improperly. Example: indexing a
string, list, or tuple with something other than an integer.</li>
<li>There is a mismatch between the items in a format string and the
items passed for conversion. This can happen if either the number
of items does not match or an invalid conversion is called for.</li>
<li>You are passing the wrong number of arguments to a function. For
methods, look at the method definition and check that the first
parameter is self. Then look at the method invocation; make sure
you are invoking the method on an object with the right type and
providing the other arguments correctly.</li>
</ul>
</dd>
<dt>KeyError:</dt>
<dd>You are trying to access an element of a dictionary using a key that
the dictionary does not contain. If the keys are strings, remember
that capitalization matters.</dd>
<dt>AttributeError:</dt>
<dd><p class="first">You are trying to access an attribute or method that does not exist.
Check the spelling! You can use the built-in function vars to list
the attributes that do exist.</p>
<p>If an AttributeError indicates that an object has NoneType, that
means that it is None. So the problem is not the attribute name, but
the object.</p>
<p class="last">The reason the object is none might be that you forgot to return a
value from a function; if you get to the end of a function without
hitting a return statement, it returns None. Another common cause is
using the result from a list method, like sort, that returns None.</p>
</dd>
<dt>IndexError:</dt>
<dd>The index you are using to access a list, string, or tuple is
greater than its length minus one. Immediately before the site of
the error, add a print statement to display the value of the index
and the length of the array. Is the array the right size? Is the
index the right value?</dd>
</dl>
<p>The Python debugger (pdb) is useful for tracking down exceptions because
it allows you to examine the state of the program immediately before the
error. You can read about pdb at
<a class="reference external" href="https://docs.python.org/3/library/pdb.html">https://docs.python.org/3/library/pdb.html</a>.</p>
</div>
<div class="section" id="i-added-so-many-print-statements-i-get-inundated-with-output">
<h3>I added so many print statements I get inundated with output.<a class="headerlink" href="#i-added-so-many-print-statements-i-get-inundated-with-output" title="Permalink to this headline">¶</a></h3>
<p>One of the problems with using print statements for debugging is that
you can end up buried in output. There are two ways to proceed: simplify
the output or simplify the program.</p>
<p>To simplify the output, you can remove or comment out print statements
that aren’t helping, or combine them, or format the output so it is
easier to understand.</p>
<p>To simplify the program, there are several things you can do. First,
scale down the problem the program is working on. For example, if you
are searching a list, search a <em>small</em> list. If the program takes input
from the user, give it the simplest input that causes the problem.</p>
<p>Second, clean up the program. Remove dead code and reorganize the
program to make it as easy to read as possible. For example, if you
suspect that the problem is in a deeply nested part of the program, try
rewriting that part with simpler structure. If you suspect a large
function, try splitting it into smaller functions and testing them
separately.</p>
<p>Often the process of finding the minimal test case leads you to the bug.
If you find that a program works in one situation but not in another,
that gives you a clue about what is going on.</p>
<p>Similarly, rewriting a piece of code can help you find subtle bugs. If
you make a change that you think shouldn’t affect the program, and it
does, that can tip you off.</p>
</div>
</div>
<div class="section" id="semantic-errors">
<h2>Semantic errors<a class="headerlink" href="#semantic-errors" title="Permalink to this headline">¶</a></h2>
<p>In some ways, semantic errors are the hardest to debug, because the
interpreter provides no information about what is wrong. Only you know
what the program is supposed to do.</p>
<p>The first step is to make a connection between the program text and the
behavior you are seeing. You need a hypothesis about what the program is
actually doing. One of the things that makes that hard is that computers
run so fast.</p>
<p>You will often wish that you could slow the program down to human speed,
and with some debuggers you can. But the time it takes to insert a few
well-placed print statements is often short compared to setting up the
debugger, inserting and removing breakpoints, and “stepping” the program
to where the error is occurring.</p>
<div class="section" id="my-program-doesnt-work">
<h3>My program doesn’t work.<a class="headerlink" href="#my-program-doesnt-work" title="Permalink to this headline">¶</a></h3>
<p>You should ask yourself these questions:</p>
<ul class="simple">
<li>Is there something the program was supposed to do but which doesn’t
seem to be happening? Find the section of the code that performs that
function and make sure it is executing when you think it should.</li>
<li>Is something happening that shouldn’t? Find code in your program that
performs that function and see if it is executing when it shouldn’t.</li>
<li>Is a section of code producing an effect that is not what you
expected? Make sure that you understand the code in question,
especially if it involves functions or methods in other Python
modules. Read the documentation for the functions you call. Try them
out by writing simple test cases and checking the results.</li>
</ul>
<p>In order to program, you need a mental model of how programs work. If
you write a program that doesn’t do what you expect, often the problem
is not in the program; it’s in your mental model.</p>
<p>The best way to correct your mental model is to break the program into
its components (usually the functions and methods) and test each
component independently. Once you find the discrepancy between your
model and reality, you can solve the problem.</p>
<p>Of course, you should be building and testing components as you develop
the program. If you encounter a problem, there should be only a small
amount of new code that is not known to be correct.</p>
</div>
<div class="section" id="ive-got-a-big-hairy-expression-and-it-doesnt-do-what-i-expect">
<h3>I’ve got a big hairy expression and it doesn’t do what I expect.<a class="headerlink" href="#ive-got-a-big-hairy-expression-and-it-doesnt-do-what-i-expect" title="Permalink to this headline">¶</a></h3>
<p>Writing complex expressions is fine as long as they are readable, but
they can be hard to debug. It is often a good idea to break a complex
expression into a series of assignments to temporary variables.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">hands</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">addCard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hands</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">findNeighbor</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">popCard</span><span class="p">())</span>
</pre></div>
</div>
<p>This can be rewritten as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">neighbor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findNeighbor</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">pickedCard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hands</span><span class="p">[</span><span class="n">neighbor</span><span class="p">]</span><span class="o">.</span><span class="n">popCard</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">hands</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">addCard</span><span class="p">(</span><span class="n">pickedCard</span><span class="p">)</span>
</pre></div>
</div>
<p>The explicit version is easier to read because the variable names
provide additional documentation, and it is easier to debug because you
can check the types of the intermediate variables and display their
values.</p>
<p>Another problem that can occur with big expressions is that the order of
evaluation may not be what you expect. For example, if you are
translating the expression <span class="math">\frac{x}{2 \pi}</span> into Python, you
might write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
</pre></div>
</div>
<p>That is not correct because multiplication and division have the same
precedence and are evaluated from left to right. So this expression
computes <span class="math">x \pi / 2</span>.</p>
<p>A good way to debug expressions is to add parentheses to make the order
of evaluation explicit:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</pre></div>
</div>
<p>Whenever you are not sure of the order of evaluation, use parentheses.
Not only will the program be correct (in the sense of doing what you
intended), it will also be more readable for other people who haven’t
memorized the order of operations.</p>
</div>
<div class="section" id="ive-got-a-function-that-doesnt-return-what-i-expect">
<h3>I’ve got a function that doesn’t return what I expect.<a class="headerlink" href="#ive-got-a-function-that-doesnt-return-what-i-expect" title="Permalink to this headline">¶</a></h3>
<p>If you have a return statement with a complex expression, you don’t have
a chance to print the result before returning. Again, you can use a
temporary variable. For example, instead of:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hands</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">removeMatches</span><span class="p">()</span>
</pre></div>
</div>
<p>you could write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hands</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">removeMatches</span><span class="p">()</span>
<span class="k">return</span> <span class="n">count</span>
</pre></div>
</div>
<p>Now you have the opportunity to display the value of count before
returning.</p>
</div>
<div class="section" id="im-really-really-stuck-and-i-need-help">
<h3>I’m really, really stuck and I need help.<a class="headerlink" href="#im-really-really-stuck-and-i-need-help" title="Permalink to this headline">¶</a></h3>
<p>First, try getting away from the computer for a few minutes. Computers
emit waves that affect the brain, causing these symptoms:</p>
<ul class="simple">
<li>Frustration and rage.</li>
<li>Superstitious beliefs (“the computer hates me”) and magical thinking
(“the program only works when I wear my hat backward”).</li>
<li>Random walk programming (the attempt to program by writing every
possible program and choosing the one that does the right thing).</li>
</ul>
<p>If you find yourself suffering from any of these symptoms, get up and go
for a walk. When you are calm, think about the program. What is it
doing? What are some possible causes of that behavior? When was the last
time you had a working program, and what did you do next?</p>
<p>Sometimes it just takes time to find a bug. I often find bugs when I am
away from the computer and let my mind wander. Some of the best places
to find bugs are trains, showers, and in bed, just before you fall
asleep.</p>
</div>
<div class="section" id="no-i-really-need-help">
<h3>No, I really need help.<a class="headerlink" href="#no-i-really-need-help" title="Permalink to this headline">¶</a></h3>
<p>It happens. Even the best programmers occasionally get stuck. Sometimes
you work on a program so long that you can’t see the error. You need a
fresh pair of eyes.</p>
<p>Before you bring someone else in, make sure you are prepared. Your
program should be as simple as possible, and you should be working on
the smallest input that causes the error. You should have print
statements in the appropriate places (and the output they produce should
be comprehensible). You should understand the problem well enough to
describe it concisely.</p>
<p>When you bring someone in to help, be sure to give them the information
they need:</p>
<ul class="simple">
<li>If there is an error message, what is it and what part of the program
does it indicate?</li>
<li>What was the last thing you did before this error occurred? What were
the last lines of code that you wrote, or what is the new test case
that fails?</li>
<li>What have you tried so far, and what have you learned?</li>
</ul>
<p>When you find the bug, take a second to think about what you could have
done to find it faster. Next time you see something similar, you will be
able to find the bug more quickly.</p>
<p>Remember, the goal is not just to make the program work. The goal is to
learn how to make the program work.</p>
</div>
</div>
</div>
<div class="section" id="analysis-of-algorithms">
<h1>Analysis of Algorithms<a class="headerlink" href="#analysis-of-algorithms" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div>This appendix is an edited excerpt from <em>Think Complexity</em>, by Allen
B. Downey, also published by O’Reilly Media (2012). When you are
done with this book, you might want to move on to that one.</div></blockquote>
<p><strong>Analysis of algorithms</strong> is a branch of computer science that studies
the performance of algorithms, especially their run time and space
requirements. See <a class="reference external" href="http://en.wikipedia.org/wiki/Analysis_of_algorithms">http://en.wikipedia.org/wiki/Analysis_of_algorithms</a>.</p>
<p>The practical goal of algorithm analysis is to predict the performance
of different algorithms in order to guide design decisions.</p>
<p>During the 2008 United States Presidential Campaign, candidate Barack
Obama was asked to perform an impromptu analysis when he visited Google.
Chief executive Eric Schmidt jokingly asked him for “the most efficient
way to sort a million 32-bit integers.” Obama had apparently been tipped
off, because he quickly replied, “I think the bubble sort would be the
wrong way to go.” See <a class="reference external" href="http://www.youtube.com/watch?v=k4RRi_ntQc8">http://www.youtube.com/watch?v=k4RRi_ntQc8</a>.</p>
<p>This is true: bubble sort is conceptually simple but slow for large
datasets. The answer Schmidt was probably looking for is “radix sort”
(<a class="reference external" href="http://en.wikipedia.org/wiki/Radix_sort">http://en.wikipedia.org/wiki/Radix_sort</a>) <a class="footnote-reference" href="#id65" id="id62">[2]</a>.</p>
<p>The goal of algorithm analysis is to make meaningful comparisons between
algorithms, but there are some problems:</p>
<ul class="simple">
<li>The relative performance of the algorithms might depend on
characteristics of the hardware, so one algorithm might be faster on
Machine A, another on Machine B. The general solution to this problem
is to specify a <strong>machine model</strong> and analyze the number of steps, or
operations, an algorithm requires under a given model.</li>
<li>Relative performance might depend on the details of the dataset. For
example, some sorting algorithms run faster if the data are already
partially sorted; other algorithms run slower in this case. A common
way to avoid this problem is to analyze the <strong>worst case</strong> scenario.
It is sometimes useful to analyze average case performance, but
that’s usually harder, and it might not be obvious what set of cases
to average over.</li>
<li>Relative performance also depends on the size of the problem. A
sorting algorithm that is fast for small lists might be slow for long
lists. The usual solution to this problem is to express run time (or
number of operations) as a function of problem size, and group
functions into categories depending on how quickly they grow as
problem size increases.</li>
</ul>
<p>The good thing about this kind of comparison is that it lends itself to
simple classification of algorithms. For example, if I know that the run
time of Algorithm A tends to be proportional to the size of the input,
<span class="math">n</span>, and Algorithm B tends to be proportional to <span class="math">n^2</span>, then
I expect A to be faster than B, at least for large values of <span class="math">n</span>.</p>
<p>This kind of analysis comes with some caveats, but we’ll get to that
later.</p>
<div class="section" id="order-of-growth">
<h2>Order of growth<a class="headerlink" href="#order-of-growth" title="Permalink to this headline">¶</a></h2>
<p>Suppose you have analyzed two algorithms and expressed their run times
in terms of the size of the input: Algorithm A takes <span class="math">100n+1</span>
steps to solve a problem with size <span class="math">n</span>; Algorithm B takes
<span class="math">n^2 + n + 1</span> steps.</p>
<p>The following table shows the run time of these algorithms for different
problem sizes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="33%" />
<col width="46%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Input</td>
<td>Run time of</td>
<td>Run time of</td>
</tr>
<tr class="row-even"><td>size</td>
<td>Algorithm A</td>
<td>Algorithm B</td>
</tr>
<tr class="row-odd"><td>10</td>
<td>1 001</td>
<td>111</td>
</tr>
<tr class="row-even"><td>100</td>
<td>10 001</td>
<td>10 101</td>
</tr>
<tr class="row-odd"><td>1 000</td>
<td>100 001</td>
<td>1 001 001</td>
</tr>
<tr class="row-even"><td>10 000</td>
<td>1 000 001</td>
<td><span class="math">&gt; 10^{10}</span></td>
</tr>
</tbody>
</table>
<p>At <span class="math">n=10</span>, Algorithm A looks pretty bad; it takes almost 10 times
longer than Algorithm B. But for <span class="math">n=100</span> they are about the same,
and for larger values A is much better.</p>
<p>The fundamental reason is that for large values of <span class="math">n</span>, any
function that contains an <span class="math">n^2</span> term will grow faster than a
function whose leading term is <span class="math">n</span>. The <strong>leading term</strong> is the
term with the highest exponent.</p>
<p>For Algorithm A, the leading term has a large coefficient, 100, which is
why B does better than A for small <span class="math">n</span>. But regardless of the
coefficients, there will always be some value of <span class="math">n</span> where
<span class="math">a n^2 &gt; b n</span>, for any values of <span class="math">a</span> and <span class="math">b</span>.</p>
<p>The same argument applies to the non-leading terms. Even if the run time
of Algorithm A were <span class="math">n+1000000</span>, it would still be better than
Algorithm B for sufficiently large <span class="math">n</span>.</p>
<p>In general, we expect an algorithm with a smaller leading term to be a
better algorithm for large problems, but for smaller problems, there may
be a <strong>crossover point</strong> where another algorithm is better. The location
of the crossover point depends on the details of the algorithms, the
inputs, and the hardware, so it is usually ignored for purposes of
algorithmic analysis. But that doesn’t mean you can forget about it.</p>
<p>If two algorithms have the same leading order term, it is hard to say
which is better; again, the answer depends on the details. So for
algorithmic analysis, functions with the same leading term are
considered equivalent, even if they have different coefficients.</p>
<p>An <strong>order of growth</strong> is a set of functions whose growth behavior is
considered equivalent. For example, <span class="math">2n</span>, <span class="math">100n</span> and
<span class="math">n+1</span> belong to the same order of growth, which is written
<span class="math">O(n)</span> in <strong>Big-Oh notation</strong> and often called <strong>linear</strong> because
every function in the set grows linearly with <span class="math">n</span>.</p>
<p>All functions with the leading term <span class="math">n^2</span> belong to
<span class="math">O(n^2)</span>; they are called <strong>quadratic</strong>.</p>
<p>The following table shows some of the orders of growth that appear most
commonly in algorithmic analysis, in increasing order of badness.</p>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="55%" />
<col width="6%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Order of</td>
<td>Name</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>growth</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><span class="math">O(1)</span></td>
<td>constant</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><span class="math">O(\log_b n)</span></td>
<td>logarithmic (for any <span class="math">b</span>)</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><span class="math">O(n)</span></td>
<td>linear</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><span class="math">O(n \log_b n)</span></td>
<td>linearithmic</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><span class="math">O(n^2)</span></td>
<td>quadratic</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><span class="math">O(n^3)</span></td>
<td>cubic</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><span class="math">O(c^n)</span></td>
<td>exponential (for any <span class="math">c</span>)</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p>For the logarithmic terms, the base of the logarithm doesn’t matter;
changing bases is the equivalent of multiplying by a constant, which
doesn’t change the order of growth. Similarly, all exponential functions
belong to the same order of growth regardless of the base of the
exponent. Exponential functions grow very quickly, so exponential
algorithms are only useful for small problems.</p>
<p>Read the Wikipedia page on Big-Oh notation at
<a class="reference external" href="http://en.wikipedia.org/wiki/Big_O_notation">http://en.wikipedia.org/wiki/Big_O_notation</a> and answer the following
questions:</p>
<ol class="arabic simple">
<li>What is the order of growth of <span class="math">n^3 + n^2</span>? What about
<span class="math">1000000 n^3 + n^2</span>? What about <span class="math">n^3 + 1000000 n^2</span>?</li>
<li>What is the order of growth of <span class="math">(n^2 + n) \cdot (n + 1)</span>?
Before you start multiplying, remember that you only need the leading
term.</li>
<li>If <span class="math">f</span> is in <span class="math">O(g)</span>, for some unspecified function
<span class="math">g</span>, what can we say about <span class="math">af+b</span>?</li>
<li>If <span class="math">f_1</span> and <span class="math">f_2</span> are in <span class="math">O(g)</span>, what can we say
about <span class="math">f_1 + f_2</span>?</li>
<li>If <span class="math">f_1</span> is in <span class="math">O(g)</span> and <span class="math">f_2</span> is in <span class="math">O(h)</span>,
what can we say about <span class="math">f_1 + f_2</span>?</li>
<li>If <span class="math">f_1</span> is in <span class="math">O(g)</span> and <span class="math">f_2</span> is <span class="math">O(h)</span>,
what can we say about <span class="math">f_1 \cdot f_2</span>?</li>
</ol>
<p>Programmers who care about performance often find this kind of analysis
hard to swallow. They have a point: sometimes the coefficients and the
non-leading terms make a real difference. Sometimes the details of the
hardware, the programming language, and the characteristics of the input
make a big difference. And for small problems asymptotic behavior is
irrelevant.</p>
<p>But if you keep those caveats in mind, algorithmic analysis is a useful
tool. At least for large problems, the “better” algorithms is usually
better, and sometimes it is <em>much</em> better. The difference between two
algorithms with the same order of growth is usually a constant factor,
but the difference between a good algorithm and a bad algorithm is
unbounded!</p>
</div>
<div class="section" id="analysis-of-basic-python-operations">
<h2>Analysis of basic Python operations<a class="headerlink" href="#analysis-of-basic-python-operations" title="Permalink to this headline">¶</a></h2>
<p>In Python, most arithmetic operations are constant time; multiplication
usually takes longer than addition and subtraction, and division takes
even longer, but these run times don’t depend on the magnitude of the
operands. Very large integers are an exception; in that case the run
time increases with the number of digits.</p>
<p>Indexing operations—reading or writing elements in a sequence or
dictionary—are also constant time, regardless of the size of the data
structure.</p>
<p>A for loop that traverses a sequence or dictionary is usually linear, as
long as all of the operations in the body of the loop are constant time.
For example, adding up the elements of a list is linear:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">x</span>
</pre></div>
</div>
<p>The built-in function sum is also linear because it does the same thing,
but it tends to be faster because it is a more efficient implementation;
in the language of algorithmic analysis, it has a smaller leading
coefficient.</p>
<p>As a rule of thumb, if the body of a loop is in <span class="math">O(n^a)</span> then the
whole loop is in <span class="math">O(n^{a+1})</span>. The exception is if you can show
that the loop exits after a constant number of iterations. If a loop
runs <span class="math">k</span> times regardless of <span class="math">n</span>, then the loop is in
<span class="math">O(n^a)</span>, even for large <span class="math">k</span>.</p>
<p>Multiplying by <span class="math">k</span> doesn’t change the order of growth, but neither
does dividing. So if the body of a loop is in <span class="math">O(n^a)</span> and it runs
<span class="math">n/k</span> times, the loop is in <span class="math">O(n^{a+1})</span>, even for large
<span class="math">k</span>.</p>
<p>Most string and tuple operations are linear, except indexing and len,
which are constant time. The built-in functions min and max are linear.
The run-time of a slice operation is proportional to the length of the
output, but independent of the size of the input.</p>
<p>String concatenation is linear; the run time depends on the sum of the
lengths of the operands.</p>
<p>All string methods are linear, but if the lengths of the strings are
bounded by a constant—for example, operations on single characters—they
are considered constant time. The string method join is linear; the run
time depends on the total length of the strings.</p>
<p>Most list methods are linear, but there are some exceptions:</p>
<ul class="simple">
<li>Adding an element to the end of a list is constant time on average;
when it runs out of room it occasionally gets copied to a bigger
location, but the total time for <span class="math">n</span> operations is
<span class="math">O(n)</span>, so the average time for each operation is <span class="math">O(1)</span>.</li>
<li>Removing an element from the end of a list is constant time.</li>
<li>Sorting is <span class="math">O(n \log n)</span>.</li>
</ul>
<p>Most dictionary operations and methods are constant time, but there are
some exceptions:</p>
<ul class="simple">
<li>The run time of update is proportional to the size of the dictionary
passed as a parameter, not the dictionary being updated.</li>
<li>keys, values and items are constant time because they return
iterators. But if you loop through the iterators, the loop will be
linear.</li>
</ul>
<p>The performance of dictionaries is one of the minor miracles of computer
science. We will see how they work in Section&nbsp;[hashtable].</p>
<p>Read the Wikipedia page on sorting algorithms at
<a class="reference external" href="http://en.wikipedia.org/wiki/Sorting_algorithm">http://en.wikipedia.org/wiki/Sorting_algorithm</a> and answer the following
questions:</p>
<ol class="arabic simple">
<li>What is a “comparison sort?” What is the best worst-case order of
growth for a comparison sort? What is the best worst-case order of
growth for any sort algorithm?</li>
<li>What is the order of growth of bubble sort, and why does Barack Obama
think it is “the wrong way to go?”</li>
<li>What is the order of growth of radix sort? What preconditions do we
need to use it?</li>
<li>What is a stable sort and why might it matter in practice?</li>
<li>What is the worst sorting algorithm (that has a name)?</li>
<li>What sort algorithm does the C library use? What sort algorithm does
Python use? Are these algorithms stable? You might have to Google
around to find these answers.</li>
<li>Many of the non-comparison sorts are linear, so why does does Python
use an <span class="math">O(n \log n)</span> comparison sort?</li>
</ol>
</div>
<div class="section" id="analysis-of-search-algorithms">
<h2>Analysis of search algorithms<a class="headerlink" href="#analysis-of-search-algorithms" title="Permalink to this headline">¶</a></h2>
<p>A <strong>search</strong> is an algorithm that takes a collection and a target item
and determines whether the target is in the collection, often returning
the index of the target.</p>
<p>The simplest search algorithm is a “linear search”, which traverses the
items of the collection in order, stopping if it finds the target. In
the worst case it has to traverse the entire collection, so the run time
is linear.</p>
<p>The in operator for sequences uses a linear search; so do string methods
like find and count.</p>
<p>If the elements of the sequence are in order, you can use a <strong>bisection
search</strong>, which is <span class="math">O(\log n)</span>. Bisection search is similar to the
algorithm you might use to look a word up in a dictionary (a paper
dictionary, not the data structure). Instead of starting at the
beginning and checking each item in order, you start with the item in
the middle and check whether the word you are looking for comes before
or after. If it comes before, then you search the first half of the
sequence. Otherwise you search the second half. Either way, you cut the
number of remaining items in half.</p>
<p>If the sequence has 1,000,000 items, it will take about 20 steps to find
the word or conclude that it’s not there. So that’s about 50,000 times
faster than a linear search.</p>
<p>Bisection search can be much faster than linear search, but it requires
the sequence to be in order, which might require extra work.</p>
<p>There is another data structure, called a <strong>hashtable</strong> that is even
faster—it can do a search in constant time—and it doesn’t require the
items to be sorted. Python dictionaries are implemented using
hashtables, which is why most dictionary operations, including the in
operator, are constant time.</p>
</div>
<div class="section" id="hashtables">
<h2>Hashtables<a class="headerlink" href="#hashtables" title="Permalink to this headline">¶</a></h2>
<p>To explain how hashtables work and why their performance is so good, I
start with a simple implementation of a map and gradually improve it
until it’s a hashtable.</p>
<p>I use Python to demonstrate these implementations, but in real life you
wouldn’t write code like this in Python; you would just use a
dictionary! So for the rest of this chapter, you have to imagine that
dictionaries don’t exist and you want to implement a data structure that
maps from keys to values. The operations you have to implement are:</p>
<dl class="docutils">
<dt>add(k, v):</dt>
<dd>Add a new item that maps from key k to value v. With a Python
dictionary, d, this operation is written d[k] = v.</dd>
<dt>get(k):</dt>
<dd>Look up and return the value that corresponds to key k. With a
Python dictionary, d, this operation is written d[k] or d.get(k).</dd>
</dl>
<p>For now, I assume that each key only appears once. The simplest
implementation of this interface uses a list of tuples, where each tuple
is a key-value pair.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">LinearMap</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">val</span>
        <span class="k">raise</span> <span class="ne">KeyError</span>
</pre></div>
</div>
<p>add appends a key-value tuple to the list of items, which takes constant
time.</p>
<p>get uses a for loop to search the list: if it finds the target key it
returns the corresponding value; otherwise it raises a KeyError. So get
is linear.</p>
<p>An alternative is to keep the list sorted by key. Then get could use a
bisection search, which is <span class="math">O(\log n)</span>. But inserting a new item
in the middle of a list is linear, so this might not be the best option.
There are other data structures that can implement add and get in log
time, but that’s still not as good as constant time, so let’s move on.</p>
<p>One way to improve LinearMap is to break the list of key-value pairs
into smaller lists. Here’s an implementation called BetterMap, which is
a list of 100 LinearMaps. As we’ll see in a second, the order of growth
for get is still linear, but BetterMap is a step on the path toward
hashtables:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">BetterMap</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LinearMap</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">find_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_map</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_map</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">__init__</span></code> makes a list of n LinearMaps.</p>
<p><code class="docutils literal"><span class="pre">find_map</span></code> is used by add and get to figure out which map to put the
new item in, or which map to search.</p>
<p><code class="docutils literal"><span class="pre">find_map</span></code> uses the built-in function hash, which takes almost any
Python object and returns an integer. A limitation of this
implementation is that it only works with hashable keys. Mutable types
like lists and dictionaries are unhashable.</p>
<p>Hashable objects that are considered equivalent return the same hash
value, but the converse is not necessarily true: two objects with
different values can return the same hash value.</p>
<p><code class="docutils literal"><span class="pre">find_map</span></code> uses the modulus operator to wrap the hash values into the
range from 0 to len(self.maps), so the result is a legal index into the
list. Of course, this means that many different hash values will wrap
onto the same index. But if the hash function spreads things out pretty
evenly (which is what hash functions are designed to do), then we expect
<span class="math">n/100</span> items per LinearMap.</p>
<p>Since the run time of LinearMap.get is proportional to the number of
items, we expect BetterMap to be about 100 times faster than LinearMap.
The order of growth is still linear, but the leading coefficient is
smaller. That’s nice, but still not as good as a hashtable.</p>
<p>Here (finally) is the crucial idea that makes hashtables fast: if you
can keep the maximum length of the LinearMaps bounded, LinearMap.get is
constant time. All you have to do is keep track of the number of items
and when the number of items per LinearMap exceeds a threshold, resize
the hashtable by adding more LinearMaps.</p>
<p>Here is an implementation of a hashtable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">HashMap</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maps</span> <span class="o">=</span> <span class="n">BetterMap</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="o">.</span><span class="n">maps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_maps</span> <span class="o">=</span> <span class="n">BetterMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="o">.</span><span class="n">maps</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
                <span class="n">new_maps</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">maps</span> <span class="o">=</span> <span class="n">new_maps</span>
</pre></div>
</div>
<p>Each HashMap contains a BetterMap; <code class="docutils literal"><span class="pre">__init__</span></code> starts with just 2
LinearMaps and initializes num, which keeps track of the number of
items.</p>
<p>get just dispatches to BetterMap. The real work happens in add, which
checks the number of items and the size of the BetterMap: if they are
equal, the average number of items per LinearMap is 1, so it calls
resize.</p>
<p>resize make a new BetterMap, twice as big as the previous one, and then
“rehashes” the items from the old map to the new.</p>
<p>Rehashing is necessary because changing the number of LinearMaps changes
the denominator of the modulus operator in <code class="docutils literal"><span class="pre">find_map</span></code>. That means that
some objects that used to hash into the same LinearMap will get split up
(which is what we wanted, right?).</p>
<p>Rehashing is linear, so resize is linear, which might seem bad, since I
promised that add would be constant time. But remember that we don’t
have to resize every time, so add is usually constant time and only
occasionally linear. The total amount of work to run add <span class="math">n</span> times
is proportional to <span class="math">n</span>, so the average time of each add is
constant time!</p>
<p>To see how this works, think about starting with an empty HashTable and
adding a sequence of items. We start with 2 LinearMaps, so the first 2
adds are fast (no resizing required). Let’s say that they take one unit
of work each. The next add requires a resize, so we have to rehash the
first two items (let’s call that 2 more units of work) and then add the
third item (one more unit). Adding the next item costs 1 unit, so the
total so far is 6 units of work for 4 items.</p>
<p>The next add costs 5 units, but the next three are only one unit each,
so the total is 14 units for the first 8 adds.</p>
<p>The next add costs 9 units, but then we can add 7 more before the next
resize, so the total is 30 units for the first 16 adds.</p>
<p>After 32 adds, the total cost is 62 units, and I hope you are starting
to see a pattern. After <span class="math">n</span> adds, where <span class="math">n</span> is a power of
two, the total cost is <span class="math">2n-2</span> units, so the average work per add
is a little less than 2 units. When <span class="math">n</span> is a power of two, that’s
the best case; for other values of <span class="math">n</span> the average work is a
little higher, but that’s not important. The important thing is that it
is <span class="math">O(1)</span>.</p>
<p>Figure&nbsp;[fig.hash] shows how this works graphically. Each block
represents a unit of work. The columns show the total work for each add
in order from left to right: the first two adds cost 1 units, the third
costs 3 units, etc.</p>
<div class="figure" id="id91">
<img alt="The cost of a hashtable add.[fig.hash]" src="_images/towers.pdf" />
<p class="caption"><span class="caption-text">The cost of a hashtable add.[fig.hash]</span></p>
</div>
<p>The extra work of rehashing appears as a sequence of increasingly tall
towers with increasing space between them. Now if you knock over the
towers, spreading the cost of resizing over all adds, you can see
graphically that the total cost after <span class="math">n</span> adds is <span class="math">2n - 2</span>.</p>
<p>An important feature of this algorithm is that when we resize the
HashTable it grows geometrically; that is, we multiply the size by a
constant. If you increase the size arithmetically—adding a fixed number
each time—the average time per add is linear.</p>
<p>You can download my implementation of HashMap from
<a class="reference external" href="http://thinkpython2.com/code/Map.py">http://thinkpython2.com/code/Map.py</a>, but remember that there is no
reason to use it; if you want a map, just use a Python dictionary.</p>
</div>
<div class="section" id="id63">
<h2>Glossary<a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>analysis of algorithms:</dt>
<dd>A way to compare algorithms in terms of their run time and/or space
requirements.</dd>
<dt>machine model:</dt>
<dd>A simplified representation of a computer used to describe
algorithms.</dd>
<dt>worst case:</dt>
<dd>The input that makes a given algorithm run slowest (or require the
most space.</dd>
<dt>leading term:</dt>
<dd>In a polynomial, the term with the highest exponent.</dd>
<dt>crossover point:</dt>
<dd>The problem size where two algorithms require the same run time or
space.</dd>
<dt>order of growth:</dt>
<dd>A set of functions that all grow in a way considered equivalent for
purposes of analysis of algorithms. For example, all functions that
grow linearly belong to the same order of growth.</dd>
<dt>Big-Oh notation:</dt>
<dd>Notation for representing an order of growth; for example,
<span class="math">O(n)</span> represents the set of functions that grow linearly.</dd>
<dt>linear:</dt>
<dd>An algorithm whose run time is proportional to problem size, at
least for large problem sizes.</dd>
<dt>quadratic:</dt>
<dd>An algorithm whose run time is proportional to <span class="math">n^2</span>, where
<span class="math">n</span> is a measure of problem size.</dd>
<dt>search:</dt>
<dd>The problem of locating an element of a collection (like a list or
dictionary) or determining that it is not present.</dd>
<dt>hashtable:</dt>
<dd>A data structure that represents a collection of key-value pairs and
performs search in constant time.</dd>
</dl>
<table class="docutils footnote" frame="void" id="id64" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id40">[1]</a></td><td>popen is deprecated now, which means we are supposed to stop using it
and start using the subprocess module. But for simple cases, I find
subprocess more complicated than necessary. So I am going to keep
using popen until they take it away.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id65" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id62">[2]</a></td><td>But if you get a question like this in an interview, I think a better
answer is, “The fastest way to sort a million integers is to use
whatever sort function is provided by the language I’m using. Its
performance is good enough for the vast majority of applications, but
if it turned out that my application was too slow, I would use a
profiler to see where the time was being spent. If it looked like a
faster sort algorithm would have a significant effect on performance,
then I would look around for a good implementation of radix sort.”</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Preface</a><ul>
<li><a class="reference internal" href="#the-strange-history-of-this-book">The strange history of this book</a></li>
<li><a class="reference internal" href="#acknowledgments">Acknowledgments</a></li>
<li><a class="reference internal" href="#contributor-list">Contributor List</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-way-of-the-program">The way of the program</a><ul>
<li><a class="reference internal" href="#what-is-a-program">What is a program?</a></li>
<li><a class="reference internal" href="#running-python">Running Python</a></li>
<li><a class="reference internal" href="#the-first-program">The first program</a></li>
<li><a class="reference internal" href="#arithmetic-operators">Arithmetic operators</a></li>
<li><a class="reference internal" href="#values-and-types">Values and types</a></li>
<li><a class="reference internal" href="#formal-and-natural-languages">Formal and natural languages</a></li>
<li><a class="reference internal" href="#debugging">Debugging</a></li>
<li><a class="reference internal" href="#glossary">Glossary</a></li>
<li><a class="reference internal" href="#exercises">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#variables-expressions-and-statements">Variables, expressions and statements</a><ul>
<li><a class="reference internal" href="#assignment-statements">Assignment statements</a></li>
<li><a class="reference internal" href="#variable-names">Variable names</a></li>
<li><a class="reference internal" href="#expressions-and-statements">Expressions and statements</a></li>
<li><a class="reference internal" href="#script-mode">Script mode</a></li>
<li><a class="reference internal" href="#order-of-operations">Order of operations</a></li>
<li><a class="reference internal" href="#string-operations">String operations</a></li>
<li><a class="reference internal" href="#comments">Comments</a></li>
<li><a class="reference internal" href="#id1">Debugging</a></li>
<li><a class="reference internal" href="#id2">Glossary</a></li>
<li><a class="reference internal" href="#id3">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functions">Functions</a><ul>
<li><a class="reference internal" href="#function-calls">Function calls</a></li>
<li><a class="reference internal" href="#math-functions">Math functions</a></li>
<li><a class="reference internal" href="#composition">Composition</a></li>
<li><a class="reference internal" href="#adding-new-functions">Adding new functions</a></li>
<li><a class="reference internal" href="#definitions-and-uses">Definitions and uses</a></li>
<li><a class="reference internal" href="#flow-of-execution">Flow of execution</a></li>
<li><a class="reference internal" href="#parameters-and-arguments">Parameters and arguments</a></li>
<li><a class="reference internal" href="#variables-and-parameters-are-local">Variables and parameters are local</a></li>
<li><a class="reference internal" href="#stack-diagrams">Stack diagrams</a></li>
<li><a class="reference internal" href="#fruitful-functions-and-void-functions">Fruitful functions and void functions</a></li>
<li><a class="reference internal" href="#why-functions">Why functions?</a></li>
<li><a class="reference internal" href="#id4">Debugging</a></li>
<li><a class="reference internal" href="#id5">Glossary</a></li>
<li><a class="reference internal" href="#id6">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#case-study-interface-design">Case study: interface design</a><ul>
<li><a class="reference internal" href="#the-turtle-module">The turtle module</a></li>
<li><a class="reference internal" href="#simple-repetition">Simple repetition</a></li>
<li><a class="reference internal" href="#id7">Exercises</a></li>
<li><a class="reference internal" href="#encapsulation">Encapsulation</a></li>
<li><a class="reference internal" href="#generalization">Generalization</a></li>
<li><a class="reference internal" href="#interface-design">Interface design</a></li>
<li><a class="reference internal" href="#refactoring">Refactoring</a></li>
<li><a class="reference internal" href="#a-development-plan">A development plan</a></li>
<li><a class="reference internal" href="#docstring">docstring</a></li>
<li><a class="reference internal" href="#id8">Debugging</a></li>
<li><a class="reference internal" href="#id9">Glossary</a></li>
<li><a class="reference internal" href="#id10">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conditionals-and-recursion">Conditionals and recursion</a><ul>
<li><a class="reference internal" href="#floor-division-and-modulus">Floor division and modulus</a></li>
<li><a class="reference internal" href="#boolean-expressions">Boolean expressions</a></li>
<li><a class="reference internal" href="#logical-operators">Logical operators</a></li>
<li><a class="reference internal" href="#conditional-execution">Conditional execution</a></li>
<li><a class="reference internal" href="#alternative-execution">Alternative execution</a></li>
<li><a class="reference internal" href="#chained-conditionals">Chained conditionals</a></li>
<li><a class="reference internal" href="#nested-conditionals">Nested conditionals</a></li>
<li><a class="reference internal" href="#recursion">Recursion</a></li>
<li><a class="reference internal" href="#stack-diagrams-for-recursive-functions">Stack diagrams for recursive functions</a></li>
<li><a class="reference internal" href="#infinite-recursion">Infinite recursion</a></li>
<li><a class="reference internal" href="#keyboard-input">Keyboard input</a></li>
<li><a class="reference internal" href="#id11">Debugging</a></li>
<li><a class="reference internal" href="#id12">Glossary</a></li>
<li><a class="reference internal" href="#id13">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fruitful-functions">Fruitful functions</a><ul>
<li><a class="reference internal" href="#return-values">Return values</a></li>
<li><a class="reference internal" href="#incremental-development">Incremental development</a></li>
<li><a class="reference internal" href="#id14">Composition</a></li>
<li><a class="reference internal" href="#boolean-functions">Boolean functions</a></li>
<li><a class="reference internal" href="#more-recursion">More recursion</a></li>
<li><a class="reference internal" href="#leap-of-faith">Leap of faith</a></li>
<li><a class="reference internal" href="#one-more-example">One more example</a></li>
<li><a class="reference internal" href="#checking-types">Checking types</a></li>
<li><a class="reference internal" href="#id15">Debugging</a></li>
<li><a class="reference internal" href="#id16">Glossary</a></li>
<li><a class="reference internal" href="#id17">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#iteration">Iteration</a><ul>
<li><a class="reference internal" href="#reassignment">Reassignment</a></li>
<li><a class="reference internal" href="#updating-variables">Updating variables</a></li>
<li><a class="reference internal" href="#the-while-statement">The while statement</a></li>
<li><a class="reference internal" href="#break">break</a></li>
<li><a class="reference internal" href="#square-roots">Square roots</a></li>
<li><a class="reference internal" href="#algorithms">Algorithms</a></li>
<li><a class="reference internal" href="#id18">Debugging</a></li>
<li><a class="reference internal" href="#id19">Glossary</a></li>
<li><a class="reference internal" href="#id20">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#strings">Strings</a><ul>
<li><a class="reference internal" href="#a-string-is-a-sequence">A string is a sequence</a></li>
<li><a class="reference internal" href="#len">len</a></li>
<li><a class="reference internal" href="#traversal-with-a-for-loop">Traversal with a for loop</a></li>
<li><a class="reference internal" href="#string-slices">String slices</a></li>
<li><a class="reference internal" href="#strings-are-immutable">Strings are immutable</a></li>
<li><a class="reference internal" href="#searching">Searching</a></li>
<li><a class="reference internal" href="#looping-and-counting">Looping and counting</a></li>
<li><a class="reference internal" href="#string-methods">String methods</a></li>
<li><a class="reference internal" href="#the-in-operator">The in operator</a></li>
<li><a class="reference internal" href="#string-comparison">String comparison</a></li>
<li><a class="reference internal" href="#id21">Debugging</a></li>
<li><a class="reference internal" href="#id22">Glossary</a></li>
<li><a class="reference internal" href="#id23">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#case-study-word-play">Case study: word play</a><ul>
<li><a class="reference internal" href="#reading-word-lists">Reading word lists</a></li>
<li><a class="reference internal" href="#id24">Exercises</a></li>
<li><a class="reference internal" href="#search">Search</a></li>
<li><a class="reference internal" href="#looping-with-indices">Looping with indices</a></li>
<li><a class="reference internal" href="#id25">Debugging</a></li>
<li><a class="reference internal" href="#id26">Glossary</a></li>
<li><a class="reference internal" href="#id27">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lists">Lists</a><ul>
<li><a class="reference internal" href="#a-list-is-a-sequence">A list is a sequence</a></li>
<li><a class="reference internal" href="#lists-are-mutable">Lists are mutable</a></li>
<li><a class="reference internal" href="#traversing-a-list">Traversing a list</a></li>
<li><a class="reference internal" href="#list-operations">List operations</a></li>
<li><a class="reference internal" href="#list-slices">List slices</a></li>
<li><a class="reference internal" href="#list-methods">List methods</a></li>
<li><a class="reference internal" href="#map-filter-and-reduce">Map, filter and reduce</a></li>
<li><a class="reference internal" href="#deleting-elements">Deleting elements</a></li>
<li><a class="reference internal" href="#lists-and-strings">Lists and strings</a></li>
<li><a class="reference internal" href="#objects-and-values">Objects and values</a></li>
<li><a class="reference internal" href="#aliasing">Aliasing</a></li>
<li><a class="reference internal" href="#list-arguments">List arguments</a></li>
<li><a class="reference internal" href="#id28">Debugging</a></li>
<li><a class="reference internal" href="#id29">Glossary</a></li>
<li><a class="reference internal" href="#id30">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dictionaries">Dictionaries</a><ul>
<li><a class="reference internal" href="#a-dictionary-is-a-mapping">A dictionary is a mapping</a></li>
<li><a class="reference internal" href="#dictionary-as-a-collection-of-counters">Dictionary as a collection of counters</a></li>
<li><a class="reference internal" href="#looping-and-dictionaries">Looping and dictionaries</a></li>
<li><a class="reference internal" href="#reverse-lookup">Reverse lookup</a></li>
<li><a class="reference internal" href="#dictionaries-and-lists">Dictionaries and lists</a></li>
<li><a class="reference internal" href="#memos">Memos</a></li>
<li><a class="reference internal" href="#global-variables">Global variables</a></li>
<li><a class="reference internal" href="#id31">Debugging</a></li>
<li><a class="reference internal" href="#id32">Glossary</a></li>
<li><a class="reference internal" href="#id33">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tuples">Tuples</a><ul>
<li><a class="reference internal" href="#tuples-are-immutable">Tuples are immutable</a></li>
<li><a class="reference internal" href="#tuple-assignment">Tuple assignment</a></li>
<li><a class="reference internal" href="#tuples-as-return-values">Tuples as return values</a></li>
<li><a class="reference internal" href="#variable-length-argument-tuples">Variable-length argument tuples</a></li>
<li><a class="reference internal" href="#lists-and-tuples">Lists and tuples</a></li>
<li><a class="reference internal" href="#dictionaries-and-tuples">Dictionaries and tuples</a></li>
<li><a class="reference internal" href="#sequences-of-sequences">Sequences of sequences</a></li>
<li><a class="reference internal" href="#id34">Debugging</a></li>
<li><a class="reference internal" href="#id35">Glossary</a></li>
<li><a class="reference internal" href="#id36">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#case-study-data-structure-selection">Case study: data structure selection</a><ul>
<li><a class="reference internal" href="#word-frequency-analysis">Word frequency analysis</a></li>
<li><a class="reference internal" href="#random-numbers">Random numbers</a></li>
<li><a class="reference internal" href="#word-histogram">Word histogram</a></li>
<li><a class="reference internal" href="#most-common-words">Most common words</a></li>
<li><a class="reference internal" href="#optional-parameters">Optional parameters</a></li>
<li><a class="reference internal" href="#dictionary-subtraction">Dictionary subtraction</a></li>
<li><a class="reference internal" href="#random-words">Random words</a></li>
<li><a class="reference internal" href="#markov-analysis">Markov analysis</a></li>
<li><a class="reference internal" href="#data-structures">Data structures</a></li>
<li><a class="reference internal" href="#id37">Debugging</a></li>
<li><a class="reference internal" href="#id38">Glossary</a></li>
<li><a class="reference internal" href="#id39">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#files">Files</a><ul>
<li><a class="reference internal" href="#persistence">Persistence</a></li>
<li><a class="reference internal" href="#reading-and-writing">Reading and writing</a></li>
<li><a class="reference internal" href="#format-operator">Format operator</a></li>
<li><a class="reference internal" href="#filenames-and-paths">Filenames and paths</a></li>
<li><a class="reference internal" href="#catching-exceptions">Catching exceptions</a></li>
<li><a class="reference internal" href="#databases">Databases</a></li>
<li><a class="reference internal" href="#pickling">Pickling</a></li>
<li><a class="reference internal" href="#pipes">Pipes</a></li>
<li><a class="reference internal" href="#writing-modules">Writing modules</a></li>
<li><a class="reference internal" href="#id41">Debugging</a></li>
<li><a class="reference internal" href="#id42">Glossary</a></li>
<li><a class="reference internal" href="#id43">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#classes-and-objects">Classes and objects</a><ul>
<li><a class="reference internal" href="#programmer-defined-types">Programmer-defined types</a></li>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
<li><a class="reference internal" href="#rectangles">Rectangles</a></li>
<li><a class="reference internal" href="#instances-as-return-values">Instances as return values</a></li>
<li><a class="reference internal" href="#objects-are-mutable">Objects are mutable</a></li>
<li><a class="reference internal" href="#copying">Copying</a></li>
<li><a class="reference internal" href="#id44">Debugging</a></li>
<li><a class="reference internal" href="#id45">Glossary</a></li>
<li><a class="reference internal" href="#id46">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#classes-and-functions">Classes and functions</a><ul>
<li><a class="reference internal" href="#time">Time</a></li>
<li><a class="reference internal" href="#pure-functions">Pure functions</a></li>
<li><a class="reference internal" href="#modifiers">Modifiers</a></li>
<li><a class="reference internal" href="#prototyping-versus-planning">Prototyping versus planning</a></li>
<li><a class="reference internal" href="#id47">Debugging</a></li>
<li><a class="reference internal" href="#id48">Glossary</a></li>
<li><a class="reference internal" href="#id49">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#classes-and-methods">Classes and methods</a><ul>
<li><a class="reference internal" href="#object-oriented-features">Object-oriented features</a></li>
<li><a class="reference internal" href="#printing-objects">Printing objects</a></li>
<li><a class="reference internal" href="#another-example">Another example</a></li>
<li><a class="reference internal" href="#a-more-complicated-example">A more complicated example</a></li>
<li><a class="reference internal" href="#the-init-method">The init method</a></li>
<li><a class="reference internal" href="#the-str-method">The __str__ method</a></li>
<li><a class="reference internal" href="#operator-overloading">Operator overloading</a></li>
<li><a class="reference internal" href="#type-based-dispatch">Type-based dispatch</a></li>
<li><a class="reference internal" href="#polymorphism">Polymorphism</a></li>
<li><a class="reference internal" href="#id50">Debugging</a></li>
<li><a class="reference internal" href="#interface-and-implementation">Interface and implementation</a></li>
<li><a class="reference internal" href="#id51">Glossary</a></li>
<li><a class="reference internal" href="#id52">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inheritance">Inheritance</a><ul>
<li><a class="reference internal" href="#card-objects">Card objects</a></li>
<li><a class="reference internal" href="#class-attributes">Class attributes</a></li>
<li><a class="reference internal" href="#comparing-cards">Comparing cards</a></li>
<li><a class="reference internal" href="#decks">Decks</a></li>
<li><a class="reference internal" href="#printing-the-deck">Printing the deck</a></li>
<li><a class="reference internal" href="#add-remove-shuffle-and-sort">Add, remove, shuffle and sort</a></li>
<li><a class="reference internal" href="#id53">Inheritance</a></li>
<li><a class="reference internal" href="#class-diagrams">Class diagrams</a></li>
<li><a class="reference internal" href="#id54">Debugging</a></li>
<li><a class="reference internal" href="#data-encapsulation">Data encapsulation</a></li>
<li><a class="reference internal" href="#id55">Glossary</a></li>
<li><a class="reference internal" href="#id56">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-goodies">The Goodies</a><ul>
<li><a class="reference internal" href="#conditional-expressions">Conditional expressions</a></li>
<li><a class="reference internal" href="#list-comprehensions">List comprehensions</a></li>
<li><a class="reference internal" href="#generator-expressions">Generator expressions</a></li>
<li><a class="reference internal" href="#any-and-all">any and all</a></li>
<li><a class="reference internal" href="#sets">Sets</a></li>
<li><a class="reference internal" href="#counters">Counters</a></li>
<li><a class="reference internal" href="#defaultdict">defaultdict</a></li>
<li><a class="reference internal" href="#named-tuples">Named tuples</a></li>
<li><a class="reference internal" href="#gathering-keyword-args">Gathering keyword args</a></li>
<li><a class="reference internal" href="#id57">Glossary</a></li>
<li><a class="reference internal" href="#id58">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id59">Debugging</a><ul>
<li><a class="reference internal" href="#syntax-errors">Syntax errors</a><ul>
<li><a class="reference internal" href="#i-keep-making-changes-and-it-makes-no-difference">I keep making changes and it makes no difference.</a></li>
</ul>
</li>
<li><a class="reference internal" href="#runtime-errors">Runtime errors</a><ul>
<li><a class="reference internal" href="#my-program-does-absolutely-nothing">My program does absolutely nothing.</a></li>
<li><a class="reference internal" href="#my-program-hangs">My program hangs.</a><ul>
<li><a class="reference internal" href="#infinite-loop">Infinite Loop</a></li>
<li><a class="reference internal" href="#id60">Infinite Recursion</a></li>
<li><a class="reference internal" href="#id61">Flow of Execution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#when-i-run-the-program-i-get-an-exception">When I run the program I get an exception.</a></li>
<li><a class="reference internal" href="#i-added-so-many-print-statements-i-get-inundated-with-output">I added so many print statements I get inundated with output.</a></li>
</ul>
</li>
<li><a class="reference internal" href="#semantic-errors">Semantic errors</a><ul>
<li><a class="reference internal" href="#my-program-doesnt-work">My program doesn’t work.</a></li>
<li><a class="reference internal" href="#ive-got-a-big-hairy-expression-and-it-doesnt-do-what-i-expect">I’ve got a big hairy expression and it doesn’t do what I expect.</a></li>
<li><a class="reference internal" href="#ive-got-a-function-that-doesnt-return-what-i-expect">I’ve got a function that doesn’t return what I expect.</a></li>
<li><a class="reference internal" href="#im-really-really-stuck-and-i-need-help">I’m really, really stuck and I need help.</a></li>
<li><a class="reference internal" href="#no-i-really-need-help">No, I really need help.</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#analysis-of-algorithms">Analysis of Algorithms</a><ul>
<li><a class="reference internal" href="#order-of-growth">Order of growth</a></li>
<li><a class="reference internal" href="#analysis-of-basic-python-operations">Analysis of basic Python operations</a></li>
<li><a class="reference internal" href="#analysis-of-search-algorithms">Analysis of search algorithms</a></li>
<li><a class="reference internal" href="#hashtables">Hashtables</a></li>
<li><a class="reference internal" href="#id63">Glossary</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/book.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Allen B. Downey.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/book.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>